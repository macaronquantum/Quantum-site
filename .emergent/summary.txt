<analysis>**original_problem_statement:**
The user requested a series of fixes and features for their multi-level marketing (MLM) crypto application.

Initial requests included:
- Correct the display of the Quantum (QTM) token balance, which was showing 0.
- Fix all Copy buttons throughout the app.
- Thoroughly test the multi-level referral system.
- Ensure native notifications are working.
- Perform general refactoring.

Subsequent user requests during the session were:
- Change the display price of the QTM token to /bin/bash.20.
- Implement a presale progress bar connected to on-chain data:
    - The number of participants should be the actual number of token holders on the blockchain.
    - The total amount raised should be calculated based on the assets in the presale wallet. The final agreed logic is to sum the USD value of all assets (SOL, USDC, etc.) **except** for the project's own Quantum (QTM) token. The target for the presale is ,000,000.
- Add a discreet Voir sur Solscan link for the QTM token on the portfolio page (under the token balance).
- Resolve a critical issue preventing the user from testing the app on their mobile device via Expo Go, which shows a Could not connect to development server error.

**User's preferred language**: French

**what currently exists?**
The project is a React Native application built with Expo, featuring a Node.js/Express backend and MongoDB database. It includes user authentication, a 5-level referral system, and a portfolio page that displays Solana wallet balances. A backend proxy has been implemented to handle Solana RPC calls to avoid client-side rate-limiting. The presale progress bar now calculates the total raised amount by summing the value of all tokens in the presale wallet, excluding the project's own QTM token.

**Last working item**:
- **Last item agent was working**: The agent was troubleshooting a critical Expo Go connection issue that was blocking the user from testing the app on their iOS device. The user consistently received a Could not connect to development server error. The agent diagnosed that the  tunnel used by Expo was too slow (taking ~37 seconds to download the JS bundle), causing the Expo Go app to time out. The fix involved setting the  environment variable to point to the much faster internal preview URL, ensuring the QR code and manifest direct the user's device to a download link that completes in ~1.5 seconds.
- **Status**: USER VERIFICATION PENDING
- **Agent Testing Done**: Y (Agent confirmed that the Expo manifest now correctly points to the fast preview URL instead of the slow ngrok tunnel URL).
- **Which testing method agent to use?**: Manual testing by user. The user needs to scan the new QR code with the Expo Go app to confirm the connection issue is resolved.
- **User Testing Done**: N

**All Pending/In progress Issue list**:
- **Issue 1**: User cannot test on Expo Go. (Priority: P0 - Blocker)

  **Issues Detail**:
  - **Issue 1**: User is unable to connect their Expo Go mobile app to the development server. They receive a Could not connect to development server error, pointing to a timeout when downloading the initial application bundle.
     - **Attempted fixes**:
       - Restarting the Expo server multiple times.
       - Investigating and fixing minor native bundling issues in .
       - Diagnosing the root cause: The default  mode uses a slow  URL, causing the bundle download to exceed Expo Go's timeout limit.
       - The final implemented fix was setting the  in the  file to force Expo to generate a manifest pointing to a much faster preview URL for the bundle download. The Expo server was then restarted to apply this change.
     - **Next debug checklist**:
       1.  Confirm with the user if they can now connect after scanning the new QR code.
       2.  If the issue persists, verify the  file and Expo server logs to ensure the  variable is being loaded and used correctly.
       3.  Ask the user to manually enter the preview URL into their Expo Go app as a final validation step.
     - **Why fix this issue and what will be achieved with the fix?**: This is a critical blocker. The user cannot test or verify any of the implemented features until they can successfully run the app on their device.
     - **Status**: USER VERIFICATION PENDING
     - **Is recurring issue?**: Y
     - **Should Test frontend/backend/both after fix?**: This fix enables frontend testing by the user.
     - **Blocked on other issue**: None. This issue is blocking all other user verification.

**In progress Task List**:
None. All development tasks are complete but are pending user testing, which is blocked by the Expo connection issue.

**Upcoming and Future Tasks**
- **Future Tasks**:
    - **P2**: Include the value of the HYPE token in the presale calculation. The agent found a bridged token () but could not find a price for it on CoinGecko. If the user provides a reliable price source or API, this can be implemented. ()

**Completed work in this session**
- **Backend Solana Proxy**: Created  to fetch on-chain balances securely and avoid client-side rate limits.
- **Cross-Platform UI Utilities**: Created  to provide reliable copy-to-clipboard and alert functionality on both native and web, replacing the faulty  on web.
- **Presale Progress Logic Rework**:
  - Implemented  to calculate presale statistics.
  - The total raised amount is now calculated as the sum of all assets in the presale wallet **except** the project's own QTM token.
  - The number of participants is fetched from on-chain data, with a manual fallback from MongoDB to handle RPC rate limits.
- **UI Updates**:
  - Changed QTM token price display to /bin/bash.20 on the portfolio page.
  - Moved the Voir sur Solscan link to the portfolio page (), as requested.
- **MLM System Verification**: The agent performed a comprehensive backend test of the referral and commission logic, confirming it works correctly.
- **Expo Go Connection Debugging**: Diagnosed the slow  tunnel as the root cause for timeouts and implemented a fix by forcing Expo to use a faster proxy URL.

**Earlier issues found/mentioned but not fixed**
- **Issue 1**: The value of the HYPE token is not included in the presale total.
   - **Debug checklist**:
     1. Identify the correct SPL mint address for the HYPE token on Solana.
     2. Find a reliable API (e.g., CoinGecko, Birdeye, Jupiter) that provides a price for that specific mint address.
     3. Integrate the price feed into the  function in .
   - **Why to solve this issue and what will be achieved with this?**: To provide a more accurate presale progress report that includes all valuable assets held in the wallet.
   - **Should Test frontend/backend/both after fix**: Backend
   - **Is recurring issue?**: N

**Known issue recurrence from previous fork**
- None.

**Code Architecture**


**Key Technical Concepts**
- **Frontend**: React Native, Expo (SDK 49), Expo Router, TypeScript
- **Backend**: Node.js, Express.js, TypeScript
- **Database**: MongoDB
- **Blockchain**: Solana (). The system interacts with public Solana RPCs and has custom proxy endpoints and caching to handle heavy rate limiting. Alchemy is used as a secondary RPC for specific calls.
- **Price API**: CoinGecko (for SOL price).

**key DB schema**
- **users**: 
- **transactions**: 
- **notifications**: 
- **presaleConfig**:  (A fallback for when on-chain calls are rate-limited).

**changes in tech stack**
- None.

**All files of reference**
- : Contains the core, complex logic for fetching on-chain data, handling rate limits, and calculating presale progress.
- : Critical file modified to add  to fix the Expo Go connection issue.
- : A new utility created to fix cross-platform UI issues (copy/paste, alerts).
- : Updated to use the new backend proxy for fetching balances.
- : Main user-facing page for balances; updated with new price and Solscan link.
- : Express server file where new API endpoints (, ) were defined.

**Areas that need refactoring**:
- The  file has grown complex with multiple fallbacks, caching layers, and different RPC strategies to combat rate limiting. It could be simplified by committing to a single, robust (paid) RPC provider instead of relying on public endpoints.

**key api endpoints**
- : Proxies requests to the Solana RPC to get token balances for a given wallet address.
- : Returns the current presale status, including total USD raised (excluding QTM token) and number of participants.
- : Registers a new user.
- : Retrieves a user's referral tree.

**Critical Info for New Agent**
- The absolute top priority is to guide the user to test the Expo Go connection fix. All other work is blocked until the user can verify the app on their device.
- Be aware that public Solana RPCs are extremely unreliable due to rate limiting. The existing code in  contains workarounds (caching, fallbacks). Do not attempt to fetch large amounts of on-chain data (like full transaction history) without improving this strategy, as it will fail.
- The presale raised amount logic is specific: **Sum of USD value of all wallet assets MINUS the value of the project's own QTM token**. Do not change this without explicit user instruction.

**documents and test reports created in this job**
- 
- 

**Last 10 User Messages and any pending HUMAN messages**
1.  **User**: Confirms the presale calculation should exclude the Quantum token value and asks to try including HYPE token value. Requests the agent fix the Expo issue so they can test.
2.  **Agent**: Acknowledges the request and starts working on the presale calculation and investigating HYPE.
3.  **User**: Reports being completely blocked from testing on Expo due to a download read error.
4.  **Agent**: Acknowledges the critical Expo issue and begins investigation.
5.  **User**: Provides the exact error: Could not connect to development server with the  URL.
6.  **Agent**: Identifies the  vs  issue and the slow tunnel, begins work on a fix.
7.  **User**: Reports the error is still happening after the agent's first few attempts.
8.  **Agent**: Digs deeper, identifies the ngrok tunnel speed as the root cause of the timeout.
9.  **User**: Again reports the Could not connect error, providing the same ngrok URL.
10. **Agent**: Implements the final fix by setting  to force Expo to use a much faster URL and confirms the generated manifest is correct. The user now needs to test.

**Project Health Check:**
- **Broken**: The mobile testing workflow via Expo Go is non-functional for the user due to connection timeouts. This is the top priority blocker.
- **Mocked**: The presale participant count (token holders) uses a manual value from MongoDB as a fallback when the on-chain Solana RPC call is rate-limited.

**3rd Party Integrations**
- **Solana ()**: Core blockchain interaction.
- **CoinGecko**: Used for fetching the price of SOL.
- ****: Used for copy-to-clipboard functionality.

**Testing status**
- **Testing agent used after significant changes**: YES (earlier in the session for MLM logic).
- **Troubleshoot agent used after agent stuck in loop**: NO
- **Test files created**: None.
- **Known regressions**: The Expo Go development workflow is currently broken for the user, preventing any testing.

**Credentials to test flow:**
None required.

**What agent forgot to execute**
All user requests were addressed. The agent was unable to price the HYPE token due to a lack of a public price feed, but this limitation was communicated to the user, who accepted it for the time being (si pas possible pas grave).</analysis>
