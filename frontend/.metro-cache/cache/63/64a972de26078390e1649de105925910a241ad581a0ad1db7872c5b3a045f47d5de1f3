{"dependencies":[{"name":"./rx","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":11,"index":25},"end":{"line":3,"column":26,"index":40}}],"key":"n0JlicJxR8rTlzZbH8aqXa14A/I=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  const rx = require(_dependencyMap[0], \"./rx\");\n  module.exports = redactor;\n  function redactor({\n    secret,\n    serialize,\n    wcLen,\n    strict,\n    isCensorFct,\n    censorFctTakesPath\n  }, state) {\n    /* eslint-disable-next-line */\n    const redact = Function('o', `\n    if (typeof o !== 'object' || o == null) {\n      ${strictImpl(strict, serialize)}\n    }\n    const { censor, secret } = this\n    const originalSecret = {}\n    const secretKeys = Object.keys(secret)\n    for (var i = 0; i < secretKeys.length; i++) {\n      originalSecret[secretKeys[i]] = secret[secretKeys[i]]\n    }\n\n    ${redactTmpl(secret, isCensorFct, censorFctTakesPath)}\n    this.compileRestore()\n    ${dynamicRedactTmpl(wcLen > 0, isCensorFct, censorFctTakesPath)}\n    this.secret = originalSecret\n    ${resultTmpl(serialize)}\n  `).bind(state);\n    redact.state = state;\n    if (serialize === false) {\n      redact.restore = o => state.restore(o);\n    }\n    return redact;\n  }\n  function redactTmpl(secret, isCensorFct, censorFctTakesPath) {\n    return Object.keys(secret).map(path => {\n      const {\n        escPath,\n        leadingBracket,\n        path: arrPath\n      } = secret[path];\n      const skip = leadingBracket ? 1 : 0;\n      const delim = leadingBracket ? '' : '.';\n      const hops = [];\n      var match;\n      while ((match = rx.exec(path)) !== null) {\n        const [, ix] = match;\n        const {\n          index,\n          input\n        } = match;\n        if (index > skip) hops.push(input.substring(0, index - (ix ? 0 : 1)));\n      }\n      var existence = hops.map(p => `o${delim}${p}`).join(' && ');\n      if (existence.length === 0) existence += `o${delim}${path} != null`;else existence += ` && o${delim}${path} != null`;\n      const circularDetection = `\n      switch (true) {\n        ${hops.reverse().map(p => `\n          case o${delim}${p} === censor:\n            secret[${escPath}].circle = ${JSON.stringify(p)}\n            break\n        `).join('\\n')}\n      }\n    `;\n      const censorArgs = censorFctTakesPath ? `val, ${JSON.stringify(arrPath)}` : `val`;\n      return `\n      if (${existence}) {\n        const val = o${delim}${path}\n        if (val === censor) {\n          secret[${escPath}].precensored = true\n        } else {\n          secret[${escPath}].val = val\n          o${delim}${path} = ${isCensorFct ? `censor(${censorArgs})` : 'censor'}\n          ${circularDetection}\n        }\n      }\n    `;\n    }).join('\\n');\n  }\n  function dynamicRedactTmpl(hasWildcards, isCensorFct, censorFctTakesPath) {\n    return hasWildcards === true ? `\n    {\n      const { wildcards, wcLen, groupRedact, nestedRedact } = this\n      for (var i = 0; i < wcLen; i++) {\n        const { before, beforeStr, after, nested } = wildcards[i]\n        if (nested === true) {\n          secret[beforeStr] = secret[beforeStr] || []\n          nestedRedact(secret[beforeStr], o, before, after, censor, ${isCensorFct}, ${censorFctTakesPath})\n        } else secret[beforeStr] = groupRedact(o, before, censor, ${isCensorFct}, ${censorFctTakesPath})\n      }\n    }\n  ` : '';\n  }\n  function resultTmpl(serialize) {\n    return serialize === false ? `return o` : `\n    var s = this.serialize(o)\n    this.restore(o)\n    return s\n  `;\n  }\n  function strictImpl(strict, serialize) {\n    return strict === true ? `throw Error('fast-redact: primitives cannot be redacted')` : serialize === false ? `return o` : `return this.serialize(o)`;\n  }\n});","lineCount":107,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,8,3,6,"rx"],[4,10,3,8],[4,13,3,11,"require"],[4,20,3,18],[4,21,3,18,"_dependencyMap"],[4,35,3,18],[4,46,3,25],[4,47,3,26],[5,2,5,0,"module"],[5,8,5,6],[5,9,5,7,"exports"],[5,16,5,14],[5,19,5,17,"redactor"],[5,27,5,25],[6,2,7,0],[6,11,7,9,"redactor"],[6,19,7,17,"redactor"],[6,20,7,19],[7,4,7,21,"secret"],[7,10,7,27],[8,4,7,29,"serialize"],[8,13,7,38],[9,4,7,40,"wcLen"],[9,9,7,45],[10,4,7,47,"strict"],[10,10,7,53],[11,4,7,55,"isCensorFct"],[11,15,7,66],[12,4,7,68,"censorFctTakesPath"],[13,2,7,87],[13,3,7,88],[13,5,7,90,"state"],[13,10,7,95],[13,12,7,97],[14,4,8,2],[15,4,9,2],[15,10,9,8,"redact"],[15,16,9,14],[15,19,9,17,"Function"],[15,27,9,25],[15,28,9,26],[15,31,9,29],[15,33,9,31],[16,0,10,0],[17,0,11,0],[17,8,11,8,"strictImpl"],[17,18,11,18],[17,19,11,19,"strict"],[17,25,11,25],[17,27,11,27,"serialize"],[17,36,11,36],[17,37,11,37],[18,0,12,0],[19,0,13,0],[20,0,14,0],[21,0,15,0],[22,0,16,0],[23,0,17,0],[24,0,18,0],[25,0,19,0],[26,0,20,0],[26,6,20,6,"redactTmpl"],[26,16,20,16],[26,17,20,17,"secret"],[26,23,20,23],[26,25,20,25,"isCensorFct"],[26,36,20,36],[26,38,20,38,"censorFctTakesPath"],[26,56,20,56],[26,57,20,57],[27,0,21,0],[28,0,22,0],[28,6,22,6,"dynamicRedactTmpl"],[28,23,22,23],[28,24,22,24,"wcLen"],[28,29,22,29],[28,32,22,32],[28,33,22,33],[28,35,22,35,"isCensorFct"],[28,46,22,46],[28,48,22,48,"censorFctTakesPath"],[28,66,22,66],[28,67,22,67],[29,0,23,0],[30,0,24,0],[30,6,24,6,"resultTmpl"],[30,16,24,16],[30,17,24,17,"serialize"],[30,26,24,26],[30,27,24,27],[31,0,25,0],[31,3,25,3],[31,4,25,4],[31,5,25,5,"bind"],[31,9,25,9],[31,10,25,10,"state"],[31,15,25,15],[31,16,25,16],[32,4,27,2,"redact"],[32,10,27,8],[32,11,27,9,"state"],[32,16,27,14],[32,19,27,17,"state"],[32,24,27,22],[33,4,29,2],[33,8,29,6,"serialize"],[33,17,29,15],[33,22,29,20],[33,27,29,25],[33,29,29,27],[34,6,30,4,"redact"],[34,12,30,10],[34,13,30,11,"restore"],[34,20,30,18],[34,23,30,22,"o"],[34,24,30,23],[34,28,30,28,"state"],[34,33,30,33],[34,34,30,34,"restore"],[34,41,30,41],[34,42,30,42,"o"],[34,43,30,43],[34,44,30,44],[35,4,31,2],[36,4,33,2],[36,11,33,9,"redact"],[36,17,33,15],[37,2,34,0],[38,2,36,0],[38,11,36,9,"redactTmpl"],[38,21,36,19,"redactTmpl"],[38,22,36,21,"secret"],[38,28,36,27],[38,30,36,29,"isCensorFct"],[38,41,36,40],[38,43,36,42,"censorFctTakesPath"],[38,61,36,60],[38,63,36,62],[39,4,37,2],[39,11,37,9,"Object"],[39,17,37,15],[39,18,37,16,"keys"],[39,22,37,20],[39,23,37,21,"secret"],[39,29,37,27],[39,30,37,28],[39,31,37,29,"map"],[39,34,37,32],[39,35,37,34,"path"],[39,39,37,38],[39,43,37,43],[40,6,38,4],[40,12,38,10],[41,8,38,12,"escPath"],[41,15,38,19],[42,8,38,21,"leadingBracket"],[42,22,38,35],[43,8,38,37,"path"],[43,12,38,41],[43,14,38,43,"arrPath"],[44,6,38,51],[44,7,38,52],[44,10,38,55,"secret"],[44,16,38,61],[44,17,38,62,"path"],[44,21,38,66],[44,22,38,67],[45,6,39,4],[45,12,39,10,"skip"],[45,16,39,14],[45,19,39,17,"leadingBracket"],[45,33,39,31],[45,36,39,34],[45,37,39,35],[45,40,39,38],[45,41,39,39],[46,6,40,4],[46,12,40,10,"delim"],[46,17,40,15],[46,20,40,18,"leadingBracket"],[46,34,40,32],[46,37,40,35],[46,39,40,37],[46,42,40,40],[46,45,40,43],[47,6,41,4],[47,12,41,10,"hops"],[47,16,41,14],[47,19,41,17],[47,21,41,19],[48,6,42,4],[48,10,42,8,"match"],[48,15,42,13],[49,6,43,4],[49,13,43,11],[49,14,43,12,"match"],[49,19,43,17],[49,22,43,20,"rx"],[49,24,43,22],[49,25,43,23,"exec"],[49,29,43,27],[49,30,43,28,"path"],[49,34,43,32],[49,35,43,33],[49,41,43,39],[49,45,43,43],[49,47,43,45],[50,8,44,6],[50,14,44,12],[50,17,44,16,"ix"],[50,19,44,18],[50,20,44,20],[50,23,44,23,"match"],[50,28,44,28],[51,8,45,6],[51,14,45,12],[52,10,45,14,"index"],[52,15,45,19],[53,10,45,21,"input"],[54,8,45,27],[54,9,45,28],[54,12,45,31,"match"],[54,17,45,36],[55,8,46,6],[55,12,46,10,"index"],[55,17,46,15],[55,20,46,18,"skip"],[55,24,46,22],[55,26,46,24,"hops"],[55,30,46,28],[55,31,46,29,"push"],[55,35,46,33],[55,36,46,34,"input"],[55,41,46,39],[55,42,46,40,"substring"],[55,51,46,49],[55,52,46,50],[55,53,46,51],[55,55,46,53,"index"],[55,60,46,58],[55,64,46,62,"ix"],[55,66,46,64],[55,69,46,67],[55,70,46,68],[55,73,46,71],[55,74,46,72],[55,75,46,73],[55,76,46,74],[55,77,46,75],[56,6,47,4],[57,6,48,4],[57,10,48,8,"existence"],[57,19,48,17],[57,22,48,20,"hops"],[57,26,48,24],[57,27,48,25,"map"],[57,30,48,28],[57,31,48,30,"p"],[57,32,48,31],[57,36,48,36],[57,40,48,40,"delim"],[57,45,48,45],[57,48,48,48,"p"],[57,49,48,49],[57,51,48,51],[57,52,48,52],[57,53,48,53,"join"],[57,57,48,57],[57,58,48,58],[57,64,48,64],[57,65,48,65],[58,6,49,4],[58,10,49,8,"existence"],[58,19,49,17],[58,20,49,18,"length"],[58,26,49,24],[58,31,49,29],[58,32,49,30],[58,34,49,32,"existence"],[58,43,49,41],[58,47,49,45],[58,51,49,49,"delim"],[58,56,49,54],[58,59,49,57,"path"],[58,63,49,61],[58,73,49,71],[58,79,50,9,"existence"],[58,88,50,18],[58,92,50,22],[58,100,50,30,"delim"],[58,105,50,35],[58,108,50,38,"path"],[58,112,50,42],[58,122,50,52],[59,6,52,4],[59,12,52,10,"circularDetection"],[59,29,52,27],[59,32,52,30],[60,0,53,0],[61,0,54,0],[61,10,54,10,"hops"],[61,14,54,14],[61,15,54,15,"reverse"],[61,22,54,22],[61,23,54,23],[61,24,54,24],[61,25,54,25,"map"],[61,28,54,28],[61,29,54,30,"p"],[61,30,54,31],[61,34,54,36],[62,0,55,0],[62,18,55,18,"delim"],[62,23,55,23],[62,26,55,26,"p"],[62,27,55,27],[63,0,56,0],[63,21,56,21,"escPath"],[63,28,56,28],[63,42,56,42,"JSON"],[63,46,56,46],[63,47,56,47,"stringify"],[63,56,56,56],[63,57,56,57,"p"],[63,58,56,58],[63,59,56,59],[64,0,57,0],[65,0,58,0],[65,9,58,9],[65,10,58,10],[65,11,58,11,"join"],[65,15,58,15],[65,16,58,16],[65,20,58,20],[65,21,58,21],[66,0,59,0],[67,0,60,0],[67,5,60,5],[68,6,62,4],[68,12,62,10,"censorArgs"],[68,22,62,20],[68,25,62,23,"censorFctTakesPath"],[68,43,62,41],[68,46,63,8],[68,54,63,16,"JSON"],[68,58,63,20],[68,59,63,21,"stringify"],[68,68,63,30],[68,69,63,31,"arrPath"],[68,76,63,38],[68,77,63,39],[68,79,63,41],[68,82,64,8],[68,87,64,13],[69,6,66,4],[69,13,66,11],[70,0,67,0],[70,12,67,12,"existence"],[70,21,67,21],[71,0,68,0],[71,23,68,23,"delim"],[71,28,68,28],[71,31,68,31,"path"],[71,35,68,35],[72,0,69,0],[73,0,70,0],[73,19,70,19,"escPath"],[73,26,70,26],[74,0,71,0],[75,0,72,0],[75,19,72,19,"escPath"],[75,26,72,26],[76,0,73,0],[76,13,73,13,"delim"],[76,18,73,18],[76,21,73,21,"path"],[76,25,73,25],[76,31,73,31,"isCensorFct"],[76,42,73,42],[76,45,73,45],[76,55,73,55,"censorArgs"],[76,65,73,65],[76,68,73,68],[76,71,73,71],[76,79,73,79],[77,0,74,0],[77,12,74,12,"circularDetection"],[77,29,74,29],[78,0,75,0],[79,0,76,0],[80,0,77,0],[80,5,77,5],[81,4,78,2],[81,5,78,3],[81,6,78,4],[81,7,78,5,"join"],[81,11,78,9],[81,12,78,10],[81,16,78,14],[81,17,78,15],[82,2,79,0],[83,2,81,0],[83,11,81,9,"dynamicRedactTmpl"],[83,28,81,26,"dynamicRedactTmpl"],[83,29,81,28,"hasWildcards"],[83,41,81,40],[83,43,81,42,"isCensorFct"],[83,54,81,53],[83,56,81,55,"censorFctTakesPath"],[83,74,81,73],[83,76,81,75],[84,4,82,2],[84,11,82,9,"hasWildcards"],[84,23,82,21],[84,28,82,26],[84,32,82,30],[84,35,82,33],[85,0,83,0],[86,0,84,0],[87,0,85,0],[88,0,86,0],[89,0,87,0],[90,0,88,0],[91,0,89,0],[91,70,89,70,"isCensorFct"],[91,81,89,81],[91,86,89,86,"censorFctTakesPath"],[91,104,89,104],[92,0,90,0],[92,68,90,68,"isCensorFct"],[92,79,90,79],[92,84,90,84,"censorFctTakesPath"],[92,102,90,102],[93,0,91,0],[94,0,92,0],[95,0,93,0],[95,3,93,3],[95,6,93,6],[95,8,93,8],[96,2,94,0],[97,2,96,0],[97,11,96,9,"resultTmpl"],[97,21,96,19,"resultTmpl"],[97,22,96,21,"serialize"],[97,31,96,30],[97,33,96,32],[98,4,97,2],[98,11,97,9,"serialize"],[98,20,97,18],[98,25,97,23],[98,30,97,28],[98,33,97,31],[98,43,97,41],[98,46,97,44],[99,0,98,0],[100,0,99,0],[101,0,100,0],[102,0,101,0],[102,3,101,3],[103,2,102,0],[104,2,104,0],[104,11,104,9,"strictImpl"],[104,21,104,19,"strictImpl"],[104,22,104,21,"strict"],[104,28,104,27],[104,30,104,29,"serialize"],[104,39,104,38],[104,41,104,40],[105,4,105,2],[105,11,105,9,"strict"],[105,17,105,15],[105,22,105,20],[105,26,105,24],[105,29,106,6],[105,88,106,65],[105,91,107,6,"serialize"],[105,100,107,15],[105,105,107,20],[105,110,107,25],[105,113,107,28],[105,123,107,38],[105,126,107,41],[105,152,107,67],[106,2,108,0],[107,0,108,1],[107,3]],"functionMap":{"names":["<global>","redactor","redact.restore","redactTmpl","Object.keys.map$argument_0","hops.map$argument_0","hops.reverse.map$argument_0","dynamicRedactTmpl","resultTmpl","strictImpl"],"mappings":"AAA;ACM;qBCuB,uBD;CDI;AGE;iCCC;6BCW,sBD;6BEM;SFI;GDoB;CHC;AOE;CPa;AQE;CRM;ASE;CTI"},"hasCjsExports":true},"type":"js/module"}]}