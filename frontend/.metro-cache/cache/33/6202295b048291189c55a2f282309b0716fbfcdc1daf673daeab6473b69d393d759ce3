{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":74,"index":74}}],"key":"2pE/btc+6/9ceuRiPNwUYrtm86Y=","exportNames":["*"],"imports":1}},{"name":"../promise/withTimeout.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":75},"end":{"line":2,"column":57,"index":132}}],"key":"R0pXVlZ6xmiOVM86DCOsnzL2IWE=","exportNames":["*"],"imports":1}},{"name":"../stringify.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":133},"end":{"line":3,"column":44,"index":177}}],"key":"2zgFGs9gb8CDQZBLm+ivBNJ2Ky0=","exportNames":["*"],"imports":1}},{"name":"./id.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":178},"end":{"line":4,"column":34,"index":212}}],"key":"XzJUTA7q3576wrp3vEEP4WANxL4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getHttpRpcClient = getHttpRpcClient;\n  var _errorsRequestJs = require(_dependencyMap[0], \"../../errors/request.js\");\n  var _promiseWithTimeoutJs = require(_dependencyMap[1], \"../promise/withTimeout.js\");\n  var _stringifyJs = require(_dependencyMap[2], \"../stringify.js\");\n  var _idJs = require(_dependencyMap[3], \"./id.js\");\n  function getHttpRpcClient(url, options = {}) {\n    return {\n      async request(params) {\n        const {\n          body,\n          onRequest = options.onRequest,\n          onResponse = options.onResponse,\n          timeout = options.timeout ?? 10_000\n        } = params;\n        const fetchOptions = Object.assign({}, options.fetchOptions ?? {}, params.fetchOptions ?? {});\n        const {\n          headers,\n          method,\n          signal: signal_\n        } = fetchOptions;\n        try {\n          const response = await (0, _promiseWithTimeoutJs.withTimeout)(async ({\n            signal\n          }) => {\n            const init = Object.assign({}, fetchOptions, {\n              body: Array.isArray(body) ? (0, _stringifyJs.stringify)(body.map(body => Object.assign({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take()\n              }, body))) : (0, _stringifyJs.stringify)(Object.assign({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take()\n              }, body)),\n              headers: Object.assign({\n                'Content-Type': 'application/json'\n              }, headers),\n              method: method || 'POST',\n              signal: signal_ || (timeout > 0 ? signal : null)\n            });\n            const request = new Request(url, init);\n            const args = (await onRequest?.(request, init)) ?? Object.assign({}, init, {\n              url\n            });\n            const response = await fetch(args.url ?? url, args);\n            return response;\n          }, {\n            errorInstance: new _errorsRequestJs.TimeoutError({\n              body,\n              url\n            }),\n            timeout,\n            signal: true\n          });\n          if (onResponse) await onResponse(response);\n          let data;\n          if (response.headers.get('Content-Type')?.startsWith('application/json')) data = await response.json();else {\n            data = await response.text();\n            try {\n              data = JSON.parse(data || '{}');\n            } catch (err) {\n              if (response.ok) throw err;\n              data = {\n                error: data\n              };\n            }\n          }\n          if (!response.ok) {\n            throw new _errorsRequestJs.HttpRequestError({\n              body,\n              details: (0, _stringifyJs.stringify)(data.error) || response.statusText,\n              headers: response.headers,\n              status: response.status,\n              url\n            });\n          }\n          return data;\n        } catch (err) {\n          if (err instanceof _errorsRequestJs.HttpRequestError) throw err;\n          if (err instanceof _errorsRequestJs.TimeoutError) throw err;\n          throw new _errorsRequestJs.HttpRequestError({\n            body,\n            cause: err,\n            url\n          });\n        }\n      }\n    };\n  }\n});","lineCount":94,"map":[[7,2,5,0,"exports"],[7,9,5,0],[7,10,5,0,"getHttpRpcClient"],[7,26,5,0],[7,29,5,0,"getHttpRpcClient"],[7,45,5,0],[8,2,1,0],[8,6,1,0,"_errorsRequestJs"],[8,22,1,0],[8,25,1,0,"require"],[8,32,1,0],[8,33,1,0,"_dependencyMap"],[8,47,1,0],[9,2,2,0],[9,6,2,0,"_promiseWithTimeoutJs"],[9,27,2,0],[9,30,2,0,"require"],[9,37,2,0],[9,38,2,0,"_dependencyMap"],[9,52,2,0],[10,2,3,0],[10,6,3,0,"_stringifyJs"],[10,18,3,0],[10,21,3,0,"require"],[10,28,3,0],[10,29,3,0,"_dependencyMap"],[10,43,3,0],[11,2,4,0],[11,6,4,0,"_idJs"],[11,11,4,0],[11,14,4,0,"require"],[11,21,4,0],[11,22,4,0,"_dependencyMap"],[11,36,4,0],[12,2,5,7],[12,11,5,16,"getHttpRpcClient"],[12,27,5,32,"getHttpRpcClient"],[12,28,5,33,"url"],[12,31,5,36],[12,33,5,38,"options"],[12,40,5,45],[12,43,5,48],[12,44,5,49],[12,45,5,50],[12,47,5,52],[13,4,6,4],[13,11,6,11],[14,6,7,8],[14,12,7,14,"request"],[14,19,7,21,"request"],[14,20,7,22,"params"],[14,26,7,28],[14,28,7,30],[15,8,8,12],[15,14,8,18],[16,10,8,20,"body"],[16,14,8,24],[17,10,8,26,"onRequest"],[17,19,8,35],[17,22,8,38,"options"],[17,29,8,45],[17,30,8,46,"onRequest"],[17,39,8,55],[18,10,8,57,"onResponse"],[18,20,8,67],[18,23,8,70,"options"],[18,30,8,77],[18,31,8,78,"onResponse"],[18,41,8,88],[19,10,8,90,"timeout"],[19,17,8,97],[19,20,8,100,"options"],[19,27,8,107],[19,28,8,108,"timeout"],[19,35,8,115],[19,39,8,119],[20,8,8,127],[20,9,8,128],[20,12,8,131,"params"],[20,18,8,137],[21,8,9,12],[21,14,9,18,"fetchOptions"],[21,26,9,30],[21,29,9,30,"Object"],[21,35,9,30],[21,36,9,30,"assign"],[21,42,9,30],[21,47,10,20,"options"],[21,54,10,27],[21,55,10,28,"fetchOptions"],[21,67,10,40],[21,71,10,44],[21,72,10,45],[21,73,10,46],[21,75,11,20,"params"],[21,81,11,26],[21,82,11,27,"fetchOptions"],[21,94,11,39],[21,98,11,43],[21,99,11,44],[21,100,11,45],[21,101,12,13],[22,8,13,12],[22,14,13,18],[23,10,13,20,"headers"],[23,17,13,27],[24,10,13,29,"method"],[24,16,13,35],[25,10,13,37,"signal"],[25,16,13,43],[25,18,13,45,"signal_"],[26,8,13,53],[26,9,13,54],[26,12,13,57,"fetchOptions"],[26,24,13,69],[27,8,14,12],[27,12,14,16],[28,10,15,16],[28,16,15,22,"response"],[28,24,15,30],[28,27,15,33],[28,33,15,39],[28,37,15,39,"withTimeout"],[28,58,15,50],[28,59,15,50,"withTimeout"],[28,70,15,50],[28,72,15,51],[28,79,15,58],[29,12,15,60,"signal"],[30,10,15,67],[30,11,15,68],[30,16,15,73],[31,12,16,20],[31,18,16,26,"init"],[31,22,16,30],[31,25,16,30,"Object"],[31,31,16,30],[31,32,16,30,"assign"],[31,38,16,30],[31,43,17,27,"fetchOptions"],[31,55,17,39],[32,14,18,24,"body"],[32,18,18,28],[32,20,18,30,"Array"],[32,25,18,35],[32,26,18,36,"isArray"],[32,33,18,43],[32,34,18,44,"body"],[32,38,18,48],[32,39,18,49],[32,42,19,30],[32,46,19,30,"stringify"],[32,58,19,39],[32,59,19,39,"stringify"],[32,68,19,39],[32,70,19,40,"body"],[32,74,19,44],[32,75,19,45,"map"],[32,78,19,48],[32,79,19,50,"body"],[32,83,19,54],[32,87,19,54,"Object"],[32,93,19,54],[32,94,19,54,"assign"],[32,100,19,54],[33,16,20,32,"jsonrpc"],[33,23,20,39],[33,25,20,41],[33,30,20,46],[34,16,21,32,"id"],[34,18,21,34],[34,20,21,36,"body"],[34,24,21,40],[34,25,21,41,"id"],[34,27,21,43],[34,31,21,47,"idCache"],[34,36,21,54],[34,37,21,54,"idCache"],[34,44,21,54],[34,45,21,55,"take"],[34,49,21,59],[34,50,21,60],[35,14,21,61],[35,17,22,35,"body"],[35,21,22,39],[35,22,23,30],[35,23,23,31],[35,24,23,32],[35,27,24,30],[35,31,24,30,"stringify"],[35,43,24,39],[35,44,24,39,"stringify"],[35,53,24,39],[35,55,24,39,"Object"],[35,61,24,39],[35,62,24,39,"assign"],[35,68,24,39],[36,16,25,32,"jsonrpc"],[36,23,25,39],[36,25,25,41],[36,30,25,46],[37,16,26,32,"id"],[37,18,26,34],[37,20,26,36,"body"],[37,24,26,40],[37,25,26,41,"id"],[37,27,26,43],[37,31,26,47,"idCache"],[37,36,26,54],[37,37,26,54,"idCache"],[37,44,26,54],[37,45,26,55,"take"],[37,49,26,59],[37,50,26,60],[38,14,26,61],[38,17,27,35,"body"],[38,21,27,39],[38,22,28,29],[38,23,28,30],[39,14,29,24,"headers"],[39,21,29,31],[39,23,29,31,"Object"],[39,29,29,31],[39,30,29,31,"assign"],[39,36,29,31],[40,16,30,28],[40,30,30,42],[40,32,30,44],[41,14,30,62],[41,17,31,31,"headers"],[41,24,31,38],[41,25,32,25],[42,14,33,24,"method"],[42,20,33,30],[42,22,33,32,"method"],[42,28,33,38],[42,32,33,42],[42,38,33,48],[43,14,34,24,"signal"],[43,20,34,30],[43,22,34,32,"signal_"],[43,29,34,39],[43,34,34,44,"timeout"],[43,41,34,51],[43,44,34,54],[43,45,34,55],[43,48,34,58,"signal"],[43,54,34,64],[43,57,34,67],[43,61,34,71],[44,12,34,72],[44,14,35,21],[45,12,36,20],[45,18,36,26,"request"],[45,25,36,33],[45,28,36,36],[45,32,36,40,"Request"],[45,39,36,47],[45,40,36,48,"url"],[45,43,36,51],[45,45,36,53,"init"],[45,49,36,57],[45,50,36,58],[46,12,37,20],[46,18,37,26,"args"],[46,22,37,30],[46,25,37,33],[46,26,37,34],[46,32,37,40,"onRequest"],[46,41,37,49],[46,44,37,52,"request"],[46,51,37,59],[46,53,37,61,"init"],[46,57,37,65],[46,58,37,66],[46,63,37,66,"Object"],[46,69,37,66],[46,70,37,66,"assign"],[46,76,37,66],[46,81,37,76,"init"],[46,85,37,80],[47,14,37,82,"url"],[48,12,37,85],[48,14,37,87],[49,12,38,20],[49,18,38,26,"response"],[49,26,38,34],[49,29,38,37],[49,35,38,43,"fetch"],[49,40,38,48],[49,41,38,49,"args"],[49,45,38,53],[49,46,38,54,"url"],[49,49,38,57],[49,53,38,61,"url"],[49,56,38,64],[49,58,38,66,"args"],[49,62,38,70],[49,63,38,71],[50,12,39,20],[50,19,39,27,"response"],[50,27,39,35],[51,10,40,16],[51,11,40,17],[51,13,40,19],[52,12,41,20,"errorInstance"],[52,25,41,33],[52,27,41,35],[52,31,41,39,"TimeoutError"],[52,47,41,51],[52,48,41,51,"TimeoutError"],[52,60,41,51],[52,61,41,52],[53,14,41,54,"body"],[53,18,41,58],[54,14,41,60,"url"],[55,12,41,64],[55,13,41,65],[55,14,41,66],[56,12,42,20,"timeout"],[56,19,42,27],[57,12,43,20,"signal"],[57,18,43,26],[57,20,43,28],[58,10,44,16],[58,11,44,17],[58,12,44,18],[59,10,45,16],[59,14,45,20,"onResponse"],[59,24,45,30],[59,26,46,20],[59,32,46,26,"onResponse"],[59,42,46,36],[59,43,46,37,"response"],[59,51,46,45],[59,52,46,46],[60,10,47,16],[60,14,47,20,"data"],[60,18,47,24],[61,10,48,16],[61,14,48,20,"response"],[61,22,48,28],[61,23,48,29,"headers"],[61,30,48,36],[61,31,48,37,"get"],[61,34,48,40],[61,35,48,41],[61,49,48,55],[61,50,48,56],[61,52,48,58,"startsWith"],[61,62,48,68],[61,63,48,69],[61,81,48,87],[61,82,48,88],[61,84,49,20,"data"],[61,88,49,24],[61,91,49,27],[61,97,49,33,"response"],[61,105,49,41],[61,106,49,42,"json"],[61,110,49,46],[61,111,49,47],[61,112,49,48],[61,113,49,49],[61,118,50,21],[62,12,51,20,"data"],[62,16,51,24],[62,19,51,27],[62,25,51,33,"response"],[62,33,51,41],[62,34,51,42,"text"],[62,38,51,46],[62,39,51,47],[62,40,51,48],[63,12,52,20],[63,16,52,24],[64,14,53,24,"data"],[64,18,53,28],[64,21,53,31,"JSON"],[64,25,53,35],[64,26,53,36,"parse"],[64,31,53,41],[64,32,53,42,"data"],[64,36,53,46],[64,40,53,50],[64,44,53,54],[64,45,53,55],[65,12,54,20],[65,13,54,21],[65,14,55,20],[65,21,55,27,"err"],[65,24,55,30],[65,26,55,32],[66,14,56,24],[66,18,56,28,"response"],[66,26,56,36],[66,27,56,37,"ok"],[66,29,56,39],[66,31,57,28],[66,37,57,34,"err"],[66,40,57,37],[67,14,58,24,"data"],[67,18,58,28],[67,21,58,31],[68,16,58,33,"error"],[68,21,58,38],[68,23,58,40,"data"],[69,14,58,45],[69,15,58,46],[70,12,59,20],[71,10,60,16],[72,10,61,16],[72,14,61,20],[72,15,61,21,"response"],[72,23,61,29],[72,24,61,30,"ok"],[72,26,61,32],[72,28,61,34],[73,12,62,20],[73,18,62,26],[73,22,62,30,"HttpRequestError"],[73,38,62,46],[73,39,62,46,"HttpRequestError"],[73,55,62,46],[73,56,62,47],[74,14,63,24,"body"],[74,18,63,28],[75,14,64,24,"details"],[75,21,64,31],[75,23,64,33],[75,27,64,33,"stringify"],[75,39,64,42],[75,40,64,42,"stringify"],[75,49,64,42],[75,51,64,43,"data"],[75,55,64,47],[75,56,64,48,"error"],[75,61,64,53],[75,62,64,54],[75,66,64,58,"response"],[75,74,64,66],[75,75,64,67,"statusText"],[75,85,64,77],[76,14,65,24,"headers"],[76,21,65,31],[76,23,65,33,"response"],[76,31,65,41],[76,32,65,42,"headers"],[76,39,65,49],[77,14,66,24,"status"],[77,20,66,30],[77,22,66,32,"response"],[77,30,66,40],[77,31,66,41,"status"],[77,37,66,47],[78,14,67,24,"url"],[79,12,68,20],[79,13,68,21],[79,14,68,22],[80,10,69,16],[81,10,70,16],[81,17,70,23,"data"],[81,21,70,27],[82,8,71,12],[82,9,71,13],[82,10,72,12],[82,17,72,19,"err"],[82,20,72,22],[82,22,72,24],[83,10,73,16],[83,14,73,20,"err"],[83,17,73,23],[83,29,73,35,"HttpRequestError"],[83,45,73,51],[83,46,73,51,"HttpRequestError"],[83,62,73,51],[83,64,74,20],[83,70,74,26,"err"],[83,73,74,29],[84,10,75,16],[84,14,75,20,"err"],[84,17,75,23],[84,29,75,35,"TimeoutError"],[84,45,75,47],[84,46,75,47,"TimeoutError"],[84,58,75,47],[84,60,76,20],[84,66,76,26,"err"],[84,69,76,29],[85,10,77,16],[85,16,77,22],[85,20,77,26,"HttpRequestError"],[85,36,77,42],[85,37,77,42,"HttpRequestError"],[85,53,77,42],[85,54,77,43],[86,12,78,20,"body"],[86,16,78,24],[87,12,79,20,"cause"],[87,17,79,25],[87,19,79,27,"err"],[87,22,79,30],[88,12,80,20,"url"],[89,10,81,16],[89,11,81,17],[89,12,81,18],[90,8,82,12],[91,6,83,8],[92,4,84,4],[92,5,84,5],[93,2,85,0],[94,0,85,1],[94,3]],"functionMap":{"names":["<global>","getHttpRpcClient","request","withTimeout$argument_0","body.map$argument_0"],"mappings":"AAA;OCI;QCE;mDCQ;iDCI;8BDI;iBDiB;SD2C;CDE"},"hasCjsExports":false},"type":"js/module"}]}