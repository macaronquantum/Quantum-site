{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  const MAX_TIMEOUT = 1000;\n  function wait(state, index, expected, timeout, done) {\n    const max = Date.now() + timeout;\n    let current = Atomics.load(state, index);\n    if (current === expected) {\n      done(null, 'ok');\n      return;\n    }\n    let prior = current;\n    const check = backoff => {\n      if (Date.now() > max) {\n        done(null, 'timed-out');\n      } else {\n        setTimeout(() => {\n          prior = current;\n          current = Atomics.load(state, index);\n          if (current === prior) {\n            check(backoff >= MAX_TIMEOUT ? MAX_TIMEOUT : backoff * 2);\n          } else {\n            if (current === expected) done(null, 'ok');else done(null, 'not-equal');\n          }\n        }, backoff);\n      }\n    };\n    check(1);\n  }\n\n  // let waitDiffCount = 0\n  function waitDiff(state, index, expected, timeout, done) {\n    // const id = waitDiffCount++\n    // process._rawDebug(`>>> waitDiff ${id}`)\n    const max = Date.now() + timeout;\n    let current = Atomics.load(state, index);\n    if (current !== expected) {\n      done(null, 'ok');\n      return;\n    }\n    const check = backoff => {\n      // process._rawDebug(`${id} ${index} current ${current} expected ${expected}`)\n      // process._rawDebug('' + backoff)\n      if (Date.now() > max) {\n        done(null, 'timed-out');\n      } else {\n        setTimeout(() => {\n          current = Atomics.load(state, index);\n          if (current !== expected) {\n            done(null, 'ok');\n          } else {\n            check(backoff >= MAX_TIMEOUT ? MAX_TIMEOUT : backoff * 2);\n          }\n        }, backoff);\n      }\n    };\n    check(1);\n  }\n  module.exports = {\n    wait,\n    waitDiff\n  };\n});","lineCount":63,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,8,3,6,"MAX_TIMEOUT"],[4,19,3,17],[4,22,3,20],[4,26,3,24],[5,2,5,0],[5,11,5,9,"wait"],[5,15,5,13,"wait"],[5,16,5,15,"state"],[5,21,5,20],[5,23,5,22,"index"],[5,28,5,27],[5,30,5,29,"expected"],[5,38,5,37],[5,40,5,39,"timeout"],[5,47,5,46],[5,49,5,48,"done"],[5,53,5,52],[5,55,5,54],[6,4,6,2],[6,10,6,8,"max"],[6,13,6,11],[6,16,6,14,"Date"],[6,20,6,18],[6,21,6,19,"now"],[6,24,6,22],[6,25,6,23],[6,26,6,24],[6,29,6,27,"timeout"],[6,36,6,34],[7,4,7,2],[7,8,7,6,"current"],[7,15,7,13],[7,18,7,16,"Atomics"],[7,25,7,23],[7,26,7,24,"load"],[7,30,7,28],[7,31,7,29,"state"],[7,36,7,34],[7,38,7,36,"index"],[7,43,7,41],[7,44,7,42],[8,4,8,2],[8,8,8,6,"current"],[8,15,8,13],[8,20,8,18,"expected"],[8,28,8,26],[8,30,8,28],[9,6,9,4,"done"],[9,10,9,8],[9,11,9,9],[9,15,9,13],[9,17,9,15],[9,21,9,19],[9,22,9,20],[10,6,10,4],[11,4,11,2],[12,4,12,2],[12,8,12,6,"prior"],[12,13,12,11],[12,16,12,14,"current"],[12,23,12,21],[13,4,13,2],[13,10,13,8,"check"],[13,15,13,13],[13,18,13,17,"backoff"],[13,25,13,24],[13,29,13,29],[14,6,14,4],[14,10,14,8,"Date"],[14,14,14,12],[14,15,14,13,"now"],[14,18,14,16],[14,19,14,17],[14,20,14,18],[14,23,14,21,"max"],[14,26,14,24],[14,28,14,26],[15,8,15,6,"done"],[15,12,15,10],[15,13,15,11],[15,17,15,15],[15,19,15,17],[15,30,15,28],[15,31,15,29],[16,6,16,4],[16,7,16,5],[16,13,16,11],[17,8,17,6,"setTimeout"],[17,18,17,16],[17,19,17,17],[17,25,17,23],[18,10,18,8,"prior"],[18,15,18,13],[18,18,18,16,"current"],[18,25,18,23],[19,10,19,8,"current"],[19,17,19,15],[19,20,19,18,"Atomics"],[19,27,19,25],[19,28,19,26,"load"],[19,32,19,30],[19,33,19,31,"state"],[19,38,19,36],[19,40,19,38,"index"],[19,45,19,43],[19,46,19,44],[20,10,20,8],[20,14,20,12,"current"],[20,21,20,19],[20,26,20,24,"prior"],[20,31,20,29],[20,33,20,31],[21,12,21,10,"check"],[21,17,21,15],[21,18,21,16,"backoff"],[21,25,21,23],[21,29,21,27,"MAX_TIMEOUT"],[21,40,21,38],[21,43,21,41,"MAX_TIMEOUT"],[21,54,21,52],[21,57,21,55,"backoff"],[21,64,21,62],[21,67,21,65],[21,68,21,66],[21,69,21,67],[22,10,22,8],[22,11,22,9],[22,17,22,15],[23,12,23,10],[23,16,23,14,"current"],[23,23,23,21],[23,28,23,26,"expected"],[23,36,23,34],[23,38,23,36,"done"],[23,42,23,40],[23,43,23,41],[23,47,23,45],[23,49,23,47],[23,53,23,51],[23,54,23,52],[23,60,24,15,"done"],[23,64,24,19],[23,65,24,20],[23,69,24,24],[23,71,24,26],[23,82,24,37],[23,83,24,38],[24,10,25,8],[25,8,26,6],[25,9,26,7],[25,11,26,9,"backoff"],[25,18,26,16],[25,19,26,17],[26,6,27,4],[27,4,28,2],[27,5,28,3],[28,4,29,2,"check"],[28,9,29,7],[28,10,29,8],[28,11,29,9],[28,12,29,10],[29,2,30,0],[31,2,32,0],[32,2,33,0],[32,11,33,9,"waitDiff"],[32,19,33,17,"waitDiff"],[32,20,33,19,"state"],[32,25,33,24],[32,27,33,26,"index"],[32,32,33,31],[32,34,33,33,"expected"],[32,42,33,41],[32,44,33,43,"timeout"],[32,51,33,50],[32,53,33,52,"done"],[32,57,33,56],[32,59,33,58],[33,4,34,2],[34,4,35,2],[35,4,36,2],[35,10,36,8,"max"],[35,13,36,11],[35,16,36,14,"Date"],[35,20,36,18],[35,21,36,19,"now"],[35,24,36,22],[35,25,36,23],[35,26,36,24],[35,29,36,27,"timeout"],[35,36,36,34],[36,4,37,2],[36,8,37,6,"current"],[36,15,37,13],[36,18,37,16,"Atomics"],[36,25,37,23],[36,26,37,24,"load"],[36,30,37,28],[36,31,37,29,"state"],[36,36,37,34],[36,38,37,36,"index"],[36,43,37,41],[36,44,37,42],[37,4,38,2],[37,8,38,6,"current"],[37,15,38,13],[37,20,38,18,"expected"],[37,28,38,26],[37,30,38,28],[38,6,39,4,"done"],[38,10,39,8],[38,11,39,9],[38,15,39,13],[38,17,39,15],[38,21,39,19],[38,22,39,20],[39,6,40,4],[40,4,41,2],[41,4,42,2],[41,10,42,8,"check"],[41,15,42,13],[41,18,42,17,"backoff"],[41,25,42,24],[41,29,42,29],[42,6,43,4],[43,6,44,4],[44,6,45,4],[44,10,45,8,"Date"],[44,14,45,12],[44,15,45,13,"now"],[44,18,45,16],[44,19,45,17],[44,20,45,18],[44,23,45,21,"max"],[44,26,45,24],[44,28,45,26],[45,8,46,6,"done"],[45,12,46,10],[45,13,46,11],[45,17,46,15],[45,19,46,17],[45,30,46,28],[45,31,46,29],[46,6,47,4],[46,7,47,5],[46,13,47,11],[47,8,48,6,"setTimeout"],[47,18,48,16],[47,19,48,17],[47,25,48,23],[48,10,49,8,"current"],[48,17,49,15],[48,20,49,18,"Atomics"],[48,27,49,25],[48,28,49,26,"load"],[48,32,49,30],[48,33,49,31,"state"],[48,38,49,36],[48,40,49,38,"index"],[48,45,49,43],[48,46,49,44],[49,10,50,8],[49,14,50,12,"current"],[49,21,50,19],[49,26,50,24,"expected"],[49,34,50,32],[49,36,50,34],[50,12,51,10,"done"],[50,16,51,14],[50,17,51,15],[50,21,51,19],[50,23,51,21],[50,27,51,25],[50,28,51,26],[51,10,52,8],[51,11,52,9],[51,17,52,15],[52,12,53,10,"check"],[52,17,53,15],[52,18,53,16,"backoff"],[52,25,53,23],[52,29,53,27,"MAX_TIMEOUT"],[52,40,53,38],[52,43,53,41,"MAX_TIMEOUT"],[52,54,53,52],[52,57,53,55,"backoff"],[52,64,53,62],[52,67,53,65],[52,68,53,66],[52,69,53,67],[53,10,54,8],[54,8,55,6],[54,9,55,7],[54,11,55,9,"backoff"],[54,18,55,16],[54,19,55,17],[55,6,56,4],[56,4,57,2],[56,5,57,3],[57,4,58,2,"check"],[57,9,58,7],[57,10,58,8],[57,11,58,9],[57,12,58,10],[58,2,59,0],[59,2,61,0,"module"],[59,8,61,6],[59,9,61,7,"exports"],[59,16,61,14],[59,19,61,17],[60,4,61,19,"wait"],[60,8,61,23],[61,4,61,25,"waitDiff"],[62,2,61,34],[62,3,61,35],[63,0,61,35],[63,3]],"functionMap":{"names":["<global>","wait","check","setTimeout$argument_0","waitDiff"],"mappings":"AAA;ACI;gBCQ;iBCI;ODS;GDE;CDE;AIG;gBFS;iBCM;ODO;GEE;CJE"},"hasCjsExports":true},"type":"js/module"}]}