{"dependencies":[{"name":"../../utils/encoding/fromHex.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":143},"end":{"line":4,"column":63,"index":185}}],"key":"T6LoMSTzqzYJuDqc58ktEbJCK9Q=","exportNames":["*"],"imports":1}},{"name":"../../utils/getAction.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":23,"index":210},"end":{"line":5,"column":58,"index":245}}],"key":"d685V9n1u7O1oRJ2ZbnkuLpcslA=","exportNames":["*"],"imports":1}},{"name":"../../utils/observe.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":21,"index":268},"end":{"line":6,"column":54,"index":301}}],"key":"NlEDsinWPPoPV3uHdXDCPvBuxx8=","exportNames":["*"],"imports":1}},{"name":"../../utils/poll.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":18,"index":321},"end":{"line":7,"column":48,"index":351}}],"key":"VGDCY0JetsesgNJKn2v/Q97mlvo=","exportNames":["*"],"imports":1}},{"name":"../../utils/stringify.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":23,"index":376},"end":{"line":8,"column":58,"index":411}}],"key":"o4d2CDgTn514XnsqOYcryKEOe1A=","exportNames":["*"],"imports":1}},{"name":"./getBlockNumber.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":9,"column":28,"index":441},"end":{"line":9,"column":58,"index":471}}],"key":"C0Y7h8azvfmBC33QpzHPTvqjITU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.watchBlockNumber = watchBlockNumber;\n  const fromHex_js_1 = require(_dependencyMap[0], \"../../utils/encoding/fromHex.js\");\n  const getAction_js_1 = require(_dependencyMap[1], \"../../utils/getAction.js\");\n  const observe_js_1 = require(_dependencyMap[2], \"../../utils/observe.js\");\n  const poll_js_1 = require(_dependencyMap[3], \"../../utils/poll.js\");\n  const stringify_js_1 = require(_dependencyMap[4], \"../../utils/stringify.js\");\n  const getBlockNumber_js_1 = require(_dependencyMap[5], \"./getBlockNumber.js\");\n  function watchBlockNumber(client, {\n    emitOnBegin = false,\n    emitMissed = false,\n    onBlockNumber,\n    onError,\n    poll: poll_,\n    pollingInterval = client.pollingInterval\n  }) {\n    const enablePolling = (() => {\n      if (typeof poll_ !== 'undefined') return poll_;\n      if (client.transport.type === 'webSocket') return false;\n      if (client.transport.type === 'fallback' && client.transport.transports[0].config.type === 'webSocket') return false;\n      return true;\n    })();\n    let prevBlockNumber;\n    const pollBlockNumber = () => {\n      const observerId = (0, stringify_js_1.stringify)(['watchBlockNumber', client.uid, emitOnBegin, emitMissed, pollingInterval]);\n      return (0, observe_js_1.observe)(observerId, {\n        onBlockNumber,\n        onError\n      }, emit => (0, poll_js_1.poll)(async () => {\n        try {\n          const blockNumber = await (0, getAction_js_1.getAction)(client, getBlockNumber_js_1.getBlockNumber, 'getBlockNumber')({\n            cacheTime: 0\n          });\n          if (prevBlockNumber) {\n            if (blockNumber === prevBlockNumber) return;\n            if (blockNumber - prevBlockNumber > 1 && emitMissed) {\n              for (let i = prevBlockNumber + 1n; i < blockNumber; i++) {\n                emit.onBlockNumber(i, prevBlockNumber);\n                prevBlockNumber = i;\n              }\n            }\n          }\n          if (!prevBlockNumber || blockNumber > prevBlockNumber) {\n            emit.onBlockNumber(blockNumber, prevBlockNumber);\n            prevBlockNumber = blockNumber;\n          }\n        } catch (err) {\n          emit.onError?.(err);\n        }\n      }, {\n        emitOnBegin,\n        interval: pollingInterval\n      }));\n    };\n    const subscribeBlockNumber = () => {\n      const observerId = (0, stringify_js_1.stringify)(['watchBlockNumber', client.uid, emitOnBegin, emitMissed]);\n      return (0, observe_js_1.observe)(observerId, {\n        onBlockNumber,\n        onError\n      }, emit => {\n        let active = true;\n        let unsubscribe = () => active = false;\n        (async () => {\n          try {\n            const transport = (() => {\n              if (client.transport.type === 'fallback') {\n                const transport = client.transport.transports.find(transport => transport.config.type === 'webSocket');\n                if (!transport) return client.transport;\n                return transport.value;\n              }\n              return client.transport;\n            })();\n            const {\n              unsubscribe: unsubscribe_\n            } = await transport.subscribe({\n              params: ['newHeads'],\n              onData(data) {\n                if (!active) return;\n                const blockNumber = (0, fromHex_js_1.hexToBigInt)(data.result?.number);\n                emit.onBlockNumber(blockNumber, prevBlockNumber);\n                prevBlockNumber = blockNumber;\n              },\n              onError(error) {\n                emit.onError?.(error);\n              }\n            });\n            unsubscribe = unsubscribe_;\n            if (!active) unsubscribe();\n          } catch (err) {\n            onError?.(err);\n          }\n        })();\n        return () => unsubscribe();\n      });\n    };\n    return enablePolling ? pollBlockNumber() : subscribeBlockNumber();\n  }\n});","lineCount":103,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"watchBlockNumber"],[7,26,3,24],[7,29,3,27,"watchBlockNumber"],[7,45,3,43],[8,2,4,0],[8,8,4,6,"fromHex_js_1"],[8,20,4,18],[8,23,4,21,"require"],[8,30,4,28],[8,31,4,28,"_dependencyMap"],[8,45,4,28],[8,83,4,62],[8,84,4,63],[9,2,5,0],[9,8,5,6,"getAction_js_1"],[9,22,5,20],[9,25,5,23,"require"],[9,32,5,30],[9,33,5,30,"_dependencyMap"],[9,47,5,30],[9,78,5,57],[9,79,5,58],[10,2,6,0],[10,8,6,6,"observe_js_1"],[10,20,6,18],[10,23,6,21,"require"],[10,30,6,28],[10,31,6,28,"_dependencyMap"],[10,45,6,28],[10,74,6,53],[10,75,6,54],[11,2,7,0],[11,8,7,6,"poll_js_1"],[11,17,7,15],[11,20,7,18,"require"],[11,27,7,25],[11,28,7,25,"_dependencyMap"],[11,42,7,25],[11,68,7,47],[11,69,7,48],[12,2,8,0],[12,8,8,6,"stringify_js_1"],[12,22,8,20],[12,25,8,23,"require"],[12,32,8,30],[12,33,8,30,"_dependencyMap"],[12,47,8,30],[12,78,8,57],[12,79,8,58],[13,2,9,0],[13,8,9,6,"getBlockNumber_js_1"],[13,27,9,25],[13,30,9,28,"require"],[13,37,9,35],[13,38,9,35,"_dependencyMap"],[13,52,9,35],[13,78,9,57],[13,79,9,58],[14,2,10,0],[14,11,10,9,"watchBlockNumber"],[14,27,10,25,"watchBlockNumber"],[14,28,10,26,"client"],[14,34,10,32],[14,36,10,34],[15,4,10,36,"emitOnBegin"],[15,15,10,47],[15,18,10,50],[15,23,10,55],[16,4,10,57,"emitMissed"],[16,14,10,67],[16,17,10,70],[16,22,10,75],[17,4,10,77,"onBlockNumber"],[17,17,10,90],[18,4,10,92,"onError"],[18,11,10,99],[19,4,10,101,"poll"],[19,8,10,105],[19,10,10,107,"poll_"],[19,15,10,112],[20,4,10,114,"pollingInterval"],[20,19,10,129],[20,22,10,132,"client"],[20,28,10,138],[20,29,10,139,"pollingInterval"],[21,2,10,156],[21,3,10,157],[21,5,10,159],[22,4,11,4],[22,10,11,10,"enablePolling"],[22,23,11,23],[22,26,11,26],[22,27,11,27],[22,33,11,33],[23,6,12,8],[23,10,12,12],[23,17,12,19,"poll_"],[23,22,12,24],[23,27,12,29],[23,38,12,40],[23,40,13,12],[23,47,13,19,"poll_"],[23,52,13,24],[24,6,14,8],[24,10,14,12,"client"],[24,16,14,18],[24,17,14,19,"transport"],[24,26,14,28],[24,27,14,29,"type"],[24,31,14,33],[24,36,14,38],[24,47,14,49],[24,49,15,12],[24,56,15,19],[24,61,15,24],[25,6,16,8],[25,10,16,12,"client"],[25,16,16,18],[25,17,16,19,"transport"],[25,26,16,28],[25,27,16,29,"type"],[25,31,16,33],[25,36,16,38],[25,46,16,48],[25,50,17,12,"client"],[25,56,17,18],[25,57,17,19,"transport"],[25,66,17,28],[25,67,17,29,"transports"],[25,77,17,39],[25,78,17,40],[25,79,17,41],[25,80,17,42],[25,81,17,43,"config"],[25,87,17,49],[25,88,17,50,"type"],[25,92,17,54],[25,97,17,59],[25,108,17,70],[25,110,18,12],[25,117,18,19],[25,122,18,24],[26,6,19,8],[26,13,19,15],[26,17,19,19],[27,4,20,4],[27,5,20,5],[27,7,20,7],[27,8,20,8],[28,4,21,4],[28,8,21,8,"prevBlockNumber"],[28,23,21,23],[29,4,22,4],[29,10,22,10,"pollBlockNumber"],[29,25,22,25],[29,28,22,28,"pollBlockNumber"],[29,29,22,28],[29,34,22,34],[30,6,23,8],[30,12,23,14,"observerId"],[30,22,23,24],[30,25,23,27],[30,26,23,28],[30,27,23,29],[30,29,23,31,"stringify_js_1"],[30,43,23,45],[30,44,23,46,"stringify"],[30,53,23,55],[30,55,23,57],[30,56,24,12],[30,74,24,30],[30,76,25,12,"client"],[30,82,25,18],[30,83,25,19,"uid"],[30,86,25,22],[30,88,26,12,"emitOnBegin"],[30,99,26,23],[30,101,27,12,"emitMissed"],[30,111,27,22],[30,113,28,12,"pollingInterval"],[30,128,28,27],[30,129,29,9],[30,130,29,10],[31,6,30,8],[31,13,30,15],[31,14,30,16],[31,15,30,17],[31,17,30,19,"observe_js_1"],[31,29,30,31],[31,30,30,32,"observe"],[31,37,30,39],[31,39,30,41,"observerId"],[31,49,30,51],[31,51,30,53],[32,8,30,55,"onBlockNumber"],[32,21,30,68],[33,8,30,70,"onError"],[34,6,30,78],[34,7,30,79],[34,9,30,82,"emit"],[34,13,30,86],[34,17,30,91],[34,18,30,92],[34,19,30,93],[34,21,30,95,"poll_js_1"],[34,30,30,104],[34,31,30,105,"poll"],[34,35,30,109],[34,37,30,111],[34,49,30,123],[35,8,31,12],[35,12,31,16],[36,10,32,16],[36,16,32,22,"blockNumber"],[36,27,32,33],[36,30,32,36],[36,36,32,42],[36,37,32,43],[36,38,32,44],[36,40,32,46,"getAction_js_1"],[36,54,32,60],[36,55,32,61,"getAction"],[36,64,32,70],[36,66,32,72,"client"],[36,72,32,78],[36,74,32,80,"getBlockNumber_js_1"],[36,93,32,99],[36,94,32,100,"getBlockNumber"],[36,108,32,114],[36,110,32,116],[36,126,32,132],[36,127,32,133],[36,128,32,134],[37,12,32,136,"cacheTime"],[37,21,32,145],[37,23,32,147],[38,10,32,149],[38,11,32,150],[38,12,32,151],[39,10,33,16],[39,14,33,20,"prevBlockNumber"],[39,29,33,35],[39,31,33,37],[40,12,34,20],[40,16,34,24,"blockNumber"],[40,27,34,35],[40,32,34,40,"prevBlockNumber"],[40,47,34,55],[40,49,35,24],[41,12,36,20],[41,16,36,24,"blockNumber"],[41,27,36,35],[41,30,36,38,"prevBlockNumber"],[41,45,36,53],[41,48,36,56],[41,49,36,57],[41,53,36,61,"emitMissed"],[41,63,36,71],[41,65,36,73],[42,14,37,24],[42,19,37,29],[42,23,37,33,"i"],[42,24,37,34],[42,27,37,37,"prevBlockNumber"],[42,42,37,52],[42,45,37,55],[42,47,37,57],[42,49,37,59,"i"],[42,50,37,60],[42,53,37,63,"blockNumber"],[42,64,37,74],[42,66,37,76,"i"],[42,67,37,77],[42,69,37,79],[42,71,37,81],[43,16,38,28,"emit"],[43,20,38,32],[43,21,38,33,"onBlockNumber"],[43,34,38,46],[43,35,38,47,"i"],[43,36,38,48],[43,38,38,50,"prevBlockNumber"],[43,53,38,65],[43,54,38,66],[44,16,39,28,"prevBlockNumber"],[44,31,39,43],[44,34,39,46,"i"],[44,35,39,47],[45,14,40,24],[46,12,41,20],[47,10,42,16],[48,10,43,16],[48,14,43,20],[48,15,43,21,"prevBlockNumber"],[48,30,43,36],[48,34,43,40,"blockNumber"],[48,45,43,51],[48,48,43,54,"prevBlockNumber"],[48,63,43,69],[48,65,43,71],[49,12,44,20,"emit"],[49,16,44,24],[49,17,44,25,"onBlockNumber"],[49,30,44,38],[49,31,44,39,"blockNumber"],[49,42,44,50],[49,44,44,52,"prevBlockNumber"],[49,59,44,67],[49,60,44,68],[50,12,45,20,"prevBlockNumber"],[50,27,45,35],[50,30,45,38,"blockNumber"],[50,41,45,49],[51,10,46,16],[52,8,47,12],[52,9,47,13],[52,10,48,12],[52,17,48,19,"err"],[52,20,48,22],[52,22,48,24],[53,10,49,16,"emit"],[53,14,49,20],[53,15,49,21,"onError"],[53,22,49,28],[53,25,49,31,"err"],[53,28,49,34],[53,29,49,35],[54,8,50,12],[55,6,51,8],[55,7,51,9],[55,9,51,11],[56,8,52,12,"emitOnBegin"],[56,19,52,23],[57,8,53,12,"interval"],[57,16,53,20],[57,18,53,22,"pollingInterval"],[58,6,54,8],[58,7,54,9],[58,8,54,10],[58,9,54,11],[59,4,55,4],[59,5,55,5],[60,4,56,4],[60,10,56,10,"subscribeBlockNumber"],[60,30,56,30],[60,33,56,33,"subscribeBlockNumber"],[60,34,56,33],[60,39,56,39],[61,6,57,8],[61,12,57,14,"observerId"],[61,22,57,24],[61,25,57,27],[61,26,57,28],[61,27,57,29],[61,29,57,31,"stringify_js_1"],[61,43,57,45],[61,44,57,46,"stringify"],[61,53,57,55],[61,55,57,57],[61,56,58,12],[61,74,58,30],[61,76,59,12,"client"],[61,82,59,18],[61,83,59,19,"uid"],[61,86,59,22],[61,88,60,12,"emitOnBegin"],[61,99,60,23],[61,101,61,12,"emitMissed"],[61,111,61,22],[61,112,62,9],[61,113,62,10],[62,6,63,8],[62,13,63,15],[62,14,63,16],[62,15,63,17],[62,17,63,19,"observe_js_1"],[62,29,63,31],[62,30,63,32,"observe"],[62,37,63,39],[62,39,63,41,"observerId"],[62,49,63,51],[62,51,63,53],[63,8,63,55,"onBlockNumber"],[63,21,63,68],[64,8,63,70,"onError"],[65,6,63,78],[65,7,63,79],[65,9,63,82,"emit"],[65,13,63,86],[65,17,63,91],[66,8,64,12],[66,12,64,16,"active"],[66,18,64,22],[66,21,64,25],[66,25,64,29],[67,8,65,12],[67,12,65,16,"unsubscribe"],[67,23,65,27],[67,26,65,30,"unsubscribe"],[67,27,65,30],[67,32,65,37,"active"],[67,38,65,43],[67,41,65,46],[67,46,65,52],[68,8,66,12],[68,9,66,13],[68,21,66,25],[69,10,67,16],[69,14,67,20],[70,12,68,20],[70,18,68,26,"transport"],[70,27,68,35],[70,30,68,38],[70,31,68,39],[70,37,68,45],[71,14,69,24],[71,18,69,28,"client"],[71,24,69,34],[71,25,69,35,"transport"],[71,34,69,44],[71,35,69,45,"type"],[71,39,69,49],[71,44,69,54],[71,54,69,64],[71,56,69,66],[72,16,70,28],[72,22,70,34,"transport"],[72,31,70,43],[72,34,70,46,"client"],[72,40,70,52],[72,41,70,53,"transport"],[72,50,70,62],[72,51,70,63,"transports"],[72,61,70,73],[72,62,70,74,"find"],[72,66,70,78],[72,67,70,80,"transport"],[72,76,70,89],[72,80,70,94,"transport"],[72,89,70,103],[72,90,70,104,"config"],[72,96,70,110],[72,97,70,111,"type"],[72,101,70,115],[72,106,70,120],[72,117,70,131],[72,118,70,132],[73,16,71,28],[73,20,71,32],[73,21,71,33,"transport"],[73,30,71,42],[73,32,72,32],[73,39,72,39,"client"],[73,45,72,45],[73,46,72,46,"transport"],[73,55,72,55],[74,16,73,28],[74,23,73,35,"transport"],[74,32,73,44],[74,33,73,45,"value"],[74,38,73,50],[75,14,74,24],[76,14,75,24],[76,21,75,31,"client"],[76,27,75,37],[76,28,75,38,"transport"],[76,37,75,47],[77,12,76,20],[77,13,76,21],[77,15,76,23],[77,16,76,24],[78,12,77,20],[78,18,77,26],[79,14,77,28,"unsubscribe"],[79,25,77,39],[79,27,77,41,"unsubscribe_"],[80,12,77,54],[80,13,77,55],[80,16,77,58],[80,22,77,64,"transport"],[80,31,77,73],[80,32,77,74,"subscribe"],[80,41,77,83],[80,42,77,84],[81,14,78,24,"params"],[81,20,78,30],[81,22,78,32],[81,23,78,33],[81,33,78,43],[81,34,78,44],[82,14,79,24,"onData"],[82,20,79,30,"onData"],[82,21,79,31,"data"],[82,25,79,35],[82,27,79,37],[83,16,80,28],[83,20,80,32],[83,21,80,33,"active"],[83,27,80,39],[83,29,81,32],[84,16,82,28],[84,22,82,34,"blockNumber"],[84,33,82,45],[84,36,82,48],[84,37,82,49],[84,38,82,50],[84,40,82,52,"fromHex_js_1"],[84,52,82,64],[84,53,82,65,"hexToBigInt"],[84,64,82,76],[84,66,82,78,"data"],[84,70,82,82],[84,71,82,83,"result"],[84,77,82,89],[84,79,82,91,"number"],[84,85,82,97],[84,86,82,98],[85,16,83,28,"emit"],[85,20,83,32],[85,21,83,33,"onBlockNumber"],[85,34,83,46],[85,35,83,47,"blockNumber"],[85,46,83,58],[85,48,83,60,"prevBlockNumber"],[85,63,83,75],[85,64,83,76],[86,16,84,28,"prevBlockNumber"],[86,31,84,43],[86,34,84,46,"blockNumber"],[86,45,84,57],[87,14,85,24],[87,15,85,25],[88,14,86,24,"onError"],[88,21,86,31,"onError"],[88,22,86,32,"error"],[88,27,86,37],[88,29,86,39],[89,16,87,28,"emit"],[89,20,87,32],[89,21,87,33,"onError"],[89,28,87,40],[89,31,87,43,"error"],[89,36,87,48],[89,37,87,49],[90,14,88,24],[91,12,89,20],[91,13,89,21],[91,14,89,22],[92,12,90,20,"unsubscribe"],[92,23,90,31],[92,26,90,34,"unsubscribe_"],[92,38,90,46],[93,12,91,20],[93,16,91,24],[93,17,91,25,"active"],[93,23,91,31],[93,25,92,24,"unsubscribe"],[93,36,92,35],[93,37,92,36],[93,38,92,37],[94,10,93,16],[94,11,93,17],[94,12,94,16],[94,19,94,23,"err"],[94,22,94,26],[94,24,94,28],[95,12,95,20,"onError"],[95,19,95,27],[95,22,95,30,"err"],[95,25,95,33],[95,26,95,34],[96,10,96,16],[97,8,97,12],[97,9,97,13],[97,11,97,15],[97,12,97,16],[98,8,98,12],[98,15,98,19],[98,21,98,25,"unsubscribe"],[98,32,98,36],[98,33,98,37],[98,34,98,38],[99,6,99,8],[99,7,99,9],[99,8,99,10],[100,4,100,4],[100,5,100,5],[101,4,101,4],[101,11,101,11,"enablePolling"],[101,24,101,24],[101,27,101,27,"pollBlockNumber"],[101,42,101,42],[101,43,101,43],[101,44,101,44],[101,47,101,47,"subscribeBlockNumber"],[101,67,101,67],[101,68,101,68],[101,69,101,69],[102,2,102,0],[103,0,102,1],[103,3]],"functionMap":{"names":["<global>","watchBlockNumber","<anonymous>","pollBlockNumber","subscribeBlockNumber","unsubscribe","client.transport.transports.find$argument_0","transport.subscribe$argument_0.onData","transport.subscribe$argument_0.onError"],"mappings":"AAA;ACS;2BCC;KDS;4BEE;iFDQ;UCwB;KFC;iCGC;iFFO;8BGE,sBH;+EIK,oDJ;wBKS;yBLM;wBMC;yBNE;SEW;KHC;CDE"},"hasCjsExports":true},"type":"js/module"}]}