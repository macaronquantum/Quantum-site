{"dependencies":[{"name":"../actions/public/getTransactionCount.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":79,"index":79}}],"key":"32yqyQtcFVtZNiSW0KYnn5jkewE=","exportNames":["*"],"imports":1}},{"name":"./lru.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":80},"end":{"line":2,"column":34,"index":114}}],"key":"F3urBxr0gMakjXuYpIKLSN1lWps=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.createNonceManager = createNonceManager;\n  exports.jsonRpc = jsonRpc;\n  Object.defineProperty(exports, \"nonceManager\", {\n    enumerable: true,\n    get: function () {\n      return nonceManager;\n    }\n  });\n  var _actionsPublicGetTransactionCountJs = require(_dependencyMap[0], \"../actions/public/getTransactionCount.js\");\n  var _lruJs = require(_dependencyMap[1], \"./lru.js\");\n  /**\n   * Creates a nonce manager for auto-incrementing transaction nonces.\n   *\n   * - Docs: https://viem.sh/docs/accounts/createNonceManager\n   *\n   * @example\n   * ```ts\n   * const nonceManager = createNonceManager({\n   *   source: jsonRpc(),\n   * })\n   * ```\n   */\n  function createNonceManager(parameters) {\n    const {\n      source\n    } = parameters;\n    const deltaMap = new Map();\n    const nonceMap = new _lruJs.LruMap(8192);\n    const promiseMap = new Map();\n    const getKey = ({\n      address,\n      chainId\n    }) => `${address}.${chainId}`;\n    return {\n      async consume({\n        address,\n        chainId,\n        client\n      }) {\n        const key = getKey({\n          address,\n          chainId\n        });\n        const promise = this.get({\n          address,\n          chainId,\n          client\n        });\n        this.increment({\n          address,\n          chainId\n        });\n        const nonce = await promise;\n        await source.set({\n          address,\n          chainId\n        }, nonce);\n        nonceMap.set(key, nonce);\n        return nonce;\n      },\n      async increment({\n        address,\n        chainId\n      }) {\n        const key = getKey({\n          address,\n          chainId\n        });\n        const delta = deltaMap.get(key) ?? 0;\n        deltaMap.set(key, delta + 1);\n      },\n      async get({\n        address,\n        chainId,\n        client\n      }) {\n        const key = getKey({\n          address,\n          chainId\n        });\n        let promise = promiseMap.get(key);\n        if (!promise) {\n          promise = (async () => {\n            try {\n              const nonce = await source.get({\n                address,\n                chainId,\n                client\n              });\n              const previousNonce = nonceMap.get(key) ?? 0;\n              if (previousNonce > 0 && nonce <= previousNonce) return previousNonce + 1;\n              nonceMap.delete(key);\n              return nonce;\n            } finally {\n              this.reset({\n                address,\n                chainId\n              });\n            }\n          })();\n          promiseMap.set(key, promise);\n        }\n        const delta = deltaMap.get(key) ?? 0;\n        return delta + (await promise);\n      },\n      reset({\n        address,\n        chainId\n      }) {\n        const key = getKey({\n          address,\n          chainId\n        });\n        deltaMap.delete(key);\n        promiseMap.delete(key);\n      }\n    };\n  }\n  /** JSON-RPC source for a nonce manager. */\n  function jsonRpc() {\n    return {\n      async get(parameters) {\n        const {\n          address,\n          client\n        } = parameters;\n        return (0, _actionsPublicGetTransactionCountJs.getTransactionCount)(client, {\n          address,\n          blockTag: 'pending'\n        });\n      },\n      set() {}\n    };\n  }\n  ////////////////////////////////////////////////////////////////////////////////////////////\n  // Default\n  /** Default Nonce Manager with a JSON-RPC source. */\n  const nonceManager = /*#__PURE__*/createNonceManager({\n    source: jsonRpc()\n  });\n});","lineCount":147,"map":[[7,2,15,0,"exports"],[7,9,15,0],[7,10,15,0,"createNonceManager"],[7,28,15,0],[7,31,15,0,"createNonceManager"],[7,49,15,0],[8,2,66,0,"exports"],[8,9,66,0],[8,10,66,0,"jsonRpc"],[8,17,66,0],[8,20,66,0,"jsonRpc"],[8,27,66,0],[9,2,81,0,"Object"],[9,8,81,0],[9,9,81,0,"defineProperty"],[9,23,81,0],[9,24,81,0,"exports"],[9,31,81,0],[10,4,81,0,"enumerable"],[10,14,81,0],[11,4,81,0,"get"],[11,7,81,0],[11,18,81,0,"get"],[11,19,81,0],[12,6,81,0],[12,13,81,0,"nonceManager"],[12,25,81,0],[13,4,81,0],[14,2,81,0],[15,2,1,0],[15,6,1,0,"_actionsPublicGetTransactionCountJs"],[15,41,1,0],[15,44,1,0,"require"],[15,51,1,0],[15,52,1,0,"_dependencyMap"],[15,66,1,0],[16,2,2,0],[16,6,2,0,"_lruJs"],[16,12,2,0],[16,15,2,0,"require"],[16,22,2,0],[16,23,2,0,"_dependencyMap"],[16,37,2,0],[17,2,3,0],[18,0,4,0],[19,0,5,0],[20,0,6,0],[21,0,7,0],[22,0,8,0],[23,0,9,0],[24,0,10,0],[25,0,11,0],[26,0,12,0],[27,0,13,0],[28,0,14,0],[29,2,15,7],[29,11,15,16,"createNonceManager"],[29,29,15,34,"createNonceManager"],[29,30,15,35,"parameters"],[29,40,15,45],[29,42,15,47],[30,4,16,4],[30,10,16,10],[31,6,16,12,"source"],[32,4,16,19],[32,5,16,20],[32,8,16,23,"parameters"],[32,18,16,33],[33,4,17,4],[33,10,17,10,"deltaMap"],[33,18,17,18],[33,21,17,21],[33,25,17,25,"Map"],[33,28,17,28],[33,29,17,29],[33,30,17,30],[34,4,18,4],[34,10,18,10,"nonceMap"],[34,18,18,18],[34,21,18,21],[34,25,18,25,"LruMap"],[34,31,18,31],[34,32,18,31,"LruMap"],[34,38,18,31],[34,39,18,32],[34,43,18,36],[34,44,18,37],[35,4,19,4],[35,10,19,10,"promiseMap"],[35,20,19,20],[35,23,19,23],[35,27,19,27,"Map"],[35,30,19,30],[35,31,19,31],[35,32,19,32],[36,4,20,4],[36,10,20,10,"getKey"],[36,16,20,16],[36,19,20,19,"getKey"],[36,20,20,20],[37,6,20,22,"address"],[37,13,20,29],[38,6,20,31,"chainId"],[39,4,20,39],[39,5,20,40],[39,10,20,45],[39,13,20,48,"address"],[39,20,20,55],[39,24,20,59,"chainId"],[39,31,20,66],[39,33,20,68],[40,4,21,4],[40,11,21,11],[41,6,22,8],[41,12,22,14,"consume"],[41,19,22,21,"consume"],[41,20,22,22],[42,8,22,24,"address"],[42,15,22,31],[43,8,22,33,"chainId"],[43,15,22,40],[44,8,22,42,"client"],[45,6,22,49],[45,7,22,50],[45,9,22,52],[46,8,23,12],[46,14,23,18,"key"],[46,17,23,21],[46,20,23,24,"getKey"],[46,26,23,30],[46,27,23,31],[47,10,23,33,"address"],[47,17,23,40],[48,10,23,42,"chainId"],[49,8,23,50],[49,9,23,51],[49,10,23,52],[50,8,24,12],[50,14,24,18,"promise"],[50,21,24,25],[50,24,24,28],[50,28,24,32],[50,29,24,33,"get"],[50,32,24,36],[50,33,24,37],[51,10,24,39,"address"],[51,17,24,46],[52,10,24,48,"chainId"],[52,17,24,55],[53,10,24,57,"client"],[54,8,24,64],[54,9,24,65],[54,10,24,66],[55,8,25,12],[55,12,25,16],[55,13,25,17,"increment"],[55,22,25,26],[55,23,25,27],[56,10,25,29,"address"],[56,17,25,36],[57,10,25,38,"chainId"],[58,8,25,46],[58,9,25,47],[58,10,25,48],[59,8,26,12],[59,14,26,18,"nonce"],[59,19,26,23],[59,22,26,26],[59,28,26,32,"promise"],[59,35,26,39],[60,8,27,12],[60,14,27,18,"source"],[60,20,27,24],[60,21,27,25,"set"],[60,24,27,28],[60,25,27,29],[61,10,27,31,"address"],[61,17,27,38],[62,10,27,40,"chainId"],[63,8,27,48],[63,9,27,49],[63,11,27,51,"nonce"],[63,16,27,56],[63,17,27,57],[64,8,28,12,"nonceMap"],[64,16,28,20],[64,17,28,21,"set"],[64,20,28,24],[64,21,28,25,"key"],[64,24,28,28],[64,26,28,30,"nonce"],[64,31,28,35],[64,32,28,36],[65,8,29,12],[65,15,29,19,"nonce"],[65,20,29,24],[66,6,30,8],[66,7,30,9],[67,6,31,8],[67,12,31,14,"increment"],[67,21,31,23,"increment"],[67,22,31,24],[68,8,31,26,"address"],[68,15,31,33],[69,8,31,35,"chainId"],[70,6,31,43],[70,7,31,44],[70,9,31,46],[71,8,32,12],[71,14,32,18,"key"],[71,17,32,21],[71,20,32,24,"getKey"],[71,26,32,30],[71,27,32,31],[72,10,32,33,"address"],[72,17,32,40],[73,10,32,42,"chainId"],[74,8,32,50],[74,9,32,51],[74,10,32,52],[75,8,33,12],[75,14,33,18,"delta"],[75,19,33,23],[75,22,33,26,"deltaMap"],[75,30,33,34],[75,31,33,35,"get"],[75,34,33,38],[75,35,33,39,"key"],[75,38,33,42],[75,39,33,43],[75,43,33,47],[75,44,33,48],[76,8,34,12,"deltaMap"],[76,16,34,20],[76,17,34,21,"set"],[76,20,34,24],[76,21,34,25,"key"],[76,24,34,28],[76,26,34,30,"delta"],[76,31,34,35],[76,34,34,38],[76,35,34,39],[76,36,34,40],[77,6,35,8],[77,7,35,9],[78,6,36,8],[78,12,36,14,"get"],[78,15,36,17,"get"],[78,16,36,18],[79,8,36,20,"address"],[79,15,36,27],[80,8,36,29,"chainId"],[80,15,36,36],[81,8,36,38,"client"],[82,6,36,45],[82,7,36,46],[82,9,36,48],[83,8,37,12],[83,14,37,18,"key"],[83,17,37,21],[83,20,37,24,"getKey"],[83,26,37,30],[83,27,37,31],[84,10,37,33,"address"],[84,17,37,40],[85,10,37,42,"chainId"],[86,8,37,50],[86,9,37,51],[86,10,37,52],[87,8,38,12],[87,12,38,16,"promise"],[87,19,38,23],[87,22,38,26,"promiseMap"],[87,32,38,36],[87,33,38,37,"get"],[87,36,38,40],[87,37,38,41,"key"],[87,40,38,44],[87,41,38,45],[88,8,39,12],[88,12,39,16],[88,13,39,17,"promise"],[88,20,39,24],[88,22,39,26],[89,10,40,16,"promise"],[89,17,40,23],[89,20,40,26],[89,21,40,27],[89,33,40,39],[90,12,41,20],[90,16,41,24],[91,14,42,24],[91,20,42,30,"nonce"],[91,25,42,35],[91,28,42,38],[91,34,42,44,"source"],[91,40,42,50],[91,41,42,51,"get"],[91,44,42,54],[91,45,42,55],[92,16,42,57,"address"],[92,23,42,64],[93,16,42,66,"chainId"],[93,23,42,73],[94,16,42,75,"client"],[95,14,42,82],[95,15,42,83],[95,16,42,84],[96,14,43,24],[96,20,43,30,"previousNonce"],[96,33,43,43],[96,36,43,46,"nonceMap"],[96,44,43,54],[96,45,43,55,"get"],[96,48,43,58],[96,49,43,59,"key"],[96,52,43,62],[96,53,43,63],[96,57,43,67],[96,58,43,68],[97,14,44,24],[97,18,44,28,"previousNonce"],[97,31,44,41],[97,34,44,44],[97,35,44,45],[97,39,44,49,"nonce"],[97,44,44,54],[97,48,44,58,"previousNonce"],[97,61,44,71],[97,63,45,28],[97,70,45,35,"previousNonce"],[97,83,45,48],[97,86,45,51],[97,87,45,52],[98,14,46,24,"nonceMap"],[98,22,46,32],[98,23,46,33,"delete"],[98,29,46,39],[98,30,46,40,"key"],[98,33,46,43],[98,34,46,44],[99,14,47,24],[99,21,47,31,"nonce"],[99,26,47,36],[100,12,48,20],[100,13,48,21],[100,22,49,28],[101,14,50,24],[101,18,50,28],[101,19,50,29,"reset"],[101,24,50,34],[101,25,50,35],[102,16,50,37,"address"],[102,23,50,44],[103,16,50,46,"chainId"],[104,14,50,54],[104,15,50,55],[104,16,50,56],[105,12,51,20],[106,10,52,16],[106,11,52,17],[106,13,52,19],[106,14,52,20],[107,10,53,16,"promiseMap"],[107,20,53,26],[107,21,53,27,"set"],[107,24,53,30],[107,25,53,31,"key"],[107,28,53,34],[107,30,53,36,"promise"],[107,37,53,43],[107,38,53,44],[108,8,54,12],[109,8,55,12],[109,14,55,18,"delta"],[109,19,55,23],[109,22,55,26,"deltaMap"],[109,30,55,34],[109,31,55,35,"get"],[109,34,55,38],[109,35,55,39,"key"],[109,38,55,42],[109,39,55,43],[109,43,55,47],[109,44,55,48],[110,8,56,12],[110,15,56,19,"delta"],[110,20,56,24],[110,24,56,28],[110,30,56,34,"promise"],[110,37,56,41],[110,38,56,42],[111,6,57,8],[111,7,57,9],[112,6,58,8,"reset"],[112,11,58,13,"reset"],[112,12,58,14],[113,8,58,16,"address"],[113,15,58,23],[114,8,58,25,"chainId"],[115,6,58,33],[115,7,58,34],[115,9,58,36],[116,8,59,12],[116,14,59,18,"key"],[116,17,59,21],[116,20,59,24,"getKey"],[116,26,59,30],[116,27,59,31],[117,10,59,33,"address"],[117,17,59,40],[118,10,59,42,"chainId"],[119,8,59,50],[119,9,59,51],[119,10,59,52],[120,8,60,12,"deltaMap"],[120,16,60,20],[120,17,60,21,"delete"],[120,23,60,27],[120,24,60,28,"key"],[120,27,60,31],[120,28,60,32],[121,8,61,12,"promiseMap"],[121,18,61,22],[121,19,61,23,"delete"],[121,25,61,29],[121,26,61,30,"key"],[121,29,61,33],[121,30,61,34],[122,6,62,8],[123,4,63,4],[123,5,63,5],[124,2,64,0],[125,2,65,0],[126,2,66,7],[126,11,66,16,"jsonRpc"],[126,18,66,23,"jsonRpc"],[126,19,66,23],[126,21,66,26],[127,4,67,4],[127,11,67,11],[128,6,68,8],[128,12,68,14,"get"],[128,15,68,17,"get"],[128,16,68,18,"parameters"],[128,26,68,28],[128,28,68,30],[129,8,69,12],[129,14,69,18],[130,10,69,20,"address"],[130,17,69,27],[131,10,69,29,"client"],[132,8,69,36],[132,9,69,37],[132,12,69,40,"parameters"],[132,22,69,50],[133,8,70,12],[133,15,70,19],[133,19,70,19,"getTransactionCount"],[133,54,70,38],[133,55,70,38,"getTransactionCount"],[133,74,70,38],[133,76,70,39,"client"],[133,82,70,45],[133,84,70,47],[134,10,71,16,"address"],[134,17,71,23],[135,10,72,16,"blockTag"],[135,18,72,24],[135,20,72,26],[136,8,73,12],[136,9,73,13],[136,10,73,14],[137,6,74,8],[137,7,74,9],[138,6,75,8,"set"],[138,9,75,11,"set"],[138,10,75,11],[138,12,75,14],[138,13,75,16],[139,4,76,4],[139,5,76,5],[140,2,77,0],[141,2,78,0],[142,2,79,0],[143,2,80,0],[144,2,81,7],[144,8,81,13,"nonceManager"],[144,20,81,25],[144,23,81,28],[144,36,81,42,"createNonceManager"],[144,54,81,60],[144,55,81,61],[145,4,82,4,"source"],[145,10,82,10],[145,12,82,12,"jsonRpc"],[145,19,82,19],[145,20,82,20],[146,2,83,0],[146,3,83,1],[146,4,83,2],[147,0,83,3],[147,3]],"functionMap":{"names":["<global>","createNonceManager","getKey","consume","increment","get","<anonymous>","reset","jsonRpc","set"],"mappings":"AAA;OCc;mBCK,iDD;QEE;SFQ;QGC;SHI;QIC;2BCI;iBDY;SJK;QMC;SNI;CDE;OQE;QHE;SGM;QCC,SD;CRE"},"hasCjsExports":false},"type":"js/module"}]}