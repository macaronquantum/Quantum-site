{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":119},"end":{"line":4,"column":55,"index":153}}],"key":"Bu6PYP3hUl2jiacy+OFL3cCcZHs=","exportNames":["*"],"imports":1}},{"name":"../../errors/transport.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":23,"index":178},"end":{"line":5,"column":59,"index":214}}],"key":"zWCiWm0X6zDiE+/d0erAkFo4VRM=","exportNames":["*"],"imports":1}},{"name":"../../utils/promise/createBatchScheduler.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":34,"index":250},"end":{"line":6,"column":88,"index":304}}],"key":"vzHnPpzWCJpiA0q0+gi8qs120Z0=","exportNames":["*"],"imports":1}},{"name":"../../utils/rpc/http.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":18,"index":324},"end":{"line":7,"column":52,"index":358}}],"key":"QyiCp0IujFpWkdzok21fehSFxhY=","exportNames":["*"],"imports":1}},{"name":"./createTransport.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":29,"index":389},"end":{"line":8,"column":60,"index":420}}],"key":"2KKCa+DiBTjCoOj7i5xHNLHMXm8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.http = http;\n  const request_js_1 = require(_dependencyMap[0], \"../../errors/request.js\");\n  const transport_js_1 = require(_dependencyMap[1], \"../../errors/transport.js\");\n  const createBatchScheduler_js_1 = require(_dependencyMap[2], \"../../utils/promise/createBatchScheduler.js\");\n  const http_js_1 = require(_dependencyMap[3], \"../../utils/rpc/http.js\");\n  const createTransport_js_1 = require(_dependencyMap[4], \"./createTransport.js\");\n  function http(url, config = {}) {\n    const {\n      batch,\n      fetchOptions,\n      key = 'http',\n      methods,\n      name = 'HTTP JSON-RPC',\n      onFetchRequest,\n      onFetchResponse,\n      retryDelay\n    } = config;\n    return ({\n      chain,\n      retryCount: retryCount_,\n      timeout: timeout_\n    }) => {\n      const {\n        batchSize = 1000,\n        wait = 0\n      } = typeof batch === 'object' ? batch : {};\n      const retryCount = config.retryCount ?? retryCount_;\n      const timeout = timeout_ ?? config.timeout ?? 10_000;\n      const url_ = url || chain?.rpcUrls.default.http[0];\n      if (!url_) throw new transport_js_1.UrlRequiredError();\n      const rpcClient = (0, http_js_1.getHttpRpcClient)(url_, {\n        fetchOptions,\n        onRequest: onFetchRequest,\n        onResponse: onFetchResponse,\n        timeout\n      });\n      return (0, createTransport_js_1.createTransport)({\n        key,\n        methods,\n        name,\n        async request({\n          method,\n          params\n        }) {\n          const body = {\n            method,\n            params\n          };\n          const {\n            schedule\n          } = (0, createBatchScheduler_js_1.createBatchScheduler)({\n            id: url_,\n            wait,\n            shouldSplitBatch(requests) {\n              return requests.length > batchSize;\n            },\n            fn: body => rpcClient.request({\n              body\n            }),\n            sort: (a, b) => a.id - b.id\n          });\n          const fn = async body => batch ? schedule(body) : [await rpcClient.request({\n            body\n          })];\n          const [{\n            error,\n            result\n          }] = await fn(body);\n          if (error) throw new request_js_1.RpcRequestError({\n            body,\n            error,\n            url: url_\n          });\n          return result;\n        },\n        retryCount,\n        retryDelay,\n        timeout,\n        type: 'http'\n      }, {\n        fetchOptions,\n        url: url_\n      });\n    };\n  }\n});","lineCount":92,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"http"],[7,14,3,12],[7,17,3,15,"http"],[7,21,3,19],[8,2,4,0],[8,8,4,6,"request_js_1"],[8,20,4,18],[8,23,4,21,"require"],[8,30,4,28],[8,31,4,28,"_dependencyMap"],[8,45,4,28],[8,75,4,54],[8,76,4,55],[9,2,5,0],[9,8,5,6,"transport_js_1"],[9,22,5,20],[9,25,5,23,"require"],[9,32,5,30],[9,33,5,30,"_dependencyMap"],[9,47,5,30],[9,79,5,58],[9,80,5,59],[10,2,6,0],[10,8,6,6,"createBatchScheduler_js_1"],[10,33,6,31],[10,36,6,34,"require"],[10,43,6,41],[10,44,6,41,"_dependencyMap"],[10,58,6,41],[10,108,6,87],[10,109,6,88],[11,2,7,0],[11,8,7,6,"http_js_1"],[11,17,7,15],[11,20,7,18,"require"],[11,27,7,25],[11,28,7,25,"_dependencyMap"],[11,42,7,25],[11,72,7,51],[11,73,7,52],[12,2,8,0],[12,8,8,6,"createTransport_js_1"],[12,28,8,26],[12,31,8,29,"require"],[12,38,8,36],[12,39,8,36,"_dependencyMap"],[12,53,8,36],[12,80,8,59],[12,81,8,60],[13,2,9,0],[13,11,9,9,"http"],[13,15,9,13,"http"],[13,16,9,14,"url"],[13,19,9,17],[13,21,9,19,"config"],[13,27,9,25],[13,30,9,28],[13,31,9,29],[13,32,9,30],[13,34,9,32],[14,4,10,4],[14,10,10,10],[15,6,10,12,"batch"],[15,11,10,17],[16,6,10,19,"fetchOptions"],[16,18,10,31],[17,6,10,33,"key"],[17,9,10,36],[17,12,10,39],[17,18,10,45],[18,6,10,47,"methods"],[18,13,10,54],[19,6,10,56,"name"],[19,10,10,60],[19,13,10,63],[19,28,10,78],[20,6,10,80,"onFetchRequest"],[20,20,10,94],[21,6,10,96,"onFetchResponse"],[21,21,10,111],[22,6,10,113,"retryDelay"],[23,4,10,125],[23,5,10,126],[23,8,10,129,"config"],[23,14,10,135],[24,4,11,4],[24,11,11,11],[24,12,11,12],[25,6,11,14,"chain"],[25,11,11,19],[26,6,11,21,"retryCount"],[26,16,11,31],[26,18,11,33,"retryCount_"],[26,29,11,44],[27,6,11,46,"timeout"],[27,13,11,53],[27,15,11,55,"timeout_"],[28,4,11,64],[28,5,11,65],[28,10,11,70],[29,6,12,8],[29,12,12,14],[30,8,12,16,"batchSize"],[30,17,12,25],[30,20,12,28],[30,24,12,32],[31,8,12,34,"wait"],[31,12,12,38],[31,15,12,41],[32,6,12,43],[32,7,12,44],[32,10,12,47],[32,17,12,54,"batch"],[32,22,12,59],[32,27,12,64],[32,35,12,72],[32,38,12,75,"batch"],[32,43,12,80],[32,46,12,83],[32,47,12,84],[32,48,12,85],[33,6,13,8],[33,12,13,14,"retryCount"],[33,22,13,24],[33,25,13,27,"config"],[33,31,13,33],[33,32,13,34,"retryCount"],[33,42,13,44],[33,46,13,48,"retryCount_"],[33,57,13,59],[34,6,14,8],[34,12,14,14,"timeout"],[34,19,14,21],[34,22,14,24,"timeout_"],[34,30,14,32],[34,34,14,36,"config"],[34,40,14,42],[34,41,14,43,"timeout"],[34,48,14,50],[34,52,14,54],[34,58,14,60],[35,6,15,8],[35,12,15,14,"url_"],[35,16,15,18],[35,19,15,21,"url"],[35,22,15,24],[35,26,15,28,"chain"],[35,31,15,33],[35,33,15,35,"rpcUrls"],[35,40,15,42],[35,41,15,43,"default"],[35,48,15,50],[35,49,15,51,"http"],[35,53,15,55],[35,54,15,56],[35,55,15,57],[35,56,15,58],[36,6,16,8],[36,10,16,12],[36,11,16,13,"url_"],[36,15,16,17],[36,17,17,12],[36,23,17,18],[36,27,17,22,"transport_js_1"],[36,41,17,36],[36,42,17,37,"UrlRequiredError"],[36,58,17,53],[36,59,17,54],[36,60,17,55],[37,6,18,8],[37,12,18,14,"rpcClient"],[37,21,18,23],[37,24,18,26],[37,25,18,27],[37,26,18,28],[37,28,18,30,"http_js_1"],[37,37,18,39],[37,38,18,40,"getHttpRpcClient"],[37,54,18,56],[37,56,18,58,"url_"],[37,60,18,62],[37,62,18,64],[38,8,19,12,"fetchOptions"],[38,20,19,24],[39,8,20,12,"onRequest"],[39,17,20,21],[39,19,20,23,"onFetchRequest"],[39,33,20,37],[40,8,21,12,"onResponse"],[40,18,21,22],[40,20,21,24,"onFetchResponse"],[40,35,21,39],[41,8,22,12,"timeout"],[42,6,23,8],[42,7,23,9],[42,8,23,10],[43,6,24,8],[43,13,24,15],[43,14,24,16],[43,15,24,17],[43,17,24,19,"createTransport_js_1"],[43,37,24,39],[43,38,24,40,"createTransport"],[43,53,24,55],[43,55,24,57],[44,8,25,12,"key"],[44,11,25,15],[45,8,26,12,"methods"],[45,15,26,19],[46,8,27,12,"name"],[46,12,27,16],[47,8,28,12],[47,14,28,18,"request"],[47,21,28,25,"request"],[47,22,28,26],[48,10,28,28,"method"],[48,16,28,34],[49,10,28,36,"params"],[50,8,28,43],[50,9,28,44],[50,11,28,46],[51,10,29,16],[51,16,29,22,"body"],[51,20,29,26],[51,23,29,29],[52,12,29,31,"method"],[52,18,29,37],[53,12,29,39,"params"],[54,10,29,46],[54,11,29,47],[55,10,30,16],[55,16,30,22],[56,12,30,24,"schedule"],[57,10,30,33],[57,11,30,34],[57,14,30,37],[57,15,30,38],[57,16,30,39],[57,18,30,41,"createBatchScheduler_js_1"],[57,43,30,66],[57,44,30,67,"createBatchScheduler"],[57,64,30,87],[57,66,30,89],[58,12,31,20,"id"],[58,14,31,22],[58,16,31,24,"url_"],[58,20,31,28],[59,12,32,20,"wait"],[59,16,32,24],[60,12,33,20,"shouldSplitBatch"],[60,28,33,36,"shouldSplitBatch"],[60,29,33,37,"requests"],[60,37,33,45],[60,39,33,47],[61,14,34,24],[61,21,34,31,"requests"],[61,29,34,39],[61,30,34,40,"length"],[61,36,34,46],[61,39,34,49,"batchSize"],[61,48,34,58],[62,12,35,20],[62,13,35,21],[63,12,36,20,"fn"],[63,14,36,22],[63,16,36,25,"body"],[63,20,36,29],[63,24,36,34,"rpcClient"],[63,33,36,43],[63,34,36,44,"request"],[63,41,36,51],[63,42,36,52],[64,14,37,24,"body"],[65,12,38,20],[65,13,38,21],[65,14,38,22],[66,12,39,20,"sort"],[66,16,39,24],[66,18,39,26,"sort"],[66,19,39,27,"a"],[66,20,39,28],[66,22,39,30,"b"],[66,23,39,31],[66,28,39,36,"a"],[66,29,39,37],[66,30,39,38,"id"],[66,32,39,40],[66,35,39,43,"b"],[66,36,39,44],[66,37,39,45,"id"],[67,10,40,16],[67,11,40,17],[67,12,40,18],[68,10,41,16],[68,16,41,22,"fn"],[68,18,41,24],[68,21,41,27],[68,27,41,34,"body"],[68,31,41,38],[68,35,41,43,"batch"],[68,40,41,48],[68,43,42,22,"schedule"],[68,51,42,30],[68,52,42,31,"body"],[68,56,42,35],[68,57,42,36],[68,60,43,22],[68,61,44,24],[68,67,44,30,"rpcClient"],[68,76,44,39],[68,77,44,40,"request"],[68,84,44,47],[68,85,44,48],[69,12,45,28,"body"],[70,10,46,24],[70,11,46,25],[70,12,46,26],[70,13,47,21],[71,10,48,16],[71,16,48,22],[71,17,48,23],[72,12,48,25,"error"],[72,17,48,30],[73,12,48,32,"result"],[74,10,48,39],[74,11,48,40],[74,12,48,41],[74,15,48,44],[74,21,48,50,"fn"],[74,23,48,52],[74,24,48,53,"body"],[74,28,48,57],[74,29,48,58],[75,10,49,16],[75,14,49,20,"error"],[75,19,49,25],[75,21,50,20],[75,27,50,26],[75,31,50,30,"request_js_1"],[75,43,50,42],[75,44,50,43,"RpcRequestError"],[75,59,50,58],[75,60,50,59],[76,12,51,24,"body"],[76,16,51,28],[77,12,52,24,"error"],[77,17,52,29],[78,12,53,24,"url"],[78,15,53,27],[78,17,53,29,"url_"],[79,10,54,20],[79,11,54,21],[79,12,54,22],[80,10,55,16],[80,17,55,23,"result"],[80,23,55,29],[81,8,56,12],[81,9,56,13],[82,8,57,12,"retryCount"],[82,18,57,22],[83,8,58,12,"retryDelay"],[83,18,58,22],[84,8,59,12,"timeout"],[84,15,59,19],[85,8,60,12,"type"],[85,12,60,16],[85,14,60,18],[86,6,61,8],[86,7,61,9],[86,9,61,11],[87,8,62,12,"fetchOptions"],[87,20,62,24],[88,8,63,12,"url"],[88,11,63,15],[88,13,63,17,"url_"],[89,6,64,8],[89,7,64,9],[89,8,64,10],[90,4,65,4],[90,5,65,5],[91,2,66,0],[92,0,66,1],[92,3]],"functionMap":{"names":["<global>","http","<anonymous>","request","shouldSplitBatch","fn","sort"],"mappings":"AAA;ACQ;WCE;YCiB;oBCK;qBDE;wBEC;sBFE;0BGC,qBH;2BEE;qBFM;aDS;KDS;CDC"},"hasCjsExports":true},"type":"js/module"}]}