{"dependencies":[{"name":"./abstract","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":19,"index":144},"end":{"line":7,"column":40,"index":165}}],"key":"6weGtcTgUrBSGCEb9+arSKHTMcA=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.ServiceWorkerWindowChannel = void 0;\n  const abstract_1 = require(_dependencyMap[0], \"./abstract\");\n  class ServiceWorkerWindowChannel extends abstract_1.AbstractMessageChannel {\n    constructor({\n      name,\n      channel,\n      logger,\n      lazyHandshake,\n      legacyMode,\n      allowSelfOrigin = false,\n      currentId\n    }) {\n      super({\n        channel,\n        sendFn: message => {\n          if (!this.port) throw new Error('port not assigned');\n          this.port.postMessage(message);\n        },\n        logger,\n        lazyHandshake,\n        legacyMode\n      });\n      this.name = name;\n      this.allowSelfOrigin = allowSelfOrigin;\n      this.currentId = currentId;\n      this.connect();\n    }\n    connect() {\n      chrome.runtime.onConnect.addListener(port => {\n        if (port.name !== this.name) return;\n        if (this.currentId?.() && this.currentId?.() !== port.sender?.tab?.id) return;\n        this.port = port;\n        this.port.onMessage.addListener((message, {\n          sender\n        }) => {\n          if (!sender) {\n            this.logger?.error('service-worker-window', 'no sender');\n            return;\n          }\n          const {\n            origin\n          } = sender;\n          const whitelist = ['https://connect.trezor.io', 'https://staging-connect.trezor.io', 'https://suite.corp.sldev.cz', 'https://dev.suite.sldev.cz', 'http://localhost:8088', 'https://suite.trezor.io', 'https://staging-suite.trezor.io', 'http://localhost:8000'];\n          const webextensionId = chrome?.runtime?.id;\n          if (webextensionId) {\n            whitelist.push(`chrome-extension://${webextensionId}`);\n          }\n          const webextensionUrl = chrome?.runtime?.getURL('');\n          if (webextensionUrl) {\n            whitelist.push(webextensionUrl.slice(0, -1));\n          }\n          if (!origin) {\n            this.logger?.error('connect-webextension/messageChannel/extensionPort/onMessage', 'no origin');\n            return;\n          }\n          if (!whitelist.includes(origin)) {\n            this.logger?.error('connect-webextension/messageChannel/extensionPort/onMessage', 'origin not whitelisted', origin);\n            return;\n          }\n          if (origin === self.origin && !this.allowSelfOrigin) {\n            return;\n          }\n          this.onMessage(message);\n        });\n      });\n      this.isConnected = true;\n    }\n    disconnect() {\n      if (!this.isConnected) return;\n      this.port?.disconnect();\n      this.clear();\n      this.isConnected = false;\n    }\n  }\n  exports.ServiceWorkerWindowChannel = ServiceWorkerWindowChannel;\n});","lineCount":82,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0,"Object"],[4,8,3,6],[4,9,3,7,"defineProperty"],[4,23,3,21],[4,24,3,22,"exports"],[4,31,3,29],[4,33,3,31],[4,45,3,43],[4,47,3,45],[5,4,4,2,"value"],[5,9,4,7],[5,11,4,9],[6,2,5,0],[6,3,5,1],[6,4,5,2],[7,2,6,0,"exports"],[7,9,6,7],[7,10,6,8,"ServiceWorkerWindowChannel"],[7,36,6,34],[7,39,6,37],[7,44,6,42],[7,45,6,43],[8,2,7,0],[8,8,7,6,"abstract_1"],[8,18,7,16],[8,21,7,19,"require"],[8,28,7,26],[8,29,7,26,"_dependencyMap"],[8,43,7,26],[8,60,7,39],[8,61,7,40],[9,2,8,0],[9,8,8,6,"ServiceWorkerWindowChannel"],[9,34,8,32],[9,43,8,41,"abstract_1"],[9,53,8,51],[9,54,8,52,"AbstractMessageChannel"],[9,76,8,74],[9,77,8,75],[10,4,13,2,"constructor"],[10,15,13,13,"constructor"],[10,16,13,14],[11,6,14,4,"name"],[11,10,14,8],[12,6,15,4,"channel"],[12,13,15,11],[13,6,16,4,"logger"],[13,12,16,10],[14,6,17,4,"lazyHandshake"],[14,19,17,17],[15,6,18,4,"legacyMode"],[15,16,18,14],[16,6,19,4,"allowSelfOrigin"],[16,21,19,19],[16,24,19,22],[16,29,19,27],[17,6,20,4,"currentId"],[18,4,21,2],[18,5,21,3],[18,7,21,5],[19,6,22,4],[19,11,22,9],[19,12,22,10],[20,8,23,6,"channel"],[20,15,23,13],[21,8,24,6,"sendFn"],[21,14,24,12],[21,16,24,14,"message"],[21,23,24,21],[21,27,24,25],[22,10,25,8],[22,14,25,12],[22,15,25,13],[22,19,25,17],[22,20,25,18,"port"],[22,24,25,22],[22,26,25,24],[22,32,25,30],[22,36,25,34,"Error"],[22,41,25,39],[22,42,25,40],[22,61,25,59],[22,62,25,60],[23,10,26,8],[23,14,26,12],[23,15,26,13,"port"],[23,19,26,17],[23,20,26,18,"postMessage"],[23,31,26,29],[23,32,26,30,"message"],[23,39,26,37],[23,40,26,38],[24,8,27,6],[24,9,27,7],[25,8,28,6,"logger"],[25,14,28,12],[26,8,29,6,"lazyHandshake"],[26,21,29,19],[27,8,30,6,"legacyMode"],[28,6,31,4],[28,7,31,5],[28,8,31,6],[29,6,32,4],[29,10,32,8],[29,11,32,9,"name"],[29,15,32,13],[29,18,32,16,"name"],[29,22,32,20],[30,6,33,4],[30,10,33,8],[30,11,33,9,"allowSelfOrigin"],[30,26,33,24],[30,29,33,27,"allowSelfOrigin"],[30,44,33,42],[31,6,34,4],[31,10,34,8],[31,11,34,9,"currentId"],[31,20,34,18],[31,23,34,21,"currentId"],[31,32,34,30],[32,6,35,4],[32,10,35,8],[32,11,35,9,"connect"],[32,18,35,16],[32,19,35,17],[32,20,35,18],[33,4,36,2],[34,4,37,2,"connect"],[34,11,37,9,"connect"],[34,12,37,9],[34,14,37,12],[35,6,38,4,"chrome"],[35,12,38,10],[35,13,38,11,"runtime"],[35,20,38,18],[35,21,38,19,"onConnect"],[35,30,38,28],[35,31,38,29,"addListener"],[35,42,38,40],[35,43,38,41,"port"],[35,47,38,45],[35,51,38,49],[36,8,39,6],[36,12,39,10,"port"],[36,16,39,14],[36,17,39,15,"name"],[36,21,39,19],[36,26,39,24],[36,30,39,28],[36,31,39,29,"name"],[36,35,39,33],[36,37,39,35],[37,8,40,6],[37,12,40,10],[37,16,40,14],[37,17,40,15,"currentId"],[37,26,40,24],[37,29,40,27],[37,30,40,28],[37,34,40,32],[37,38,40,36],[37,39,40,37,"currentId"],[37,48,40,46],[37,51,40,49],[37,52,40,50],[37,57,40,55,"port"],[37,61,40,59],[37,62,40,60,"sender"],[37,68,40,66],[37,70,40,68,"tab"],[37,73,40,71],[37,75,40,73,"id"],[37,77,40,75],[37,79,40,77],[38,8,41,6],[38,12,41,10],[38,13,41,11,"port"],[38,17,41,15],[38,20,41,18,"port"],[38,24,41,22],[39,8,42,6],[39,12,42,10],[39,13,42,11,"port"],[39,17,42,15],[39,18,42,16,"onMessage"],[39,27,42,25],[39,28,42,26,"addListener"],[39,39,42,37],[39,40,42,38],[39,41,42,39,"message"],[39,48,42,46],[39,50,42,48],[40,10,43,8,"sender"],[41,8,44,6],[41,9,44,7],[41,14,44,12],[42,10,45,8],[42,14,45,12],[42,15,45,13,"sender"],[42,21,45,19],[42,23,45,21],[43,12,46,10],[43,16,46,14],[43,17,46,15,"logger"],[43,23,46,21],[43,25,46,23,"error"],[43,30,46,28],[43,31,46,29],[43,54,46,52],[43,56,46,54],[43,67,46,65],[43,68,46,66],[44,12,47,10],[45,10,48,8],[46,10,49,8],[46,16,49,14],[47,12,50,10,"origin"],[48,10,51,8],[48,11,51,9],[48,14,51,12,"sender"],[48,20,51,18],[49,10,52,8],[49,16,52,14,"whitelist"],[49,25,52,23],[49,28,52,26],[49,29,52,27],[49,56,52,54],[49,58,52,56],[49,93,52,91],[49,95,52,93],[49,124,52,122],[49,126,52,124],[49,154,52,152],[49,156,52,154],[49,179,52,177],[49,181,52,179],[49,206,52,204],[49,208,52,206],[49,241,52,239],[49,243,52,241],[49,266,52,264],[49,267,52,265],[50,10,53,8],[50,16,53,14,"webextensionId"],[50,30,53,28],[50,33,53,31,"chrome"],[50,39,53,37],[50,41,53,39,"runtime"],[50,48,53,46],[50,50,53,48,"id"],[50,52,53,50],[51,10,54,8],[51,14,54,12,"webextensionId"],[51,28,54,26],[51,30,54,28],[52,12,55,10,"whitelist"],[52,21,55,19],[52,22,55,20,"push"],[52,26,55,24],[52,27,55,25],[52,49,55,47,"webextensionId"],[52,63,55,61],[52,65,55,63],[52,66,55,64],[53,10,56,8],[54,10,57,8],[54,16,57,14,"webextensionUrl"],[54,31,57,29],[54,34,57,32,"chrome"],[54,40,57,38],[54,42,57,40,"runtime"],[54,49,57,47],[54,51,57,49,"getURL"],[54,57,57,55],[54,58,57,56],[54,60,57,58],[54,61,57,59],[55,10,58,8],[55,14,58,12,"webextensionUrl"],[55,29,58,27],[55,31,58,29],[56,12,59,10,"whitelist"],[56,21,59,19],[56,22,59,20,"push"],[56,26,59,24],[56,27,59,25,"webextensionUrl"],[56,42,59,40],[56,43,59,41,"slice"],[56,48,59,46],[56,49,59,47],[56,50,59,48],[56,52,59,50],[56,53,59,51],[56,54,59,52],[56,55,59,53],[56,56,59,54],[57,10,60,8],[58,10,61,8],[58,14,61,12],[58,15,61,13,"origin"],[58,21,61,19],[58,23,61,21],[59,12,62,10],[59,16,62,14],[59,17,62,15,"logger"],[59,23,62,21],[59,25,62,23,"error"],[59,30,62,28],[59,31,62,29],[59,92,62,90],[59,94,62,92],[59,105,62,103],[59,106,62,104],[60,12,63,10],[61,10,64,8],[62,10,65,8],[62,14,65,12],[62,15,65,13,"whitelist"],[62,24,65,22],[62,25,65,23,"includes"],[62,33,65,31],[62,34,65,32,"origin"],[62,40,65,38],[62,41,65,39],[62,43,65,41],[63,12,66,10],[63,16,66,14],[63,17,66,15,"logger"],[63,23,66,21],[63,25,66,23,"error"],[63,30,66,28],[63,31,66,29],[63,92,66,90],[63,94,66,92],[63,118,66,116],[63,120,66,118,"origin"],[63,126,66,124],[63,127,66,125],[64,12,67,10],[65,10,68,8],[66,10,69,8],[66,14,69,12,"origin"],[66,20,69,18],[66,25,69,23,"self"],[66,29,69,27],[66,30,69,28,"origin"],[66,36,69,34],[66,40,69,38],[66,41,69,39],[66,45,69,43],[66,46,69,44,"allowSelfOrigin"],[66,61,69,59],[66,63,69,61],[67,12,70,10],[68,10,71,8],[69,10,72,8],[69,14,72,12],[69,15,72,13,"onMessage"],[69,24,72,22],[69,25,72,23,"message"],[69,32,72,30],[69,33,72,31],[70,8,73,6],[70,9,73,7],[70,10,73,8],[71,6,74,4],[71,7,74,5],[71,8,74,6],[72,6,75,4],[72,10,75,8],[72,11,75,9,"isConnected"],[72,22,75,20],[72,25,75,23],[72,29,75,27],[73,4,76,2],[74,4,77,2,"disconnect"],[74,14,77,12,"disconnect"],[74,15,77,12],[74,17,77,15],[75,6,78,4],[75,10,78,8],[75,11,78,9],[75,15,78,13],[75,16,78,14,"isConnected"],[75,27,78,25],[75,29,78,27],[76,6,79,4],[76,10,79,8],[76,11,79,9,"port"],[76,15,79,13],[76,17,79,15,"disconnect"],[76,27,79,25],[76,28,79,26],[76,29,79,27],[77,6,80,4],[77,10,80,8],[77,11,80,9,"clear"],[77,16,80,14],[77,17,80,15],[77,18,80,16],[78,6,81,4],[78,10,81,8],[78,11,81,9,"isConnected"],[78,22,81,20],[78,25,81,23],[78,30,81,28],[79,4,82,2],[80,2,83,0],[81,2,84,0,"exports"],[81,9,84,7],[81,10,84,8,"ServiceWorkerWindowChannel"],[81,36,84,34],[81,39,84,37,"ServiceWorkerWindowChannel"],[81,65,84,63],[82,0,84,64],[82,3]],"functionMap":{"names":["<global>","ServiceWorkerWindowChannel","ServiceWorkerWindowChannel#constructor","sendFn","ServiceWorkerWindowChannel#connect","chrome.runtime.onConnect.addListener$argument_0","port.onMessage.addListener$argument_0","ServiceWorkerWindowChannel#disconnect"],"mappings":"AAA;ACO;ECK;cCW;ODG;GDS;EGC;yCCC;sCCI;OD+B;KDC;GHE;EMC;GNK;CDC"},"hasCjsExports":true},"type":"js/module"}]}