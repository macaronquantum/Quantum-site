{"dependencies":[{"name":"./withResolvers.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":27,"index":157},"end":{"line":4,"column":56,"index":186}}],"key":"COdjDZ+n8K0lDPwSEZ7mayTBbqI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.createBatchScheduler = createBatchScheduler;\n  const withResolvers_js_1 = require(_dependencyMap[0], \"./withResolvers.js\");\n  const schedulerCache = new Map();\n  function createBatchScheduler({\n    fn,\n    id,\n    shouldSplitBatch,\n    wait = 0,\n    sort\n  }) {\n    const exec = async () => {\n      const scheduler = getScheduler();\n      flush();\n      const args = scheduler.map(({\n        args\n      }) => args);\n      if (args.length === 0) return;\n      fn(args).then(data => {\n        if (sort && Array.isArray(data)) data.sort(sort);\n        for (let i = 0; i < scheduler.length; i++) {\n          const {\n            resolve\n          } = scheduler[i];\n          resolve?.([data[i], data]);\n        }\n      }).catch(err => {\n        for (let i = 0; i < scheduler.length; i++) {\n          const {\n            reject\n          } = scheduler[i];\n          reject?.(err);\n        }\n      });\n    };\n    const flush = () => schedulerCache.delete(id);\n    const getBatchedArgs = () => getScheduler().map(({\n      args\n    }) => args);\n    const getScheduler = () => schedulerCache.get(id) || [];\n    const setScheduler = item => schedulerCache.set(id, [...getScheduler(), item]);\n    return {\n      flush,\n      async schedule(args) {\n        const {\n          promise,\n          resolve,\n          reject\n        } = (0, withResolvers_js_1.withResolvers)();\n        const split = shouldSplitBatch?.([...getBatchedArgs(), args]);\n        if (split) exec();\n        const hasActiveScheduler = getScheduler().length > 0;\n        if (hasActiveScheduler) {\n          setScheduler({\n            args,\n            resolve,\n            reject\n          });\n          return promise;\n        }\n        setScheduler({\n          args,\n          resolve,\n          reject\n        });\n        setTimeout(exec, wait);\n        return promise;\n      }\n    };\n  }\n});","lineCount":76,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"createBatchScheduler"],[7,30,3,28],[7,33,3,31,"createBatchScheduler"],[7,53,3,51],[8,2,4,0],[8,8,4,6,"withResolvers_js_1"],[8,26,4,24],[8,29,4,27,"require"],[8,36,4,34],[8,37,4,34,"_dependencyMap"],[8,51,4,34],[8,76,4,55],[8,77,4,56],[9,2,5,0],[9,8,5,6,"schedulerCache"],[9,22,5,20],[9,25,5,23],[9,29,5,27,"Map"],[9,32,5,30],[9,33,5,31],[9,34,5,32],[10,2,6,0],[10,11,6,9,"createBatchScheduler"],[10,31,6,29,"createBatchScheduler"],[10,32,6,30],[11,4,6,32,"fn"],[11,6,6,34],[12,4,6,36,"id"],[12,6,6,38],[13,4,6,40,"shouldSplitBatch"],[13,20,6,56],[14,4,6,58,"wait"],[14,8,6,62],[14,11,6,65],[14,12,6,66],[15,4,6,68,"sort"],[16,2,6,74],[16,3,6,75],[16,5,6,77],[17,4,7,4],[17,10,7,10,"exec"],[17,14,7,14],[17,17,7,17],[17,23,7,17,"exec"],[17,24,7,17],[17,29,7,29],[18,6,8,8],[18,12,8,14,"scheduler"],[18,21,8,23],[18,24,8,26,"getScheduler"],[18,36,8,38],[18,37,8,39],[18,38,8,40],[19,6,9,8,"flush"],[19,11,9,13],[19,12,9,14],[19,13,9,15],[20,6,10,8],[20,12,10,14,"args"],[20,16,10,18],[20,19,10,21,"scheduler"],[20,28,10,30],[20,29,10,31,"map"],[20,32,10,34],[20,33,10,35],[20,34,10,36],[21,8,10,38,"args"],[22,6,10,43],[22,7,10,44],[22,12,10,49,"args"],[22,16,10,53],[22,17,10,54],[23,6,11,8],[23,10,11,12,"args"],[23,14,11,16],[23,15,11,17,"length"],[23,21,11,23],[23,26,11,28],[23,27,11,29],[23,29,12,12],[24,6,13,8,"fn"],[24,8,13,10],[24,9,13,11,"args"],[24,13,13,15],[24,14,13,16],[24,15,14,13,"then"],[24,19,14,17],[24,20,14,19,"data"],[24,24,14,23],[24,28,14,28],[25,8,15,12],[25,12,15,16,"sort"],[25,16,15,20],[25,20,15,24,"Array"],[25,25,15,29],[25,26,15,30,"isArray"],[25,33,15,37],[25,34,15,38,"data"],[25,38,15,42],[25,39,15,43],[25,41,16,16,"data"],[25,45,16,20],[25,46,16,21,"sort"],[25,50,16,25],[25,51,16,26,"sort"],[25,55,16,30],[25,56,16,31],[26,8,17,12],[26,13,17,17],[26,17,17,21,"i"],[26,18,17,22],[26,21,17,25],[26,22,17,26],[26,24,17,28,"i"],[26,25,17,29],[26,28,17,32,"scheduler"],[26,37,17,41],[26,38,17,42,"length"],[26,44,17,48],[26,46,17,50,"i"],[26,47,17,51],[26,49,17,53],[26,51,17,55],[27,10,18,16],[27,16,18,22],[28,12,18,24,"resolve"],[29,10,18,32],[29,11,18,33],[29,14,18,36,"scheduler"],[29,23,18,45],[29,24,18,46,"i"],[29,25,18,47],[29,26,18,48],[30,10,19,16,"resolve"],[30,17,19,23],[30,20,19,26],[30,21,19,27,"data"],[30,25,19,31],[30,26,19,32,"i"],[30,27,19,33],[30,28,19,34],[30,30,19,36,"data"],[30,34,19,40],[30,35,19,41],[30,36,19,42],[31,8,20,12],[32,6,21,8],[32,7,21,9],[32,8,21,10],[32,9,22,13,"catch"],[32,14,22,18],[32,15,22,20,"err"],[32,18,22,23],[32,22,22,28],[33,8,23,12],[33,13,23,17],[33,17,23,21,"i"],[33,18,23,22],[33,21,23,25],[33,22,23,26],[33,24,23,28,"i"],[33,25,23,29],[33,28,23,32,"scheduler"],[33,37,23,41],[33,38,23,42,"length"],[33,44,23,48],[33,46,23,50,"i"],[33,47,23,51],[33,49,23,53],[33,51,23,55],[34,10,24,16],[34,16,24,22],[35,12,24,24,"reject"],[36,10,24,31],[36,11,24,32],[36,14,24,35,"scheduler"],[36,23,24,44],[36,24,24,45,"i"],[36,25,24,46],[36,26,24,47],[37,10,25,16,"reject"],[37,16,25,22],[37,19,25,25,"err"],[37,22,25,28],[37,23,25,29],[38,8,26,12],[39,6,27,8],[39,7,27,9],[39,8,27,10],[40,4,28,4],[40,5,28,5],[41,4,29,4],[41,10,29,10,"flush"],[41,15,29,15],[41,18,29,18,"flush"],[41,19,29,18],[41,24,29,24,"schedulerCache"],[41,38,29,38],[41,39,29,39,"delete"],[41,45,29,45],[41,46,29,46,"id"],[41,48,29,48],[41,49,29,49],[42,4,30,4],[42,10,30,10,"getBatchedArgs"],[42,24,30,24],[42,27,30,27,"getBatchedArgs"],[42,28,30,27],[42,33,30,33,"getScheduler"],[42,45,30,45],[42,46,30,46],[42,47,30,47],[42,48,30,48,"map"],[42,51,30,51],[42,52,30,52],[42,53,30,53],[43,6,30,55,"args"],[44,4,30,60],[44,5,30,61],[44,10,30,66,"args"],[44,14,30,70],[44,15,30,71],[45,4,31,4],[45,10,31,10,"getScheduler"],[45,22,31,22],[45,25,31,25,"getScheduler"],[45,26,31,25],[45,31,31,31,"schedulerCache"],[45,45,31,45],[45,46,31,46,"get"],[45,49,31,49],[45,50,31,50,"id"],[45,52,31,52],[45,53,31,53],[45,57,31,57],[45,59,31,59],[46,4,32,4],[46,10,32,10,"setScheduler"],[46,22,32,22],[46,25,32,26,"item"],[46,29,32,30],[46,33,32,35,"schedulerCache"],[46,47,32,49],[46,48,32,50,"set"],[46,51,32,53],[46,52,32,54,"id"],[46,54,32,56],[46,56,32,58],[46,57,32,59],[46,60,32,62,"getScheduler"],[46,72,32,74],[46,73,32,75],[46,74,32,76],[46,76,32,78,"item"],[46,80,32,82],[46,81,32,83],[46,82,32,84],[47,4,33,4],[47,11,33,11],[48,6,34,8,"flush"],[48,11,34,13],[49,6,35,8],[49,12,35,14,"schedule"],[49,20,35,22,"schedule"],[49,21,35,23,"args"],[49,25,35,27],[49,27,35,29],[50,8,36,12],[50,14,36,18],[51,10,36,20,"promise"],[51,17,36,27],[52,10,36,29,"resolve"],[52,17,36,36],[53,10,36,38,"reject"],[54,8,36,45],[54,9,36,46],[54,12,36,49],[54,13,36,50],[54,14,36,51],[54,16,36,53,"withResolvers_js_1"],[54,34,36,71],[54,35,36,72,"withResolvers"],[54,48,36,85],[54,50,36,87],[54,51,36,88],[55,8,37,12],[55,14,37,18,"split"],[55,19,37,23],[55,22,37,26,"shouldSplitBatch"],[55,38,37,42],[55,41,37,45],[55,42,37,46],[55,45,37,49,"getBatchedArgs"],[55,59,37,63],[55,60,37,64],[55,61,37,65],[55,63,37,67,"args"],[55,67,37,71],[55,68,37,72],[55,69,37,73],[56,8,38,12],[56,12,38,16,"split"],[56,17,38,21],[56,19,39,16,"exec"],[56,23,39,20],[56,24,39,21],[56,25,39,22],[57,8,40,12],[57,14,40,18,"hasActiveScheduler"],[57,32,40,36],[57,35,40,39,"getScheduler"],[57,47,40,51],[57,48,40,52],[57,49,40,53],[57,50,40,54,"length"],[57,56,40,60],[57,59,40,63],[57,60,40,64],[58,8,41,12],[58,12,41,16,"hasActiveScheduler"],[58,30,41,34],[58,32,41,36],[59,10,42,16,"setScheduler"],[59,22,42,28],[59,23,42,29],[60,12,42,31,"args"],[60,16,42,35],[61,12,42,37,"resolve"],[61,19,42,44],[62,12,42,46,"reject"],[63,10,42,53],[63,11,42,54],[63,12,42,55],[64,10,43,16],[64,17,43,23,"promise"],[64,24,43,30],[65,8,44,12],[66,8,45,12,"setScheduler"],[66,20,45,24],[66,21,45,25],[67,10,45,27,"args"],[67,14,45,31],[68,10,45,33,"resolve"],[68,17,45,40],[69,10,45,42,"reject"],[70,8,45,49],[70,9,45,50],[70,10,45,51],[71,8,46,12,"setTimeout"],[71,18,46,22],[71,19,46,23,"exec"],[71,23,46,27],[71,25,46,29,"wait"],[71,29,46,33],[71,30,46,34],[72,8,47,12],[72,15,47,19,"promise"],[72,22,47,26],[73,6,48,8],[74,4,49,4],[74,5,49,5],[75,2,50,0],[76,0,50,1],[76,3]],"functionMap":{"names":["<global>","createBatchScheduler","exec","scheduler.map$argument_0","fn.then$argument_0","fn.then._catch$argument_0","flush","getBatchedArgs","getScheduler.map$argument_0","getScheduler","setScheduler","schedule"],"mappings":"AAA;ACK;iBCC;mCCG,kBD;kBEI;SFO;mBGC;SHK;KDC;kBKC,+BL;2BMC,yBC,kBD,CN;yBQC,kCR;yBSC,2DT;QUG;SVa;CDE"},"hasCjsExports":true},"type":"js/module"}]}