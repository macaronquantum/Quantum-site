{"dependencies":[{"name":"@noble/curves/p256","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":42,"index":42}}],"key":"GlP+25tb8i8AdR0edkRVR6BxCg0=","exportNames":["*"],"imports":1}},{"name":"../Hex.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":43},"end":{"line":2,"column":33,"index":76}}],"key":"nTraklGBJmiFOjBr0V5IV5HhW0A=","exportNames":["*"],"imports":1}},{"name":"../PublicKey.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":77},"end":{"line":3,"column":45,"index":122}}],"key":"xDBiV+fs1GenjuJJkyXncOZLDeY=","exportNames":["*"],"imports":1}},{"name":"../WebAuthnP256.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":123},"end":{"line":4,"column":67,"index":190}}],"key":"DK7y4v8ElD4YbLchDMsLXDUz7c4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  exports.parseAsn1Signature = parseAsn1Signature;\n  exports.parseCredentialPublicKey = parseCredentialPublicKey;\n  var _nobleCurvesP = require(_dependencyMap[0], \"@noble/curves/p256\");\n  var _HexJs = require(_dependencyMap[1], \"../Hex.js\");\n  var Hex = _interopNamespace(_HexJs);\n  var _PublicKeyJs = require(_dependencyMap[2], \"../PublicKey.js\");\n  var PublicKey = _interopNamespace(_PublicKeyJs);\n  var _WebAuthnP256Js = require(_dependencyMap[3], \"../WebAuthnP256.js\");\n  /**\n   * Parses an ASN.1 signature into a r and s value.\n   *\n   * @internal\n   */\n  function parseAsn1Signature(bytes) {\n    const r_start = bytes[4] === 0 ? 5 : 4;\n    const r_end = r_start + 32;\n    const s_start = bytes[r_end + 2] === 0 ? r_end + 3 : r_end + 2;\n    const r = BigInt(Hex.fromBytes(bytes.slice(r_start, r_end)));\n    const s = BigInt(Hex.fromBytes(bytes.slice(s_start)));\n    return {\n      r,\n      s: s > _nobleCurvesP.p256.CURVE.n / 2n ? _nobleCurvesP.p256.CURVE.n - s : s\n    };\n  }\n  /**\n   * Parses a public key into x and y coordinates from the public key\n   * defined on the credential.\n   *\n   * @internal\n   */\n  async function parseCredentialPublicKey(response) {\n    try {\n      const publicKeyBuffer = response.getPublicKey();\n      if (!publicKeyBuffer) throw new _WebAuthnP256Js.CredentialCreationFailedError();\n      // Converting `publicKeyBuffer` throws when credential is created by 1Password Firefox Add-on\n      const publicKeyBytes = new Uint8Array(publicKeyBuffer);\n      const cryptoKey = await crypto.subtle.importKey('spki', new Uint8Array(publicKeyBytes), {\n        name: 'ECDSA',\n        namedCurve: 'P-256',\n        hash: 'SHA-256'\n      }, true, ['verify']);\n      const publicKey = new Uint8Array(await crypto.subtle.exportKey('raw', cryptoKey));\n      return PublicKey.from(publicKey);\n    } catch (error) {\n      // Fallback for 1Password Firefox Add-on restricts access to certain credential properties\n      // so we need to use `attestationObject` to extract the public key.\n      // https://github.com/passwordless-id/webauthn/issues/50#issuecomment-2072902094\n      if (error.message !== 'Permission denied to access object') throw error;\n      const data = new Uint8Array(response.attestationObject);\n      const coordinateLength = 0x20;\n      const cborPrefix = 0x58;\n      const findStart = key => {\n        const coordinate = new Uint8Array([key, cborPrefix, coordinateLength]);\n        for (let i = 0; i < data.length - coordinate.length; i++) if (coordinate.every((byte, j) => data[i + j] === byte)) return i + coordinate.length;\n        throw new _WebAuthnP256Js.CredentialCreationFailedError();\n      };\n      const xStart = findStart(0x21);\n      const yStart = findStart(0x22);\n      return PublicKey.from(new Uint8Array([0x04, ...data.slice(xStart, xStart + coordinateLength), ...data.slice(yStart, yStart + coordinateLength)]));\n    }\n  }\n});","lineCount":83,"map":[[22,2,10,0,"exports"],[22,9,10,0],[22,10,10,0,"parseAsn1Signature"],[22,28,10,0],[22,31,10,0,"parseAsn1Signature"],[22,49,10,0],[23,2,27,0,"exports"],[23,9,27,0],[23,10,27,0,"parseCredentialPublicKey"],[23,34,27,0],[23,37,27,0,"parseCredentialPublicKey"],[23,61,27,0],[24,2,1,0],[24,6,1,0,"_nobleCurvesP"],[24,19,1,0],[24,22,1,0,"require"],[24,29,1,0],[24,30,1,0,"_dependencyMap"],[24,44,1,0],[25,2,2,0],[25,6,2,0,"_HexJs"],[25,12,2,0],[25,15,2,0,"require"],[25,22,2,0],[25,23,2,0,"_dependencyMap"],[25,37,2,0],[26,2,2,0],[26,6,2,0,"Hex"],[26,9,2,0],[26,12,2,0,"_interopNamespace"],[26,29,2,0],[26,30,2,0,"_HexJs"],[26,36,2,0],[27,2,3,0],[27,6,3,0,"_PublicKeyJs"],[27,18,3,0],[27,21,3,0,"require"],[27,28,3,0],[27,29,3,0,"_dependencyMap"],[27,43,3,0],[28,2,3,0],[28,6,3,0,"PublicKey"],[28,15,3,0],[28,18,3,0,"_interopNamespace"],[28,35,3,0],[28,36,3,0,"_PublicKeyJs"],[28,48,3,0],[29,2,4,0],[29,6,4,0,"_WebAuthnP256Js"],[29,21,4,0],[29,24,4,0,"require"],[29,31,4,0],[29,32,4,0,"_dependencyMap"],[29,46,4,0],[30,2,5,0],[31,0,6,0],[32,0,7,0],[33,0,8,0],[34,0,9,0],[35,2,10,7],[35,11,10,16,"parseAsn1Signature"],[35,29,10,34,"parseAsn1Signature"],[35,30,10,35,"bytes"],[35,35,10,40],[35,37,10,42],[36,4,11,4],[36,10,11,10,"r_start"],[36,17,11,17],[36,20,11,20,"bytes"],[36,25,11,25],[36,26,11,26],[36,27,11,27],[36,28,11,28],[36,33,11,33],[36,34,11,34],[36,37,11,37],[36,38,11,38],[36,41,11,41],[36,42,11,42],[37,4,12,4],[37,10,12,10,"r_end"],[37,15,12,15],[37,18,12,18,"r_start"],[37,25,12,25],[37,28,12,28],[37,30,12,30],[38,4,13,4],[38,10,13,10,"s_start"],[38,17,13,17],[38,20,13,20,"bytes"],[38,25,13,25],[38,26,13,26,"r_end"],[38,31,13,31],[38,34,13,34],[38,35,13,35],[38,36,13,36],[38,41,13,41],[38,42,13,42],[38,45,13,45,"r_end"],[38,50,13,50],[38,53,13,53],[38,54,13,54],[38,57,13,57,"r_end"],[38,62,13,62],[38,65,13,65],[38,66,13,66],[39,4,14,4],[39,10,14,10,"r"],[39,11,14,11],[39,14,14,14,"BigInt"],[39,20,14,20],[39,21,14,21,"Hex"],[39,24,14,24],[39,25,14,25,"fromBytes"],[39,34,14,34],[39,35,14,35,"bytes"],[39,40,14,40],[39,41,14,41,"slice"],[39,46,14,46],[39,47,14,47,"r_start"],[39,54,14,54],[39,56,14,56,"r_end"],[39,61,14,61],[39,62,14,62],[39,63,14,63],[39,64,14,64],[40,4,15,4],[40,10,15,10,"s"],[40,11,15,11],[40,14,15,14,"BigInt"],[40,20,15,20],[40,21,15,21,"Hex"],[40,24,15,24],[40,25,15,25,"fromBytes"],[40,34,15,34],[40,35,15,35,"bytes"],[40,40,15,40],[40,41,15,41,"slice"],[40,46,15,46],[40,47,15,47,"s_start"],[40,54,15,54],[40,55,15,55],[40,56,15,56],[40,57,15,57],[41,4,16,4],[41,11,16,11],[42,6,17,8,"r"],[42,7,17,9],[43,6,18,8,"s"],[43,7,18,9],[43,9,18,11,"s"],[43,10,18,12],[43,13,18,15,"p256"],[43,26,18,19],[43,27,18,19,"p256"],[43,31,18,19],[43,32,18,20,"CURVE"],[43,37,18,25],[43,38,18,26,"n"],[43,39,18,27],[43,42,18,30],[43,44,18,32],[43,47,18,35,"p256"],[43,60,18,39],[43,61,18,39,"p256"],[43,65,18,39],[43,66,18,40,"CURVE"],[43,71,18,45],[43,72,18,46,"n"],[43,73,18,47],[43,76,18,50,"s"],[43,77,18,51],[43,80,18,54,"s"],[44,4,19,4],[44,5,19,5],[45,2,20,0],[46,2,21,0],[47,0,22,0],[48,0,23,0],[49,0,24,0],[50,0,25,0],[51,0,26,0],[52,2,27,7],[52,17,27,22,"parseCredentialPublicKey"],[52,41,27,46,"parseCredentialPublicKey"],[52,42,27,47,"response"],[52,50,27,55],[52,52,27,57],[53,4,28,4],[53,8,28,8],[54,6,29,8],[54,12,29,14,"publicKeyBuffer"],[54,27,29,29],[54,30,29,32,"response"],[54,38,29,40],[54,39,29,41,"getPublicKey"],[54,51,29,53],[54,52,29,54],[54,53,29,55],[55,6,30,8],[55,10,30,12],[55,11,30,13,"publicKeyBuffer"],[55,26,30,28],[55,28,31,12],[55,34,31,18],[55,38,31,22,"CredentialCreationFailedError"],[55,53,31,51],[55,54,31,51,"CredentialCreationFailedError"],[55,83,31,51],[55,84,31,52],[55,85,31,53],[56,6,32,8],[57,6,33,8],[57,12,33,14,"publicKeyBytes"],[57,26,33,28],[57,29,33,31],[57,33,33,35,"Uint8Array"],[57,43,33,45],[57,44,33,46,"publicKeyBuffer"],[57,59,33,61],[57,60,33,62],[58,6,34,8],[58,12,34,14,"cryptoKey"],[58,21,34,23],[58,24,34,26],[58,30,34,32,"crypto"],[58,36,34,38],[58,37,34,39,"subtle"],[58,43,34,45],[58,44,34,46,"importKey"],[58,53,34,55],[58,54,34,56],[58,60,34,62],[58,62,34,64],[58,66,34,68,"Uint8Array"],[58,76,34,78],[58,77,34,79,"publicKeyBytes"],[58,91,34,93],[58,92,34,94],[58,94,34,96],[59,8,35,12,"name"],[59,12,35,16],[59,14,35,18],[59,21,35,25],[60,8,36,12,"namedCurve"],[60,18,36,22],[60,20,36,24],[60,27,36,31],[61,8,37,12,"hash"],[61,12,37,16],[61,14,37,18],[62,6,38,8],[62,7,38,9],[62,9,38,11],[62,13,38,15],[62,15,38,17],[62,16,38,18],[62,24,38,26],[62,25,38,27],[62,26,38,28],[63,6,39,8],[63,12,39,14,"publicKey"],[63,21,39,23],[63,24,39,26],[63,28,39,30,"Uint8Array"],[63,38,39,40],[63,39,39,41],[63,45,39,47,"crypto"],[63,51,39,53],[63,52,39,54,"subtle"],[63,58,39,60],[63,59,39,61,"exportKey"],[63,68,39,70],[63,69,39,71],[63,74,39,76],[63,76,39,78,"cryptoKey"],[63,85,39,87],[63,86,39,88],[63,87,39,89],[64,6,40,8],[64,13,40,15,"PublicKey"],[64,22,40,24],[64,23,40,25,"from"],[64,27,40,29],[64,28,40,30,"publicKey"],[64,37,40,39],[64,38,40,40],[65,4,41,4],[65,5,41,5],[65,6,42,4],[65,13,42,11,"error"],[65,18,42,16],[65,20,42,18],[66,6,43,8],[67,6,44,8],[68,6,45,8],[69,6,46,8],[69,10,46,12,"error"],[69,15,46,17],[69,16,46,18,"message"],[69,23,46,25],[69,28,46,30],[69,64,46,66],[69,66,47,12],[69,72,47,18,"error"],[69,77,47,23],[70,6,48,8],[70,12,48,14,"data"],[70,16,48,18],[70,19,48,21],[70,23,48,25,"Uint8Array"],[70,33,48,35],[70,34,48,36,"response"],[70,42,48,44],[70,43,48,45,"attestationObject"],[70,60,48,62],[70,61,48,63],[71,6,49,8],[71,12,49,14,"coordinateLength"],[71,28,49,30],[71,31,49,33],[71,35,49,37],[72,6,50,8],[72,12,50,14,"cborPrefix"],[72,22,50,24],[72,25,50,27],[72,29,50,31],[73,6,51,8],[73,12,51,14,"findStart"],[73,21,51,23],[73,24,51,27,"key"],[73,27,51,30],[73,31,51,35],[74,8,52,12],[74,14,52,18,"coordinate"],[74,24,52,28],[74,27,52,31],[74,31,52,35,"Uint8Array"],[74,41,52,45],[74,42,52,46],[74,43,52,47,"key"],[74,46,52,50],[74,48,52,52,"cborPrefix"],[74,58,52,62],[74,60,52,64,"coordinateLength"],[74,76,52,80],[74,77,52,81],[74,78,52,82],[75,8,53,12],[75,13,53,17],[75,17,53,21,"i"],[75,18,53,22],[75,21,53,25],[75,22,53,26],[75,24,53,28,"i"],[75,25,53,29],[75,28,53,32,"data"],[75,32,53,36],[75,33,53,37,"length"],[75,39,53,43],[75,42,53,46,"coordinate"],[75,52,53,56],[75,53,53,57,"length"],[75,59,53,63],[75,61,53,65,"i"],[75,62,53,66],[75,64,53,68],[75,66,54,16],[75,70,54,20,"coordinate"],[75,80,54,30],[75,81,54,31,"every"],[75,86,54,36],[75,87,54,37],[75,88,54,38,"byte"],[75,92,54,42],[75,94,54,44,"j"],[75,95,54,45],[75,100,54,50,"data"],[75,104,54,54],[75,105,54,55,"i"],[75,106,54,56],[75,109,54,59,"j"],[75,110,54,60],[75,111,54,61],[75,116,54,66,"byte"],[75,120,54,70],[75,121,54,71],[75,123,55,20],[75,130,55,27,"i"],[75,131,55,28],[75,134,55,31,"coordinate"],[75,144,55,41],[75,145,55,42,"length"],[75,151,55,48],[76,8,56,12],[76,14,56,18],[76,18,56,22,"CredentialCreationFailedError"],[76,33,56,51],[76,34,56,51,"CredentialCreationFailedError"],[76,63,56,51],[76,64,56,52],[76,65,56,53],[77,6,57,8],[77,7,57,9],[78,6,58,8],[78,12,58,14,"xStart"],[78,18,58,20],[78,21,58,23,"findStart"],[78,30,58,32],[78,31,58,33],[78,35,58,37],[78,36,58,38],[79,6,59,8],[79,12,59,14,"yStart"],[79,18,59,20],[79,21,59,23,"findStart"],[79,30,59,32],[79,31,59,33],[79,35,59,37],[79,36,59,38],[80,6,60,8],[80,13,60,15,"PublicKey"],[80,22,60,24],[80,23,60,25,"from"],[80,27,60,29],[80,28,60,30],[80,32,60,34,"Uint8Array"],[80,42,60,44],[80,43,60,45],[80,44,61,12],[80,48,61,16],[80,50,62,12],[80,53,62,15,"data"],[80,57,62,19],[80,58,62,20,"slice"],[80,63,62,25],[80,64,62,26,"xStart"],[80,70,62,32],[80,72,62,34,"xStart"],[80,78,62,40],[80,81,62,43,"coordinateLength"],[80,97,62,59],[80,98,62,60],[80,100,63,12],[80,103,63,15,"data"],[80,107,63,19],[80,108,63,20,"slice"],[80,113,63,25],[80,114,63,26,"yStart"],[80,120,63,32],[80,122,63,34,"yStart"],[80,128,63,40],[80,131,63,43,"coordinateLength"],[80,147,63,59],[80,148,63,60],[80,149,64,9],[80,150,64,10],[80,151,64,11],[81,4,65,4],[82,2,66,0],[83,0,66,1],[83,3]],"functionMap":{"names":["<global>","parseAsn1Signature","parseCredentialPublicKey","findStart","coordinate.every$argument_0"],"mappings":"AAA;OCS;CDU;OEO;0BCwB;qCCG,iCD;SDG;CFS"},"hasCjsExports":false},"type":"js/module"}]}