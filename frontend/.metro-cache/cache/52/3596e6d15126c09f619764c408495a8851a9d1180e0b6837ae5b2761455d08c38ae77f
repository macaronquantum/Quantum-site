{"dependencies":[{"name":"../../constants/abis.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":73,"index":73}}],"key":"LZvwvaZmwAX6SyAqVHRt5iP6qx8=","exportNames":["*"],"imports":1}},{"name":"../../constants/contracts.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":74},"end":{"line":2,"column":83,"index":157}}],"key":"b/tl5Ug/COmIS97PDoQeIuXc5GU=","exportNames":["*"],"imports":1}},{"name":"../../errors/contract.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":158},"end":{"line":3,"column":62,"index":220}}],"key":"pu+Gm6xdmJpOol3ibtAAH4q14qs=","exportNames":["*"],"imports":1}},{"name":"../../utils/abi/encodeDeployData.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":221},"end":{"line":4,"column":72,"index":293}}],"key":"I5l/WkecYSILZO4ok15/Ea9ewqg=","exportNames":["*"],"imports":1}},{"name":"../../utils/address/getAddress.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":294},"end":{"line":5,"column":63,"index":357}}],"key":"U+tnwsBc9jSVNJw1pK5ns6DGAY8=","exportNames":["*"],"imports":1}},{"name":"../../utils/address/isAddressEqual.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":358},"end":{"line":6,"column":71,"index":429}}],"key":"QOKdL7e5DneeeeM2JMix/Sm+VlQ=","exportNames":["*"],"imports":1}},{"name":"../../utils/data/isHex.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":430},"end":{"line":7,"column":50,"index":480}}],"key":"/2En9yCSYltwMvOB2kCib+LiN7k=","exportNames":["*"],"imports":1}},{"name":"../../utils/encoding/toHex.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":481},"end":{"line":8,"column":59,"index":540}}],"key":"U2IsyW1seIe5m4FUbe8axrr/0FQ=","exportNames":["*"],"imports":1}},{"name":"../../utils/getAction.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":541},"end":{"line":9,"column":53,"index":594}}],"key":"vt4scbNyA2t/tyY0oQJI6AZPJS4=","exportNames":["*"],"imports":1}},{"name":"../../utils/index.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":595},"end":{"line":10,"column":69,"index":664}}],"key":"AUCnYNcCot7PlCuuOg5nVchJREc=","exportNames":["*"],"imports":1}},{"name":"../../utils/signature/isErc6492Signature.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":11,"column":0,"index":665},"end":{"line":11,"column":81,"index":746}}],"key":"7xJE9H9vNtr/JoeVHuharBrpVgE=","exportNames":["*"],"imports":1}},{"name":"../../utils/signature/recoverAddress.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":747},"end":{"line":12,"column":73,"index":820}}],"key":"sgMvi1+Uti/PJXfJxLhDNCiEzvw=","exportNames":["*"],"imports":1}},{"name":"../../utils/signature/serializeErc6492Signature.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":13,"column":0,"index":821},"end":{"line":13,"column":95,"index":916}}],"key":"pUobxYMX1E9hRX71GSwnh/1FFEs=","exportNames":["*"],"imports":1}},{"name":"../../utils/signature/serializeSignature.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":917},"end":{"line":14,"column":81,"index":998}}],"key":"AV4E+xvEzboBrzK9nJH/uFiu2XQ=","exportNames":["*"],"imports":1}},{"name":"./call.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":15,"column":0,"index":999},"end":{"line":15,"column":33,"index":1032}}],"key":"aSmxMv/g2RJz56PpxDSq10PV1HA=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.verifyHash = verifyHash;\n  var _constantsAbisJs = require(_dependencyMap[0], \"../../constants/abis.js\");\n  var _constantsContractsJs = require(_dependencyMap[1], \"../../constants/contracts.js\");\n  var _errorsContractJs = require(_dependencyMap[2], \"../../errors/contract.js\");\n  var _utilsAbiEncodeDeployDataJs = require(_dependencyMap[3], \"../../utils/abi/encodeDeployData.js\");\n  var _utilsAddressGetAddressJs = require(_dependencyMap[4], \"../../utils/address/getAddress.js\");\n  var _utilsAddressIsAddressEqualJs = require(_dependencyMap[5], \"../../utils/address/isAddressEqual.js\");\n  var _utilsDataIsHexJs = require(_dependencyMap[6], \"../../utils/data/isHex.js\");\n  var _utilsEncodingToHexJs = require(_dependencyMap[7], \"../../utils/encoding/toHex.js\");\n  var _utilsGetActionJs = require(_dependencyMap[8], \"../../utils/getAction.js\");\n  var _utilsIndexJs = require(_dependencyMap[9], \"../../utils/index.js\");\n  var _utilsSignatureIsErc6492SignatureJs = require(_dependencyMap[10], \"../../utils/signature/isErc6492Signature.js\");\n  var _utilsSignatureRecoverAddressJs = require(_dependencyMap[11], \"../../utils/signature/recoverAddress.js\");\n  var _utilsSignatureSerializeErc6492SignatureJs = require(_dependencyMap[12], \"../../utils/signature/serializeErc6492Signature.js\");\n  var _utilsSignatureSerializeSignatureJs = require(_dependencyMap[13], \"../../utils/signature/serializeSignature.js\");\n  var _callJs = require(_dependencyMap[14], \"./call.js\");\n  /**\n   * Verifies a message hash onchain using ERC-6492.\n   *\n   * @param client - Client to use.\n   * @param parameters - {@link VerifyHashParameters}\n   * @returns Whether or not the signature is valid. {@link VerifyHashReturnType}\n   */\n  async function verifyHash(client, parameters) {\n    const {\n      address,\n      factory,\n      factoryData,\n      hash,\n      signature,\n      universalSignatureVerifierAddress = client.chain?.contracts?.universalSignatureVerifier?.address,\n      ...rest\n    } = parameters;\n    const signatureHex = (() => {\n      if ((0, _utilsDataIsHexJs.isHex)(signature)) return signature;\n      if (typeof signature === 'object' && 'r' in signature && 's' in signature) return (0, _utilsSignatureSerializeSignatureJs.serializeSignature)(signature);\n      return (0, _utilsEncodingToHexJs.bytesToHex)(signature);\n    })();\n    const wrappedSignature = await (async () => {\n      // If no `factory` or `factoryData` is provided, it is assumed that the\n      // address is not a Smart Account, or the Smart Account is already deployed.\n      if (!factory && !factoryData) return signatureHex;\n      // If the signature is already wrapped, return the signature.\n      if ((0, _utilsSignatureIsErc6492SignatureJs.isErc6492Signature)(signatureHex)) return signatureHex;\n      // If the Smart Account is not deployed, wrap the signature with a 6492 wrapper\n      // to perform counterfactual validation.\n      return (0, _utilsSignatureSerializeErc6492SignatureJs.serializeErc6492Signature)({\n        address: factory,\n        data: factoryData,\n        signature: signatureHex\n      });\n    })();\n    try {\n      const args = universalSignatureVerifierAddress ? {\n        to: universalSignatureVerifierAddress,\n        data: (0, _utilsIndexJs.encodeFunctionData)({\n          abi: _constantsAbisJs.universalSignatureValidatorAbi,\n          functionName: 'isValidSig',\n          args: [address, hash, wrappedSignature]\n        }),\n        ...rest\n      } : {\n        data: (0, _utilsAbiEncodeDeployDataJs.encodeDeployData)({\n          abi: _constantsAbisJs.universalSignatureValidatorAbi,\n          args: [address, hash, wrappedSignature],\n          bytecode: _constantsContractsJs.universalSignatureValidatorByteCode\n        }),\n        ...rest\n      };\n      const {\n        data\n      } = await (0, _utilsGetActionJs.getAction)(client, _callJs.call, 'call')(args);\n      return (0, _utilsIndexJs.hexToBool)(data ?? '0x0');\n    } catch (error) {\n      // Fallback attempt to verify the signature via ECDSA recovery.\n      try {\n        const verified = (0, _utilsAddressIsAddressEqualJs.isAddressEqual)((0, _utilsAddressGetAddressJs.getAddress)(address), await (0, _utilsSignatureRecoverAddressJs.recoverAddress)({\n          hash,\n          signature\n        }));\n        if (verified) return true;\n      } catch {}\n      if (error instanceof _errorsContractJs.CallExecutionError) {\n        // if the execution fails, the signature was not valid and an internal method inside of the validator reverted\n        // this can happen for many reasons, for example if signer can not be recovered from the signature\n        // or if the signature has no valid format\n        return false;\n      }\n      throw error;\n    }\n  }\n});","lineCount":98,"map":[[7,2,23,0,"exports"],[7,9,23,0],[7,10,23,0,"verifyHash"],[7,20,23,0],[7,23,23,0,"verifyHash"],[7,33,23,0],[8,2,1,0],[8,6,1,0,"_constantsAbisJs"],[8,22,1,0],[8,25,1,0,"require"],[8,32,1,0],[8,33,1,0,"_dependencyMap"],[8,47,1,0],[9,2,2,0],[9,6,2,0,"_constantsContractsJs"],[9,27,2,0],[9,30,2,0,"require"],[9,37,2,0],[9,38,2,0,"_dependencyMap"],[9,52,2,0],[10,2,3,0],[10,6,3,0,"_errorsContractJs"],[10,23,3,0],[10,26,3,0,"require"],[10,33,3,0],[10,34,3,0,"_dependencyMap"],[10,48,3,0],[11,2,4,0],[11,6,4,0,"_utilsAbiEncodeDeployDataJs"],[11,33,4,0],[11,36,4,0,"require"],[11,43,4,0],[11,44,4,0,"_dependencyMap"],[11,58,4,0],[12,2,5,0],[12,6,5,0,"_utilsAddressGetAddressJs"],[12,31,5,0],[12,34,5,0,"require"],[12,41,5,0],[12,42,5,0,"_dependencyMap"],[12,56,5,0],[13,2,6,0],[13,6,6,0,"_utilsAddressIsAddressEqualJs"],[13,35,6,0],[13,38,6,0,"require"],[13,45,6,0],[13,46,6,0,"_dependencyMap"],[13,60,6,0],[14,2,7,0],[14,6,7,0,"_utilsDataIsHexJs"],[14,23,7,0],[14,26,7,0,"require"],[14,33,7,0],[14,34,7,0,"_dependencyMap"],[14,48,7,0],[15,2,8,0],[15,6,8,0,"_utilsEncodingToHexJs"],[15,27,8,0],[15,30,8,0,"require"],[15,37,8,0],[15,38,8,0,"_dependencyMap"],[15,52,8,0],[16,2,9,0],[16,6,9,0,"_utilsGetActionJs"],[16,23,9,0],[16,26,9,0,"require"],[16,33,9,0],[16,34,9,0,"_dependencyMap"],[16,48,9,0],[17,2,10,0],[17,6,10,0,"_utilsIndexJs"],[17,19,10,0],[17,22,10,0,"require"],[17,29,10,0],[17,30,10,0,"_dependencyMap"],[17,44,10,0],[18,2,11,0],[18,6,11,0,"_utilsSignatureIsErc6492SignatureJs"],[18,41,11,0],[18,44,11,0,"require"],[18,51,11,0],[18,52,11,0,"_dependencyMap"],[18,66,11,0],[19,2,12,0],[19,6,12,0,"_utilsSignatureRecoverAddressJs"],[19,37,12,0],[19,40,12,0,"require"],[19,47,12,0],[19,48,12,0,"_dependencyMap"],[19,62,12,0],[20,2,13,0],[20,6,13,0,"_utilsSignatureSerializeErc6492SignatureJs"],[20,48,13,0],[20,51,13,0,"require"],[20,58,13,0],[20,59,13,0,"_dependencyMap"],[20,73,13,0],[21,2,14,0],[21,6,14,0,"_utilsSignatureSerializeSignatureJs"],[21,41,14,0],[21,44,14,0,"require"],[21,51,14,0],[21,52,14,0,"_dependencyMap"],[21,66,14,0],[22,2,15,0],[22,6,15,0,"_callJs"],[22,13,15,0],[22,16,15,0,"require"],[22,23,15,0],[22,24,15,0,"_dependencyMap"],[22,38,15,0],[23,2,16,0],[24,0,17,0],[25,0,18,0],[26,0,19,0],[27,0,20,0],[28,0,21,0],[29,0,22,0],[30,2,23,7],[30,17,23,22,"verifyHash"],[30,27,23,32,"verifyHash"],[30,28,23,33,"client"],[30,34,23,39],[30,36,23,41,"parameters"],[30,46,23,51],[30,48,23,53],[31,4,24,4],[31,10,24,10],[32,6,24,12,"address"],[32,13,24,19],[33,6,24,21,"factory"],[33,13,24,28],[34,6,24,30,"factoryData"],[34,17,24,41],[35,6,24,43,"hash"],[35,10,24,47],[36,6,24,49,"signature"],[36,15,24,58],[37,6,24,60,"universalSignatureVerifierAddress"],[37,39,24,93],[37,42,24,96,"client"],[37,48,24,102],[37,49,24,103,"chain"],[37,54,24,108],[37,56,24,110,"contracts"],[37,65,24,119],[37,67,25,10,"universalSignatureVerifier"],[37,93,25,36],[37,95,25,38,"address"],[37,102,25,45],[38,6,25,47],[38,9,25,50,"rest"],[39,4,25,55],[39,5,25,56],[39,8,25,59,"parameters"],[39,18,25,69],[40,4,26,4],[40,10,26,10,"signatureHex"],[40,22,26,22],[40,25,26,25],[40,26,26,26],[40,32,26,32],[41,6,27,8],[41,10,27,12],[41,14,27,12,"isHex"],[41,31,27,17],[41,32,27,17,"isHex"],[41,37,27,17],[41,39,27,18,"signature"],[41,48,27,27],[41,49,27,28],[41,51,28,12],[41,58,28,19,"signature"],[41,67,28,28],[42,6,29,8],[42,10,29,12],[42,17,29,19,"signature"],[42,26,29,28],[42,31,29,33],[42,39,29,41],[42,43,29,45],[42,46,29,48],[42,50,29,52,"signature"],[42,59,29,61],[42,63,29,65],[42,66,29,68],[42,70,29,72,"signature"],[42,79,29,81],[42,81,30,12],[42,88,30,19],[42,92,30,19,"serializeSignature"],[42,127,30,37],[42,128,30,37,"serializeSignature"],[42,146,30,37],[42,148,30,38,"signature"],[42,157,30,47],[42,158,30,48],[43,6,31,8],[43,13,31,15],[43,17,31,15,"bytesToHex"],[43,38,31,25],[43,39,31,25,"bytesToHex"],[43,49,31,25],[43,51,31,26,"signature"],[43,60,31,35],[43,61,31,36],[44,4,32,4],[44,5,32,5],[44,7,32,7],[44,8,32,8],[45,4,33,4],[45,10,33,10,"wrappedSignature"],[45,26,33,26],[45,29,33,29],[45,35,33,35],[45,36,33,36],[45,48,33,48],[46,6,34,8],[47,6,35,8],[48,6,36,8],[48,10,36,12],[48,11,36,13,"factory"],[48,18,36,20],[48,22,36,24],[48,23,36,25,"factoryData"],[48,34,36,36],[48,36,37,12],[48,43,37,19,"signatureHex"],[48,55,37,31],[49,6,38,8],[50,6,39,8],[50,10,39,12],[50,14,39,12,"isErc6492Signature"],[50,49,39,30],[50,50,39,30,"isErc6492Signature"],[50,68,39,30],[50,70,39,31,"signatureHex"],[50,82,39,43],[50,83,39,44],[50,85,40,12],[50,92,40,19,"signatureHex"],[50,104,40,31],[51,6,41,8],[52,6,42,8],[53,6,43,8],[53,13,43,15],[53,17,43,15,"serializeErc6492Signature"],[53,59,43,40],[53,60,43,40,"serializeErc6492Signature"],[53,85,43,40],[53,87,43,41],[54,8,44,12,"address"],[54,15,44,19],[54,17,44,21,"factory"],[54,24,44,28],[55,8,45,12,"data"],[55,12,45,16],[55,14,45,18,"factoryData"],[55,25,45,29],[56,8,46,12,"signature"],[56,17,46,21],[56,19,46,23,"signatureHex"],[57,6,47,8],[57,7,47,9],[57,8,47,10],[58,4,48,4],[58,5,48,5],[58,7,48,7],[58,8,48,8],[59,4,49,4],[59,8,49,8],[60,6,50,8],[60,12,50,14,"args"],[60,16,50,18],[60,19,50,21,"universalSignatureVerifierAddress"],[60,52,50,54],[60,55,51,14],[61,8,52,16,"to"],[61,10,52,18],[61,12,52,20,"universalSignatureVerifierAddress"],[61,45,52,53],[62,8,53,16,"data"],[62,12,53,20],[62,14,53,22],[62,18,53,22,"encodeFunctionData"],[62,31,53,40],[62,32,53,40,"encodeFunctionData"],[62,50,53,40],[62,52,53,41],[63,10,54,20,"abi"],[63,13,54,23],[63,15,54,25,"universalSignatureValidatorAbi"],[63,31,54,55],[63,32,54,55,"universalSignatureValidatorAbi"],[63,62,54,55],[64,10,55,20,"functionName"],[64,22,55,32],[64,24,55,34],[64,36,55,46],[65,10,56,20,"args"],[65,14,56,24],[65,16,56,26],[65,17,56,27,"address"],[65,24,56,34],[65,26,56,36,"hash"],[65,30,56,40],[65,32,56,42,"wrappedSignature"],[65,48,56,58],[66,8,57,16],[66,9,57,17],[66,10,57,18],[67,8,58,16],[67,11,58,19,"rest"],[68,6,59,12],[68,7,59,13],[68,10,60,14],[69,8,61,16,"data"],[69,12,61,20],[69,14,61,22],[69,18,61,22,"encodeDeployData"],[69,45,61,38],[69,46,61,38,"encodeDeployData"],[69,62,61,38],[69,64,61,39],[70,10,62,20,"abi"],[70,13,62,23],[70,15,62,25,"universalSignatureValidatorAbi"],[70,31,62,55],[70,32,62,55,"universalSignatureValidatorAbi"],[70,62,62,55],[71,10,63,20,"args"],[71,14,63,24],[71,16,63,26],[71,17,63,27,"address"],[71,24,63,34],[71,26,63,36,"hash"],[71,30,63,40],[71,32,63,42,"wrappedSignature"],[71,48,63,58],[71,49,63,59],[72,10,64,20,"bytecode"],[72,18,64,28],[72,20,64,30,"universalSignatureValidatorByteCode"],[72,41,64,65],[72,42,64,65,"universalSignatureValidatorByteCode"],[73,8,65,16],[73,9,65,17],[73,10,65,18],[74,8,66,16],[74,11,66,19,"rest"],[75,6,67,12],[75,7,67,13],[76,6,68,8],[76,12,68,14],[77,8,68,16,"data"],[78,6,68,21],[78,7,68,22],[78,10,68,25],[78,16,68,31],[78,20,68,31,"getAction"],[78,37,68,40],[78,38,68,40,"getAction"],[78,47,68,40],[78,49,68,41,"client"],[78,55,68,47],[78,57,68,49,"call"],[78,64,68,53],[78,65,68,53,"call"],[78,69,68,53],[78,71,68,55],[78,77,68,61],[78,78,68,62],[78,79,68,63,"args"],[78,83,68,67],[78,84,68,68],[79,6,69,8],[79,13,69,15],[79,17,69,15,"hexToBool"],[79,30,69,24],[79,31,69,24,"hexToBool"],[79,40,69,24],[79,42,69,25,"data"],[79,46,69,29],[79,50,69,33],[79,55,69,38],[79,56,69,39],[80,4,70,4],[80,5,70,5],[80,6,71,4],[80,13,71,11,"error"],[80,18,71,16],[80,20,71,18],[81,6,72,8],[82,6,73,8],[82,10,73,12],[83,8,74,12],[83,14,74,18,"verified"],[83,22,74,26],[83,25,74,29],[83,29,74,29,"isAddressEqual"],[83,58,74,43],[83,59,74,43,"isAddressEqual"],[83,73,74,43],[83,75,74,44],[83,79,74,44,"getAddress"],[83,104,74,54],[83,105,74,54,"getAddress"],[83,115,74,54],[83,117,74,55,"address"],[83,124,74,62],[83,125,74,63],[83,127,74,65],[83,133,74,71],[83,137,74,71,"recoverAddress"],[83,168,74,85],[83,169,74,85,"recoverAddress"],[83,183,74,85],[83,185,74,86],[84,10,74,88,"hash"],[84,14,74,92],[85,10,74,94,"signature"],[86,8,74,104],[86,9,74,105],[86,10,74,106],[86,11,74,107],[87,8,75,12],[87,12,75,16,"verified"],[87,20,75,24],[87,22,76,16],[87,29,76,23],[87,33,76,27],[88,6,77,8],[88,7,77,9],[88,8,78,8],[88,14,78,14],[88,15,78,16],[89,6,79,8],[89,10,79,12,"error"],[89,15,79,17],[89,27,79,29,"CallExecutionError"],[89,44,79,47],[89,45,79,47,"CallExecutionError"],[89,63,79,47],[89,65,79,49],[90,8,80,12],[91,8,81,12],[92,8,82,12],[93,8,83,12],[93,15,83,19],[93,20,83,24],[94,6,84,8],[95,6,85,8],[95,12,85,14,"error"],[95,17,85,19],[96,4,86,4],[97,2,87,0],[98,0,87,1],[98,3]],"functionMap":{"names":["<global>","verifyHash","<anonymous>"],"mappings":"AAA;OCsB;0BCG;KDM;oCCC;KDe;CDuC"},"hasCjsExports":false},"type":"js/module"}]}