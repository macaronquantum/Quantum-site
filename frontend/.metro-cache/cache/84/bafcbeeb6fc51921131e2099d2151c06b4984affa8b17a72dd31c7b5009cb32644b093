{"dependencies":[{"name":"../../utils/getAction.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":53,"index":53}}],"key":"vt4scbNyA2t/tyY0oQJI6AZPJS4=","exportNames":["*"],"imports":1}},{"name":"../../utils/observe.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":54},"end":{"line":2,"column":49,"index":103}}],"key":"HKjcCKJVuiHtohOTQ78FBQFk94I=","exportNames":["*"],"imports":1}},{"name":"../../utils/poll.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":104},"end":{"line":3,"column":43,"index":147}}],"key":"Vy9/0HY5f9EZBKje2fl3cZrd9b0=","exportNames":["*"],"imports":1}},{"name":"../../utils/stringify.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":148},"end":{"line":4,"column":53,"index":201}}],"key":"hATh5RA/q0TQG1HzvPAqv2f5XM8=","exportNames":["*"],"imports":1}},{"name":"./createPendingTransactionFilter.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":202},"end":{"line":5,"column":85,"index":287}}],"key":"SrsJN+GiW+D96Ql0crywaG7cA2A=","exportNames":["*"],"imports":1}},{"name":"./getFilterChanges.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":288},"end":{"line":6,"column":57,"index":345}}],"key":"wjNQDF4/IGWZHpSGaDtBl05QJx8=","exportNames":["*"],"imports":1}},{"name":"./uninstallFilter.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":346},"end":{"line":7,"column":55,"index":401}}],"key":"4Ixra2lwclZlxAeICKfRfCpMyzY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.watchPendingTransactions = watchPendingTransactions;\n  var _utilsGetActionJs = require(_dependencyMap[0], \"../../utils/getAction.js\");\n  var _utilsObserveJs = require(_dependencyMap[1], \"../../utils/observe.js\");\n  var _utilsPollJs = require(_dependencyMap[2], \"../../utils/poll.js\");\n  var _utilsStringifyJs = require(_dependencyMap[3], \"../../utils/stringify.js\");\n  var _createPendingTransactionFilterJs = require(_dependencyMap[4], \"./createPendingTransactionFilter.js\");\n  var _getFilterChangesJs = require(_dependencyMap[5], \"./getFilterChanges.js\");\n  var _uninstallFilterJs = require(_dependencyMap[6], \"./uninstallFilter.js\");\n  /**\n   * Watches and returns pending transaction hashes.\n   *\n   * - Docs: https://viem.sh/docs/actions/public/watchPendingTransactions\n   * - JSON-RPC Methods:\n   *   - When `poll: true`\n   *     - Calls [`eth_newPendingTransactionFilter`](https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_newpendingtransactionfilter) to initialize the filter.\n   *     - Calls [`eth_getFilterChanges`](https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_getFilterChanges) on a polling interval.\n   *   - When `poll: false` & WebSocket Transport, uses a WebSocket subscription via [`eth_subscribe`](https://docs.alchemy.com/reference/eth-subscribe-polygon) and the `\"newPendingTransactions\"` event.\n   *\n   * This Action will batch up all the pending transactions found within the [`pollingInterval`](https://viem.sh/docs/actions/public/watchPendingTransactions#pollinginterval-optional), and invoke them via [`onTransactions`](https://viem.sh/docs/actions/public/watchPendingTransactions#ontransactions).\n   *\n   * @param client - Client to use\n   * @param parameters - {@link WatchPendingTransactionsParameters}\n   * @returns A function that can be invoked to stop watching for new pending transaction hashes. {@link WatchPendingTransactionsReturnType}\n   *\n   * @example\n   * import { createPublicClient, http } from 'viem'\n   * import { mainnet } from 'viem/chains'\n   * import { watchPendingTransactions } from 'viem/public'\n   *\n   * const client = createPublicClient({\n   *   chain: mainnet,\n   *   transport: http(),\n   * })\n   * const unwatch = await watchPendingTransactions(client, {\n   *   onTransactions: (hashes) => console.log(hashes),\n   * })\n   */\n  function watchPendingTransactions(client, {\n    batch = true,\n    onError,\n    onTransactions,\n    poll: poll_,\n    pollingInterval = client.pollingInterval\n  }) {\n    const enablePolling = typeof poll_ !== 'undefined' ? poll_ : client.transport.type !== 'webSocket';\n    const pollPendingTransactions = () => {\n      const observerId = (0, _utilsStringifyJs.stringify)(['watchPendingTransactions', client.uid, batch, pollingInterval]);\n      return (0, _utilsObserveJs.observe)(observerId, {\n        onTransactions,\n        onError\n      }, emit => {\n        let filter;\n        const unwatch = (0, _utilsPollJs.poll)(async () => {\n          try {\n            if (!filter) {\n              try {\n                filter = await (0, _utilsGetActionJs.getAction)(client, _createPendingTransactionFilterJs.createPendingTransactionFilter, 'createPendingTransactionFilter')({});\n                return;\n              } catch (err) {\n                unwatch();\n                throw err;\n              }\n            }\n            const hashes = await (0, _utilsGetActionJs.getAction)(client, _getFilterChangesJs.getFilterChanges, 'getFilterChanges')({\n              filter\n            });\n            if (hashes.length === 0) return;\n            if (batch) emit.onTransactions(hashes);else for (const hash of hashes) emit.onTransactions([hash]);\n          } catch (err) {\n            emit.onError?.(err);\n          }\n        }, {\n          emitOnBegin: true,\n          interval: pollingInterval\n        });\n        return async () => {\n          if (filter) await (0, _utilsGetActionJs.getAction)(client, _uninstallFilterJs.uninstallFilter, 'uninstallFilter')({\n            filter\n          });\n          unwatch();\n        };\n      });\n    };\n    const subscribePendingTransactions = () => {\n      let active = true;\n      let unsubscribe = () => active = false;\n      (async () => {\n        try {\n          const {\n            unsubscribe: unsubscribe_\n          } = await client.transport.subscribe({\n            params: ['newPendingTransactions'],\n            onData(data) {\n              if (!active) return;\n              const transaction = data.result;\n              onTransactions([transaction]);\n            },\n            onError(error) {\n              onError?.(error);\n            }\n          });\n          unsubscribe = unsubscribe_;\n          if (!active) unsubscribe();\n        } catch (err) {\n          onError?.(err);\n        }\n      })();\n      return () => unsubscribe();\n    };\n    return enablePolling ? pollPendingTransactions() : subscribePendingTransactions();\n  }\n});","lineCount":118,"map":[[7,2,37,0,"exports"],[7,9,37,0],[7,10,37,0,"watchPendingTransactions"],[7,34,37,0],[7,37,37,0,"watchPendingTransactions"],[7,61,37,0],[8,2,1,0],[8,6,1,0,"_utilsGetActionJs"],[8,23,1,0],[8,26,1,0,"require"],[8,33,1,0],[8,34,1,0,"_dependencyMap"],[8,48,1,0],[9,2,2,0],[9,6,2,0,"_utilsObserveJs"],[9,21,2,0],[9,24,2,0,"require"],[9,31,2,0],[9,32,2,0,"_dependencyMap"],[9,46,2,0],[10,2,3,0],[10,6,3,0,"_utilsPollJs"],[10,18,3,0],[10,21,3,0,"require"],[10,28,3,0],[10,29,3,0,"_dependencyMap"],[10,43,3,0],[11,2,4,0],[11,6,4,0,"_utilsStringifyJs"],[11,23,4,0],[11,26,4,0,"require"],[11,33,4,0],[11,34,4,0,"_dependencyMap"],[11,48,4,0],[12,2,5,0],[12,6,5,0,"_createPendingTransactionFilterJs"],[12,39,5,0],[12,42,5,0,"require"],[12,49,5,0],[12,50,5,0,"_dependencyMap"],[12,64,5,0],[13,2,6,0],[13,6,6,0,"_getFilterChangesJs"],[13,25,6,0],[13,28,6,0,"require"],[13,35,6,0],[13,36,6,0,"_dependencyMap"],[13,50,6,0],[14,2,7,0],[14,6,7,0,"_uninstallFilterJs"],[14,24,7,0],[14,27,7,0,"require"],[14,34,7,0],[14,35,7,0,"_dependencyMap"],[14,49,7,0],[15,2,8,0],[16,0,9,0],[17,0,10,0],[18,0,11,0],[19,0,12,0],[20,0,13,0],[21,0,14,0],[22,0,15,0],[23,0,16,0],[24,0,17,0],[25,0,18,0],[26,0,19,0],[27,0,20,0],[28,0,21,0],[29,0,22,0],[30,0,23,0],[31,0,24,0],[32,0,25,0],[33,0,26,0],[34,0,27,0],[35,0,28,0],[36,0,29,0],[37,0,30,0],[38,0,31,0],[39,0,32,0],[40,0,33,0],[41,0,34,0],[42,0,35,0],[43,0,36,0],[44,2,37,7],[44,11,37,16,"watchPendingTransactions"],[44,35,37,40,"watchPendingTransactions"],[44,36,37,41,"client"],[44,42,37,47],[44,44,37,49],[45,4,37,51,"batch"],[45,9,37,56],[45,12,37,59],[45,16,37,63],[46,4,37,65,"onError"],[46,11,37,72],[47,4,37,74,"onTransactions"],[47,18,37,88],[48,4,37,90,"poll"],[48,8,37,94],[48,10,37,96,"poll_"],[48,15,37,101],[49,4,37,103,"pollingInterval"],[49,19,37,118],[49,22,37,121,"client"],[49,28,37,127],[49,29,37,128,"pollingInterval"],[50,2,37,145],[50,3,37,146],[50,5,37,148],[51,4,38,4],[51,10,38,10,"enablePolling"],[51,23,38,23],[51,26,38,26],[51,33,38,33,"poll_"],[51,38,38,38],[51,43,38,43],[51,54,38,54],[51,57,38,57,"poll_"],[51,62,38,62],[51,65,38,65,"client"],[51,71,38,71],[51,72,38,72,"transport"],[51,81,38,81],[51,82,38,82,"type"],[51,86,38,86],[51,91,38,91],[51,102,38,102],[52,4,39,4],[52,10,39,10,"pollPendingTransactions"],[52,33,39,33],[52,36,39,36,"pollPendingTransactions"],[52,37,39,36],[52,42,39,42],[53,6,40,8],[53,12,40,14,"observerId"],[53,22,40,24],[53,25,40,27],[53,29,40,27,"stringify"],[53,46,40,36],[53,47,40,36,"stringify"],[53,56,40,36],[53,58,40,37],[53,59,41,12],[53,85,41,38],[53,87,42,12,"client"],[53,93,42,18],[53,94,42,19,"uid"],[53,97,42,22],[53,99,43,12,"batch"],[53,104,43,17],[53,106,44,12,"pollingInterval"],[53,121,44,27],[53,122,45,9],[53,123,45,10],[54,6,46,8],[54,13,46,15],[54,17,46,15,"observe"],[54,32,46,22],[54,33,46,22,"observe"],[54,40,46,22],[54,42,46,23,"observerId"],[54,52,46,33],[54,54,46,35],[55,8,46,37,"onTransactions"],[55,22,46,51],[56,8,46,53,"onError"],[57,6,46,61],[57,7,46,62],[57,9,46,65,"emit"],[57,13,46,69],[57,17,46,74],[58,8,47,12],[58,12,47,16,"filter"],[58,18,47,22],[59,8,48,12],[59,14,48,18,"unwatch"],[59,21,48,25],[59,24,48,28],[59,28,48,28,"poll"],[59,40,48,32],[59,41,48,32,"poll"],[59,45,48,32],[59,47,48,33],[59,59,48,45],[60,10,49,16],[60,14,49,20],[61,12,50,20],[61,16,50,24],[61,17,50,25,"filter"],[61,23,50,31],[61,25,50,33],[62,14,51,24],[62,18,51,28],[63,16,52,28,"filter"],[63,22,52,34],[63,25,52,37],[63,31,52,43],[63,35,52,43,"getAction"],[63,52,52,52],[63,53,52,52,"getAction"],[63,62,52,52],[63,64,52,53,"client"],[63,70,52,59],[63,72,52,61,"createPendingTransactionFilter"],[63,105,52,91],[63,106,52,91,"createPendingTransactionFilter"],[63,136,52,91],[63,138,52,93],[63,170,52,125],[63,171,52,126],[63,172,52,127],[63,173,52,128],[63,174,52,129],[63,175,52,130],[64,16,53,28],[65,14,54,24],[65,15,54,25],[65,16,55,24],[65,23,55,31,"err"],[65,26,55,34],[65,28,55,36],[66,16,56,28,"unwatch"],[66,23,56,35],[66,24,56,36],[66,25,56,37],[67,16,57,28],[67,22,57,34,"err"],[67,25,57,37],[68,14,58,24],[69,12,59,20],[70,12,60,20],[70,18,60,26,"hashes"],[70,24,60,32],[70,27,60,35],[70,33,60,41],[70,37,60,41,"getAction"],[70,54,60,50],[70,55,60,50,"getAction"],[70,64,60,50],[70,66,60,51,"client"],[70,72,60,57],[70,74,60,59,"getFilterChanges"],[70,93,60,75],[70,94,60,75,"getFilterChanges"],[70,110,60,75],[70,112,60,77],[70,130,60,95],[70,131,60,96],[70,132,60,97],[71,14,60,99,"filter"],[72,12,60,106],[72,13,60,107],[72,14,60,108],[73,12,61,20],[73,16,61,24,"hashes"],[73,22,61,30],[73,23,61,31,"length"],[73,29,61,37],[73,34,61,42],[73,35,61,43],[73,37,62,24],[74,12,63,20],[74,16,63,24,"batch"],[74,21,63,29],[74,23,64,24,"emit"],[74,27,64,28],[74,28,64,29,"onTransactions"],[74,42,64,43],[74,43,64,44,"hashes"],[74,49,64,50],[74,50,64,51],[74,51,64,52],[74,56,66,24],[74,61,66,29],[74,67,66,35,"hash"],[74,71,66,39],[74,75,66,43,"hashes"],[74,81,66,49],[74,83,67,28,"emit"],[74,87,67,32],[74,88,67,33,"onTransactions"],[74,102,67,47],[74,103,67,48],[74,104,67,49,"hash"],[74,108,67,53],[74,109,67,54],[74,110,67,55],[75,10,68,16],[75,11,68,17],[75,12,69,16],[75,19,69,23,"err"],[75,22,69,26],[75,24,69,28],[76,12,70,20,"emit"],[76,16,70,24],[76,17,70,25,"onError"],[76,24,70,32],[76,27,70,35,"err"],[76,30,70,38],[76,31,70,39],[77,10,71,16],[78,8,72,12],[78,9,72,13],[78,11,72,15],[79,10,73,16,"emitOnBegin"],[79,21,73,27],[79,23,73,29],[79,27,73,33],[80,10,74,16,"interval"],[80,18,74,24],[80,20,74,26,"pollingInterval"],[81,8,75,12],[81,9,75,13],[81,10,75,14],[82,8,76,12],[82,15,76,19],[82,27,76,31],[83,10,77,16],[83,14,77,20,"filter"],[83,20,77,26],[83,22,78,20],[83,28,78,26],[83,32,78,26,"getAction"],[83,49,78,35],[83,50,78,35,"getAction"],[83,59,78,35],[83,61,78,36,"client"],[83,67,78,42],[83,69,78,44,"uninstallFilter"],[83,87,78,59],[83,88,78,59,"uninstallFilter"],[83,103,78,59],[83,105,78,61],[83,122,78,78],[83,123,78,79],[83,124,78,80],[84,12,78,82,"filter"],[85,10,78,89],[85,11,78,90],[85,12,78,91],[86,10,79,16,"unwatch"],[86,17,79,23],[86,18,79,24],[86,19,79,25],[87,8,80,12],[87,9,80,13],[88,6,81,8],[88,7,81,9],[88,8,81,10],[89,4,82,4],[89,5,82,5],[90,4,83,4],[90,10,83,10,"subscribePendingTransactions"],[90,38,83,38],[90,41,83,41,"subscribePendingTransactions"],[90,42,83,41],[90,47,83,47],[91,6,84,8],[91,10,84,12,"active"],[91,16,84,18],[91,19,84,21],[91,23,84,25],[92,6,85,8],[92,10,85,12,"unsubscribe"],[92,21,85,23],[92,24,85,26,"unsubscribe"],[92,25,85,26],[92,30,85,33,"active"],[92,36,85,39],[92,39,85,42],[92,44,85,48],[93,6,86,8],[93,7,86,9],[93,19,86,21],[94,8,87,12],[94,12,87,16],[95,10,88,16],[95,16,88,22],[96,12,88,24,"unsubscribe"],[96,23,88,35],[96,25,88,37,"unsubscribe_"],[97,10,88,50],[97,11,88,51],[97,14,88,54],[97,20,88,60,"client"],[97,26,88,66],[97,27,88,67,"transport"],[97,36,88,76],[97,37,88,77,"subscribe"],[97,46,88,86],[97,47,88,87],[98,12,89,20,"params"],[98,18,89,26],[98,20,89,28],[98,21,89,29],[98,45,89,53],[98,46,89,54],[99,12,90,20,"onData"],[99,18,90,26,"onData"],[99,19,90,27,"data"],[99,23,90,31],[99,25,90,33],[100,14,91,24],[100,18,91,28],[100,19,91,29,"active"],[100,25,91,35],[100,27,92,28],[101,14,93,24],[101,20,93,30,"transaction"],[101,31,93,41],[101,34,93,44,"data"],[101,38,93,48],[101,39,93,49,"result"],[101,45,93,55],[102,14,94,24,"onTransactions"],[102,28,94,38],[102,29,94,39],[102,30,94,40,"transaction"],[102,41,94,51],[102,42,94,52],[102,43,94,53],[103,12,95,20],[103,13,95,21],[104,12,96,20,"onError"],[104,19,96,27,"onError"],[104,20,96,28,"error"],[104,25,96,33],[104,27,96,35],[105,14,97,24,"onError"],[105,21,97,31],[105,24,97,34,"error"],[105,29,97,39],[105,30,97,40],[106,12,98,20],[107,10,99,16],[107,11,99,17],[107,12,99,18],[108,10,100,16,"unsubscribe"],[108,21,100,27],[108,24,100,30,"unsubscribe_"],[108,36,100,42],[109,10,101,16],[109,14,101,20],[109,15,101,21,"active"],[109,21,101,27],[109,23,102,20,"unsubscribe"],[109,34,102,31],[109,35,102,32],[109,36,102,33],[110,8,103,12],[110,9,103,13],[110,10,104,12],[110,17,104,19,"err"],[110,20,104,22],[110,22,104,24],[111,10,105,16,"onError"],[111,17,105,23],[111,20,105,26,"err"],[111,23,105,29],[111,24,105,30],[112,8,106,12],[113,6,107,8],[113,7,107,9],[113,9,107,11],[113,10,107,12],[114,6,108,8],[114,13,108,15],[114,19,108,21,"unsubscribe"],[114,30,108,32],[114,31,108,33],[114,32,108,34],[115,4,109,4],[115,5,109,5],[116,4,110,4],[116,11,110,11,"enablePolling"],[116,24,110,24],[116,27,111,10,"pollPendingTransactions"],[116,50,111,33],[116,51,111,34],[116,52,111,35],[116,55,112,10,"subscribePendingTransactions"],[116,83,112,38],[116,84,112,39],[116,85,112,40],[117,2,113,0],[118,0,113,1],[118,3]],"functionMap":{"names":["<global>","watchPendingTransactions","pollPendingTransactions","observe$argument_2","poll$argument_0","<anonymous>","subscribePendingTransactions","unsubscribe","client.transport.subscribe$argument_0.onData","client.transport.subscribe$argument_0.onError"],"mappings":"AAA;OCoC;oCCE;gECO;iCCE;aDwB;mBEI;aFI;SDC;KDC;yCKC;0BCE,sBD;SDC;oBGI;qBHK;oBIC;qBJE;SCS;eDC,mBC;KLC;CDI"},"hasCjsExports":false},"type":"js/module"}]}