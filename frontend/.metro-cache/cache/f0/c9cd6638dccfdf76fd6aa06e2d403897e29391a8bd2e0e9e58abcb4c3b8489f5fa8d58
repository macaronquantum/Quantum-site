{"dependencies":[{"name":"../transport.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":23,"index":260},"end":{"line":7,"column":49,"index":286}}],"key":"lFCvJFzyfVWMX45Bf0f/rFXObZ0=","exportNames":["*"],"imports":1}},{"name":"../globals.node.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":26,"index":314},"end":{"line":8,"column":55,"index":343}}],"key":"ZfdmBFq8qn8BbA89eBFcCa3JjTk=","exportNames":["*"],"imports":1}},{"name":"engine.io-parser","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":9,"column":27,"index":372},"end":{"line":9,"column":54,"index":399}}],"key":"ZdCLryCFqJSS+1R9t7L2i2r0/QM=","exportNames":["*"],"imports":1}},{"name":"debug","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":10,"column":32,"index":433},"end":{"line":10,"column":48,"index":449}}],"key":"iZ55sBoXw9WwOGuopuB9Sv3DBX8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var __importDefault = this && this.__importDefault || function (mod) {\n    return mod && mod.__esModule ? mod : {\n      \"default\": mod\n    };\n  };\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.WT = void 0;\n  const transport_js_1 = require(_dependencyMap[0], \"../transport.js\");\n  const globals_node_js_1 = require(_dependencyMap[1], \"../globals.node.js\");\n  const engine_io_parser_1 = require(_dependencyMap[2], \"engine.io-parser\");\n  const debug_1 = __importDefault(require(_dependencyMap[3], \"debug\")); // debug()\n  const debug = (0, debug_1.default)(\"engine.io-client:webtransport\"); // debug()\n  /**\n   * WebTransport transport based on the built-in `WebTransport` object.\n   *\n   * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n   * @see https://caniuse.com/webtransport\n   */\n  class WT extends transport_js_1.Transport {\n    get name() {\n      return \"webtransport\";\n    }\n    doOpen() {\n      try {\n        // @ts-ignore\n        this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n      } catch (err) {\n        return this.emitReserved(\"error\", err);\n      }\n      this._transport.closed.then(() => {\n        debug(\"transport closed gracefully\");\n        this.onClose();\n      }).catch(err => {\n        debug(\"transport closed due to %s\", err);\n        this.onError(\"webtransport error\", err);\n      });\n      // note: we could have used async/await, but that would require some additional polyfills\n      this._transport.ready.then(() => {\n        this._transport.createBidirectionalStream().then(stream => {\n          const decoderStream = (0, engine_io_parser_1.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n          const reader = stream.readable.pipeThrough(decoderStream).getReader();\n          const encoderStream = (0, engine_io_parser_1.createPacketEncoderStream)();\n          encoderStream.readable.pipeTo(stream.writable);\n          this._writer = encoderStream.writable.getWriter();\n          const read = () => {\n            reader.read().then(({\n              done,\n              value\n            }) => {\n              if (done) {\n                debug(\"session is closed\");\n                return;\n              }\n              debug(\"received chunk: %o\", value);\n              this.onPacket(value);\n              read();\n            }).catch(err => {\n              debug(\"an error occurred while reading: %s\", err);\n            });\n          };\n          read();\n          const packet = {\n            type: \"open\"\n          };\n          if (this.query.sid) {\n            packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n          }\n          this._writer.write(packet).then(() => this.onOpen());\n        });\n      });\n    }\n    write(packets) {\n      this.writable = false;\n      for (let i = 0; i < packets.length; i++) {\n        const packet = packets[i];\n        const lastPacket = i === packets.length - 1;\n        this._writer.write(packet).then(() => {\n          if (lastPacket) {\n            (0, globals_node_js_1.nextTick)(() => {\n              this.writable = true;\n              this.emitReserved(\"drain\");\n            }, this.setTimeoutFn);\n          }\n        });\n      }\n    }\n    doClose() {\n      var _a;\n      (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n  }\n  exports.WT = WT;\n});","lineCount":100,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0],[4,6,2,4,"__importDefault"],[4,21,2,19],[4,24,2,23],[4,28,2,27],[4,32,2,31],[4,36,2,35],[4,37,2,36,"__importDefault"],[4,52,2,51],[4,56,2,56],[4,66,2,66,"mod"],[4,69,2,69],[4,71,2,71],[5,4,3,4],[5,11,3,12,"mod"],[5,14,3,15],[5,18,3,19,"mod"],[5,21,3,22],[5,22,3,23,"__esModule"],[5,32,3,33],[5,35,3,37,"mod"],[5,38,3,40],[5,41,3,43],[6,6,3,45],[6,15,3,54],[6,17,3,56,"mod"],[7,4,3,60],[7,5,3,61],[8,2,4,0],[8,3,4,1],[9,2,5,0,"Object"],[9,8,5,6],[9,9,5,7,"defineProperty"],[9,23,5,21],[9,24,5,22,"exports"],[9,31,5,29],[9,33,5,31],[9,45,5,43],[9,47,5,45],[10,4,5,47,"value"],[10,9,5,52],[10,11,5,54],[11,2,5,59],[11,3,5,60],[11,4,5,61],[12,2,6,0,"exports"],[12,9,6,7],[12,10,6,8,"WT"],[12,12,6,10],[12,15,6,13],[12,20,6,18],[12,21,6,19],[13,2,7,0],[13,8,7,6,"transport_js_1"],[13,22,7,20],[13,25,7,23,"require"],[13,32,7,30],[13,33,7,30,"_dependencyMap"],[13,47,7,30],[13,69,7,48],[13,70,7,49],[14,2,8,0],[14,8,8,6,"globals_node_js_1"],[14,25,8,23],[14,28,8,26,"require"],[14,35,8,33],[14,36,8,33,"_dependencyMap"],[14,50,8,33],[14,75,8,54],[14,76,8,55],[15,2,9,0],[15,8,9,6,"engine_io_parser_1"],[15,26,9,24],[15,29,9,27,"require"],[15,36,9,34],[15,37,9,34,"_dependencyMap"],[15,51,9,34],[15,74,9,53],[15,75,9,54],[16,2,10,0],[16,8,10,6,"debug_1"],[16,15,10,13],[16,18,10,16,"__importDefault"],[16,33,10,31],[16,34,10,32,"require"],[16,41,10,39],[16,42,10,39,"_dependencyMap"],[16,56,10,39],[16,68,10,47],[16,69,10,48],[16,70,10,49],[16,71,10,50],[16,72,10,51],[17,2,11,0],[17,8,11,6,"debug"],[17,13,11,11],[17,16,11,14],[17,17,11,15],[17,18,11,16],[17,20,11,18,"debug_1"],[17,27,11,25],[17,28,11,26,"default"],[17,35,11,33],[17,37,11,35],[17,68,11,66],[17,69,11,67],[17,70,11,68],[17,71,11,69],[18,2,12,0],[19,0,13,0],[20,0,14,0],[21,0,15,0],[22,0,16,0],[23,0,17,0],[24,0,18,0],[25,0,19,0],[26,2,20,0],[26,8,20,6,"WT"],[26,10,20,8],[26,19,20,17,"transport_js_1"],[26,33,20,31],[26,34,20,32,"Transport"],[26,43,20,41],[26,44,20,42],[27,4,21,4],[27,8,21,8,"name"],[27,12,21,12,"name"],[27,13,21,12],[27,15,21,15],[28,6,22,8],[28,13,22,15],[28,27,22,29],[29,4,23,4],[30,4,24,4,"doOpen"],[30,10,24,10,"doOpen"],[30,11,24,10],[30,13,24,13],[31,6,25,8],[31,10,25,12],[32,8,26,12],[33,8,27,12],[33,12,27,16],[33,13,27,17,"_transport"],[33,23,27,27],[33,26,27,30],[33,30,27,34,"WebTransport"],[33,42,27,46],[33,43,27,47],[33,47,27,51],[33,48,27,52,"createUri"],[33,57,27,61],[33,58,27,62],[33,65,27,69],[33,66,27,70],[33,68,27,72],[33,72,27,76],[33,73,27,77,"opts"],[33,77,27,81],[33,78,27,82,"transportOptions"],[33,94,27,98],[33,95,27,99],[33,99,27,103],[33,100,27,104,"name"],[33,104,27,108],[33,105,27,109],[33,106,27,110],[34,6,28,8],[34,7,28,9],[34,8,29,8],[34,15,29,15,"err"],[34,18,29,18],[34,20,29,20],[35,8,30,12],[35,15,30,19],[35,19,30,23],[35,20,30,24,"emitReserved"],[35,32,30,36],[35,33,30,37],[35,40,30,44],[35,42,30,46,"err"],[35,45,30,49],[35,46,30,50],[36,6,31,8],[37,6,32,8],[37,10,32,12],[37,11,32,13,"_transport"],[37,21,32,23],[37,22,32,24,"closed"],[37,28,32,30],[37,29,33,13,"then"],[37,33,33,17],[37,34,33,18],[37,40,33,24],[38,8,34,12,"debug"],[38,13,34,17],[38,14,34,18],[38,43,34,47],[38,44,34,48],[39,8,35,12],[39,12,35,16],[39,13,35,17,"onClose"],[39,20,35,24],[39,21,35,25],[39,22,35,26],[40,6,36,8],[40,7,36,9],[40,8,36,10],[40,9,37,13,"catch"],[40,14,37,18],[40,15,37,20,"err"],[40,18,37,23],[40,22,37,28],[41,8,38,12,"debug"],[41,13,38,17],[41,14,38,18],[41,42,38,46],[41,44,38,48,"err"],[41,47,38,51],[41,48,38,52],[42,8,39,12],[42,12,39,16],[42,13,39,17,"onError"],[42,20,39,24],[42,21,39,25],[42,41,39,45],[42,43,39,47,"err"],[42,46,39,50],[42,47,39,51],[43,6,40,8],[43,7,40,9],[43,8,40,10],[44,6,41,8],[45,6,42,8],[45,10,42,12],[45,11,42,13,"_transport"],[45,21,42,23],[45,22,42,24,"ready"],[45,27,42,29],[45,28,42,30,"then"],[45,32,42,34],[45,33,42,35],[45,39,42,41],[46,8,43,12],[46,12,43,16],[46,13,43,17,"_transport"],[46,23,43,27],[46,24,43,28,"createBidirectionalStream"],[46,49,43,53],[46,50,43,54],[46,51,43,55],[46,52,43,56,"then"],[46,56,43,60],[46,57,43,62,"stream"],[46,63,43,68],[46,67,43,73],[47,10,44,16],[47,16,44,22,"decoderStream"],[47,29,44,35],[47,32,44,38],[47,33,44,39],[47,34,44,40],[47,36,44,42,"engine_io_parser_1"],[47,54,44,60],[47,55,44,61,"createPacketDecoderStream"],[47,80,44,86],[47,82,44,88,"Number"],[47,88,44,94],[47,89,44,95,"MAX_SAFE_INTEGER"],[47,105,44,111],[47,107,44,113],[47,111,44,117],[47,112,44,118,"socket"],[47,118,44,124],[47,119,44,125,"binaryType"],[47,129,44,135],[47,130,44,136],[48,10,45,16],[48,16,45,22,"reader"],[48,22,45,28],[48,25,45,31,"stream"],[48,31,45,37],[48,32,45,38,"readable"],[48,40,45,46],[48,41,45,47,"pipeThrough"],[48,52,45,58],[48,53,45,59,"decoderStream"],[48,66,45,72],[48,67,45,73],[48,68,45,74,"getReader"],[48,77,45,83],[48,78,45,84],[48,79,45,85],[49,10,46,16],[49,16,46,22,"encoderStream"],[49,29,46,35],[49,32,46,38],[49,33,46,39],[49,34,46,40],[49,36,46,42,"engine_io_parser_1"],[49,54,46,60],[49,55,46,61,"createPacketEncoderStream"],[49,80,46,86],[49,82,46,88],[49,83,46,89],[50,10,47,16,"encoderStream"],[50,23,47,29],[50,24,47,30,"readable"],[50,32,47,38],[50,33,47,39,"pipeTo"],[50,39,47,45],[50,40,47,46,"stream"],[50,46,47,52],[50,47,47,53,"writable"],[50,55,47,61],[50,56,47,62],[51,10,48,16],[51,14,48,20],[51,15,48,21,"_writer"],[51,22,48,28],[51,25,48,31,"encoderStream"],[51,38,48,44],[51,39,48,45,"writable"],[51,47,48,53],[51,48,48,54,"getWriter"],[51,57,48,63],[51,58,48,64],[51,59,48,65],[52,10,49,16],[52,16,49,22,"read"],[52,20,49,26],[52,23,49,29,"read"],[52,24,49,29],[52,29,49,35],[53,12,50,20,"reader"],[53,18,50,26],[53,19,51,25,"read"],[53,23,51,29],[53,24,51,30],[53,25,51,31],[53,26,52,25,"then"],[53,30,52,29],[53,31,52,30],[53,32,52,31],[54,14,52,33,"done"],[54,18,52,37],[55,14,52,39,"value"],[56,12,52,45],[56,13,52,46],[56,18,52,51],[57,14,53,24],[57,18,53,28,"done"],[57,22,53,32],[57,24,53,34],[58,16,54,28,"debug"],[58,21,54,33],[58,22,54,34],[58,41,54,53],[58,42,54,54],[59,16,55,28],[60,14,56,24],[61,14,57,24,"debug"],[61,19,57,29],[61,20,57,30],[61,40,57,50],[61,42,57,52,"value"],[61,47,57,57],[61,48,57,58],[62,14,58,24],[62,18,58,28],[62,19,58,29,"onPacket"],[62,27,58,37],[62,28,58,38,"value"],[62,33,58,43],[62,34,58,44],[63,14,59,24,"read"],[63,18,59,28],[63,19,59,29],[63,20,59,30],[64,12,60,20],[64,13,60,21],[64,14,60,22],[64,15,61,25,"catch"],[64,20,61,30],[64,21,61,32,"err"],[64,24,61,35],[64,28,61,40],[65,14,62,24,"debug"],[65,19,62,29],[65,20,62,30],[65,57,62,67],[65,59,62,69,"err"],[65,62,62,72],[65,63,62,73],[66,12,63,20],[66,13,63,21],[66,14,63,22],[67,10,64,16],[67,11,64,17],[68,10,65,16,"read"],[68,14,65,20],[68,15,65,21],[68,16,65,22],[69,10,66,16],[69,16,66,22,"packet"],[69,22,66,28],[69,25,66,31],[70,12,66,33,"type"],[70,16,66,37],[70,18,66,39],[71,10,66,46],[71,11,66,47],[72,10,67,16],[72,14,67,20],[72,18,67,24],[72,19,67,25,"query"],[72,24,67,30],[72,25,67,31,"sid"],[72,28,67,34],[72,30,67,36],[73,12,68,20,"packet"],[73,18,68,26],[73,19,68,27,"data"],[73,23,68,31],[73,26,68,34],[73,37,68,45],[73,41,68,49],[73,42,68,50,"query"],[73,47,68,55],[73,48,68,56,"sid"],[73,51,68,59],[73,55,68,63],[74,10,69,16],[75,10,70,16],[75,14,70,20],[75,15,70,21,"_writer"],[75,22,70,28],[75,23,70,29,"write"],[75,28,70,34],[75,29,70,35,"packet"],[75,35,70,41],[75,36,70,42],[75,37,70,43,"then"],[75,41,70,47],[75,42,70,48],[75,48,70,54],[75,52,70,58],[75,53,70,59,"onOpen"],[75,59,70,65],[75,60,70,66],[75,61,70,67],[75,62,70,68],[76,8,71,12],[76,9,71,13],[76,10,71,14],[77,6,72,8],[77,7,72,9],[77,8,72,10],[78,4,73,4],[79,4,74,4,"write"],[79,9,74,9,"write"],[79,10,74,10,"packets"],[79,17,74,17],[79,19,74,19],[80,6,75,8],[80,10,75,12],[80,11,75,13,"writable"],[80,19,75,21],[80,22,75,24],[80,27,75,29],[81,6,76,8],[81,11,76,13],[81,15,76,17,"i"],[81,16,76,18],[81,19,76,21],[81,20,76,22],[81,22,76,24,"i"],[81,23,76,25],[81,26,76,28,"packets"],[81,33,76,35],[81,34,76,36,"length"],[81,40,76,42],[81,42,76,44,"i"],[81,43,76,45],[81,45,76,47],[81,47,76,49],[82,8,77,12],[82,14,77,18,"packet"],[82,20,77,24],[82,23,77,27,"packets"],[82,30,77,34],[82,31,77,35,"i"],[82,32,77,36],[82,33,77,37],[83,8,78,12],[83,14,78,18,"lastPacket"],[83,24,78,28],[83,27,78,31,"i"],[83,28,78,32],[83,33,78,37,"packets"],[83,40,78,44],[83,41,78,45,"length"],[83,47,78,51],[83,50,78,54],[83,51,78,55],[84,8,79,12],[84,12,79,16],[84,13,79,17,"_writer"],[84,20,79,24],[84,21,79,25,"write"],[84,26,79,30],[84,27,79,31,"packet"],[84,33,79,37],[84,34,79,38],[84,35,79,39,"then"],[84,39,79,43],[84,40,79,44],[84,46,79,50],[85,10,80,16],[85,14,80,20,"lastPacket"],[85,24,80,30],[85,26,80,32],[86,12,81,20],[86,13,81,21],[86,14,81,22],[86,16,81,24,"globals_node_js_1"],[86,33,81,41],[86,34,81,42,"nextTick"],[86,42,81,50],[86,44,81,52],[86,50,81,58],[87,14,82,24],[87,18,82,28],[87,19,82,29,"writable"],[87,27,82,37],[87,30,82,40],[87,34,82,44],[88,14,83,24],[88,18,83,28],[88,19,83,29,"emitReserved"],[88,31,83,41],[88,32,83,42],[88,39,83,49],[88,40,83,50],[89,12,84,20],[89,13,84,21],[89,15,84,23],[89,19,84,27],[89,20,84,28,"setTimeoutFn"],[89,32,84,40],[89,33,84,41],[90,10,85,16],[91,8,86,12],[91,9,86,13],[91,10,86,14],[92,6,87,8],[93,4,88,4],[94,4,89,4,"doClose"],[94,11,89,11,"doClose"],[94,12,89,11],[94,14,89,14],[95,6,90,8],[95,10,90,12,"_a"],[95,12,90,14],[96,6,91,8],[96,7,91,9,"_a"],[96,9,91,11],[96,12,91,14],[96,16,91,18],[96,17,91,19,"_transport"],[96,27,91,29],[96,33,91,35],[96,37,91,39],[96,41,91,43,"_a"],[96,43,91,45],[96,48,91,50],[96,53,91,55],[96,54,91,56],[96,57,91,59],[96,62,91,64],[96,63,91,65],[96,66,91,68,"_a"],[96,68,91,70],[96,69,91,71,"close"],[96,74,91,76],[96,75,91,77],[96,76,91,78],[97,4,92,4],[98,2,93,0],[99,2,94,0,"exports"],[99,9,94,7],[99,10,94,8,"WT"],[99,12,94,10],[99,15,94,13,"WT"],[99,17,94,15],[100,0,94,16],[100,3]],"functionMap":{"names":["<global>","<anonymous>","WT","WT#get__name","WT#doOpen","_transport.closed.then$argument_0","_transport.closed.then._catch$argument_0","_transport.ready.then$argument_0","_transport.createBidirectionalStream.then$argument_0","read","reader.read.then$argument_0","reader.read.then._catch$argument_0","_writer.write.then$argument_0","WT#write","WT#doClose"],"mappings":"AAA;wDCC;CDE;AEgB;ICC;KDE;IEC;kBCS;SDG;mBEC;SFG;mCGE;6DCC;6BCM;8BCG;qBDQ;+BEC;qBFE;iBDC;gDIM,mBJ;aDC;SHC;KFC;IWC;4CDK;oDXE;qBWG;aCE;KXE;IYC;KZG;CFC"},"hasCjsExports":true},"type":"js/module"}]}