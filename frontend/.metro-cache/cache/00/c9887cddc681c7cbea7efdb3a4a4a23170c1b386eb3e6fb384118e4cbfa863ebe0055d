{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":153},"end":{"line":4,"column":55,"index":187}}],"key":"Bu6PYP3hUl2jiacy+OFL3cCcZHs=","exportNames":["*"],"imports":1}},{"name":"./socket.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":20,"index":209},"end":{"line":5,"column":42,"index":231}}],"key":"mIp26Y4RZBmjLnn6eJPUMQuqDuA=","exportNames":["*"],"imports":1}},{"name":"isows","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":10,"column":65,"index":519},"end":{"line":10,"column":81,"index":535}}],"key":"jQDboCV7KGBj8OKLH0IUEzqRis4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.getWebSocketRpcClient = getWebSocketRpcClient;\n  const request_js_1 = require(_dependencyMap[0], \"../../errors/request.js\");\n  const socket_js_1 = require(_dependencyMap[1], \"./socket.js\");\n  async function getWebSocketRpcClient(url, options = {}) {\n    const {\n      keepAlive,\n      reconnect\n    } = options;\n    return (0, socket_js_1.getSocketRpcClient)({\n      async getSocket({\n        onClose,\n        onError,\n        onOpen,\n        onResponse\n      }) {\n        const WebSocket = await Promise.resolve().then(() => require(_dependencyMap[2], \"isows\")).then(module => module.WebSocket);\n        const socket = new WebSocket(url);\n        function onClose_() {\n          socket.removeEventListener('close', onClose_);\n          socket.removeEventListener('message', onMessage);\n          socket.removeEventListener('error', onError);\n          socket.removeEventListener('open', onOpen);\n          onClose();\n        }\n        function onMessage({\n          data\n        }) {\n          onResponse(JSON.parse(data));\n        }\n        socket.addEventListener('close', onClose_);\n        socket.addEventListener('message', onMessage);\n        socket.addEventListener('error', onError);\n        socket.addEventListener('open', onOpen);\n        if (socket.readyState === WebSocket.CONNECTING) {\n          await new Promise((resolve, reject) => {\n            if (!socket) return;\n            socket.onopen = resolve;\n            socket.onerror = reject;\n          });\n        }\n        const {\n          close: close_\n        } = socket;\n        return Object.assign(socket, {\n          close() {\n            close_.bind(socket)();\n            onClose_();\n          },\n          ping() {\n            try {\n              if (socket.readyState === socket.CLOSED || socket.readyState === socket.CLOSING) throw new request_js_1.WebSocketRequestError({\n                url: socket.url,\n                cause: new request_js_1.SocketClosedError({\n                  url: socket.url\n                })\n              });\n              const body = {\n                jsonrpc: '2.0',\n                method: 'net_version',\n                params: []\n              };\n              socket.send(JSON.stringify(body));\n            } catch (error) {\n              onError(error);\n            }\n          },\n          request({\n            body\n          }) {\n            if (socket.readyState === socket.CLOSED || socket.readyState === socket.CLOSING) throw new request_js_1.WebSocketRequestError({\n              body,\n              url: socket.url,\n              cause: new request_js_1.SocketClosedError({\n                url: socket.url\n              })\n            });\n            return socket.send(JSON.stringify(body));\n          }\n        });\n      },\n      keepAlive,\n      reconnect,\n      url\n    });\n  }\n});","lineCount":92,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"getWebSocketRpcClient"],[7,31,3,29],[7,34,3,32,"getWebSocketRpcClient"],[7,55,3,53],[8,2,4,0],[8,8,4,6,"request_js_1"],[8,20,4,18],[8,23,4,21,"require"],[8,30,4,28],[8,31,4,28,"_dependencyMap"],[8,45,4,28],[8,75,4,54],[8,76,4,55],[9,2,5,0],[9,8,5,6,"socket_js_1"],[9,19,5,17],[9,22,5,20,"require"],[9,29,5,27],[9,30,5,27,"_dependencyMap"],[9,44,5,27],[9,62,5,41],[9,63,5,42],[10,2,6,0],[10,17,6,15,"getWebSocketRpcClient"],[10,38,6,36,"getWebSocketRpcClient"],[10,39,6,37,"url"],[10,42,6,40],[10,44,6,42,"options"],[10,51,6,49],[10,54,6,52],[10,55,6,53],[10,56,6,54],[10,58,6,56],[11,4,7,4],[11,10,7,10],[12,6,7,12,"keepAlive"],[12,15,7,21],[13,6,7,23,"reconnect"],[14,4,7,33],[14,5,7,34],[14,8,7,37,"options"],[14,15,7,44],[15,4,8,4],[15,11,8,11],[15,12,8,12],[15,13,8,13],[15,15,8,15,"socket_js_1"],[15,26,8,26],[15,27,8,27,"getSocketRpcClient"],[15,45,8,45],[15,47,8,47],[16,6,9,8],[16,12,9,14,"getSocket"],[16,21,9,23,"getSocket"],[16,22,9,24],[17,8,9,26,"onClose"],[17,15,9,33],[18,8,9,35,"onError"],[18,15,9,42],[19,8,9,44,"onOpen"],[19,14,9,50],[20,8,9,52,"onResponse"],[21,6,9,63],[21,7,9,64],[21,9,9,66],[22,8,10,12],[22,14,10,18,"WebSocket"],[22,23,10,27],[22,26,10,30],[22,32,10,36,"Promise"],[22,39,10,43],[22,40,10,44,"resolve"],[22,47,10,51],[22,48,10,52],[22,49,10,53],[22,50,10,54,"then"],[22,54,10,58],[22,55,10,59],[22,61,10,65,"require"],[22,68,10,72],[22,69,10,72,"_dependencyMap"],[22,83,10,72],[22,95,10,80],[22,96,10,81],[22,97,10,82],[22,98,10,83,"then"],[22,102,10,87],[22,103,10,89,"module"],[22,109,10,95],[22,113,10,100,"module"],[22,119,10,106],[22,120,10,107,"WebSocket"],[22,129,10,116],[22,130,10,117],[23,8,11,12],[23,14,11,18,"socket"],[23,20,11,24],[23,23,11,27],[23,27,11,31,"WebSocket"],[23,36,11,40],[23,37,11,41,"url"],[23,40,11,44],[23,41,11,45],[24,8,12,12],[24,17,12,21,"onClose_"],[24,25,12,29,"onClose_"],[24,26,12,29],[24,28,12,32],[25,10,13,16,"socket"],[25,16,13,22],[25,17,13,23,"removeEventListener"],[25,36,13,42],[25,37,13,43],[25,44,13,50],[25,46,13,52,"onClose_"],[25,54,13,60],[25,55,13,61],[26,10,14,16,"socket"],[26,16,14,22],[26,17,14,23,"removeEventListener"],[26,36,14,42],[26,37,14,43],[26,46,14,52],[26,48,14,54,"onMessage"],[26,57,14,63],[26,58,14,64],[27,10,15,16,"socket"],[27,16,15,22],[27,17,15,23,"removeEventListener"],[27,36,15,42],[27,37,15,43],[27,44,15,50],[27,46,15,52,"onError"],[27,53,15,59],[27,54,15,60],[28,10,16,16,"socket"],[28,16,16,22],[28,17,16,23,"removeEventListener"],[28,36,16,42],[28,37,16,43],[28,43,16,49],[28,45,16,51,"onOpen"],[28,51,16,57],[28,52,16,58],[29,10,17,16,"onClose"],[29,17,17,23],[29,18,17,24],[29,19,17,25],[30,8,18,12],[31,8,19,12],[31,17,19,21,"onMessage"],[31,26,19,30,"onMessage"],[31,27,19,31],[32,10,19,33,"data"],[33,8,19,38],[33,9,19,39],[33,11,19,41],[34,10,20,16,"onResponse"],[34,20,20,26],[34,21,20,27,"JSON"],[34,25,20,31],[34,26,20,32,"parse"],[34,31,20,37],[34,32,20,38,"data"],[34,36,20,42],[34,37,20,43],[34,38,20,44],[35,8,21,12],[36,8,22,12,"socket"],[36,14,22,18],[36,15,22,19,"addEventListener"],[36,31,22,35],[36,32,22,36],[36,39,22,43],[36,41,22,45,"onClose_"],[36,49,22,53],[36,50,22,54],[37,8,23,12,"socket"],[37,14,23,18],[37,15,23,19,"addEventListener"],[37,31,23,35],[37,32,23,36],[37,41,23,45],[37,43,23,47,"onMessage"],[37,52,23,56],[37,53,23,57],[38,8,24,12,"socket"],[38,14,24,18],[38,15,24,19,"addEventListener"],[38,31,24,35],[38,32,24,36],[38,39,24,43],[38,41,24,45,"onError"],[38,48,24,52],[38,49,24,53],[39,8,25,12,"socket"],[39,14,25,18],[39,15,25,19,"addEventListener"],[39,31,25,35],[39,32,25,36],[39,38,25,42],[39,40,25,44,"onOpen"],[39,46,25,50],[39,47,25,51],[40,8,26,12],[40,12,26,16,"socket"],[40,18,26,22],[40,19,26,23,"readyState"],[40,29,26,33],[40,34,26,38,"WebSocket"],[40,43,26,47],[40,44,26,48,"CONNECTING"],[40,54,26,58],[40,56,26,60],[41,10,27,16],[41,16,27,22],[41,20,27,26,"Promise"],[41,27,27,33],[41,28,27,34],[41,29,27,35,"resolve"],[41,36,27,42],[41,38,27,44,"reject"],[41,44,27,50],[41,49,27,55],[42,12,28,20],[42,16,28,24],[42,17,28,25,"socket"],[42,23,28,31],[42,25,29,24],[43,12,30,20,"socket"],[43,18,30,26],[43,19,30,27,"onopen"],[43,25,30,33],[43,28,30,36,"resolve"],[43,35,30,43],[44,12,31,20,"socket"],[44,18,31,26],[44,19,31,27,"onerror"],[44,26,31,34],[44,29,31,37,"reject"],[44,35,31,43],[45,10,32,16],[45,11,32,17],[45,12,32,18],[46,8,33,12],[47,8,34,12],[47,14,34,18],[48,10,34,20,"close"],[48,15,34,25],[48,17,34,27,"close_"],[49,8,34,34],[49,9,34,35],[49,12,34,38,"socket"],[49,18,34,44],[50,8,35,12],[50,15,35,19,"Object"],[50,21,35,25],[50,22,35,26,"assign"],[50,28,35,32],[50,29,35,33,"socket"],[50,35,35,39],[50,37,35,41],[51,10,36,16,"close"],[51,15,36,21,"close"],[51,16,36,21],[51,18,36,24],[52,12,37,20,"close_"],[52,18,37,26],[52,19,37,27,"bind"],[52,23,37,31],[52,24,37,32,"socket"],[52,30,37,38],[52,31,37,39],[52,32,37,40],[52,33,37,41],[53,12,38,20,"onClose_"],[53,20,38,28],[53,21,38,29],[53,22,38,30],[54,10,39,16],[54,11,39,17],[55,10,40,16,"ping"],[55,14,40,20,"ping"],[55,15,40,20],[55,17,40,23],[56,12,41,20],[56,16,41,24],[57,14,42,24],[57,18,42,28,"socket"],[57,24,42,34],[57,25,42,35,"readyState"],[57,35,42,45],[57,40,42,50,"socket"],[57,46,42,56],[57,47,42,57,"CLOSED"],[57,53,42,63],[57,57,43,28,"socket"],[57,63,43,34],[57,64,43,35,"readyState"],[57,74,43,45],[57,79,43,50,"socket"],[57,85,43,56],[57,86,43,57,"CLOSING"],[57,93,43,64],[57,95,44,28],[57,101,44,34],[57,105,44,38,"request_js_1"],[57,117,44,50],[57,118,44,51,"WebSocketRequestError"],[57,139,44,72],[57,140,44,73],[58,16,45,32,"url"],[58,19,45,35],[58,21,45,37,"socket"],[58,27,45,43],[58,28,45,44,"url"],[58,31,45,47],[59,16,46,32,"cause"],[59,21,46,37],[59,23,46,39],[59,27,46,43,"request_js_1"],[59,39,46,55],[59,40,46,56,"SocketClosedError"],[59,57,46,73],[59,58,46,74],[60,18,46,76,"url"],[60,21,46,79],[60,23,46,81,"socket"],[60,29,46,87],[60,30,46,88,"url"],[61,16,46,92],[61,17,46,93],[62,14,47,28],[62,15,47,29],[62,16,47,30],[63,14,48,24],[63,20,48,30,"body"],[63,24,48,34],[63,27,48,37],[64,16,49,28,"jsonrpc"],[64,23,49,35],[64,25,49,37],[64,30,49,42],[65,16,50,28,"method"],[65,22,50,34],[65,24,50,36],[65,37,50,49],[66,16,51,28,"params"],[66,22,51,34],[66,24,51,36],[67,14,52,24],[67,15,52,25],[68,14,53,24,"socket"],[68,20,53,30],[68,21,53,31,"send"],[68,25,53,35],[68,26,53,36,"JSON"],[68,30,53,40],[68,31,53,41,"stringify"],[68,40,53,50],[68,41,53,51,"body"],[68,45,53,55],[68,46,53,56],[68,47,53,57],[69,12,54,20],[69,13,54,21],[69,14,55,20],[69,21,55,27,"error"],[69,26,55,32],[69,28,55,34],[70,14,56,24,"onError"],[70,21,56,31],[70,22,56,32,"error"],[70,27,56,37],[70,28,56,38],[71,12,57,20],[72,10,58,16],[72,11,58,17],[73,10,59,16,"request"],[73,17,59,23,"request"],[73,18,59,24],[74,12,59,26,"body"],[75,10,59,31],[75,11,59,32],[75,13,59,34],[76,12,60,20],[76,16,60,24,"socket"],[76,22,60,30],[76,23,60,31,"readyState"],[76,33,60,41],[76,38,60,46,"socket"],[76,44,60,52],[76,45,60,53,"CLOSED"],[76,51,60,59],[76,55,61,24,"socket"],[76,61,61,30],[76,62,61,31,"readyState"],[76,72,61,41],[76,77,61,46,"socket"],[76,83,61,52],[76,84,61,53,"CLOSING"],[76,91,61,60],[76,93,62,24],[76,99,62,30],[76,103,62,34,"request_js_1"],[76,115,62,46],[76,116,62,47,"WebSocketRequestError"],[76,137,62,68],[76,138,62,69],[77,14,63,28,"body"],[77,18,63,32],[78,14,64,28,"url"],[78,17,64,31],[78,19,64,33,"socket"],[78,25,64,39],[78,26,64,40,"url"],[78,29,64,43],[79,14,65,28,"cause"],[79,19,65,33],[79,21,65,35],[79,25,65,39,"request_js_1"],[79,37,65,51],[79,38,65,52,"SocketClosedError"],[79,55,65,69],[79,56,65,70],[80,16,65,72,"url"],[80,19,65,75],[80,21,65,77,"socket"],[80,27,65,83],[80,28,65,84,"url"],[81,14,65,88],[81,15,65,89],[82,12,66,24],[82,13,66,25],[82,14,66,26],[83,12,67,20],[83,19,67,27,"socket"],[83,25,67,33],[83,26,67,34,"send"],[83,30,67,38],[83,31,67,39,"JSON"],[83,35,67,43],[83,36,67,44,"stringify"],[83,45,67,53],[83,46,67,54,"body"],[83,50,67,58],[83,51,67,59],[83,52,67,60],[84,10,68,16],[85,8,69,12],[85,9,69,13],[85,10,69,14],[86,6,70,8],[86,7,70,9],[87,6,71,8,"keepAlive"],[87,15,71,17],[88,6,72,8,"reconnect"],[88,15,72,17],[89,6,73,8,"url"],[90,4,74,4],[90,5,74,5],[90,6,74,6],[91,2,75,0],[92,0,75,1],[92,3]],"functionMap":{"names":["<global>","getWebSocketRpcClient","getSocket","Promise.resolve.then$argument_0","Promise.resolve.then.then$argument_0","onClose_","onMessage","Promise$argument_0","Object.assign$argument_1.close","Object.assign$argument_1.ping","Object.assign$argument_1.request"],"mappings":"AAA;ACK;QCG;2DCC,sBD,OE,4BF;YGE;aHM;YIC;aJE;kCKM;iBLK;gBMI;iBNG;gBOC;iBPkB;gBQC;iBRS;SDE;CDK"},"hasCjsExports":true},"type":"js/module"}]}