{"dependencies":[{"name":"fast-redact","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":19,"index":33},"end":{"line":3,"column":41,"index":55}}],"key":"vR8C6SAlJWFNLYzU9yEbfhSn/8U=","exportNames":["*"],"imports":1}},{"name":"./symbols","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":43,"index":99},"end":{"line":4,"column":63,"index":119}}],"key":"ab2m4Asmhdk58sCF6nygJvPWckI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  const fastRedact = require(_dependencyMap[0], \"fast-redact\");\n  const {\n    redactFmtSym,\n    wildcardFirstSym\n  } = require(_dependencyMap[1], \"./symbols\");\n  const {\n    rx,\n    validator\n  } = fastRedact;\n  const validate = validator({\n    ERR_PATHS_MUST_BE_STRINGS: () => 'pino – redacted paths must be strings',\n    ERR_INVALID_PATH: s => `pino – redact paths array contains an invalid path (${s})`\n  });\n  const CENSOR = '[Redacted]';\n  const strict = false; // TODO should this be configurable?\n\n  function redaction(opts, serialize) {\n    const {\n      paths,\n      censor\n    } = handle(opts);\n    const shape = paths.reduce((o, str) => {\n      rx.lastIndex = 0;\n      const first = rx.exec(str);\n      const next = rx.exec(str);\n\n      // ns is the top-level path segment, brackets + quoting removed.\n      let ns = first[1] !== undefined ? first[1].replace(/^(?:\"|'|`)(.*)(?:\"|'|`)$/, '$1') : first[0];\n      if (ns === '*') {\n        ns = wildcardFirstSym;\n      }\n\n      // top level key:\n      if (next === null) {\n        o[ns] = null;\n        return o;\n      }\n\n      // path with at least two segments:\n      // if ns is already redacted at the top level, ignore lower level redactions\n      if (o[ns] === null) {\n        return o;\n      }\n      const {\n        index\n      } = next;\n      const nextPath = `${str.substr(index, str.length - 1)}`;\n      o[ns] = o[ns] || [];\n\n      // shape is a mix of paths beginning with literal values and wildcard\n      // paths [ \"a.b.c\", \"*.b.z\" ] should reduce to a shape of\n      // { \"a\": [ \"b.c\", \"b.z\" ], *: [ \"b.z\" ] }\n      // note: \"b.z\" is in both \"a\" and * arrays because \"a\" matches the wildcard.\n      // (* entry has wildcardFirstSym as key)\n      if (ns !== wildcardFirstSym && o[ns].length === 0) {\n        // first time ns's get all '*' redactions so far\n        o[ns].push(...(o[wildcardFirstSym] || []));\n      }\n      if (ns === wildcardFirstSym) {\n        // new * path gets added to all previously registered literal ns's.\n        Object.keys(o).forEach(function (k) {\n          if (o[k]) {\n            o[k].push(nextPath);\n          }\n        });\n      }\n      o[ns].push(nextPath);\n      return o;\n    }, {});\n\n    // the redactor assigned to the format symbol key\n    // provides top level redaction for instances where\n    // an object is interpolated into the msg string\n    const result = {\n      [redactFmtSym]: fastRedact({\n        paths,\n        censor,\n        serialize,\n        strict\n      })\n    };\n    const topCensor = (...args) => {\n      return typeof censor === 'function' ? serialize(censor(...args)) : serialize(censor);\n    };\n    return [...Object.keys(shape), ...Object.getOwnPropertySymbols(shape)].reduce((o, k) => {\n      // top level key:\n      if (shape[k] === null) {\n        o[k] = value => topCensor(value, [k]);\n      } else {\n        const wrappedCensor = typeof censor === 'function' ? (value, path) => {\n          return censor(value, [k, ...path]);\n        } : censor;\n        o[k] = fastRedact({\n          paths: shape[k],\n          censor: wrappedCensor,\n          serialize,\n          strict\n        });\n      }\n      return o;\n    }, result);\n  }\n  function handle(opts) {\n    if (Array.isArray(opts)) {\n      opts = {\n        paths: opts,\n        censor: CENSOR\n      };\n      validate(opts);\n      return opts;\n    }\n    let {\n      paths,\n      censor = CENSOR,\n      remove\n    } = opts;\n    if (Array.isArray(paths) === false) {\n      throw Error('pino – redact must contain an array of strings');\n    }\n    if (remove === true) censor = undefined;\n    validate({\n      paths,\n      censor\n    });\n    return {\n      paths,\n      censor\n    };\n  }\n  module.exports = redaction;\n});","lineCount":134,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,8,3,6,"fastRedact"],[4,18,3,16],[4,21,3,19,"require"],[4,28,3,26],[4,29,3,26,"_dependencyMap"],[4,43,3,26],[4,61,3,40],[4,62,3,41],[5,2,4,0],[5,8,4,6],[6,4,4,8,"redactFmtSym"],[6,16,4,20],[7,4,4,22,"wildcardFirstSym"],[8,2,4,39],[8,3,4,40],[8,6,4,43,"require"],[8,13,4,50],[8,14,4,50,"_dependencyMap"],[8,28,4,50],[8,44,4,62],[8,45,4,63],[9,2,5,0],[9,8,5,6],[10,4,5,8,"rx"],[10,6,5,10],[11,4,5,12,"validator"],[12,2,5,22],[12,3,5,23],[12,6,5,26,"fastRedact"],[12,16,5,36],[13,2,7,0],[13,8,7,6,"validate"],[13,16,7,14],[13,19,7,17,"validator"],[13,28,7,26],[13,29,7,27],[14,4,8,2,"ERR_PATHS_MUST_BE_STRINGS"],[14,29,8,27],[14,31,8,29,"ERR_PATHS_MUST_BE_STRINGS"],[14,32,8,29],[14,37,8,35],[14,76,8,74],[15,4,9,2,"ERR_INVALID_PATH"],[15,20,9,18],[15,22,9,21,"s"],[15,23,9,22],[15,27,9,27],[15,82,9,82,"s"],[15,83,9,83],[16,2,10,0],[16,3,10,1],[16,4,10,2],[17,2,12,0],[17,8,12,6,"CENSOR"],[17,14,12,12],[17,17,12,15],[17,29,12,27],[18,2,13,0],[18,8,13,6,"strict"],[18,14,13,12],[18,17,13,15],[18,22,13,20],[18,24,13,21],[20,2,15,0],[20,11,15,9,"redaction"],[20,20,15,18,"redaction"],[20,21,15,20,"opts"],[20,25,15,24],[20,27,15,26,"serialize"],[20,36,15,35],[20,38,15,37],[21,4,16,2],[21,10,16,8],[22,6,16,10,"paths"],[22,11,16,15],[23,6,16,17,"censor"],[24,4,16,24],[24,5,16,25],[24,8,16,28,"handle"],[24,14,16,34],[24,15,16,35,"opts"],[24,19,16,39],[24,20,16,40],[25,4,18,2],[25,10,18,8,"shape"],[25,15,18,13],[25,18,18,16,"paths"],[25,23,18,21],[25,24,18,22,"reduce"],[25,30,18,28],[25,31,18,29],[25,32,18,30,"o"],[25,33,18,31],[25,35,18,33,"str"],[25,38,18,36],[25,43,18,41],[26,6,19,4,"rx"],[26,8,19,6],[26,9,19,7,"lastIndex"],[26,18,19,16],[26,21,19,19],[26,22,19,20],[27,6,20,4],[27,12,20,10,"first"],[27,17,20,15],[27,20,20,18,"rx"],[27,22,20,20],[27,23,20,21,"exec"],[27,27,20,25],[27,28,20,26,"str"],[27,31,20,29],[27,32,20,30],[28,6,21,4],[28,12,21,10,"next"],[28,16,21,14],[28,19,21,17,"rx"],[28,21,21,19],[28,22,21,20,"exec"],[28,26,21,24],[28,27,21,25,"str"],[28,30,21,28],[28,31,21,29],[30,6,23,4],[31,6,24,4],[31,10,24,8,"ns"],[31,12,24,10],[31,15,24,13,"first"],[31,20,24,18],[31,21,24,19],[31,22,24,20],[31,23,24,21],[31,28,24,26,"undefined"],[31,37,24,35],[31,40,25,8,"first"],[31,45,25,13],[31,46,25,14],[31,47,25,15],[31,48,25,16],[31,49,25,17,"replace"],[31,56,25,24],[31,57,25,25],[31,83,25,51],[31,85,25,53],[31,89,25,57],[31,90,25,58],[31,93,26,8,"first"],[31,98,26,13],[31,99,26,14],[31,100,26,15],[31,101,26,16],[32,6,28,4],[32,10,28,8,"ns"],[32,12,28,10],[32,17,28,15],[32,20,28,18],[32,22,28,20],[33,8,29,6,"ns"],[33,10,29,8],[33,13,29,11,"wildcardFirstSym"],[33,29,29,27],[34,6,30,4],[36,6,32,4],[37,6,33,4],[37,10,33,8,"next"],[37,14,33,12],[37,19,33,17],[37,23,33,21],[37,25,33,23],[38,8,34,6,"o"],[38,9,34,7],[38,10,34,8,"ns"],[38,12,34,10],[38,13,34,11],[38,16,34,14],[38,20,34,18],[39,8,35,6],[39,15,35,13,"o"],[39,16,35,14],[40,6,36,4],[42,6,38,4],[43,6,39,4],[44,6,40,4],[44,10,40,8,"o"],[44,11,40,9],[44,12,40,10,"ns"],[44,14,40,12],[44,15,40,13],[44,20,40,18],[44,24,40,22],[44,26,40,24],[45,8,41,6],[45,15,41,13,"o"],[45,16,41,14],[46,6,42,4],[47,6,44,4],[47,12,44,10],[48,8,44,12,"index"],[49,6,44,18],[49,7,44,19],[49,10,44,22,"next"],[49,14,44,26],[50,6,45,4],[50,12,45,10,"nextPath"],[50,20,45,18],[50,23,45,21],[50,26,45,24,"str"],[50,29,45,27],[50,30,45,28,"substr"],[50,36,45,34],[50,37,45,35,"index"],[50,42,45,40],[50,44,45,42,"str"],[50,47,45,45],[50,48,45,46,"length"],[50,54,45,52],[50,57,45,55],[50,58,45,56],[50,59,45,57],[50,61,45,59],[51,6,47,4,"o"],[51,7,47,5],[51,8,47,6,"ns"],[51,10,47,8],[51,11,47,9],[51,14,47,12,"o"],[51,15,47,13],[51,16,47,14,"ns"],[51,18,47,16],[51,19,47,17],[51,23,47,21],[51,25,47,23],[53,6,49,4],[54,6,50,4],[55,6,51,4],[56,6,52,4],[57,6,53,4],[58,6,54,4],[58,10,54,8,"ns"],[58,12,54,10],[58,17,54,15,"wildcardFirstSym"],[58,33,54,31],[58,37,54,35,"o"],[58,38,54,36],[58,39,54,37,"ns"],[58,41,54,39],[58,42,54,40],[58,43,54,41,"length"],[58,49,54,47],[58,54,54,52],[58,55,54,53],[58,57,54,55],[59,8,55,6],[60,8,56,6,"o"],[60,9,56,7],[60,10,56,8,"ns"],[60,12,56,10],[60,13,56,11],[60,14,56,12,"push"],[60,18,56,16],[60,19,56,17],[60,23,56,21,"o"],[60,24,56,22],[60,25,56,23,"wildcardFirstSym"],[60,41,56,39],[60,42,56,40],[60,46,56,44],[60,48,56,46],[60,49,56,47],[60,50,56,48],[61,6,57,4],[62,6,59,4],[62,10,59,8,"ns"],[62,12,59,10],[62,17,59,15,"wildcardFirstSym"],[62,33,59,31],[62,35,59,33],[63,8,60,6],[64,8,61,6,"Object"],[64,14,61,12],[64,15,61,13,"keys"],[64,19,61,17],[64,20,61,18,"o"],[64,21,61,19],[64,22,61,20],[64,23,61,21,"forEach"],[64,30,61,28],[64,31,61,29],[64,41,61,39,"k"],[64,42,61,40],[64,44,61,42],[65,10,62,8],[65,14,62,12,"o"],[65,15,62,13],[65,16,62,14,"k"],[65,17,62,15],[65,18,62,16],[65,20,62,18],[66,12,63,10,"o"],[66,13,63,11],[66,14,63,12,"k"],[66,15,63,13],[66,16,63,14],[66,17,63,15,"push"],[66,21,63,19],[66,22,63,20,"nextPath"],[66,30,63,28],[66,31,63,29],[67,10,64,8],[68,8,65,6],[68,9,65,7],[68,10,65,8],[69,6,66,4],[70,6,68,4,"o"],[70,7,68,5],[70,8,68,6,"ns"],[70,10,68,8],[70,11,68,9],[70,12,68,10,"push"],[70,16,68,14],[70,17,68,15,"nextPath"],[70,25,68,23],[70,26,68,24],[71,6,69,4],[71,13,69,11,"o"],[71,14,69,12],[72,4,70,2],[72,5,70,3],[72,7,70,5],[72,8,70,6],[72,9,70,7],[72,10,70,8],[74,4,72,2],[75,4,73,2],[76,4,74,2],[77,4,75,2],[77,10,75,8,"result"],[77,16,75,14],[77,19,75,17],[78,6,76,4],[78,7,76,5,"redactFmtSym"],[78,19,76,17],[78,22,76,20,"fastRedact"],[78,32,76,30],[78,33,76,31],[79,8,76,33,"paths"],[79,13,76,38],[80,8,76,40,"censor"],[80,14,76,46],[81,8,76,48,"serialize"],[81,17,76,57],[82,8,76,59,"strict"],[83,6,76,66],[83,7,76,67],[84,4,77,2],[84,5,77,3],[85,4,79,2],[85,10,79,8,"topCensor"],[85,19,79,17],[85,22,79,20,"topCensor"],[85,23,79,21],[85,26,79,24,"args"],[85,30,79,28],[85,35,79,33],[86,6,80,4],[86,13,80,11],[86,20,80,18,"censor"],[86,26,80,24],[86,31,80,29],[86,41,80,39],[86,44,80,42,"serialize"],[86,53,80,51],[86,54,80,52,"censor"],[86,60,80,58],[86,61,80,59],[86,64,80,62,"args"],[86,68,80,66],[86,69,80,67],[86,70,80,68],[86,73,80,71,"serialize"],[86,82,80,80],[86,83,80,81,"censor"],[86,89,80,87],[86,90,80,88],[87,4,81,2],[87,5,81,3],[88,4,83,2],[88,11,83,9],[88,12,83,10],[88,15,83,13,"Object"],[88,21,83,19],[88,22,83,20,"keys"],[88,26,83,24],[88,27,83,25,"shape"],[88,32,83,30],[88,33,83,31],[88,35,83,33],[88,38,83,36,"Object"],[88,44,83,42],[88,45,83,43,"getOwnPropertySymbols"],[88,66,83,64],[88,67,83,65,"shape"],[88,72,83,70],[88,73,83,71],[88,74,83,72],[88,75,83,73,"reduce"],[88,81,83,79],[88,82,83,80],[88,83,83,81,"o"],[88,84,83,82],[88,86,83,84,"k"],[88,87,83,85],[88,92,83,90],[89,6,84,4],[90,6,85,4],[90,10,85,8,"shape"],[90,15,85,13],[90,16,85,14,"k"],[90,17,85,15],[90,18,85,16],[90,23,85,21],[90,27,85,25],[90,29,85,27],[91,8,86,6,"o"],[91,9,86,7],[91,10,86,8,"k"],[91,11,86,9],[91,12,86,10],[91,15,86,14,"value"],[91,20,86,19],[91,24,86,24,"topCensor"],[91,33,86,33],[91,34,86,34,"value"],[91,39,86,39],[91,41,86,41],[91,42,86,42,"k"],[91,43,86,43],[91,44,86,44],[91,45,86,45],[92,6,87,4],[92,7,87,5],[92,13,87,11],[93,8,88,6],[93,14,88,12,"wrappedCensor"],[93,27,88,25],[93,30,88,28],[93,37,88,35,"censor"],[93,43,88,41],[93,48,88,46],[93,58,88,56],[93,61,89,10],[93,62,89,11,"value"],[93,67,89,16],[93,69,89,18,"path"],[93,73,89,22],[93,78,89,27],[94,10,90,12],[94,17,90,19,"censor"],[94,23,90,25],[94,24,90,26,"value"],[94,29,90,31],[94,31,90,33],[94,32,90,34,"k"],[94,33,90,35],[94,35,90,37],[94,38,90,40,"path"],[94,42,90,44],[94,43,90,45],[94,44,90,46],[95,8,91,10],[95,9,91,11],[95,12,92,10,"censor"],[95,18,92,16],[96,8,93,6,"o"],[96,9,93,7],[96,10,93,8,"k"],[96,11,93,9],[96,12,93,10],[96,15,93,13,"fastRedact"],[96,25,93,23],[96,26,93,24],[97,10,94,8,"paths"],[97,15,94,13],[97,17,94,15,"shape"],[97,22,94,20],[97,23,94,21,"k"],[97,24,94,22],[97,25,94,23],[98,10,95,8,"censor"],[98,16,95,14],[98,18,95,16,"wrappedCensor"],[98,31,95,29],[99,10,96,8,"serialize"],[99,19,96,17],[100,10,97,8,"strict"],[101,8,98,6],[101,9,98,7],[101,10,98,8],[102,6,99,4],[103,6,100,4],[103,13,100,11,"o"],[103,14,100,12],[104,4,101,2],[104,5,101,3],[104,7,101,5,"result"],[104,13,101,11],[104,14,101,12],[105,2,102,0],[106,2,104,0],[106,11,104,9,"handle"],[106,17,104,15,"handle"],[106,18,104,17,"opts"],[106,22,104,21],[106,24,104,23],[107,4,105,2],[107,8,105,6,"Array"],[107,13,105,11],[107,14,105,12,"isArray"],[107,21,105,19],[107,22,105,20,"opts"],[107,26,105,24],[107,27,105,25],[107,29,105,27],[108,6,106,4,"opts"],[108,10,106,8],[108,13,106,11],[109,8,106,13,"paths"],[109,13,106,18],[109,15,106,20,"opts"],[109,19,106,24],[110,8,106,26,"censor"],[110,14,106,32],[110,16,106,34,"CENSOR"],[111,6,106,41],[111,7,106,42],[112,6,107,4,"validate"],[112,14,107,12],[112,15,107,13,"opts"],[112,19,107,17],[112,20,107,18],[113,6,108,4],[113,13,108,11,"opts"],[113,17,108,15],[114,4,109,2],[115,4,110,2],[115,8,110,6],[116,6,110,8,"paths"],[116,11,110,13],[117,6,110,15,"censor"],[117,12,110,21],[117,15,110,24,"CENSOR"],[117,21,110,30],[118,6,110,32,"remove"],[119,4,110,39],[119,5,110,40],[119,8,110,43,"opts"],[119,12,110,47],[120,4,111,2],[120,8,111,6,"Array"],[120,13,111,11],[120,14,111,12,"isArray"],[120,21,111,19],[120,22,111,20,"paths"],[120,27,111,25],[120,28,111,26],[120,33,111,31],[120,38,111,36],[120,40,111,38],[121,6,111,40],[121,12,111,46,"Error"],[121,17,111,51],[121,18,111,52],[121,66,111,100],[121,67,111,101],[122,4,111,102],[123,4,112,2],[123,8,112,6,"remove"],[123,14,112,12],[123,19,112,17],[123,23,112,21],[123,25,112,23,"censor"],[123,31,112,29],[123,34,112,32,"undefined"],[123,43,112,41],[124,4,113,2,"validate"],[124,12,113,10],[124,13,113,11],[125,6,113,13,"paths"],[125,11,113,18],[126,6,113,20,"censor"],[127,4,113,27],[127,5,113,28],[127,6,113,29],[128,4,115,2],[128,11,115,9],[129,6,115,11,"paths"],[129,11,115,16],[130,6,115,18,"censor"],[131,4,115,25],[131,5,115,26],[132,2,116,0],[133,2,118,0,"module"],[133,8,118,6],[133,9,118,7,"exports"],[133,16,118,14],[133,19,118,17,"redaction"],[133,28,118,26],[134,0,118,26],[134,3]],"functionMap":{"names":["<global>","validator$argument_0.ERR_PATHS_MUST_BE_STRINGS","validator$argument_0.ERR_INVALID_PATH","redaction","paths.reduce$argument_0","Object.keys.forEach$argument_0","topCensor","reduce$argument_0","o.k","<anonymous>","handle"],"mappings":"AAA;6BCO,6CD;oBEC,kEF;AGM;6BCG;6BC2C;ODI;GDK;oBGS;GHE;gFIE;aCG,gCD;UEG;WFE;GJU;CHC;AUE;CVY"},"hasCjsExports":true},"type":"js/module"}]}