{"dependencies":[{"name":"./withResolvers.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":51,"index":51}}],"key":"8fA822Ra1PzWxrcUHzutiOYMWGA=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.createBatchScheduler = createBatchScheduler;\n  var _withResolversJs = require(_dependencyMap[0], \"./withResolvers.js\");\n  const schedulerCache = /*#__PURE__*/new Map();\n  /** @internal */\n  function createBatchScheduler({\n    fn,\n    id,\n    shouldSplitBatch,\n    wait = 0,\n    sort\n  }) {\n    const exec = async () => {\n      const scheduler = getScheduler();\n      flush();\n      const args = scheduler.map(({\n        args\n      }) => args);\n      if (args.length === 0) return;\n      fn(args).then(data => {\n        if (sort && Array.isArray(data)) data.sort(sort);\n        for (let i = 0; i < scheduler.length; i++) {\n          const {\n            resolve\n          } = scheduler[i];\n          resolve?.([data[i], data]);\n        }\n      }).catch(err => {\n        for (let i = 0; i < scheduler.length; i++) {\n          const {\n            reject\n          } = scheduler[i];\n          reject?.(err);\n        }\n      });\n    };\n    const flush = () => schedulerCache.delete(id);\n    const getBatchedArgs = () => getScheduler().map(({\n      args\n    }) => args);\n    const getScheduler = () => schedulerCache.get(id) || [];\n    const setScheduler = item => schedulerCache.set(id, [...getScheduler(), item]);\n    return {\n      flush,\n      async schedule(args) {\n        const {\n          promise,\n          resolve,\n          reject\n        } = (0, _withResolversJs.withResolvers)();\n        const split = shouldSplitBatch?.([...getBatchedArgs(), args]);\n        if (split) exec();\n        const hasActiveScheduler = getScheduler().length > 0;\n        if (hasActiveScheduler) {\n          setScheduler({\n            args,\n            resolve,\n            reject\n          });\n          return promise;\n        }\n        setScheduler({\n          args,\n          resolve,\n          reject\n        });\n        setTimeout(exec, wait);\n        return promise;\n      }\n    };\n  }\n});","lineCount":77,"map":[[7,2,4,0,"exports"],[7,9,4,0],[7,10,4,0,"createBatchScheduler"],[7,30,4,0],[7,33,4,0,"createBatchScheduler"],[7,53,4,0],[8,2,1,0],[8,6,1,0,"_withResolversJs"],[8,22,1,0],[8,25,1,0,"require"],[8,32,1,0],[8,33,1,0,"_dependencyMap"],[8,47,1,0],[9,2,2,0],[9,8,2,6,"schedulerCache"],[9,22,2,20],[9,25,2,23],[9,38,2,37],[9,42,2,41,"Map"],[9,45,2,44],[9,46,2,45],[9,47,2,46],[10,2,3,0],[11,2,4,7],[11,11,4,16,"createBatchScheduler"],[11,31,4,36,"createBatchScheduler"],[11,32,4,37],[12,4,4,39,"fn"],[12,6,4,41],[13,4,4,43,"id"],[13,6,4,45],[14,4,4,47,"shouldSplitBatch"],[14,20,4,63],[15,4,4,65,"wait"],[15,8,4,69],[15,11,4,72],[15,12,4,73],[16,4,4,75,"sort"],[17,2,4,81],[17,3,4,82],[17,5,4,84],[18,4,5,4],[18,10,5,10,"exec"],[18,14,5,14],[18,17,5,17],[18,23,5,17,"exec"],[18,24,5,17],[18,29,5,29],[19,6,6,8],[19,12,6,14,"scheduler"],[19,21,6,23],[19,24,6,26,"getScheduler"],[19,36,6,38],[19,37,6,39],[19,38,6,40],[20,6,7,8,"flush"],[20,11,7,13],[20,12,7,14],[20,13,7,15],[21,6,8,8],[21,12,8,14,"args"],[21,16,8,18],[21,19,8,21,"scheduler"],[21,28,8,30],[21,29,8,31,"map"],[21,32,8,34],[21,33,8,35],[21,34,8,36],[22,8,8,38,"args"],[23,6,8,43],[23,7,8,44],[23,12,8,49,"args"],[23,16,8,53],[23,17,8,54],[24,6,9,8],[24,10,9,12,"args"],[24,14,9,16],[24,15,9,17,"length"],[24,21,9,23],[24,26,9,28],[24,27,9,29],[24,29,10,12],[25,6,11,8,"fn"],[25,8,11,10],[25,9,11,11,"args"],[25,13,11,15],[25,14,11,16],[25,15,12,13,"then"],[25,19,12,17],[25,20,12,19,"data"],[25,24,12,23],[25,28,12,28],[26,8,13,12],[26,12,13,16,"sort"],[26,16,13,20],[26,20,13,24,"Array"],[26,25,13,29],[26,26,13,30,"isArray"],[26,33,13,37],[26,34,13,38,"data"],[26,38,13,42],[26,39,13,43],[26,41,14,16,"data"],[26,45,14,20],[26,46,14,21,"sort"],[26,50,14,25],[26,51,14,26,"sort"],[26,55,14,30],[26,56,14,31],[27,8,15,12],[27,13,15,17],[27,17,15,21,"i"],[27,18,15,22],[27,21,15,25],[27,22,15,26],[27,24,15,28,"i"],[27,25,15,29],[27,28,15,32,"scheduler"],[27,37,15,41],[27,38,15,42,"length"],[27,44,15,48],[27,46,15,50,"i"],[27,47,15,51],[27,49,15,53],[27,51,15,55],[28,10,16,16],[28,16,16,22],[29,12,16,24,"resolve"],[30,10,16,32],[30,11,16,33],[30,14,16,36,"scheduler"],[30,23,16,45],[30,24,16,46,"i"],[30,25,16,47],[30,26,16,48],[31,10,17,16,"resolve"],[31,17,17,23],[31,20,17,26],[31,21,17,27,"data"],[31,25,17,31],[31,26,17,32,"i"],[31,27,17,33],[31,28,17,34],[31,30,17,36,"data"],[31,34,17,40],[31,35,17,41],[31,36,17,42],[32,8,18,12],[33,6,19,8],[33,7,19,9],[33,8,19,10],[33,9,20,13,"catch"],[33,14,20,18],[33,15,20,20,"err"],[33,18,20,23],[33,22,20,28],[34,8,21,12],[34,13,21,17],[34,17,21,21,"i"],[34,18,21,22],[34,21,21,25],[34,22,21,26],[34,24,21,28,"i"],[34,25,21,29],[34,28,21,32,"scheduler"],[34,37,21,41],[34,38,21,42,"length"],[34,44,21,48],[34,46,21,50,"i"],[34,47,21,51],[34,49,21,53],[34,51,21,55],[35,10,22,16],[35,16,22,22],[36,12,22,24,"reject"],[37,10,22,31],[37,11,22,32],[37,14,22,35,"scheduler"],[37,23,22,44],[37,24,22,45,"i"],[37,25,22,46],[37,26,22,47],[38,10,23,16,"reject"],[38,16,23,22],[38,19,23,25,"err"],[38,22,23,28],[38,23,23,29],[39,8,24,12],[40,6,25,8],[40,7,25,9],[40,8,25,10],[41,4,26,4],[41,5,26,5],[42,4,27,4],[42,10,27,10,"flush"],[42,15,27,15],[42,18,27,18,"flush"],[42,19,27,18],[42,24,27,24,"schedulerCache"],[42,38,27,38],[42,39,27,39,"delete"],[42,45,27,45],[42,46,27,46,"id"],[42,48,27,48],[42,49,27,49],[43,4,28,4],[43,10,28,10,"getBatchedArgs"],[43,24,28,24],[43,27,28,27,"getBatchedArgs"],[43,28,28,27],[43,33,28,33,"getScheduler"],[43,45,28,45],[43,46,28,46],[43,47,28,47],[43,48,28,48,"map"],[43,51,28,51],[43,52,28,52],[43,53,28,53],[44,6,28,55,"args"],[45,4,28,60],[45,5,28,61],[45,10,28,66,"args"],[45,14,28,70],[45,15,28,71],[46,4,29,4],[46,10,29,10,"getScheduler"],[46,22,29,22],[46,25,29,25,"getScheduler"],[46,26,29,25],[46,31,29,31,"schedulerCache"],[46,45,29,45],[46,46,29,46,"get"],[46,49,29,49],[46,50,29,50,"id"],[46,52,29,52],[46,53,29,53],[46,57,29,57],[46,59,29,59],[47,4,30,4],[47,10,30,10,"setScheduler"],[47,22,30,22],[47,25,30,26,"item"],[47,29,30,30],[47,33,30,35,"schedulerCache"],[47,47,30,49],[47,48,30,50,"set"],[47,51,30,53],[47,52,30,54,"id"],[47,54,30,56],[47,56,30,58],[47,57,30,59],[47,60,30,62,"getScheduler"],[47,72,30,74],[47,73,30,75],[47,74,30,76],[47,76,30,78,"item"],[47,80,30,82],[47,81,30,83],[47,82,30,84],[48,4,31,4],[48,11,31,11],[49,6,32,8,"flush"],[49,11,32,13],[50,6,33,8],[50,12,33,14,"schedule"],[50,20,33,22,"schedule"],[50,21,33,23,"args"],[50,25,33,27],[50,27,33,29],[51,8,34,12],[51,14,34,18],[52,10,34,20,"promise"],[52,17,34,27],[53,10,34,29,"resolve"],[53,17,34,36],[54,10,34,38,"reject"],[55,8,34,45],[55,9,34,46],[55,12,34,49],[55,16,34,49,"withResolvers"],[55,32,34,62],[55,33,34,62,"withResolvers"],[55,46,34,62],[55,48,34,63],[55,49,34,64],[56,8,35,12],[56,14,35,18,"split"],[56,19,35,23],[56,22,35,26,"shouldSplitBatch"],[56,38,35,42],[56,41,35,45],[56,42,35,46],[56,45,35,49,"getBatchedArgs"],[56,59,35,63],[56,60,35,64],[56,61,35,65],[56,63,35,67,"args"],[56,67,35,71],[56,68,35,72],[56,69,35,73],[57,8,36,12],[57,12,36,16,"split"],[57,17,36,21],[57,19,37,16,"exec"],[57,23,37,20],[57,24,37,21],[57,25,37,22],[58,8,38,12],[58,14,38,18,"hasActiveScheduler"],[58,32,38,36],[58,35,38,39,"getScheduler"],[58,47,38,51],[58,48,38,52],[58,49,38,53],[58,50,38,54,"length"],[58,56,38,60],[58,59,38,63],[58,60,38,64],[59,8,39,12],[59,12,39,16,"hasActiveScheduler"],[59,30,39,34],[59,32,39,36],[60,10,40,16,"setScheduler"],[60,22,40,28],[60,23,40,29],[61,12,40,31,"args"],[61,16,40,35],[62,12,40,37,"resolve"],[62,19,40,44],[63,12,40,46,"reject"],[64,10,40,53],[64,11,40,54],[64,12,40,55],[65,10,41,16],[65,17,41,23,"promise"],[65,24,41,30],[66,8,42,12],[67,8,43,12,"setScheduler"],[67,20,43,24],[67,21,43,25],[68,10,43,27,"args"],[68,14,43,31],[69,10,43,33,"resolve"],[69,17,43,40],[70,10,43,42,"reject"],[71,8,43,49],[71,9,43,50],[71,10,43,51],[72,8,44,12,"setTimeout"],[72,18,44,22],[72,19,44,23,"exec"],[72,23,44,27],[72,25,44,29,"wait"],[72,29,44,33],[72,30,44,34],[73,8,45,12],[73,15,45,19,"promise"],[73,22,45,26],[74,6,46,8],[75,4,47,4],[75,5,47,5],[76,2,48,0],[77,0,48,1],[77,3]],"functionMap":{"names":["<global>","createBatchScheduler","exec","scheduler.map$argument_0","fn.then$argument_0","fn.then._catch$argument_0","flush","getBatchedArgs","getScheduler.map$argument_0","getScheduler","setScheduler","schedule"],"mappings":"AAA;OCG;iBCC;mCCG,kBD;kBEI;SFO;mBGC;SHK;KDC;kBKC,+BL;2BMC,yBC,kBD,CN;yBQC,kCR;yBSC,2DT;QUG;SVa;CDE"},"hasCjsExports":false},"type":"js/module"}]}