{"dependencies":[{"name":"./is-binary.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":23,"index":194},"end":{"line":5,"column":48,"index":219}}],"key":"Aape7T+/x9esXlwptjKF8c3XaF4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.deconstructPacket = deconstructPacket;\n  exports.reconstructPacket = reconstructPacket;\n  const is_binary_js_1 = require(_dependencyMap[0], \"./is-binary.js\");\n  /**\n   * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n   *\n   * @param {Object} packet - socket.io event packet\n   * @return {Object} with deconstructed packet and list of buffers\n   * @public\n   */\n  function deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return {\n      packet: pack,\n      buffers: buffers\n    };\n  }\n  function _deconstructPacket(data, buffers) {\n    if (!data) return data;\n    if ((0, is_binary_js_1.isBinary)(data)) {\n      const placeholder = {\n        _placeholder: true,\n        num: buffers.length\n      };\n      buffers.push(data);\n      return placeholder;\n    } else if (Array.isArray(data)) {\n      const newData = new Array(data.length);\n      for (let i = 0; i < data.length; i++) {\n        newData[i] = _deconstructPacket(data[i], buffers);\n      }\n      return newData;\n    } else if (typeof data === \"object\" && !(data instanceof Date)) {\n      const newData = {};\n      for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n          newData[key] = _deconstructPacket(data[key], buffers);\n        }\n      }\n      return newData;\n    }\n    return data;\n  }\n  /**\n   * Reconstructs a binary packet from its placeholder packet and buffers\n   *\n   * @param {Object} packet - event packet with placeholders\n   * @param {Array} buffers - binary buffers to put in placeholder positions\n   * @return {Object} reconstructed packet\n   * @public\n   */\n  function reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n  }\n  function _reconstructPacket(data, buffers) {\n    if (!data) return data;\n    if (data && data._placeholder === true) {\n      const isIndexValid = typeof data.num === \"number\" && data.num >= 0 && data.num < buffers.length;\n      if (isIndexValid) {\n        return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n      } else {\n        throw new Error(\"illegal attachments\");\n      }\n    } else if (Array.isArray(data)) {\n      for (let i = 0; i < data.length; i++) {\n        data[i] = _reconstructPacket(data[i], buffers);\n      }\n    } else if (typeof data === \"object\") {\n      for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n          data[key] = _reconstructPacket(data[key], buffers);\n        }\n      }\n    }\n    return data;\n  }\n});","lineCount":89,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"deconstructPacket"],[7,27,3,25],[7,30,3,28,"deconstructPacket"],[7,47,3,45],[8,2,4,0,"exports"],[8,9,4,7],[8,10,4,8,"reconstructPacket"],[8,27,4,25],[8,30,4,28,"reconstructPacket"],[8,47,4,45],[9,2,5,0],[9,8,5,6,"is_binary_js_1"],[9,22,5,20],[9,25,5,23,"require"],[9,32,5,30],[9,33,5,30,"_dependencyMap"],[9,47,5,30],[9,68,5,47],[9,69,5,48],[10,2,6,0],[11,0,7,0],[12,0,8,0],[13,0,9,0],[14,0,10,0],[15,0,11,0],[16,0,12,0],[17,2,13,0],[17,11,13,9,"deconstructPacket"],[17,28,13,26,"deconstructPacket"],[17,29,13,27,"packet"],[17,35,13,33],[17,37,13,35],[18,4,14,4],[18,10,14,10,"buffers"],[18,17,14,17],[18,20,14,20],[18,22,14,22],[19,4,15,4],[19,10,15,10,"packetData"],[19,20,15,20],[19,23,15,23,"packet"],[19,29,15,29],[19,30,15,30,"data"],[19,34,15,34],[20,4,16,4],[20,10,16,10,"pack"],[20,14,16,14],[20,17,16,17,"packet"],[20,23,16,23],[21,4,17,4,"pack"],[21,8,17,8],[21,9,17,9,"data"],[21,13,17,13],[21,16,17,16,"_deconstructPacket"],[21,34,17,34],[21,35,17,35,"packetData"],[21,45,17,45],[21,47,17,47,"buffers"],[21,54,17,54],[21,55,17,55],[22,4,18,4,"pack"],[22,8,18,8],[22,9,18,9,"attachments"],[22,20,18,20],[22,23,18,23,"buffers"],[22,30,18,30],[22,31,18,31,"length"],[22,37,18,37],[22,38,18,38],[22,39,18,39],[23,4,19,4],[23,11,19,11],[24,6,19,13,"packet"],[24,12,19,19],[24,14,19,21,"pack"],[24,18,19,25],[25,6,19,27,"buffers"],[25,13,19,34],[25,15,19,36,"buffers"],[26,4,19,44],[26,5,19,45],[27,2,20,0],[28,2,21,0],[28,11,21,9,"_deconstructPacket"],[28,29,21,27,"_deconstructPacket"],[28,30,21,28,"data"],[28,34,21,32],[28,36,21,34,"buffers"],[28,43,21,41],[28,45,21,43],[29,4,22,4],[29,8,22,8],[29,9,22,9,"data"],[29,13,22,13],[29,15,23,8],[29,22,23,15,"data"],[29,26,23,19],[30,4,24,4],[30,8,24,8],[30,9,24,9],[30,10,24,10],[30,12,24,12,"is_binary_js_1"],[30,26,24,26],[30,27,24,27,"isBinary"],[30,35,24,35],[30,37,24,37,"data"],[30,41,24,41],[30,42,24,42],[30,44,24,44],[31,6,25,8],[31,12,25,14,"placeholder"],[31,23,25,25],[31,26,25,28],[32,8,25,30,"_placeholder"],[32,20,25,42],[32,22,25,44],[32,26,25,48],[33,8,25,50,"num"],[33,11,25,53],[33,13,25,55,"buffers"],[33,20,25,62],[33,21,25,63,"length"],[34,6,25,70],[34,7,25,71],[35,6,26,8,"buffers"],[35,13,26,15],[35,14,26,16,"push"],[35,18,26,20],[35,19,26,21,"data"],[35,23,26,25],[35,24,26,26],[36,6,27,8],[36,13,27,15,"placeholder"],[36,24,27,26],[37,4,28,4],[37,5,28,5],[37,11,29,9],[37,15,29,13,"Array"],[37,20,29,18],[37,21,29,19,"isArray"],[37,28,29,26],[37,29,29,27,"data"],[37,33,29,31],[37,34,29,32],[37,36,29,34],[38,6,30,8],[38,12,30,14,"newData"],[38,19,30,21],[38,22,30,24],[38,26,30,28,"Array"],[38,31,30,33],[38,32,30,34,"data"],[38,36,30,38],[38,37,30,39,"length"],[38,43,30,45],[38,44,30,46],[39,6,31,8],[39,11,31,13],[39,15,31,17,"i"],[39,16,31,18],[39,19,31,21],[39,20,31,22],[39,22,31,24,"i"],[39,23,31,25],[39,26,31,28,"data"],[39,30,31,32],[39,31,31,33,"length"],[39,37,31,39],[39,39,31,41,"i"],[39,40,31,42],[39,42,31,44],[39,44,31,46],[40,8,32,12,"newData"],[40,15,32,19],[40,16,32,20,"i"],[40,17,32,21],[40,18,32,22],[40,21,32,25,"_deconstructPacket"],[40,39,32,43],[40,40,32,44,"data"],[40,44,32,48],[40,45,32,49,"i"],[40,46,32,50],[40,47,32,51],[40,49,32,53,"buffers"],[40,56,32,60],[40,57,32,61],[41,6,33,8],[42,6,34,8],[42,13,34,15,"newData"],[42,20,34,22],[43,4,35,4],[43,5,35,5],[43,11,36,9],[43,15,36,13],[43,22,36,20,"data"],[43,26,36,24],[43,31,36,29],[43,39,36,37],[43,43,36,41],[43,45,36,43,"data"],[43,49,36,47],[43,61,36,59,"Date"],[43,65,36,63],[43,66,36,64],[43,68,36,66],[44,6,37,8],[44,12,37,14,"newData"],[44,19,37,21],[44,22,37,24],[44,23,37,25],[44,24,37,26],[45,6,38,8],[45,11,38,13],[45,17,38,19,"key"],[45,20,38,22],[45,24,38,26,"data"],[45,28,38,30],[45,30,38,32],[46,8,39,12],[46,12,39,16,"Object"],[46,18,39,22],[46,19,39,23,"prototype"],[46,28,39,32],[46,29,39,33,"hasOwnProperty"],[46,43,39,47],[46,44,39,48,"call"],[46,48,39,52],[46,49,39,53,"data"],[46,53,39,57],[46,55,39,59,"key"],[46,58,39,62],[46,59,39,63],[46,61,39,65],[47,10,40,16,"newData"],[47,17,40,23],[47,18,40,24,"key"],[47,21,40,27],[47,22,40,28],[47,25,40,31,"_deconstructPacket"],[47,43,40,49],[47,44,40,50,"data"],[47,48,40,54],[47,49,40,55,"key"],[47,52,40,58],[47,53,40,59],[47,55,40,61,"buffers"],[47,62,40,68],[47,63,40,69],[48,8,41,12],[49,6,42,8],[50,6,43,8],[50,13,43,15,"newData"],[50,20,43,22],[51,4,44,4],[52,4,45,4],[52,11,45,11,"data"],[52,15,45,15],[53,2,46,0],[54,2,47,0],[55,0,48,0],[56,0,49,0],[57,0,50,0],[58,0,51,0],[59,0,52,0],[60,0,53,0],[61,0,54,0],[62,2,55,0],[62,11,55,9,"reconstructPacket"],[62,28,55,26,"reconstructPacket"],[62,29,55,27,"packet"],[62,35,55,33],[62,37,55,35,"buffers"],[62,44,55,42],[62,46,55,44],[63,4,56,4,"packet"],[63,10,56,10],[63,11,56,11,"data"],[63,15,56,15],[63,18,56,18,"_reconstructPacket"],[63,36,56,36],[63,37,56,37,"packet"],[63,43,56,43],[63,44,56,44,"data"],[63,48,56,48],[63,50,56,50,"buffers"],[63,57,56,57],[63,58,56,58],[64,4,57,4],[64,11,57,11,"packet"],[64,17,57,17],[64,18,57,18,"attachments"],[64,29,57,29],[64,30,57,30],[64,31,57,31],[65,4,58,4],[65,11,58,11,"packet"],[65,17,58,17],[66,2,59,0],[67,2,60,0],[67,11,60,9,"_reconstructPacket"],[67,29,60,27,"_reconstructPacket"],[67,30,60,28,"data"],[67,34,60,32],[67,36,60,34,"buffers"],[67,43,60,41],[67,45,60,43],[68,4,61,4],[68,8,61,8],[68,9,61,9,"data"],[68,13,61,13],[68,15,62,8],[68,22,62,15,"data"],[68,26,62,19],[69,4,63,4],[69,8,63,8,"data"],[69,12,63,12],[69,16,63,16,"data"],[69,20,63,20],[69,21,63,21,"_placeholder"],[69,33,63,33],[69,38,63,38],[69,42,63,42],[69,44,63,44],[70,6,64,8],[70,12,64,14,"isIndexValid"],[70,24,64,26],[70,27,64,29],[70,34,64,36,"data"],[70,38,64,40],[70,39,64,41,"num"],[70,42,64,44],[70,47,64,49],[70,55,64,57],[70,59,65,12,"data"],[70,63,65,16],[70,64,65,17,"num"],[70,67,65,20],[70,71,65,24],[70,72,65,25],[70,76,66,12,"data"],[70,80,66,16],[70,81,66,17,"num"],[70,84,66,20],[70,87,66,23,"buffers"],[70,94,66,30],[70,95,66,31,"length"],[70,101,66,37],[71,6,67,8],[71,10,67,12,"isIndexValid"],[71,22,67,24],[71,24,67,26],[72,8,68,12],[72,15,68,19,"buffers"],[72,22,68,26],[72,23,68,27,"data"],[72,27,68,31],[72,28,68,32,"num"],[72,31,68,35],[72,32,68,36],[72,33,68,37],[72,34,68,38],[73,6,69,8],[73,7,69,9],[73,13,70,13],[74,8,71,12],[74,14,71,18],[74,18,71,22,"Error"],[74,23,71,27],[74,24,71,28],[74,45,71,49],[74,46,71,50],[75,6,72,8],[76,4,73,4],[76,5,73,5],[76,11,74,9],[76,15,74,13,"Array"],[76,20,74,18],[76,21,74,19,"isArray"],[76,28,74,26],[76,29,74,27,"data"],[76,33,74,31],[76,34,74,32],[76,36,74,34],[77,6,75,8],[77,11,75,13],[77,15,75,17,"i"],[77,16,75,18],[77,19,75,21],[77,20,75,22],[77,22,75,24,"i"],[77,23,75,25],[77,26,75,28,"data"],[77,30,75,32],[77,31,75,33,"length"],[77,37,75,39],[77,39,75,41,"i"],[77,40,75,42],[77,42,75,44],[77,44,75,46],[78,8,76,12,"data"],[78,12,76,16],[78,13,76,17,"i"],[78,14,76,18],[78,15,76,19],[78,18,76,22,"_reconstructPacket"],[78,36,76,40],[78,37,76,41,"data"],[78,41,76,45],[78,42,76,46,"i"],[78,43,76,47],[78,44,76,48],[78,46,76,50,"buffers"],[78,53,76,57],[78,54,76,58],[79,6,77,8],[80,4,78,4],[80,5,78,5],[80,11,79,9],[80,15,79,13],[80,22,79,20,"data"],[80,26,79,24],[80,31,79,29],[80,39,79,37],[80,41,79,39],[81,6,80,8],[81,11,80,13],[81,17,80,19,"key"],[81,20,80,22],[81,24,80,26,"data"],[81,28,80,30],[81,30,80,32],[82,8,81,12],[82,12,81,16,"Object"],[82,18,81,22],[82,19,81,23,"prototype"],[82,28,81,32],[82,29,81,33,"hasOwnProperty"],[82,43,81,47],[82,44,81,48,"call"],[82,48,81,52],[82,49,81,53,"data"],[82,53,81,57],[82,55,81,59,"key"],[82,58,81,62],[82,59,81,63],[82,61,81,65],[83,10,82,16,"data"],[83,14,82,20],[83,15,82,21,"key"],[83,18,82,24],[83,19,82,25],[83,22,82,28,"_reconstructPacket"],[83,40,82,46],[83,41,82,47,"data"],[83,45,82,51],[83,46,82,52,"key"],[83,49,82,55],[83,50,82,56],[83,52,82,58,"buffers"],[83,59,82,65],[83,60,82,66],[84,8,83,12],[85,6,84,8],[86,4,85,4],[87,4,86,4],[87,11,86,11,"data"],[87,15,86,15],[88,2,87,0],[89,0,87,1],[89,3]],"functionMap":{"names":["<global>","deconstructPacket","_deconstructPacket","reconstructPacket","_reconstructPacket"],"mappings":"AAA;ACY;CDO;AEC;CFyB;AGS;CHI;AIC;CJ2B"},"hasCjsExports":true},"type":"js/module"}]}