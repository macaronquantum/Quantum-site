{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.Lock = void 0;\n  // Based on https://github.com/jsoendermann/semaphore-async-await/blob/master/src/Semaphore.ts\n  class Lock {\n    constructor() {\n      this.permits = 1;\n      this.promiseResolverQueue = [];\n    }\n    /**\n     * Returns a promise used to wait for a permit to become available. This method should be awaited on.\n     * @returns  A promise that gets resolved when execution is allowed to proceed.\n     */\n    async acquire() {\n      if (this.permits > 0) {\n        this.permits -= 1;\n        return Promise.resolve(true);\n      }\n      // If there is no permit available, we return a promise that resolves once the semaphore gets\n      // signaled enough times that permits is equal to one.\n      return new Promise(resolver => this.promiseResolverQueue.push(resolver));\n    }\n    /**\n     * Increases the number of permits by one. If there are other functions waiting, one of them will\n     * continue to execute in a future iteration of the event loop.\n     */\n    release() {\n      this.permits += 1;\n      if (this.permits > 1 && this.promiseResolverQueue.length > 0) {\n        // eslint-disable-next-line no-console\n        console.warn('Lock.permits should never be > 0 when there is someone waiting.');\n      } else if (this.permits === 1 && this.promiseResolverQueue.length > 0) {\n        // If there is someone else waiting, immediately consume the permit that was released\n        // at the beginning of this function and let the waiting function resume.\n        this.permits -= 1;\n        const nextResolver = this.promiseResolverQueue.shift();\n        if (nextResolver) {\n          nextResolver(true);\n        }\n      }\n    }\n  }\n  exports.Lock = Lock;\n});","lineCount":48,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"Lock"],[7,14,3,12],[7,17,3,15],[7,22,3,20],[7,23,3,21],[8,2,4,0],[9,2,5,0],[9,8,5,6,"Lock"],[9,12,5,10],[9,13,5,11],[10,4,6,4,"constructor"],[10,15,6,15,"constructor"],[10,16,6,15],[10,18,6,18],[11,6,7,8],[11,10,7,12],[11,11,7,13,"permits"],[11,18,7,20],[11,21,7,23],[11,22,7,24],[12,6,8,8],[12,10,8,12],[12,11,8,13,"promiseResolverQueue"],[12,31,8,33],[12,34,8,36],[12,36,8,38],[13,4,9,4],[14,4,10,4],[15,0,11,0],[16,0,12,0],[17,0,13,0],[18,4,14,4],[18,10,14,10,"acquire"],[18,17,14,17,"acquire"],[18,18,14,17],[18,20,14,20],[19,6,15,8],[19,10,15,12],[19,14,15,16],[19,15,15,17,"permits"],[19,22,15,24],[19,25,15,27],[19,26,15,28],[19,28,15,30],[20,8,16,12],[20,12,16,16],[20,13,16,17,"permits"],[20,20,16,24],[20,24,16,28],[20,25,16,29],[21,8,17,12],[21,15,17,19,"Promise"],[21,22,17,26],[21,23,17,27,"resolve"],[21,30,17,34],[21,31,17,35],[21,35,17,39],[21,36,17,40],[22,6,18,8],[23,6,19,8],[24,6,20,8],[25,6,21,8],[25,13,21,15],[25,17,21,19,"Promise"],[25,24,21,26],[25,25,21,28,"resolver"],[25,33,21,36],[25,37,21,41],[25,41,21,45],[25,42,21,46,"promiseResolverQueue"],[25,62,21,66],[25,63,21,67,"push"],[25,67,21,71],[25,68,21,72,"resolver"],[25,76,21,80],[25,77,21,81],[25,78,21,82],[26,4,22,4],[27,4,23,4],[28,0,24,0],[29,0,25,0],[30,0,26,0],[31,4,27,4,"release"],[31,11,27,11,"release"],[31,12,27,11],[31,14,27,14],[32,6,28,8],[32,10,28,12],[32,11,28,13,"permits"],[32,18,28,20],[32,22,28,24],[32,23,28,25],[33,6,29,8],[33,10,29,12],[33,14,29,16],[33,15,29,17,"permits"],[33,22,29,24],[33,25,29,27],[33,26,29,28],[33,30,29,32],[33,34,29,36],[33,35,29,37,"promiseResolverQueue"],[33,55,29,57],[33,56,29,58,"length"],[33,62,29,64],[33,65,29,67],[33,66,29,68],[33,68,29,70],[34,8,30,12],[35,8,31,12,"console"],[35,15,31,19],[35,16,31,20,"warn"],[35,20,31,24],[35,21,31,25],[35,86,31,90],[35,87,31,91],[36,6,32,8],[36,7,32,9],[36,13,33,13],[36,17,33,17],[36,21,33,21],[36,22,33,22,"permits"],[36,29,33,29],[36,34,33,34],[36,35,33,35],[36,39,33,39],[36,43,33,43],[36,44,33,44,"promiseResolverQueue"],[36,64,33,64],[36,65,33,65,"length"],[36,71,33,71],[36,74,33,74],[36,75,33,75],[36,77,33,77],[37,8,34,12],[38,8,35,12],[39,8,36,12],[39,12,36,16],[39,13,36,17,"permits"],[39,20,36,24],[39,24,36,28],[39,25,36,29],[40,8,37,12],[40,14,37,18,"nextResolver"],[40,26,37,30],[40,29,37,33],[40,33,37,37],[40,34,37,38,"promiseResolverQueue"],[40,54,37,58],[40,55,37,59,"shift"],[40,60,37,64],[40,61,37,65],[40,62,37,66],[41,8,38,12],[41,12,38,16,"nextResolver"],[41,24,38,28],[41,26,38,30],[42,10,39,16,"nextResolver"],[42,22,39,28],[42,23,39,29],[42,27,39,33],[42,28,39,34],[43,8,40,12],[44,6,41,8],[45,4,42,4],[46,2,43,0],[47,2,44,0,"exports"],[47,9,44,7],[47,10,44,8,"Lock"],[47,14,44,12],[47,17,44,15,"Lock"],[47,21,44,19],[48,0,44,20],[48,3]],"functionMap":{"names":["<global>","Lock","Lock#constructor","Lock#acquire","Promise$argument_0","Lock#release"],"mappings":"AAA;ACI;ICC;KDG;IEK;2BCO,sDD;KFC;IIK;KJe;CDC"},"hasCjsExports":true},"type":"js/module"}]}