{"dependencies":[{"name":"./modifiers","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":40,"index":54},"end":{"line":3,"column":62,"index":76}}],"key":"zULYkz4pfQC65QyeHgT28Quvsk8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  const {\n    groupRestore,\n    nestedRestore\n  } = require(_dependencyMap[0], \"./modifiers\");\n  module.exports = restorer;\n  function restorer() {\n    return function compileRestore() {\n      if (this.restore) {\n        this.restore.state.secret = this.secret;\n        return;\n      }\n      const {\n        secret,\n        wcLen\n      } = this;\n      const paths = Object.keys(secret);\n      const resetters = resetTmpl(secret, paths);\n      const hasWildcards = wcLen > 0;\n      const state = hasWildcards ? {\n        secret,\n        groupRestore,\n        nestedRestore\n      } : {\n        secret\n      };\n      /* eslint-disable-next-line */\n      this.restore = Function('o', restoreTmpl(resetters, paths, hasWildcards)).bind(state);\n      this.restore.state = state;\n    };\n  }\n\n  /**\n   * Mutates the original object to be censored by restoring its original values\n   * prior to censoring.\n   *\n   * @param {object} secret Compiled object describing which target fields should\n   * be censored and the field states.\n   * @param {string[]} paths The list of paths to censor as provided at\n   * initialization time.\n   *\n   * @returns {string} String of JavaScript to be used by `Function()`. The\n   * string compiles to the function that does the work in the description.\n   */\n  function resetTmpl(secret, paths) {\n    return paths.map(path => {\n      const {\n        circle,\n        escPath,\n        leadingBracket\n      } = secret[path];\n      const delim = leadingBracket ? '' : '.';\n      const reset = circle ? `o.${circle} = secret[${escPath}].val` : `o${delim}${path} = secret[${escPath}].val`;\n      const clear = `secret[${escPath}].val = undefined`;\n      return `\n      if (secret[${escPath}].val !== undefined) {\n        try { ${reset} } catch (e) {}\n        ${clear}\n      }\n    `;\n    }).join('');\n  }\n\n  /**\n   * Creates the body of the restore function\n   *\n   * Restoration of the redacted object happens\n   * backwards, in reverse order of redactions,\n   * so that repeated redactions on the same object\n   * property can be eventually rolled back to the\n   * original value.\n   *\n   * This way dynamic redactions are restored first,\n   * starting from the last one working backwards and\n   * followed by the static ones.\n   *\n   * @returns {string} the body of the restore function\n   */\n  function restoreTmpl(resetters, paths, hasWildcards) {\n    const dynamicReset = hasWildcards === true ? `\n    const keys = Object.keys(secret)\n    const len = keys.length\n    for (var i = len - 1; i >= ${paths.length}; i--) {\n      const k = keys[i]\n      const o = secret[k]\n      if (o) {\n        if (o.flat === true) this.groupRestore(o)\n        else this.nestedRestore(o)\n        secret[k] = null\n      }\n    }\n  ` : '';\n    return `\n    const secret = this.secret\n    ${dynamicReset}\n    ${resetters}\n    return o\n  `;\n  }\n});","lineCount":102,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,8,3,6],[5,4,3,8,"groupRestore"],[5,16,3,20],[6,4,3,22,"nestedRestore"],[7,2,3,36],[7,3,3,37],[7,6,3,40,"require"],[7,13,3,47],[7,14,3,47,"_dependencyMap"],[7,28,3,47],[7,46,3,61],[7,47,3,62],[8,2,5,0,"module"],[8,8,5,6],[8,9,5,7,"exports"],[8,16,5,14],[8,19,5,17,"restorer"],[8,27,5,25],[9,2,7,0],[9,11,7,9,"restorer"],[9,19,7,17,"restorer"],[9,20,7,17],[9,22,7,21],[10,4,8,2],[10,11,8,9],[10,20,8,18,"compileRestore"],[10,34,8,32,"compileRestore"],[10,35,8,32],[10,37,8,36],[11,6,9,4],[11,10,9,8],[11,14,9,12],[11,15,9,13,"restore"],[11,22,9,20],[11,24,9,22],[12,8,10,6],[12,12,10,10],[12,13,10,11,"restore"],[12,20,10,18],[12,21,10,19,"state"],[12,26,10,24],[12,27,10,25,"secret"],[12,33,10,31],[12,36,10,34],[12,40,10,38],[12,41,10,39,"secret"],[12,47,10,45],[13,8,11,6],[14,6,12,4],[15,6,13,4],[15,12,13,10],[16,8,13,12,"secret"],[16,14,13,18],[17,8,13,20,"wcLen"],[18,6,13,26],[18,7,13,27],[18,10,13,30],[18,14,13,34],[19,6,14,4],[19,12,14,10,"paths"],[19,17,14,15],[19,20,14,18,"Object"],[19,26,14,24],[19,27,14,25,"keys"],[19,31,14,29],[19,32,14,30,"secret"],[19,38,14,36],[19,39,14,37],[20,6,15,4],[20,12,15,10,"resetters"],[20,21,15,19],[20,24,15,22,"resetTmpl"],[20,33,15,31],[20,34,15,32,"secret"],[20,40,15,38],[20,42,15,40,"paths"],[20,47,15,45],[20,48,15,46],[21,6,16,4],[21,12,16,10,"hasWildcards"],[21,24,16,22],[21,27,16,25,"wcLen"],[21,32,16,30],[21,35,16,33],[21,36,16,34],[22,6,17,4],[22,12,17,10,"state"],[22,17,17,15],[22,20,17,18,"hasWildcards"],[22,32,17,30],[22,35,17,33],[23,8,17,35,"secret"],[23,14,17,41],[24,8,17,43,"groupRestore"],[24,20,17,55],[25,8,17,57,"nestedRestore"],[26,6,17,71],[26,7,17,72],[26,10,17,75],[27,8,17,77,"secret"],[28,6,17,84],[28,7,17,85],[29,6,18,4],[30,6,19,4],[30,10,19,8],[30,11,19,9,"restore"],[30,18,19,16],[30,21,19,19,"Function"],[30,29,19,27],[30,30,20,6],[30,33,20,9],[30,35,21,6,"restoreTmpl"],[30,46,21,17],[30,47,21,18,"resetters"],[30,56,21,27],[30,58,21,29,"paths"],[30,63,21,34],[30,65,21,36,"hasWildcards"],[30,77,21,48],[30,78,22,4],[30,79,22,5],[30,80,22,6,"bind"],[30,84,22,10],[30,85,22,11,"state"],[30,90,22,16],[30,91,22,17],[31,6,23,4],[31,10,23,8],[31,11,23,9,"restore"],[31,18,23,16],[31,19,23,17,"state"],[31,24,23,22],[31,27,23,25,"state"],[31,32,23,30],[32,4,24,2],[32,5,24,3],[33,2,25,0],[35,2,27,0],[36,0,28,0],[37,0,29,0],[38,0,30,0],[39,0,31,0],[40,0,32,0],[41,0,33,0],[42,0,34,0],[43,0,35,0],[44,0,36,0],[45,0,37,0],[46,0,38,0],[47,2,39,0],[47,11,39,9,"resetTmpl"],[47,20,39,18,"resetTmpl"],[47,21,39,20,"secret"],[47,27,39,26],[47,29,39,28,"paths"],[47,34,39,33],[47,36,39,35],[48,4,40,2],[48,11,40,9,"paths"],[48,16,40,14],[48,17,40,15,"map"],[48,20,40,18],[48,21,40,20,"path"],[48,25,40,24],[48,29,40,29],[49,6,41,4],[49,12,41,10],[50,8,41,12,"circle"],[50,14,41,18],[51,8,41,20,"escPath"],[51,15,41,27],[52,8,41,29,"leadingBracket"],[53,6,41,44],[53,7,41,45],[53,10,41,48,"secret"],[53,16,41,54],[53,17,41,55,"path"],[53,21,41,59],[53,22,41,60],[54,6,42,4],[54,12,42,10,"delim"],[54,17,42,15],[54,20,42,18,"leadingBracket"],[54,34,42,32],[54,37,42,35],[54,39,42,37],[54,42,42,40],[54,45,42,43],[55,6,43,4],[55,12,43,10,"reset"],[55,17,43,15],[55,20,43,18,"circle"],[55,26,43,24],[55,29,44,8],[55,34,44,13,"circle"],[55,40,44,19],[55,53,44,32,"escPath"],[55,60,44,39],[55,67,44,46],[55,70,45,8],[55,74,45,12,"delim"],[55,79,45,17],[55,82,45,20,"path"],[55,86,45,24],[55,99,45,37,"escPath"],[55,106,45,44],[55,113,45,51],[56,6,46,4],[56,12,46,10,"clear"],[56,17,46,15],[56,20,46,18],[56,30,46,28,"escPath"],[56,37,46,35],[56,56,46,54],[57,6,47,4],[57,13,47,11],[58,0,48,0],[58,19,48,19,"escPath"],[58,26,48,26],[59,0,49,0],[59,16,49,16,"reset"],[59,21,49,21],[60,0,50,0],[60,10,50,10,"clear"],[60,15,50,15],[61,0,51,0],[62,0,52,0],[62,5,52,5],[63,4,53,2],[63,5,53,3],[63,6,53,4],[63,7,53,5,"join"],[63,11,53,9],[63,12,53,10],[63,14,53,12],[63,15,53,13],[64,2,54,0],[66,2,56,0],[67,0,57,0],[68,0,58,0],[69,0,59,0],[70,0,60,0],[71,0,61,0],[72,0,62,0],[73,0,63,0],[74,0,64,0],[75,0,65,0],[76,0,66,0],[77,0,67,0],[78,0,68,0],[79,0,69,0],[80,0,70,0],[81,2,71,0],[81,11,71,9,"restoreTmpl"],[81,22,71,20,"restoreTmpl"],[81,23,71,22,"resetters"],[81,32,71,31],[81,34,71,33,"paths"],[81,39,71,38],[81,41,71,40,"hasWildcards"],[81,53,71,52],[81,55,71,54],[82,4,72,2],[82,10,72,8,"dynamicReset"],[82,22,72,20],[82,25,72,23,"hasWildcards"],[82,37,72,35],[82,42,72,40],[82,46,72,44],[82,49,72,47],[83,0,73,0],[84,0,74,0],[85,0,75,0],[85,33,75,33,"paths"],[85,38,75,38],[85,39,75,39,"length"],[85,45,75,45],[86,0,76,0],[87,0,77,0],[88,0,78,0],[89,0,79,0],[90,0,80,0],[91,0,81,0],[92,0,82,0],[93,0,83,0],[94,0,84,0],[94,3,84,3],[94,6,84,6],[94,8,84,8],[95,4,86,2],[95,11,86,9],[96,0,87,0],[97,0,88,0],[97,6,88,6,"dynamicReset"],[97,18,88,18],[98,0,89,0],[98,6,89,6,"resetters"],[98,15,89,15],[99,0,90,0],[100,0,91,0],[100,3,91,3],[101,2,92,0],[102,0,92,1],[102,3]],"functionMap":{"names":["<global>","restorer","compileRestore","resetTmpl","paths.map$argument_0","restoreTmpl"],"mappings":"AAA;ACM;SCC;GDgB;CDC;AGc;mBCC;GDa;CHC;AKiB;CLqB"},"hasCjsExports":true},"type":"js/module"}]}