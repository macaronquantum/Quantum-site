{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":74,"index":74}}],"key":"2pE/btc+6/9ceuRiPNwUYrtm86Y=","exportNames":["*"],"imports":1}},{"name":"../promise/withTimeout.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":75},"end":{"line":2,"column":57,"index":132}}],"key":"R0pXVlZ6xmiOVM86DCOsnzL2IWE=","exportNames":["*"],"imports":1}},{"name":"../stringify.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":133},"end":{"line":3,"column":44,"index":177}}],"key":"2zgFGs9gb8CDQZBLm+ivBNJ2Ky0=","exportNames":["*"],"imports":1}},{"name":"./id.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":178},"end":{"line":4,"column":34,"index":212}}],"key":"XzJUTA7q3576wrp3vEEP4WANxL4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getHttpRpcClient = getHttpRpcClient;\n  exports.parseUrl = parseUrl;\n  var _errorsRequestJs = require(_dependencyMap[0], \"../../errors/request.js\");\n  var _promiseWithTimeoutJs = require(_dependencyMap[1], \"../promise/withTimeout.js\");\n  var _stringifyJs = require(_dependencyMap[2], \"../stringify.js\");\n  var _idJs = require(_dependencyMap[3], \"./id.js\");\n  function getHttpRpcClient(url_, options = {}) {\n    const {\n      url,\n      headers: headers_url\n    } = parseUrl(url_);\n    return {\n      async request(params) {\n        const {\n          body,\n          fetchFn = options.fetchFn ?? fetch,\n          onRequest = options.onRequest,\n          onResponse = options.onResponse,\n          timeout = options.timeout ?? 10_000\n        } = params;\n        const fetchOptions = {\n          ...(options.fetchOptions ?? {}),\n          ...(params.fetchOptions ?? {})\n        };\n        const {\n          headers,\n          method,\n          signal: signal_\n        } = fetchOptions;\n        try {\n          const response = await (0, _promiseWithTimeoutJs.withTimeout)(async ({\n            signal\n          }) => {\n            const init = {\n              ...fetchOptions,\n              body: Array.isArray(body) ? (0, _stringifyJs.stringify)(body.map(body => ({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take(),\n                ...body\n              }))) : (0, _stringifyJs.stringify)({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take(),\n                ...body\n              }),\n              headers: {\n                ...headers_url,\n                'Content-Type': 'application/json',\n                ...headers\n              },\n              method: method || 'POST',\n              signal: signal_ || (timeout > 0 ? signal : null)\n            };\n            const request = new Request(url, init);\n            const args = (await onRequest?.(request, init)) ?? {\n              ...init,\n              url\n            };\n            const response = await fetchFn(args.url ?? url, args);\n            return response;\n          }, {\n            errorInstance: new _errorsRequestJs.TimeoutError({\n              body,\n              url\n            }),\n            timeout,\n            signal: true\n          });\n          if (onResponse) await onResponse(response);\n          let data;\n          if (response.headers.get('Content-Type')?.startsWith('application/json')) data = await response.json();else {\n            data = await response.text();\n            try {\n              data = JSON.parse(data || '{}');\n            } catch (err) {\n              if (response.ok) throw err;\n              data = {\n                error: data\n              };\n            }\n          }\n          if (!response.ok) {\n            throw new _errorsRequestJs.HttpRequestError({\n              body,\n              details: (0, _stringifyJs.stringify)(data.error) || response.statusText,\n              headers: response.headers,\n              status: response.status,\n              url\n            });\n          }\n          return data;\n        } catch (err) {\n          if (err instanceof _errorsRequestJs.HttpRequestError) throw err;\n          if (err instanceof _errorsRequestJs.TimeoutError) throw err;\n          throw new _errorsRequestJs.HttpRequestError({\n            body,\n            cause: err,\n            url\n          });\n        }\n      }\n    };\n  }\n  /** @internal */\n  function parseUrl(url_) {\n    try {\n      const url = new URL(url_);\n      const result = (() => {\n        // Handle Basic authentication credentials\n        if (url.username) {\n          const credentials = `${decodeURIComponent(url.username)}:${decodeURIComponent(url.password)}`;\n          url.username = '';\n          url.password = '';\n          return {\n            url: url.toString(),\n            headers: {\n              Authorization: `Basic ${btoa(credentials)}`\n            }\n          };\n        }\n        return;\n      })();\n      return {\n        url: url.toString(),\n        ...result\n      };\n    } catch {\n      return {\n        url: url_\n      };\n    }\n  }\n});","lineCount":138,"map":[[7,2,5,0,"exports"],[7,9,5,0],[7,10,5,0,"getHttpRpcClient"],[7,26,5,0],[7,29,5,0,"getHttpRpcClient"],[7,45,5,0],[8,2,89,0,"exports"],[8,9,89,0],[8,10,89,0,"parseUrl"],[8,18,89,0],[8,21,89,0,"parseUrl"],[8,29,89,0],[9,2,1,0],[9,6,1,0,"_errorsRequestJs"],[9,22,1,0],[9,25,1,0,"require"],[9,32,1,0],[9,33,1,0,"_dependencyMap"],[9,47,1,0],[10,2,2,0],[10,6,2,0,"_promiseWithTimeoutJs"],[10,27,2,0],[10,30,2,0,"require"],[10,37,2,0],[10,38,2,0,"_dependencyMap"],[10,52,2,0],[11,2,3,0],[11,6,3,0,"_stringifyJs"],[11,18,3,0],[11,21,3,0,"require"],[11,28,3,0],[11,29,3,0,"_dependencyMap"],[11,43,3,0],[12,2,4,0],[12,6,4,0,"_idJs"],[12,11,4,0],[12,14,4,0,"require"],[12,21,4,0],[12,22,4,0,"_dependencyMap"],[12,36,4,0],[13,2,5,7],[13,11,5,16,"getHttpRpcClient"],[13,27,5,32,"getHttpRpcClient"],[13,28,5,33,"url_"],[13,32,5,37],[13,34,5,39,"options"],[13,41,5,46],[13,44,5,49],[13,45,5,50],[13,46,5,51],[13,48,5,53],[14,4,6,4],[14,10,6,10],[15,6,6,12,"url"],[15,9,6,15],[16,6,6,17,"headers"],[16,13,6,24],[16,15,6,26,"headers_url"],[17,4,6,38],[17,5,6,39],[17,8,6,42,"parseUrl"],[17,16,6,50],[17,17,6,51,"url_"],[17,21,6,55],[17,22,6,56],[18,4,7,4],[18,11,7,11],[19,6,8,8],[19,12,8,14,"request"],[19,19,8,21,"request"],[19,20,8,22,"params"],[19,26,8,28],[19,28,8,30],[20,8,9,12],[20,14,9,18],[21,10,9,20,"body"],[21,14,9,24],[22,10,9,26,"fetchFn"],[22,17,9,33],[22,20,9,36,"options"],[22,27,9,43],[22,28,9,44,"fetchFn"],[22,35,9,51],[22,39,9,55,"fetch"],[22,44,9,60],[23,10,9,62,"onRequest"],[23,19,9,71],[23,22,9,74,"options"],[23,29,9,81],[23,30,9,82,"onRequest"],[23,39,9,91],[24,10,9,93,"onResponse"],[24,20,9,103],[24,23,9,106,"options"],[24,30,9,113],[24,31,9,114,"onResponse"],[24,41,9,124],[25,10,9,126,"timeout"],[25,17,9,133],[25,20,9,136,"options"],[25,27,9,143],[25,28,9,144,"timeout"],[25,35,9,151],[25,39,9,155],[26,8,9,163],[26,9,9,164],[26,12,9,167,"params"],[26,18,9,173],[27,8,10,12],[27,14,10,18,"fetchOptions"],[27,26,10,30],[27,29,10,33],[28,10,11,16],[28,14,11,20,"options"],[28,21,11,27],[28,22,11,28,"fetchOptions"],[28,34,11,40],[28,38,11,44],[28,39,11,45],[28,40,11,46],[28,41,11,47],[29,10,12,16],[29,14,12,20,"params"],[29,20,12,26],[29,21,12,27,"fetchOptions"],[29,33,12,39],[29,37,12,43],[29,38,12,44],[29,39,12,45],[30,8,13,12],[30,9,13,13],[31,8,14,12],[31,14,14,18],[32,10,14,20,"headers"],[32,17,14,27],[33,10,14,29,"method"],[33,16,14,35],[34,10,14,37,"signal"],[34,16,14,43],[34,18,14,45,"signal_"],[35,8,14,53],[35,9,14,54],[35,12,14,57,"fetchOptions"],[35,24,14,69],[36,8,15,12],[36,12,15,16],[37,10,16,16],[37,16,16,22,"response"],[37,24,16,30],[37,27,16,33],[37,33,16,39],[37,37,16,39,"withTimeout"],[37,58,16,50],[37,59,16,50,"withTimeout"],[37,70,16,50],[37,72,16,51],[37,79,16,58],[38,12,16,60,"signal"],[39,10,16,67],[39,11,16,68],[39,16,16,73],[40,12,17,20],[40,18,17,26,"init"],[40,22,17,30],[40,25,17,33],[41,14,18,24],[41,17,18,27,"fetchOptions"],[41,29,18,39],[42,14,19,24,"body"],[42,18,19,28],[42,20,19,30,"Array"],[42,25,19,35],[42,26,19,36,"isArray"],[42,33,19,43],[42,34,19,44,"body"],[42,38,19,48],[42,39,19,49],[42,42,20,30],[42,46,20,30,"stringify"],[42,58,20,39],[42,59,20,39,"stringify"],[42,68,20,39],[42,70,20,40,"body"],[42,74,20,44],[42,75,20,45,"map"],[42,78,20,48],[42,79,20,50,"body"],[42,83,20,54],[42,88,20,60],[43,16,21,32,"jsonrpc"],[43,23,21,39],[43,25,21,41],[43,30,21,46],[44,16,22,32,"id"],[44,18,22,34],[44,20,22,36,"body"],[44,24,22,40],[44,25,22,41,"id"],[44,27,22,43],[44,31,22,47,"idCache"],[44,36,22,54],[44,37,22,54,"idCache"],[44,44,22,54],[44,45,22,55,"take"],[44,49,22,59],[44,50,22,60],[44,51,22,61],[45,16,23,32],[45,19,23,35,"body"],[46,14,24,28],[46,15,24,29],[46,16,24,30],[46,17,24,31],[46,18,24,32],[46,21,25,30],[46,25,25,30,"stringify"],[46,37,25,39],[46,38,25,39,"stringify"],[46,47,25,39],[46,49,25,40],[47,16,26,32,"jsonrpc"],[47,23,26,39],[47,25,26,41],[47,30,26,46],[48,16,27,32,"id"],[48,18,27,34],[48,20,27,36,"body"],[48,24,27,40],[48,25,27,41,"id"],[48,27,27,43],[48,31,27,47,"idCache"],[48,36,27,54],[48,37,27,54,"idCache"],[48,44,27,54],[48,45,27,55,"take"],[48,49,27,59],[48,50,27,60],[48,51,27,61],[49,16,28,32],[49,19,28,35,"body"],[50,14,29,28],[50,15,29,29],[50,16,29,30],[51,14,30,24,"headers"],[51,21,30,31],[51,23,30,33],[52,16,31,28],[52,19,31,31,"headers_url"],[52,30,31,42],[53,16,32,28],[53,30,32,42],[53,32,32,44],[53,50,32,62],[54,16,33,28],[54,19,33,31,"headers"],[55,14,34,24],[55,15,34,25],[56,14,35,24,"method"],[56,20,35,30],[56,22,35,32,"method"],[56,28,35,38],[56,32,35,42],[56,38,35,48],[57,14,36,24,"signal"],[57,20,36,30],[57,22,36,32,"signal_"],[57,29,36,39],[57,34,36,44,"timeout"],[57,41,36,51],[57,44,36,54],[57,45,36,55],[57,48,36,58,"signal"],[57,54,36,64],[57,57,36,67],[57,61,36,71],[58,12,37,20],[58,13,37,21],[59,12,38,20],[59,18,38,26,"request"],[59,25,38,33],[59,28,38,36],[59,32,38,40,"Request"],[59,39,38,47],[59,40,38,48,"url"],[59,43,38,51],[59,45,38,53,"init"],[59,49,38,57],[59,50,38,58],[60,12,39,20],[60,18,39,26,"args"],[60,22,39,30],[60,25,39,33],[60,26,39,34],[60,32,39,40,"onRequest"],[60,41,39,49],[60,44,39,52,"request"],[60,51,39,59],[60,53,39,61,"init"],[60,57,39,65],[60,58,39,66],[60,63,39,71],[61,14,39,73],[61,17,39,76,"init"],[61,21,39,80],[62,14,39,82,"url"],[63,12,39,86],[63,13,39,87],[64,12,40,20],[64,18,40,26,"response"],[64,26,40,34],[64,29,40,37],[64,35,40,43,"fetchFn"],[64,42,40,50],[64,43,40,51,"args"],[64,47,40,55],[64,48,40,56,"url"],[64,51,40,59],[64,55,40,63,"url"],[64,58,40,66],[64,60,40,68,"args"],[64,64,40,72],[64,65,40,73],[65,12,41,20],[65,19,41,27,"response"],[65,27,41,35],[66,10,42,16],[66,11,42,17],[66,13,42,19],[67,12,43,20,"errorInstance"],[67,25,43,33],[67,27,43,35],[67,31,43,39,"TimeoutError"],[67,47,43,51],[67,48,43,51,"TimeoutError"],[67,60,43,51],[67,61,43,52],[68,14,43,54,"body"],[68,18,43,58],[69,14,43,60,"url"],[70,12,43,64],[70,13,43,65],[70,14,43,66],[71,12,44,20,"timeout"],[71,19,44,27],[72,12,45,20,"signal"],[72,18,45,26],[72,20,45,28],[73,10,46,16],[73,11,46,17],[73,12,46,18],[74,10,47,16],[74,14,47,20,"onResponse"],[74,24,47,30],[74,26,48,20],[74,32,48,26,"onResponse"],[74,42,48,36],[74,43,48,37,"response"],[74,51,48,45],[74,52,48,46],[75,10,49,16],[75,14,49,20,"data"],[75,18,49,24],[76,10,50,16],[76,14,50,20,"response"],[76,22,50,28],[76,23,50,29,"headers"],[76,30,50,36],[76,31,50,37,"get"],[76,34,50,40],[76,35,50,41],[76,49,50,55],[76,50,50,56],[76,52,50,58,"startsWith"],[76,62,50,68],[76,63,50,69],[76,81,50,87],[76,82,50,88],[76,84,51,20,"data"],[76,88,51,24],[76,91,51,27],[76,97,51,33,"response"],[76,105,51,41],[76,106,51,42,"json"],[76,110,51,46],[76,111,51,47],[76,112,51,48],[76,113,51,49],[76,118,52,21],[77,12,53,20,"data"],[77,16,53,24],[77,19,53,27],[77,25,53,33,"response"],[77,33,53,41],[77,34,53,42,"text"],[77,38,53,46],[77,39,53,47],[77,40,53,48],[78,12,54,20],[78,16,54,24],[79,14,55,24,"data"],[79,18,55,28],[79,21,55,31,"JSON"],[79,25,55,35],[79,26,55,36,"parse"],[79,31,55,41],[79,32,55,42,"data"],[79,36,55,46],[79,40,55,50],[79,44,55,54],[79,45,55,55],[80,12,56,20],[80,13,56,21],[80,14,57,20],[80,21,57,27,"err"],[80,24,57,30],[80,26,57,32],[81,14,58,24],[81,18,58,28,"response"],[81,26,58,36],[81,27,58,37,"ok"],[81,29,58,39],[81,31,59,28],[81,37,59,34,"err"],[81,40,59,37],[82,14,60,24,"data"],[82,18,60,28],[82,21,60,31],[83,16,60,33,"error"],[83,21,60,38],[83,23,60,40,"data"],[84,14,60,45],[84,15,60,46],[85,12,61,20],[86,10,62,16],[87,10,63,16],[87,14,63,20],[87,15,63,21,"response"],[87,23,63,29],[87,24,63,30,"ok"],[87,26,63,32],[87,28,63,34],[88,12,64,20],[88,18,64,26],[88,22,64,30,"HttpRequestError"],[88,38,64,46],[88,39,64,46,"HttpRequestError"],[88,55,64,46],[88,56,64,47],[89,14,65,24,"body"],[89,18,65,28],[90,14,66,24,"details"],[90,21,66,31],[90,23,66,33],[90,27,66,33,"stringify"],[90,39,66,42],[90,40,66,42,"stringify"],[90,49,66,42],[90,51,66,43,"data"],[90,55,66,47],[90,56,66,48,"error"],[90,61,66,53],[90,62,66,54],[90,66,66,58,"response"],[90,74,66,66],[90,75,66,67,"statusText"],[90,85,66,77],[91,14,67,24,"headers"],[91,21,67,31],[91,23,67,33,"response"],[91,31,67,41],[91,32,67,42,"headers"],[91,39,67,49],[92,14,68,24,"status"],[92,20,68,30],[92,22,68,32,"response"],[92,30,68,40],[92,31,68,41,"status"],[92,37,68,47],[93,14,69,24,"url"],[94,12,70,20],[94,13,70,21],[94,14,70,22],[95,10,71,16],[96,10,72,16],[96,17,72,23,"data"],[96,21,72,27],[97,8,73,12],[97,9,73,13],[97,10,74,12],[97,17,74,19,"err"],[97,20,74,22],[97,22,74,24],[98,10,75,16],[98,14,75,20,"err"],[98,17,75,23],[98,29,75,35,"HttpRequestError"],[98,45,75,51],[98,46,75,51,"HttpRequestError"],[98,62,75,51],[98,64,76,20],[98,70,76,26,"err"],[98,73,76,29],[99,10,77,16],[99,14,77,20,"err"],[99,17,77,23],[99,29,77,35,"TimeoutError"],[99,45,77,47],[99,46,77,47,"TimeoutError"],[99,58,77,47],[99,60,78,20],[99,66,78,26,"err"],[99,69,78,29],[100,10,79,16],[100,16,79,22],[100,20,79,26,"HttpRequestError"],[100,36,79,42],[100,37,79,42,"HttpRequestError"],[100,53,79,42],[100,54,79,43],[101,12,80,20,"body"],[101,16,80,24],[102,12,81,20,"cause"],[102,17,81,25],[102,19,81,27,"err"],[102,22,81,30],[103,12,82,20,"url"],[104,10,83,16],[104,11,83,17],[104,12,83,18],[105,8,84,12],[106,6,85,8],[107,4,86,4],[107,5,86,5],[108,2,87,0],[109,2,88,0],[110,2,89,7],[110,11,89,16,"parseUrl"],[110,19,89,24,"parseUrl"],[110,20,89,25,"url_"],[110,24,89,29],[110,26,89,31],[111,4,90,4],[111,8,90,8],[112,6,91,8],[112,12,91,14,"url"],[112,15,91,17],[112,18,91,20],[112,22,91,24,"URL"],[112,25,91,27],[112,26,91,28,"url_"],[112,30,91,32],[112,31,91,33],[113,6,92,8],[113,12,92,14,"result"],[113,18,92,20],[113,21,92,23],[113,22,92,24],[113,28,92,30],[114,8,93,12],[115,8,94,12],[115,12,94,16,"url"],[115,15,94,19],[115,16,94,20,"username"],[115,24,94,28],[115,26,94,30],[116,10,95,16],[116,16,95,22,"credentials"],[116,27,95,33],[116,30,95,36],[116,33,95,39,"decodeURIComponent"],[116,51,95,57],[116,52,95,58,"url"],[116,55,95,61],[116,56,95,62,"username"],[116,64,95,70],[116,65,95,71],[116,69,95,75,"decodeURIComponent"],[116,87,95,93],[116,88,95,94,"url"],[116,91,95,97],[116,92,95,98,"password"],[116,100,95,106],[116,101,95,107],[116,103,95,109],[117,10,96,16,"url"],[117,13,96,19],[117,14,96,20,"username"],[117,22,96,28],[117,25,96,31],[117,27,96,33],[118,10,97,16,"url"],[118,13,97,19],[118,14,97,20,"password"],[118,22,97,28],[118,25,97,31],[118,27,97,33],[119,10,98,16],[119,17,98,23],[120,12,99,20,"url"],[120,15,99,23],[120,17,99,25,"url"],[120,20,99,28],[120,21,99,29,"toString"],[120,29,99,37],[120,30,99,38],[120,31,99,39],[121,12,100,20,"headers"],[121,19,100,27],[121,21,100,29],[122,14,100,31,"Authorization"],[122,27,100,44],[122,29,100,46],[122,38,100,55,"btoa"],[122,42,100,59],[122,43,100,60,"credentials"],[122,54,100,71],[122,55,100,72],[123,12,100,75],[124,10,101,16],[124,11,101,17],[125,8,102,12],[126,8,103,12],[127,6,104,8],[127,7,104,9],[127,9,104,11],[127,10,104,12],[128,6,105,8],[128,13,105,15],[129,8,105,17,"url"],[129,11,105,20],[129,13,105,22,"url"],[129,16,105,25],[129,17,105,26,"toString"],[129,25,105,34],[129,26,105,35],[129,27,105,36],[130,8,105,38],[130,11,105,41,"result"],[131,6,105,48],[131,7,105,49],[132,4,106,4],[132,5,106,5],[132,6,107,4],[132,12,107,10],[133,6,108,8],[133,13,108,15],[134,8,108,17,"url"],[134,11,108,20],[134,13,108,22,"url_"],[135,6,108,27],[135,7,108,28],[136,4,109,4],[137,2,110,0],[138,0,110,1],[138,3]],"functionMap":{"names":["<global>","getHttpRpcClient","request","withTimeout$argument_0","body.map$argument_0","parseUrl","<anonymous>"],"mappings":"AAA;OCI;QCG;mDCQ;iDCI;8BDI;iBDkB;SD2C;CDE;OKE;wBCG;SDY;CLM"},"hasCjsExports":false},"type":"js/module"}]}