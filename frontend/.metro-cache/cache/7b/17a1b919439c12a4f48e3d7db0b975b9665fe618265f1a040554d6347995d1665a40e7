{"dependencies":[{"name":"./createDeferred","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":25,"index":145},"end":{"line":7,"column":52,"index":172}}],"key":"MmqwyK+20uZjfwDrSt8b4uz+17U=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.createDeferredManager = void 0;\n  const createDeferred_1 = require(_dependencyMap[0], \"./createDeferred\");\n  const createDeferredManager = options => {\n    const {\n      initialId = 0,\n      timeout: defaultTimeout = 0,\n      onTimeout\n    } = options ?? {};\n    const promises = [];\n    let ID = initialId;\n    let timeoutHandle;\n    const length = () => promises.length;\n    const nextId = () => ID;\n    const replanTimeout = () => {\n      const now = Date.now();\n      const nearestDeadline = promises.reduce((prev, {\n        deadline\n      }) => (prev && deadline ? Math.min : Math.max)(prev, deadline), 0);\n      if (timeoutHandle) clearTimeout(timeoutHandle);\n      timeoutHandle = nearestDeadline ? setTimeout(timeoutCallback, Math.max(nearestDeadline - now, 0)) : undefined;\n    };\n    const timeoutCallback = () => {\n      const now = Date.now();\n      promises.filter(promise => promise.deadline && promise.deadline <= now).forEach(promise => {\n        onTimeout?.(promise.id);\n        promise.deadline = 0;\n      });\n      replanTimeout();\n    };\n    const create = (timeout = defaultTimeout) => {\n      const promiseId = ID++;\n      const deferred = (0, createDeferred_1.createDeferred)(promiseId);\n      const deadline = timeout && Date.now() + timeout;\n      promises.push({\n        ...deferred,\n        deadline\n      });\n      if (timeout) replanTimeout();\n      return {\n        promiseId,\n        promise: deferred.promise\n      };\n    };\n    const extract = promiseId => {\n      const index = promises.findIndex(({\n        id\n      }) => id === promiseId);\n      const [promise] = index >= 0 ? promises.splice(index, 1) : [undefined];\n      if (promise?.deadline) replanTimeout();\n      return promise;\n    };\n    const resolve = (promiseId, value) => {\n      const promise = extract(promiseId);\n      promise?.resolve(value);\n      return !!promise;\n    };\n    const reject = (promiseId, error) => {\n      const promise = extract(promiseId);\n      promise?.reject(error);\n      return !!promise;\n    };\n    const rejectAll = error => {\n      promises.forEach(promise => promise.reject(error));\n      const deleted = promises.splice(0, promises.length);\n      if (deleted.length) replanTimeout();\n    };\n    return {\n      length,\n      nextId,\n      create,\n      resolve,\n      reject,\n      rejectAll\n    };\n  };\n  exports.createDeferredManager = createDeferredManager;\n});","lineCount":83,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0,"Object"],[4,8,3,6],[4,9,3,7,"defineProperty"],[4,23,3,21],[4,24,3,22,"exports"],[4,31,3,29],[4,33,3,31],[4,45,3,43],[4,47,3,45],[5,4,4,2,"value"],[5,9,4,7],[5,11,4,9],[6,2,5,0],[6,3,5,1],[6,4,5,2],[7,2,6,0,"exports"],[7,9,6,7],[7,10,6,8,"createDeferredManager"],[7,31,6,29],[7,34,6,32],[7,39,6,37],[7,40,6,38],[8,2,7,0],[8,8,7,6,"createDeferred_1"],[8,24,7,22],[8,27,7,25,"require"],[8,34,7,32],[8,35,7,32,"_dependencyMap"],[8,49,7,32],[8,72,7,51],[8,73,7,52],[9,2,8,0],[9,8,8,6,"createDeferredManager"],[9,29,8,27],[9,32,8,30,"options"],[9,39,8,37],[9,43,8,41],[10,4,9,2],[10,10,9,8],[11,6,10,4,"initialId"],[11,15,10,13],[11,18,10,16],[11,19,10,17],[12,6,11,4,"timeout"],[12,13,11,11],[12,15,11,13,"defaultTimeout"],[12,29,11,27],[12,32,11,30],[12,33,11,31],[13,6,12,4,"onTimeout"],[14,4,13,2],[14,5,13,3],[14,8,13,6,"options"],[14,15,13,13],[14,19,13,17],[14,20,13,18],[14,21,13,19],[15,4,14,2],[15,10,14,8,"promises"],[15,18,14,16],[15,21,14,19],[15,23,14,21],[16,4,15,2],[16,8,15,6,"ID"],[16,10,15,8],[16,13,15,11,"initialId"],[16,22,15,20],[17,4,16,2],[17,8,16,6,"timeoutHandle"],[17,21,16,19],[18,4,17,2],[18,10,17,8,"length"],[18,16,17,14],[18,19,17,17,"length"],[18,20,17,17],[18,25,17,23,"promises"],[18,33,17,31],[18,34,17,32,"length"],[18,40,17,38],[19,4,18,2],[19,10,18,8,"nextId"],[19,16,18,14],[19,19,18,17,"nextId"],[19,20,18,17],[19,25,18,23,"ID"],[19,27,18,25],[20,4,19,2],[20,10,19,8,"replanTimeout"],[20,23,19,21],[20,26,19,24,"replanTimeout"],[20,27,19,24],[20,32,19,30],[21,6,20,4],[21,12,20,10,"now"],[21,15,20,13],[21,18,20,16,"Date"],[21,22,20,20],[21,23,20,21,"now"],[21,26,20,24],[21,27,20,25],[21,28,20,26],[22,6,21,4],[22,12,21,10,"nearestDeadline"],[22,27,21,25],[22,30,21,28,"promises"],[22,38,21,36],[22,39,21,37,"reduce"],[22,45,21,43],[22,46,21,44],[22,47,21,45,"prev"],[22,51,21,49],[22,53,21,51],[23,8,22,6,"deadline"],[24,6,23,4],[24,7,23,5],[24,12,23,10],[24,13,23,11,"prev"],[24,17,23,15],[24,21,23,19,"deadline"],[24,29,23,27],[24,32,23,30,"Math"],[24,36,23,34],[24,37,23,35,"min"],[24,40,23,38],[24,43,23,41,"Math"],[24,47,23,45],[24,48,23,46,"max"],[24,51,23,49],[24,53,23,51,"prev"],[24,57,23,55],[24,59,23,57,"deadline"],[24,67,23,65],[24,68,23,66],[24,70,23,68],[24,71,23,69],[24,72,23,70],[25,6,24,4],[25,10,24,8,"timeoutHandle"],[25,23,24,21],[25,25,24,23,"clearTimeout"],[25,37,24,35],[25,38,24,36,"timeoutHandle"],[25,51,24,49],[25,52,24,50],[26,6,25,4,"timeoutHandle"],[26,19,25,17],[26,22,25,20,"nearestDeadline"],[26,37,25,35],[26,40,25,38,"setTimeout"],[26,50,25,48],[26,51,25,49,"timeoutCallback"],[26,66,25,64],[26,68,25,66,"Math"],[26,72,25,70],[26,73,25,71,"max"],[26,76,25,74],[26,77,25,75,"nearestDeadline"],[26,92,25,90],[26,95,25,93,"now"],[26,98,25,96],[26,100,25,98],[26,101,25,99],[26,102,25,100],[26,103,25,101],[26,106,25,104,"undefined"],[26,115,25,113],[27,4,26,2],[27,5,26,3],[28,4,27,2],[28,10,27,8,"timeoutCallback"],[28,25,27,23],[28,28,27,26,"timeoutCallback"],[28,29,27,26],[28,34,27,32],[29,6,28,4],[29,12,28,10,"now"],[29,15,28,13],[29,18,28,16,"Date"],[29,22,28,20],[29,23,28,21,"now"],[29,26,28,24],[29,27,28,25],[29,28,28,26],[30,6,29,4,"promises"],[30,14,29,12],[30,15,29,13,"filter"],[30,21,29,19],[30,22,29,20,"promise"],[30,29,29,27],[30,33,29,31,"promise"],[30,40,29,38],[30,41,29,39,"deadline"],[30,49,29,47],[30,53,29,51,"promise"],[30,60,29,58],[30,61,29,59,"deadline"],[30,69,29,67],[30,73,29,71,"now"],[30,76,29,74],[30,77,29,75],[30,78,29,76,"forEach"],[30,85,29,83],[30,86,29,84,"promise"],[30,93,29,91],[30,97,29,95],[31,8,30,6,"onTimeout"],[31,17,30,15],[31,20,30,18,"promise"],[31,27,30,25],[31,28,30,26,"id"],[31,30,30,28],[31,31,30,29],[32,8,31,6,"promise"],[32,15,31,13],[32,16,31,14,"deadline"],[32,24,31,22],[32,27,31,25],[32,28,31,26],[33,6,32,4],[33,7,32,5],[33,8,32,6],[34,6,33,4,"replanTimeout"],[34,19,33,17],[34,20,33,18],[34,21,33,19],[35,4,34,2],[35,5,34,3],[36,4,35,2],[36,10,35,8,"create"],[36,16,35,14],[36,19,35,17,"create"],[36,20,35,18,"timeout"],[36,27,35,25],[36,30,35,28,"defaultTimeout"],[36,44,35,42],[36,49,35,47],[37,6,36,4],[37,12,36,10,"promiseId"],[37,21,36,19],[37,24,36,22,"ID"],[37,26,36,24],[37,28,36,26],[38,6,37,4],[38,12,37,10,"deferred"],[38,20,37,18],[38,23,37,21],[38,24,37,22],[38,25,37,23],[38,27,37,25,"createDeferred_1"],[38,43,37,41],[38,44,37,42,"createDeferred"],[38,58,37,56],[38,60,37,58,"promiseId"],[38,69,37,67],[38,70,37,68],[39,6,38,4],[39,12,38,10,"deadline"],[39,20,38,18],[39,23,38,21,"timeout"],[39,30,38,28],[39,34,38,32,"Date"],[39,38,38,36],[39,39,38,37,"now"],[39,42,38,40],[39,43,38,41],[39,44,38,42],[39,47,38,45,"timeout"],[39,54,38,52],[40,6,39,4,"promises"],[40,14,39,12],[40,15,39,13,"push"],[40,19,39,17],[40,20,39,18],[41,8,40,6],[41,11,40,9,"deferred"],[41,19,40,17],[42,8,41,6,"deadline"],[43,6,42,4],[43,7,42,5],[43,8,42,6],[44,6,43,4],[44,10,43,8,"timeout"],[44,17,43,15],[44,19,43,17,"replanTimeout"],[44,32,43,30],[44,33,43,31],[44,34,43,32],[45,6,44,4],[45,13,44,11],[46,8,45,6,"promiseId"],[46,17,45,15],[47,8,46,6,"promise"],[47,15,46,13],[47,17,46,15,"deferred"],[47,25,46,23],[47,26,46,24,"promise"],[48,6,47,4],[48,7,47,5],[49,4,48,2],[49,5,48,3],[50,4,49,2],[50,10,49,8,"extract"],[50,17,49,15],[50,20,49,18,"promiseId"],[50,29,49,27],[50,33,49,31],[51,6,50,4],[51,12,50,10,"index"],[51,17,50,15],[51,20,50,18,"promises"],[51,28,50,26],[51,29,50,27,"findIndex"],[51,38,50,36],[51,39,50,37],[51,40,50,38],[52,8,51,6,"id"],[53,6,52,4],[53,7,52,5],[53,12,52,10,"id"],[53,14,52,12],[53,19,52,17,"promiseId"],[53,28,52,26],[53,29,52,27],[54,6,53,4],[54,12,53,10],[54,13,53,11,"promise"],[54,20,53,18],[54,21,53,19],[54,24,53,22,"index"],[54,29,53,27],[54,33,53,31],[54,34,53,32],[54,37,53,35,"promises"],[54,45,53,43],[54,46,53,44,"splice"],[54,52,53,50],[54,53,53,51,"index"],[54,58,53,56],[54,60,53,58],[54,61,53,59],[54,62,53,60],[54,65,53,63],[54,66,53,64,"undefined"],[54,75,53,73],[54,76,53,74],[55,6,54,4],[55,10,54,8,"promise"],[55,17,54,15],[55,19,54,17,"deadline"],[55,27,54,25],[55,29,54,27,"replanTimeout"],[55,42,54,40],[55,43,54,41],[55,44,54,42],[56,6,55,4],[56,13,55,11,"promise"],[56,20,55,18],[57,4,56,2],[57,5,56,3],[58,4,57,2],[58,10,57,8,"resolve"],[58,17,57,15],[58,20,57,18,"resolve"],[58,21,57,19,"promiseId"],[58,30,57,28],[58,32,57,30,"value"],[58,37,57,35],[58,42,57,40],[59,6,58,4],[59,12,58,10,"promise"],[59,19,58,17],[59,22,58,20,"extract"],[59,29,58,27],[59,30,58,28,"promiseId"],[59,39,58,37],[59,40,58,38],[60,6,59,4,"promise"],[60,13,59,11],[60,15,59,13,"resolve"],[60,22,59,20],[60,23,59,21,"value"],[60,28,59,26],[60,29,59,27],[61,6,60,4],[61,13,60,11],[61,14,60,12],[61,15,60,13,"promise"],[61,22,60,20],[62,4,61,2],[62,5,61,3],[63,4,62,2],[63,10,62,8,"reject"],[63,16,62,14],[63,19,62,17,"reject"],[63,20,62,18,"promiseId"],[63,29,62,27],[63,31,62,29,"error"],[63,36,62,34],[63,41,62,39],[64,6,63,4],[64,12,63,10,"promise"],[64,19,63,17],[64,22,63,20,"extract"],[64,29,63,27],[64,30,63,28,"promiseId"],[64,39,63,37],[64,40,63,38],[65,6,64,4,"promise"],[65,13,64,11],[65,15,64,13,"reject"],[65,21,64,19],[65,22,64,20,"error"],[65,27,64,25],[65,28,64,26],[66,6,65,4],[66,13,65,11],[66,14,65,12],[66,15,65,13,"promise"],[66,22,65,20],[67,4,66,2],[67,5,66,3],[68,4,67,2],[68,10,67,8,"rejectAll"],[68,19,67,17],[68,22,67,20,"error"],[68,27,67,25],[68,31,67,29],[69,6,68,4,"promises"],[69,14,68,12],[69,15,68,13,"forEach"],[69,22,68,20],[69,23,68,21,"promise"],[69,30,68,28],[69,34,68,32,"promise"],[69,41,68,39],[69,42,68,40,"reject"],[69,48,68,46],[69,49,68,47,"error"],[69,54,68,52],[69,55,68,53],[69,56,68,54],[70,6,69,4],[70,12,69,10,"deleted"],[70,19,69,17],[70,22,69,20,"promises"],[70,30,69,28],[70,31,69,29,"splice"],[70,37,69,35],[70,38,69,36],[70,39,69,37],[70,41,69,39,"promises"],[70,49,69,47],[70,50,69,48,"length"],[70,56,69,54],[70,57,69,55],[71,6,70,4],[71,10,70,8,"deleted"],[71,17,70,15],[71,18,70,16,"length"],[71,24,70,22],[71,26,70,24,"replanTimeout"],[71,39,70,37],[71,40,70,38],[71,41,70,39],[72,4,71,2],[72,5,71,3],[73,4,72,2],[73,11,72,9],[74,6,73,4,"length"],[74,12,73,10],[75,6,74,4,"nextId"],[75,12,74,10],[76,6,75,4,"create"],[76,12,75,10],[77,6,76,4,"resolve"],[77,13,76,11],[78,6,77,4,"reject"],[78,12,77,10],[79,6,78,4,"rejectAll"],[80,4,79,2],[80,5,79,3],[81,2,80,0],[81,3,80,1],[82,2,81,0,"exports"],[82,9,81,7],[82,10,81,8,"createDeferredManager"],[82,31,81,29],[82,34,81,32,"createDeferredManager"],[82,55,81,53],[83,0,81,54],[83,3]],"functionMap":{"names":["<global>","createDeferredManager","length","nextId","replanTimeout","promises.reduce$argument_0","timeoutCallback","promises.filter$argument_0","promises.filter.forEach$argument_0","create","extract","promises.findIndex$argument_0","resolve","reject","rejectAll","promises.forEach$argument_0"],"mappings":"AAA;8BCO;iBCS,qBD;iBEC,QF;wBGC;4CCE;kEDE;GHG;0BKC;oBCE,sDD,UE;KFG;GLE;iBQC;GRa;kBSC;qCCC;0BDE;GTI;kBWC;GXI;iBYC;GZI;oBaC;qBCC,gCD;GbG;CDS"},"hasCjsExports":true},"type":"js/module"}]}