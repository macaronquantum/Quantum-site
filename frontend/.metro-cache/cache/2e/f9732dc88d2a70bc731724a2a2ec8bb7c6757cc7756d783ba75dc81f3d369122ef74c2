{"dependencies":[{"name":"module","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":26,"index":40},"end":{"line":3,"column":43,"index":57}}],"key":"2e30ZFw25FjjPwl2tnbflVgsbEQ=","exportNames":["*"],"imports":1}},{"name":"./caller","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":19,"index":77},"end":{"line":4,"column":38,"index":96}}],"key":"Dtu6FiiPY8vU/bSacwWsLDlKLgU=","exportNames":["*"],"imports":1}},{"name":"path","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":29,"index":126},"end":{"line":5,"column":44,"index":141}}],"key":"sC7uOmzp0ncn/Io61vx77lEWh8A=","exportNames":["*"],"imports":1}},{"name":"atomic-sleep","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":14,"index":156},"end":{"line":6,"column":37,"index":179}}],"key":"8LRBzmuolRYWP8ZbF9vIlMd8J0Y=","exportNames":["*"],"imports":1}},{"name":"on-exit-leak-free","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":13,"column":11,"index":395},"end":{"line":13,"column":39,"index":423}}],"key":"wqOTici/x/9WGOXwuJ9jMCKA6xk=","exportNames":["*"],"imports":1}},{"name":"thread-stream","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":16,"column":21,"index":448},"end":{"line":16,"column":45,"index":472}}],"key":"LIyoiNYKBql76cZ3Z0OuTZzD45c=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  const {\n    createRequire\n  } = require(_dependencyMap[0], \"module\");\n  const getCallers = require(_dependencyMap[1], \"./caller\");\n  const {\n    join,\n    isAbsolute\n  } = require(_dependencyMap[2], \"path\");\n  const sleep = require(_dependencyMap[3], \"atomic-sleep\");\n  let onExit;\n  if (global.WeakRef && global.WeakMap && global.FinalizationRegistry) {\n    // This require MUST be top level otherwise the transport would\n    // not work from within Jest as it hijacks require.\n    onExit = require(_dependencyMap[4], \"on-exit-leak-free\");\n  }\n  const ThreadStream = require(_dependencyMap[5], \"thread-stream\");\n  function setupOnExit(stream) {\n    /* istanbul ignore next */\n    if (onExit) {\n      // This is leak free, it does not leave event handlers\n      onExit.register(stream, autoEnd);\n      stream.on('close', function () {\n        onExit.unregister(stream);\n      });\n    } else {\n      const fn = autoEnd.bind(null, stream);\n      process.once('beforeExit', fn);\n      process.once('exit', fn);\n      stream.on('close', function () {\n        process.removeListener('beforeExit', fn);\n        process.removeListener('exit', fn);\n      });\n    }\n  }\n  function buildStream(filename, workerData, workerOpts) {\n    const stream = new ThreadStream({\n      filename,\n      workerData,\n      workerOpts\n    });\n    stream.on('ready', onReady);\n    stream.on('close', function () {\n      process.removeListener('exit', onExit);\n    });\n    process.on('exit', onExit);\n    function onReady() {\n      process.removeListener('exit', onExit);\n      stream.unref();\n      if (workerOpts.autoEnd !== false) {\n        setupOnExit(stream);\n      }\n    }\n    function onExit() {\n      if (stream.closed) {\n        return;\n      }\n      stream.flushSync();\n      // Apparently there is a very sporadic race condition\n      // that in certain OS would prevent the messages to be flushed\n      // because the thread might not have been created still.\n      // Unfortunately we need to sleep(100) in this case.\n      sleep(100);\n      stream.end();\n    }\n    return stream;\n  }\n  function autoEnd(stream) {\n    stream.ref();\n    stream.flushSync();\n    stream.end();\n    stream.once('close', function () {\n      stream.unref();\n    });\n  }\n  function transport(fullOptions) {\n    const {\n      pipeline,\n      targets,\n      levels,\n      options = {},\n      worker = {},\n      caller = getCallers()\n    } = fullOptions;\n\n    // Backwards compatibility\n    const callers = typeof caller === 'string' ? [caller] : caller;\n\n    // This will be eventually modified by bundlers\n    const bundlerOverrides = '__bundlerPathsOverrides' in globalThis ? globalThis.__bundlerPathsOverrides : {};\n    let target = fullOptions.target;\n    if (target && targets) {\n      throw new Error('only one of target or targets can be specified');\n    }\n    if (targets) {\n      target = bundlerOverrides['pino-worker'] || join(__dirname, 'worker.js');\n      options.targets = targets.map(dest => {\n        return {\n          ...dest,\n          target: fixTarget(dest.target)\n        };\n      });\n    } else if (pipeline) {\n      target = bundlerOverrides['pino-pipeline-worker'] || join(__dirname, 'worker-pipeline.js');\n      options.targets = pipeline.map(dest => {\n        return {\n          ...dest,\n          target: fixTarget(dest.target)\n        };\n      });\n    }\n    if (levels) {\n      options.levels = levels;\n    }\n    return buildStream(fixTarget(target), options, worker);\n    function fixTarget(origin) {\n      origin = bundlerOverrides[origin] || origin;\n      if (isAbsolute(origin) || origin.indexOf('file://') === 0) {\n        return origin;\n      }\n      if (origin === 'pino/file') {\n        return join(__dirname, '..', 'file.js');\n      }\n      let fixTarget;\n      for (const filePath of callers) {\n        try {\n          fixTarget = createRequire(filePath).resolve(origin);\n          break;\n        } catch (err) {\n          // Silent catch\n          continue;\n        }\n      }\n      if (!fixTarget) {\n        throw new Error(`unable to determine transport target for \"${origin}\"`);\n      }\n      return fixTarget;\n    }\n  }\n  module.exports = transport;\n});","lineCount":143,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,8,3,6],[5,4,3,8,"createRequire"],[6,2,3,22],[6,3,3,23],[6,6,3,26,"require"],[6,13,3,33],[6,14,3,33,"_dependencyMap"],[6,28,3,33],[6,41,3,42],[6,42,3,43],[7,2,4,0],[7,8,4,6,"getCallers"],[7,18,4,16],[7,21,4,19,"require"],[7,28,4,26],[7,29,4,26,"_dependencyMap"],[7,43,4,26],[7,58,4,37],[7,59,4,38],[8,2,5,0],[8,8,5,6],[9,4,5,8,"join"],[9,8,5,12],[10,4,5,14,"isAbsolute"],[11,2,5,25],[11,3,5,26],[11,6,5,29,"require"],[11,13,5,36],[11,14,5,36,"_dependencyMap"],[11,28,5,36],[11,39,5,43],[11,40,5,44],[12,2,6,0],[12,8,6,6,"sleep"],[12,13,6,11],[12,16,6,14,"require"],[12,23,6,21],[12,24,6,21,"_dependencyMap"],[12,38,6,21],[12,57,6,36],[12,58,6,37],[13,2,8,0],[13,6,8,4,"onExit"],[13,12,8,10],[14,2,10,0],[14,6,10,4,"global"],[14,12,10,10],[14,13,10,11,"WeakRef"],[14,20,10,18],[14,24,10,22,"global"],[14,30,10,28],[14,31,10,29,"WeakMap"],[14,38,10,36],[14,42,10,40,"global"],[14,48,10,46],[14,49,10,47,"FinalizationRegistry"],[14,69,10,67],[14,71,10,69],[15,4,11,2],[16,4,12,2],[17,4,13,2,"onExit"],[17,10,13,8],[17,13,13,11,"require"],[17,20,13,18],[17,21,13,18,"_dependencyMap"],[17,35,13,18],[17,59,13,38],[17,60,13,39],[18,2,14,0],[19,2,16,0],[19,8,16,6,"ThreadStream"],[19,20,16,18],[19,23,16,21,"require"],[19,30,16,28],[19,31,16,28,"_dependencyMap"],[19,45,16,28],[19,65,16,44],[19,66,16,45],[20,2,18,0],[20,11,18,9,"setupOnExit"],[20,22,18,20,"setupOnExit"],[20,23,18,22,"stream"],[20,29,18,28],[20,31,18,30],[21,4,19,2],[22,4,20,2],[22,8,20,6,"onExit"],[22,14,20,12],[22,16,20,14],[23,6,21,4],[24,6,22,4,"onExit"],[24,12,22,10],[24,13,22,11,"register"],[24,21,22,19],[24,22,22,20,"stream"],[24,28,22,26],[24,30,22,28,"autoEnd"],[24,37,22,35],[24,38,22,36],[25,6,24,4,"stream"],[25,12,24,10],[25,13,24,11,"on"],[25,15,24,13],[25,16,24,14],[25,23,24,21],[25,25,24,23],[25,37,24,35],[26,8,25,6,"onExit"],[26,14,25,12],[26,15,25,13,"unregister"],[26,25,25,23],[26,26,25,24,"stream"],[26,32,25,30],[26,33,25,31],[27,6,26,4],[27,7,26,5],[27,8,26,6],[28,4,27,2],[28,5,27,3],[28,11,27,9],[29,6,28,4],[29,12,28,10,"fn"],[29,14,28,12],[29,17,28,15,"autoEnd"],[29,24,28,22],[29,25,28,23,"bind"],[29,29,28,27],[29,30,28,28],[29,34,28,32],[29,36,28,34,"stream"],[29,42,28,40],[29,43,28,41],[30,6,29,4,"process"],[30,13,29,11],[30,14,29,12,"once"],[30,18,29,16],[30,19,29,17],[30,31,29,29],[30,33,29,31,"fn"],[30,35,29,33],[30,36,29,34],[31,6,30,4,"process"],[31,13,30,11],[31,14,30,12,"once"],[31,18,30,16],[31,19,30,17],[31,25,30,23],[31,27,30,25,"fn"],[31,29,30,27],[31,30,30,28],[32,6,32,4,"stream"],[32,12,32,10],[32,13,32,11,"on"],[32,15,32,13],[32,16,32,14],[32,23,32,21],[32,25,32,23],[32,37,32,35],[33,8,33,6,"process"],[33,15,33,13],[33,16,33,14,"removeListener"],[33,30,33,28],[33,31,33,29],[33,43,33,41],[33,45,33,43,"fn"],[33,47,33,45],[33,48,33,46],[34,8,34,6,"process"],[34,15,34,13],[34,16,34,14,"removeListener"],[34,30,34,28],[34,31,34,29],[34,37,34,35],[34,39,34,37,"fn"],[34,41,34,39],[34,42,34,40],[35,6,35,4],[35,7,35,5],[35,8,35,6],[36,4,36,2],[37,2,37,0],[38,2,39,0],[38,11,39,9,"buildStream"],[38,22,39,20,"buildStream"],[38,23,39,22,"filename"],[38,31,39,30],[38,33,39,32,"workerData"],[38,43,39,42],[38,45,39,44,"workerOpts"],[38,55,39,54],[38,57,39,56],[39,4,40,2],[39,10,40,8,"stream"],[39,16,40,14],[39,19,40,17],[39,23,40,21,"ThreadStream"],[39,35,40,33],[39,36,40,34],[40,6,41,4,"filename"],[40,14,41,12],[41,6,42,4,"workerData"],[41,16,42,14],[42,6,43,4,"workerOpts"],[43,4,44,2],[43,5,44,3],[43,6,44,4],[44,4,46,2,"stream"],[44,10,46,8],[44,11,46,9,"on"],[44,13,46,11],[44,14,46,12],[44,21,46,19],[44,23,46,21,"onReady"],[44,30,46,28],[44,31,46,29],[45,4,47,2,"stream"],[45,10,47,8],[45,11,47,9,"on"],[45,13,47,11],[45,14,47,12],[45,21,47,19],[45,23,47,21],[45,35,47,33],[46,6,48,4,"process"],[46,13,48,11],[46,14,48,12,"removeListener"],[46,28,48,26],[46,29,48,27],[46,35,48,33],[46,37,48,35,"onExit"],[46,43,48,41],[46,44,48,42],[47,4,49,2],[47,5,49,3],[47,6,49,4],[48,4,51,2,"process"],[48,11,51,9],[48,12,51,10,"on"],[48,14,51,12],[48,15,51,13],[48,21,51,19],[48,23,51,21,"onExit"],[48,29,51,27],[48,30,51,28],[49,4,53,2],[49,13,53,11,"onReady"],[49,20,53,18,"onReady"],[49,21,53,18],[49,23,53,22],[50,6,54,4,"process"],[50,13,54,11],[50,14,54,12,"removeListener"],[50,28,54,26],[50,29,54,27],[50,35,54,33],[50,37,54,35,"onExit"],[50,43,54,41],[50,44,54,42],[51,6,55,4,"stream"],[51,12,55,10],[51,13,55,11,"unref"],[51,18,55,16],[51,19,55,17],[51,20,55,18],[52,6,57,4],[52,10,57,8,"workerOpts"],[52,20,57,18],[52,21,57,19,"autoEnd"],[52,28,57,26],[52,33,57,31],[52,38,57,36],[52,40,57,38],[53,8,58,6,"setupOnExit"],[53,19,58,17],[53,20,58,18,"stream"],[53,26,58,24],[53,27,58,25],[54,6,59,4],[55,4,60,2],[56,4,62,2],[56,13,62,11,"onExit"],[56,19,62,17,"onExit"],[56,20,62,17],[56,22,62,21],[57,6,63,4],[57,10,63,8,"stream"],[57,16,63,14],[57,17,63,15,"closed"],[57,23,63,21],[57,25,63,23],[58,8,64,6],[59,6,65,4],[60,6,66,4,"stream"],[60,12,66,10],[60,13,66,11,"flushSync"],[60,22,66,20],[60,23,66,21],[60,24,66,22],[61,6,67,4],[62,6,68,4],[63,6,69,4],[64,6,70,4],[65,6,71,4,"sleep"],[65,11,71,9],[65,12,71,10],[65,15,71,13],[65,16,71,14],[66,6,72,4,"stream"],[66,12,72,10],[66,13,72,11,"end"],[66,16,72,14],[66,17,72,15],[66,18,72,16],[67,4,73,2],[68,4,75,2],[68,11,75,9,"stream"],[68,17,75,15],[69,2,76,0],[70,2,78,0],[70,11,78,9,"autoEnd"],[70,18,78,16,"autoEnd"],[70,19,78,18,"stream"],[70,25,78,24],[70,27,78,26],[71,4,79,2,"stream"],[71,10,79,8],[71,11,79,9,"ref"],[71,14,79,12],[71,15,79,13],[71,16,79,14],[72,4,80,2,"stream"],[72,10,80,8],[72,11,80,9,"flushSync"],[72,20,80,18],[72,21,80,19],[72,22,80,20],[73,4,81,2,"stream"],[73,10,81,8],[73,11,81,9,"end"],[73,14,81,12],[73,15,81,13],[73,16,81,14],[74,4,82,2,"stream"],[74,10,82,8],[74,11,82,9,"once"],[74,15,82,13],[74,16,82,14],[74,23,82,21],[74,25,82,23],[74,37,82,35],[75,6,83,4,"stream"],[75,12,83,10],[75,13,83,11,"unref"],[75,18,83,16],[75,19,83,17],[75,20,83,18],[76,4,84,2],[76,5,84,3],[76,6,84,4],[77,2,85,0],[78,2,87,0],[78,11,87,9,"transport"],[78,20,87,18,"transport"],[78,21,87,20,"fullOptions"],[78,32,87,31],[78,34,87,33],[79,4,88,2],[79,10,88,8],[80,6,88,10,"pipeline"],[80,14,88,18],[81,6,88,20,"targets"],[81,13,88,27],[82,6,88,29,"levels"],[82,12,88,35],[83,6,88,37,"options"],[83,13,88,44],[83,16,88,47],[83,17,88,48],[83,18,88,49],[84,6,88,51,"worker"],[84,12,88,57],[84,15,88,60],[84,16,88,61],[84,17,88,62],[85,6,88,64,"caller"],[85,12,88,70],[85,15,88,73,"getCallers"],[85,25,88,83],[85,26,88,84],[86,4,88,86],[86,5,88,87],[86,8,88,90,"fullOptions"],[86,19,88,101],[88,4,90,2],[89,4,91,2],[89,10,91,8,"callers"],[89,17,91,15],[89,20,91,18],[89,27,91,25,"caller"],[89,33,91,31],[89,38,91,36],[89,46,91,44],[89,49,91,47],[89,50,91,48,"caller"],[89,56,91,54],[89,57,91,55],[89,60,91,58,"caller"],[89,66,91,64],[91,4,93,2],[92,4,94,2],[92,10,94,8,"bundlerOverrides"],[92,26,94,24],[92,29,94,27],[92,54,94,52],[92,58,94,56,"globalThis"],[92,68,94,66],[92,71,94,69,"globalThis"],[92,81,94,79],[92,82,94,80,"__bundlerPathsOverrides"],[92,105,94,103],[92,108,94,106],[92,109,94,107],[92,110,94,108],[93,4,96,2],[93,8,96,6,"target"],[93,14,96,12],[93,17,96,15,"fullOptions"],[93,28,96,26],[93,29,96,27,"target"],[93,35,96,33],[94,4,98,2],[94,8,98,6,"target"],[94,14,98,12],[94,18,98,16,"targets"],[94,25,98,23],[94,27,98,25],[95,6,99,4],[95,12,99,10],[95,16,99,14,"Error"],[95,21,99,19],[95,22,99,20],[95,70,99,68],[95,71,99,69],[96,4,100,2],[97,4,102,2],[97,8,102,6,"targets"],[97,15,102,13],[97,17,102,15],[98,6,103,4,"target"],[98,12,103,10],[98,15,103,13,"bundlerOverrides"],[98,31,103,29],[98,32,103,30],[98,45,103,43],[98,46,103,44],[98,50,103,48,"join"],[98,54,103,52],[98,55,103,53,"__dirname"],[98,64,103,62],[98,66,103,64],[98,77,103,75],[98,78,103,76],[99,6,104,4,"options"],[99,13,104,11],[99,14,104,12,"targets"],[99,21,104,19],[99,24,104,22,"targets"],[99,31,104,29],[99,32,104,30,"map"],[99,35,104,33],[99,36,104,35,"dest"],[99,40,104,39],[99,44,104,44],[100,8,105,6],[100,15,105,13],[101,10,106,8],[101,13,106,11,"dest"],[101,17,106,15],[102,10,107,8,"target"],[102,16,107,14],[102,18,107,16,"fixTarget"],[102,27,107,25],[102,28,107,26,"dest"],[102,32,107,30],[102,33,107,31,"target"],[102,39,107,37],[103,8,108,6],[103,9,108,7],[104,6,109,4],[104,7,109,5],[104,8,109,6],[105,4,110,2],[105,5,110,3],[105,11,110,9],[105,15,110,13,"pipeline"],[105,23,110,21],[105,25,110,23],[106,6,111,4,"target"],[106,12,111,10],[106,15,111,13,"bundlerOverrides"],[106,31,111,29],[106,32,111,30],[106,54,111,52],[106,55,111,53],[106,59,111,57,"join"],[106,63,111,61],[106,64,111,62,"__dirname"],[106,73,111,71],[106,75,111,73],[106,95,111,93],[106,96,111,94],[107,6,112,4,"options"],[107,13,112,11],[107,14,112,12,"targets"],[107,21,112,19],[107,24,112,22,"pipeline"],[107,32,112,30],[107,33,112,31,"map"],[107,36,112,34],[107,37,112,36,"dest"],[107,41,112,40],[107,45,112,45],[108,8,113,6],[108,15,113,13],[109,10,114,8],[109,13,114,11,"dest"],[109,17,114,15],[110,10,115,8,"target"],[110,16,115,14],[110,18,115,16,"fixTarget"],[110,27,115,25],[110,28,115,26,"dest"],[110,32,115,30],[110,33,115,31,"target"],[110,39,115,37],[111,8,116,6],[111,9,116,7],[112,6,117,4],[112,7,117,5],[112,8,117,6],[113,4,118,2],[114,4,120,2],[114,8,120,6,"levels"],[114,14,120,12],[114,16,120,14],[115,6,121,4,"options"],[115,13,121,11],[115,14,121,12,"levels"],[115,20,121,18],[115,23,121,21,"levels"],[115,29,121,27],[116,4,122,2],[117,4,124,2],[117,11,124,9,"buildStream"],[117,22,124,20],[117,23,124,21,"fixTarget"],[117,32,124,30],[117,33,124,31,"target"],[117,39,124,37],[117,40,124,38],[117,42,124,40,"options"],[117,49,124,47],[117,51,124,49,"worker"],[117,57,124,55],[117,58,124,56],[118,4,126,2],[118,13,126,11,"fixTarget"],[118,22,126,20,"fixTarget"],[118,23,126,22,"origin"],[118,29,126,28],[118,31,126,30],[119,6,127,4,"origin"],[119,12,127,10],[119,15,127,13,"bundlerOverrides"],[119,31,127,29],[119,32,127,30,"origin"],[119,38,127,36],[119,39,127,37],[119,43,127,41,"origin"],[119,49,127,47],[120,6,129,4],[120,10,129,8,"isAbsolute"],[120,20,129,18],[120,21,129,19,"origin"],[120,27,129,25],[120,28,129,26],[120,32,129,30,"origin"],[120,38,129,36],[120,39,129,37,"indexOf"],[120,46,129,44],[120,47,129,45],[120,56,129,54],[120,57,129,55],[120,62,129,60],[120,63,129,61],[120,65,129,63],[121,8,130,6],[121,15,130,13,"origin"],[121,21,130,19],[122,6,131,4],[123,6,133,4],[123,10,133,8,"origin"],[123,16,133,14],[123,21,133,19],[123,32,133,30],[123,34,133,32],[124,8,134,6],[124,15,134,13,"join"],[124,19,134,17],[124,20,134,18,"__dirname"],[124,29,134,27],[124,31,134,29],[124,35,134,33],[124,37,134,35],[124,46,134,44],[124,47,134,45],[125,6,135,4],[126,6,137,4],[126,10,137,8,"fixTarget"],[126,19,137,17],[127,6,139,4],[127,11,139,9],[127,17,139,15,"filePath"],[127,25,139,23],[127,29,139,27,"callers"],[127,36,139,34],[127,38,139,36],[128,8,140,6],[128,12,140,10],[129,10,141,8,"fixTarget"],[129,19,141,17],[129,22,141,20,"createRequire"],[129,35,141,33],[129,36,141,34,"filePath"],[129,44,141,42],[129,45,141,43],[129,46,141,44,"resolve"],[129,53,141,51],[129,54,141,52,"origin"],[129,60,141,58],[129,61,141,59],[130,10,142,8],[131,8,143,6],[131,9,143,7],[131,10,143,8],[131,17,143,15,"err"],[131,20,143,18],[131,22,143,20],[132,10,144,8],[133,10,145,8],[134,8,146,6],[135,6,147,4],[136,6,149,4],[136,10,149,8],[136,11,149,9,"fixTarget"],[136,20,149,18],[136,22,149,20],[137,8,150,6],[137,14,150,12],[137,18,150,16,"Error"],[137,23,150,21],[137,24,150,22],[137,69,150,67,"origin"],[137,75,150,73],[137,78,150,76],[137,79,150,77],[138,6,151,4],[139,6,153,4],[139,13,153,11,"fixTarget"],[139,22,153,20],[140,4,154,2],[141,2,155,0],[142,2,157,0,"module"],[142,8,157,6],[142,9,157,7,"exports"],[142,16,157,14],[142,19,157,17,"transport"],[142,28,157,26],[143,0,157,26],[143,3]],"functionMap":{"names":["<global>","setupOnExit","stream.on$argument_1","buildStream","onReady","onExit","autoEnd","stream.once$argument_1","transport","targets.map$argument_0","pipeline.map$argument_0","fixTarget"],"mappings":"AAA;ACiB;uBCM;KDE;uBCM;KDG;CDE;AGE;qBDQ;GCE;ECI;GDO;EEE;GFW;CHG;AME;uBCI;GDE;CNC;AQE;kCCiB;KDK;mCEG;KFK;EGS;GH4B;CRC"},"hasCjsExports":true},"type":"js/module"}]}