{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":74,"index":74}}],"key":"2pE/btc+6/9ceuRiPNwUYrtm86Y=","exportNames":["*"],"imports":1}},{"name":"../promise/withTimeout.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":75},"end":{"line":2,"column":57,"index":132}}],"key":"R0pXVlZ6xmiOVM86DCOsnzL2IWE=","exportNames":["*"],"imports":1}},{"name":"../stringify.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":133},"end":{"line":3,"column":44,"index":177}}],"key":"2zgFGs9gb8CDQZBLm+ivBNJ2Ky0=","exportNames":["*"],"imports":1}},{"name":"./id.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":178},"end":{"line":4,"column":34,"index":212}}],"key":"XzJUTA7q3576wrp3vEEP4WANxL4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getHttpRpcClient = getHttpRpcClient;\n  var _errorsRequestJs = require(_dependencyMap[0], \"../../errors/request.js\");\n  var _promiseWithTimeoutJs = require(_dependencyMap[1], \"../promise/withTimeout.js\");\n  var _stringifyJs = require(_dependencyMap[2], \"../stringify.js\");\n  var _idJs = require(_dependencyMap[3], \"./id.js\");\n  function getHttpRpcClient(url, options = {}) {\n    return {\n      async request(params) {\n        const {\n          body,\n          onRequest = options.onRequest,\n          onResponse = options.onResponse,\n          timeout = options.timeout ?? 10_000\n        } = params;\n        const fetchOptions = {\n          ...(options.fetchOptions ?? {}),\n          ...(params.fetchOptions ?? {})\n        };\n        const {\n          headers,\n          method,\n          signal: signal_\n        } = fetchOptions;\n        try {\n          const response = await (0, _promiseWithTimeoutJs.withTimeout)(async ({\n            signal\n          }) => {\n            const init = {\n              ...fetchOptions,\n              body: Array.isArray(body) ? (0, _stringifyJs.stringify)(body.map(body => ({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take(),\n                ...body\n              }))) : (0, _stringifyJs.stringify)({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take(),\n                ...body\n              }),\n              headers: {\n                'Content-Type': 'application/json',\n                ...headers\n              },\n              method: method || 'POST',\n              signal: signal_ || (timeout > 0 ? signal : null)\n            };\n            const request = new Request(url, init);\n            const args = (await onRequest?.(request, init)) ?? {\n              ...init,\n              url\n            };\n            const response = await fetch(args.url ?? url, args);\n            return response;\n          }, {\n            errorInstance: new _errorsRequestJs.TimeoutError({\n              body,\n              url\n            }),\n            timeout,\n            signal: true\n          });\n          if (onResponse) await onResponse(response);\n          let data;\n          if (response.headers.get('Content-Type')?.startsWith('application/json')) data = await response.json();else {\n            data = await response.text();\n            try {\n              data = JSON.parse(data || '{}');\n            } catch (err) {\n              if (response.ok) throw err;\n              data = {\n                error: data\n              };\n            }\n          }\n          if (!response.ok) {\n            throw new _errorsRequestJs.HttpRequestError({\n              body,\n              details: (0, _stringifyJs.stringify)(data.error) || response.statusText,\n              headers: response.headers,\n              status: response.status,\n              url\n            });\n          }\n          return data;\n        } catch (err) {\n          if (err instanceof _errorsRequestJs.HttpRequestError) throw err;\n          if (err instanceof _errorsRequestJs.TimeoutError) throw err;\n          throw new _errorsRequestJs.HttpRequestError({\n            body,\n            cause: err,\n            url\n          });\n        }\n      }\n    };\n  }\n});","lineCount":102,"map":[[7,2,5,0,"exports"],[7,9,5,0],[7,10,5,0,"getHttpRpcClient"],[7,26,5,0],[7,29,5,0,"getHttpRpcClient"],[7,45,5,0],[8,2,1,0],[8,6,1,0,"_errorsRequestJs"],[8,22,1,0],[8,25,1,0,"require"],[8,32,1,0],[8,33,1,0,"_dependencyMap"],[8,47,1,0],[9,2,2,0],[9,6,2,0,"_promiseWithTimeoutJs"],[9,27,2,0],[9,30,2,0,"require"],[9,37,2,0],[9,38,2,0,"_dependencyMap"],[9,52,2,0],[10,2,3,0],[10,6,3,0,"_stringifyJs"],[10,18,3,0],[10,21,3,0,"require"],[10,28,3,0],[10,29,3,0,"_dependencyMap"],[10,43,3,0],[11,2,4,0],[11,6,4,0,"_idJs"],[11,11,4,0],[11,14,4,0,"require"],[11,21,4,0],[11,22,4,0,"_dependencyMap"],[11,36,4,0],[12,2,5,7],[12,11,5,16,"getHttpRpcClient"],[12,27,5,32,"getHttpRpcClient"],[12,28,5,33,"url"],[12,31,5,36],[12,33,5,38,"options"],[12,40,5,45],[12,43,5,48],[12,44,5,49],[12,45,5,50],[12,47,5,52],[13,4,6,4],[13,11,6,11],[14,6,7,8],[14,12,7,14,"request"],[14,19,7,21,"request"],[14,20,7,22,"params"],[14,26,7,28],[14,28,7,30],[15,8,8,12],[15,14,8,18],[16,10,8,20,"body"],[16,14,8,24],[17,10,8,26,"onRequest"],[17,19,8,35],[17,22,8,38,"options"],[17,29,8,45],[17,30,8,46,"onRequest"],[17,39,8,55],[18,10,8,57,"onResponse"],[18,20,8,67],[18,23,8,70,"options"],[18,30,8,77],[18,31,8,78,"onResponse"],[18,41,8,88],[19,10,8,90,"timeout"],[19,17,8,97],[19,20,8,100,"options"],[19,27,8,107],[19,28,8,108,"timeout"],[19,35,8,115],[19,39,8,119],[20,8,8,127],[20,9,8,128],[20,12,8,131,"params"],[20,18,8,137],[21,8,9,12],[21,14,9,18,"fetchOptions"],[21,26,9,30],[21,29,9,33],[22,10,10,16],[22,14,10,20,"options"],[22,21,10,27],[22,22,10,28,"fetchOptions"],[22,34,10,40],[22,38,10,44],[22,39,10,45],[22,40,10,46],[22,41,10,47],[23,10,11,16],[23,14,11,20,"params"],[23,20,11,26],[23,21,11,27,"fetchOptions"],[23,33,11,39],[23,37,11,43],[23,38,11,44],[23,39,11,45],[24,8,12,12],[24,9,12,13],[25,8,13,12],[25,14,13,18],[26,10,13,20,"headers"],[26,17,13,27],[27,10,13,29,"method"],[27,16,13,35],[28,10,13,37,"signal"],[28,16,13,43],[28,18,13,45,"signal_"],[29,8,13,53],[29,9,13,54],[29,12,13,57,"fetchOptions"],[29,24,13,69],[30,8,14,12],[30,12,14,16],[31,10,15,16],[31,16,15,22,"response"],[31,24,15,30],[31,27,15,33],[31,33,15,39],[31,37,15,39,"withTimeout"],[31,58,15,50],[31,59,15,50,"withTimeout"],[31,70,15,50],[31,72,15,51],[31,79,15,58],[32,12,15,60,"signal"],[33,10,15,67],[33,11,15,68],[33,16,15,73],[34,12,16,20],[34,18,16,26,"init"],[34,22,16,30],[34,25,16,33],[35,14,17,24],[35,17,17,27,"fetchOptions"],[35,29,17,39],[36,14,18,24,"body"],[36,18,18,28],[36,20,18,30,"Array"],[36,25,18,35],[36,26,18,36,"isArray"],[36,33,18,43],[36,34,18,44,"body"],[36,38,18,48],[36,39,18,49],[36,42,19,30],[36,46,19,30,"stringify"],[36,58,19,39],[36,59,19,39,"stringify"],[36,68,19,39],[36,70,19,40,"body"],[36,74,19,44],[36,75,19,45,"map"],[36,78,19,48],[36,79,19,50,"body"],[36,83,19,54],[36,88,19,60],[37,16,20,32,"jsonrpc"],[37,23,20,39],[37,25,20,41],[37,30,20,46],[38,16,21,32,"id"],[38,18,21,34],[38,20,21,36,"body"],[38,24,21,40],[38,25,21,41,"id"],[38,27,21,43],[38,31,21,47,"idCache"],[38,36,21,54],[38,37,21,54,"idCache"],[38,44,21,54],[38,45,21,55,"take"],[38,49,21,59],[38,50,21,60],[38,51,21,61],[39,16,22,32],[39,19,22,35,"body"],[40,14,23,28],[40,15,23,29],[40,16,23,30],[40,17,23,31],[40,18,23,32],[40,21,24,30],[40,25,24,30,"stringify"],[40,37,24,39],[40,38,24,39,"stringify"],[40,47,24,39],[40,49,24,40],[41,16,25,32,"jsonrpc"],[41,23,25,39],[41,25,25,41],[41,30,25,46],[42,16,26,32,"id"],[42,18,26,34],[42,20,26,36,"body"],[42,24,26,40],[42,25,26,41,"id"],[42,27,26,43],[42,31,26,47,"idCache"],[42,36,26,54],[42,37,26,54,"idCache"],[42,44,26,54],[42,45,26,55,"take"],[42,49,26,59],[42,50,26,60],[42,51,26,61],[43,16,27,32],[43,19,27,35,"body"],[44,14,28,28],[44,15,28,29],[44,16,28,30],[45,14,29,24,"headers"],[45,21,29,31],[45,23,29,33],[46,16,30,28],[46,30,30,42],[46,32,30,44],[46,50,30,62],[47,16,31,28],[47,19,31,31,"headers"],[48,14,32,24],[48,15,32,25],[49,14,33,24,"method"],[49,20,33,30],[49,22,33,32,"method"],[49,28,33,38],[49,32,33,42],[49,38,33,48],[50,14,34,24,"signal"],[50,20,34,30],[50,22,34,32,"signal_"],[50,29,34,39],[50,34,34,44,"timeout"],[50,41,34,51],[50,44,34,54],[50,45,34,55],[50,48,34,58,"signal"],[50,54,34,64],[50,57,34,67],[50,61,34,71],[51,12,35,20],[51,13,35,21],[52,12,36,20],[52,18,36,26,"request"],[52,25,36,33],[52,28,36,36],[52,32,36,40,"Request"],[52,39,36,47],[52,40,36,48,"url"],[52,43,36,51],[52,45,36,53,"init"],[52,49,36,57],[52,50,36,58],[53,12,37,20],[53,18,37,26,"args"],[53,22,37,30],[53,25,37,33],[53,26,37,34],[53,32,37,40,"onRequest"],[53,41,37,49],[53,44,37,52,"request"],[53,51,37,59],[53,53,37,61,"init"],[53,57,37,65],[53,58,37,66],[53,63,37,71],[54,14,37,73],[54,17,37,76,"init"],[54,21,37,80],[55,14,37,82,"url"],[56,12,37,86],[56,13,37,87],[57,12,38,20],[57,18,38,26,"response"],[57,26,38,34],[57,29,38,37],[57,35,38,43,"fetch"],[57,40,38,48],[57,41,38,49,"args"],[57,45,38,53],[57,46,38,54,"url"],[57,49,38,57],[57,53,38,61,"url"],[57,56,38,64],[57,58,38,66,"args"],[57,62,38,70],[57,63,38,71],[58,12,39,20],[58,19,39,27,"response"],[58,27,39,35],[59,10,40,16],[59,11,40,17],[59,13,40,19],[60,12,41,20,"errorInstance"],[60,25,41,33],[60,27,41,35],[60,31,41,39,"TimeoutError"],[60,47,41,51],[60,48,41,51,"TimeoutError"],[60,60,41,51],[60,61,41,52],[61,14,41,54,"body"],[61,18,41,58],[62,14,41,60,"url"],[63,12,41,64],[63,13,41,65],[63,14,41,66],[64,12,42,20,"timeout"],[64,19,42,27],[65,12,43,20,"signal"],[65,18,43,26],[65,20,43,28],[66,10,44,16],[66,11,44,17],[66,12,44,18],[67,10,45,16],[67,14,45,20,"onResponse"],[67,24,45,30],[67,26,46,20],[67,32,46,26,"onResponse"],[67,42,46,36],[67,43,46,37,"response"],[67,51,46,45],[67,52,46,46],[68,10,47,16],[68,14,47,20,"data"],[68,18,47,24],[69,10,48,16],[69,14,48,20,"response"],[69,22,48,28],[69,23,48,29,"headers"],[69,30,48,36],[69,31,48,37,"get"],[69,34,48,40],[69,35,48,41],[69,49,48,55],[69,50,48,56],[69,52,48,58,"startsWith"],[69,62,48,68],[69,63,48,69],[69,81,48,87],[69,82,48,88],[69,84,49,20,"data"],[69,88,49,24],[69,91,49,27],[69,97,49,33,"response"],[69,105,49,41],[69,106,49,42,"json"],[69,110,49,46],[69,111,49,47],[69,112,49,48],[69,113,49,49],[69,118,50,21],[70,12,51,20,"data"],[70,16,51,24],[70,19,51,27],[70,25,51,33,"response"],[70,33,51,41],[70,34,51,42,"text"],[70,38,51,46],[70,39,51,47],[70,40,51,48],[71,12,52,20],[71,16,52,24],[72,14,53,24,"data"],[72,18,53,28],[72,21,53,31,"JSON"],[72,25,53,35],[72,26,53,36,"parse"],[72,31,53,41],[72,32,53,42,"data"],[72,36,53,46],[72,40,53,50],[72,44,53,54],[72,45,53,55],[73,12,54,20],[73,13,54,21],[73,14,55,20],[73,21,55,27,"err"],[73,24,55,30],[73,26,55,32],[74,14,56,24],[74,18,56,28,"response"],[74,26,56,36],[74,27,56,37,"ok"],[74,29,56,39],[74,31,57,28],[74,37,57,34,"err"],[74,40,57,37],[75,14,58,24,"data"],[75,18,58,28],[75,21,58,31],[76,16,58,33,"error"],[76,21,58,38],[76,23,58,40,"data"],[77,14,58,45],[77,15,58,46],[78,12,59,20],[79,10,60,16],[80,10,61,16],[80,14,61,20],[80,15,61,21,"response"],[80,23,61,29],[80,24,61,30,"ok"],[80,26,61,32],[80,28,61,34],[81,12,62,20],[81,18,62,26],[81,22,62,30,"HttpRequestError"],[81,38,62,46],[81,39,62,46,"HttpRequestError"],[81,55,62,46],[81,56,62,47],[82,14,63,24,"body"],[82,18,63,28],[83,14,64,24,"details"],[83,21,64,31],[83,23,64,33],[83,27,64,33,"stringify"],[83,39,64,42],[83,40,64,42,"stringify"],[83,49,64,42],[83,51,64,43,"data"],[83,55,64,47],[83,56,64,48,"error"],[83,61,64,53],[83,62,64,54],[83,66,64,58,"response"],[83,74,64,66],[83,75,64,67,"statusText"],[83,85,64,77],[84,14,65,24,"headers"],[84,21,65,31],[84,23,65,33,"response"],[84,31,65,41],[84,32,65,42,"headers"],[84,39,65,49],[85,14,66,24,"status"],[85,20,66,30],[85,22,66,32,"response"],[85,30,66,40],[85,31,66,41,"status"],[85,37,66,47],[86,14,67,24,"url"],[87,12,68,20],[87,13,68,21],[87,14,68,22],[88,10,69,16],[89,10,70,16],[89,17,70,23,"data"],[89,21,70,27],[90,8,71,12],[90,9,71,13],[90,10,72,12],[90,17,72,19,"err"],[90,20,72,22],[90,22,72,24],[91,10,73,16],[91,14,73,20,"err"],[91,17,73,23],[91,29,73,35,"HttpRequestError"],[91,45,73,51],[91,46,73,51,"HttpRequestError"],[91,62,73,51],[91,64,74,20],[91,70,74,26,"err"],[91,73,74,29],[92,10,75,16],[92,14,75,20,"err"],[92,17,75,23],[92,29,75,35,"TimeoutError"],[92,45,75,47],[92,46,75,47,"TimeoutError"],[92,58,75,47],[92,60,76,20],[92,66,76,26,"err"],[92,69,76,29],[93,10,77,16],[93,16,77,22],[93,20,77,26,"HttpRequestError"],[93,36,77,42],[93,37,77,42,"HttpRequestError"],[93,53,77,42],[93,54,77,43],[94,12,78,20,"body"],[94,16,78,24],[95,12,79,20,"cause"],[95,17,79,25],[95,19,79,27,"err"],[95,22,79,30],[96,12,80,20,"url"],[97,10,81,16],[97,11,81,17],[97,12,81,18],[98,8,82,12],[99,6,83,8],[100,4,84,4],[100,5,84,5],[101,2,85,0],[102,0,85,1],[102,3]],"functionMap":{"names":["<global>","getHttpRpcClient","request","withTimeout$argument_0","body.map$argument_0"],"mappings":"AAA;OCI;QCE;mDCQ;iDCI;8BDI;iBDiB;SD2C;CDE"},"hasCjsExports":false},"type":"js/module"}]}