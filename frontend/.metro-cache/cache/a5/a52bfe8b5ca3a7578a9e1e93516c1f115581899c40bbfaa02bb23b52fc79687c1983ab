{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":74,"index":74}}],"key":"2pE/btc+6/9ceuRiPNwUYrtm86Y=","exportNames":["*"],"imports":1}},{"name":"../promise/withTimeout.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":75},"end":{"line":2,"column":57,"index":132}}],"key":"R0pXVlZ6xmiOVM86DCOsnzL2IWE=","exportNames":["*"],"imports":1}},{"name":"../stringify.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":133},"end":{"line":3,"column":44,"index":177}}],"key":"2zgFGs9gb8CDQZBLm+ivBNJ2Ky0=","exportNames":["*"],"imports":1}},{"name":"./id.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":178},"end":{"line":4,"column":34,"index":212}}],"key":"XzJUTA7q3576wrp3vEEP4WANxL4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getHttpRpcClient = getHttpRpcClient;\n  exports.parseUrl = parseUrl;\n  var _errorsRequestJs = require(_dependencyMap[0], \"../../errors/request.js\");\n  var _promiseWithTimeoutJs = require(_dependencyMap[1], \"../promise/withTimeout.js\");\n  var _stringifyJs = require(_dependencyMap[2], \"../stringify.js\");\n  var _idJs = require(_dependencyMap[3], \"./id.js\");\n  function getHttpRpcClient(url_, options = {}) {\n    const {\n      url,\n      headers: headers_url\n    } = parseUrl(url_);\n    return {\n      async request(params) {\n        const {\n          body,\n          fetchFn = options.fetchFn ?? fetch,\n          onRequest = options.onRequest,\n          onResponse = options.onResponse,\n          timeout = options.timeout ?? 10_000\n        } = params;\n        const fetchOptions = Object.assign({}, options.fetchOptions ?? {}, params.fetchOptions ?? {});\n        const {\n          headers,\n          method,\n          signal: signal_\n        } = fetchOptions;\n        try {\n          const response = await (0, _promiseWithTimeoutJs.withTimeout)(async ({\n            signal\n          }) => {\n            const init = Object.assign({}, fetchOptions, {\n              body: Array.isArray(body) ? (0, _stringifyJs.stringify)(body.map(body => Object.assign({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take()\n              }, body))) : (0, _stringifyJs.stringify)(Object.assign({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take()\n              }, body)),\n              headers: Object.assign({}, headers_url, {\n                'Content-Type': 'application/json'\n              }, headers),\n              method: method || 'POST',\n              signal: signal_ || (timeout > 0 ? signal : null)\n            });\n            const request = new Request(url, init);\n            const args = (await onRequest?.(request, init)) ?? Object.assign({}, init, {\n              url\n            });\n            const response = await fetchFn(args.url ?? url, args);\n            return response;\n          }, {\n            errorInstance: new _errorsRequestJs.TimeoutError({\n              body,\n              url\n            }),\n            timeout,\n            signal: true\n          });\n          if (onResponse) await onResponse(response);\n          let data;\n          if (response.headers.get('Content-Type')?.startsWith('application/json')) data = await response.json();else {\n            data = await response.text();\n            try {\n              data = JSON.parse(data || '{}');\n            } catch (err) {\n              if (response.ok) throw err;\n              data = {\n                error: data\n              };\n            }\n          }\n          if (!response.ok) {\n            throw new _errorsRequestJs.HttpRequestError({\n              body,\n              details: (0, _stringifyJs.stringify)(data.error) || response.statusText,\n              headers: response.headers,\n              status: response.status,\n              url\n            });\n          }\n          return data;\n        } catch (err) {\n          if (err instanceof _errorsRequestJs.HttpRequestError) throw err;\n          if (err instanceof _errorsRequestJs.TimeoutError) throw err;\n          throw new _errorsRequestJs.HttpRequestError({\n            body,\n            cause: err,\n            url\n          });\n        }\n      }\n    };\n  }\n  /** @internal */\n  function parseUrl(url_) {\n    try {\n      const url = new URL(url_);\n      const result = (() => {\n        // Handle Basic authentication credentials\n        if (url.username) {\n          const credentials = `${decodeURIComponent(url.username)}:${decodeURIComponent(url.password)}`;\n          url.username = '';\n          url.password = '';\n          return {\n            url: url.toString(),\n            headers: {\n              Authorization: `Basic ${btoa(credentials)}`\n            }\n          };\n        }\n        return;\n      })();\n      return Object.assign({\n        url: url.toString()\n      }, result);\n    } catch {\n      return {\n        url: url_\n      };\n    }\n  }\n});","lineCount":128,"map":[[7,2,5,0,"exports"],[7,9,5,0],[7,10,5,0,"getHttpRpcClient"],[7,26,5,0],[7,29,5,0,"getHttpRpcClient"],[7,45,5,0],[8,2,89,0,"exports"],[8,9,89,0],[8,10,89,0,"parseUrl"],[8,18,89,0],[8,21,89,0,"parseUrl"],[8,29,89,0],[9,2,1,0],[9,6,1,0,"_errorsRequestJs"],[9,22,1,0],[9,25,1,0,"require"],[9,32,1,0],[9,33,1,0,"_dependencyMap"],[9,47,1,0],[10,2,2,0],[10,6,2,0,"_promiseWithTimeoutJs"],[10,27,2,0],[10,30,2,0,"require"],[10,37,2,0],[10,38,2,0,"_dependencyMap"],[10,52,2,0],[11,2,3,0],[11,6,3,0,"_stringifyJs"],[11,18,3,0],[11,21,3,0,"require"],[11,28,3,0],[11,29,3,0,"_dependencyMap"],[11,43,3,0],[12,2,4,0],[12,6,4,0,"_idJs"],[12,11,4,0],[12,14,4,0,"require"],[12,21,4,0],[12,22,4,0,"_dependencyMap"],[12,36,4,0],[13,2,5,7],[13,11,5,16,"getHttpRpcClient"],[13,27,5,32,"getHttpRpcClient"],[13,28,5,33,"url_"],[13,32,5,37],[13,34,5,39,"options"],[13,41,5,46],[13,44,5,49],[13,45,5,50],[13,46,5,51],[13,48,5,53],[14,4,6,4],[14,10,6,10],[15,6,6,12,"url"],[15,9,6,15],[16,6,6,17,"headers"],[16,13,6,24],[16,15,6,26,"headers_url"],[17,4,6,38],[17,5,6,39],[17,8,6,42,"parseUrl"],[17,16,6,50],[17,17,6,51,"url_"],[17,21,6,55],[17,22,6,56],[18,4,7,4],[18,11,7,11],[19,6,8,8],[19,12,8,14,"request"],[19,19,8,21,"request"],[19,20,8,22,"params"],[19,26,8,28],[19,28,8,30],[20,8,9,12],[20,14,9,18],[21,10,9,20,"body"],[21,14,9,24],[22,10,9,26,"fetchFn"],[22,17,9,33],[22,20,9,36,"options"],[22,27,9,43],[22,28,9,44,"fetchFn"],[22,35,9,51],[22,39,9,55,"fetch"],[22,44,9,60],[23,10,9,62,"onRequest"],[23,19,9,71],[23,22,9,74,"options"],[23,29,9,81],[23,30,9,82,"onRequest"],[23,39,9,91],[24,10,9,93,"onResponse"],[24,20,9,103],[24,23,9,106,"options"],[24,30,9,113],[24,31,9,114,"onResponse"],[24,41,9,124],[25,10,9,126,"timeout"],[25,17,9,133],[25,20,9,136,"options"],[25,27,9,143],[25,28,9,144,"timeout"],[25,35,9,151],[25,39,9,155],[26,8,9,163],[26,9,9,164],[26,12,9,167,"params"],[26,18,9,173],[27,8,10,12],[27,14,10,18,"fetchOptions"],[27,26,10,30],[27,29,10,30,"Object"],[27,35,10,30],[27,36,10,30,"assign"],[27,42,10,30],[27,47,11,20,"options"],[27,54,11,27],[27,55,11,28,"fetchOptions"],[27,67,11,40],[27,71,11,44],[27,72,11,45],[27,73,11,46],[27,75,12,20,"params"],[27,81,12,26],[27,82,12,27,"fetchOptions"],[27,94,12,39],[27,98,12,43],[27,99,12,44],[27,100,12,45],[27,101,13,13],[28,8,14,12],[28,14,14,18],[29,10,14,20,"headers"],[29,17,14,27],[30,10,14,29,"method"],[30,16,14,35],[31,10,14,37,"signal"],[31,16,14,43],[31,18,14,45,"signal_"],[32,8,14,53],[32,9,14,54],[32,12,14,57,"fetchOptions"],[32,24,14,69],[33,8,15,12],[33,12,15,16],[34,10,16,16],[34,16,16,22,"response"],[34,24,16,30],[34,27,16,33],[34,33,16,39],[34,37,16,39,"withTimeout"],[34,58,16,50],[34,59,16,50,"withTimeout"],[34,70,16,50],[34,72,16,51],[34,79,16,58],[35,12,16,60,"signal"],[36,10,16,67],[36,11,16,68],[36,16,16,73],[37,12,17,20],[37,18,17,26,"init"],[37,22,17,30],[37,25,17,30,"Object"],[37,31,17,30],[37,32,17,30,"assign"],[37,38,17,30],[37,43,18,27,"fetchOptions"],[37,55,18,39],[38,14,19,24,"body"],[38,18,19,28],[38,20,19,30,"Array"],[38,25,19,35],[38,26,19,36,"isArray"],[38,33,19,43],[38,34,19,44,"body"],[38,38,19,48],[38,39,19,49],[38,42,20,30],[38,46,20,30,"stringify"],[38,58,20,39],[38,59,20,39,"stringify"],[38,68,20,39],[38,70,20,40,"body"],[38,74,20,44],[38,75,20,45,"map"],[38,78,20,48],[38,79,20,50,"body"],[38,83,20,54],[38,87,20,54,"Object"],[38,93,20,54],[38,94,20,54,"assign"],[38,100,20,54],[39,16,21,32,"jsonrpc"],[39,23,21,39],[39,25,21,41],[39,30,21,46],[40,16,22,32,"id"],[40,18,22,34],[40,20,22,36,"body"],[40,24,22,40],[40,25,22,41,"id"],[40,27,22,43],[40,31,22,47,"idCache"],[40,36,22,54],[40,37,22,54,"idCache"],[40,44,22,54],[40,45,22,55,"take"],[40,49,22,59],[40,50,22,60],[41,14,22,61],[41,17,23,35,"body"],[41,21,23,39],[41,22,24,30],[41,23,24,31],[41,24,24,32],[41,27,25,30],[41,31,25,30,"stringify"],[41,43,25,39],[41,44,25,39,"stringify"],[41,53,25,39],[41,55,25,39,"Object"],[41,61,25,39],[41,62,25,39,"assign"],[41,68,25,39],[42,16,26,32,"jsonrpc"],[42,23,26,39],[42,25,26,41],[42,30,26,46],[43,16,27,32,"id"],[43,18,27,34],[43,20,27,36,"body"],[43,24,27,40],[43,25,27,41,"id"],[43,27,27,43],[43,31,27,47,"idCache"],[43,36,27,54],[43,37,27,54,"idCache"],[43,44,27,54],[43,45,27,55,"take"],[43,49,27,59],[43,50,27,60],[44,14,27,61],[44,17,28,35,"body"],[44,21,28,39],[44,22,29,29],[44,23,29,30],[45,14,30,24,"headers"],[45,21,30,31],[45,23,30,31,"Object"],[45,29,30,31],[45,30,30,31,"assign"],[45,36,30,31],[45,41,31,31,"headers_url"],[45,52,31,42],[46,16,32,28],[46,30,32,42],[46,32,32,44],[47,14,32,62],[47,17,33,31,"headers"],[47,24,33,38],[47,25,34,25],[48,14,35,24,"method"],[48,20,35,30],[48,22,35,32,"method"],[48,28,35,38],[48,32,35,42],[48,38,35,48],[49,14,36,24,"signal"],[49,20,36,30],[49,22,36,32,"signal_"],[49,29,36,39],[49,34,36,44,"timeout"],[49,41,36,51],[49,44,36,54],[49,45,36,55],[49,48,36,58,"signal"],[49,54,36,64],[49,57,36,67],[49,61,36,71],[50,12,36,72],[50,14,37,21],[51,12,38,20],[51,18,38,26,"request"],[51,25,38,33],[51,28,38,36],[51,32,38,40,"Request"],[51,39,38,47],[51,40,38,48,"url"],[51,43,38,51],[51,45,38,53,"init"],[51,49,38,57],[51,50,38,58],[52,12,39,20],[52,18,39,26,"args"],[52,22,39,30],[52,25,39,33],[52,26,39,34],[52,32,39,40,"onRequest"],[52,41,39,49],[52,44,39,52,"request"],[52,51,39,59],[52,53,39,61,"init"],[52,57,39,65],[52,58,39,66],[52,63,39,66,"Object"],[52,69,39,66],[52,70,39,66,"assign"],[52,76,39,66],[52,81,39,76,"init"],[52,85,39,80],[53,14,39,82,"url"],[54,12,39,85],[54,14,39,87],[55,12,40,20],[55,18,40,26,"response"],[55,26,40,34],[55,29,40,37],[55,35,40,43,"fetchFn"],[55,42,40,50],[55,43,40,51,"args"],[55,47,40,55],[55,48,40,56,"url"],[55,51,40,59],[55,55,40,63,"url"],[55,58,40,66],[55,60,40,68,"args"],[55,64,40,72],[55,65,40,73],[56,12,41,20],[56,19,41,27,"response"],[56,27,41,35],[57,10,42,16],[57,11,42,17],[57,13,42,19],[58,12,43,20,"errorInstance"],[58,25,43,33],[58,27,43,35],[58,31,43,39,"TimeoutError"],[58,47,43,51],[58,48,43,51,"TimeoutError"],[58,60,43,51],[58,61,43,52],[59,14,43,54,"body"],[59,18,43,58],[60,14,43,60,"url"],[61,12,43,64],[61,13,43,65],[61,14,43,66],[62,12,44,20,"timeout"],[62,19,44,27],[63,12,45,20,"signal"],[63,18,45,26],[63,20,45,28],[64,10,46,16],[64,11,46,17],[64,12,46,18],[65,10,47,16],[65,14,47,20,"onResponse"],[65,24,47,30],[65,26,48,20],[65,32,48,26,"onResponse"],[65,42,48,36],[65,43,48,37,"response"],[65,51,48,45],[65,52,48,46],[66,10,49,16],[66,14,49,20,"data"],[66,18,49,24],[67,10,50,16],[67,14,50,20,"response"],[67,22,50,28],[67,23,50,29,"headers"],[67,30,50,36],[67,31,50,37,"get"],[67,34,50,40],[67,35,50,41],[67,49,50,55],[67,50,50,56],[67,52,50,58,"startsWith"],[67,62,50,68],[67,63,50,69],[67,81,50,87],[67,82,50,88],[67,84,51,20,"data"],[67,88,51,24],[67,91,51,27],[67,97,51,33,"response"],[67,105,51,41],[67,106,51,42,"json"],[67,110,51,46],[67,111,51,47],[67,112,51,48],[67,113,51,49],[67,118,52,21],[68,12,53,20,"data"],[68,16,53,24],[68,19,53,27],[68,25,53,33,"response"],[68,33,53,41],[68,34,53,42,"text"],[68,38,53,46],[68,39,53,47],[68,40,53,48],[69,12,54,20],[69,16,54,24],[70,14,55,24,"data"],[70,18,55,28],[70,21,55,31,"JSON"],[70,25,55,35],[70,26,55,36,"parse"],[70,31,55,41],[70,32,55,42,"data"],[70,36,55,46],[70,40,55,50],[70,44,55,54],[70,45,55,55],[71,12,56,20],[71,13,56,21],[71,14,57,20],[71,21,57,27,"err"],[71,24,57,30],[71,26,57,32],[72,14,58,24],[72,18,58,28,"response"],[72,26,58,36],[72,27,58,37,"ok"],[72,29,58,39],[72,31,59,28],[72,37,59,34,"err"],[72,40,59,37],[73,14,60,24,"data"],[73,18,60,28],[73,21,60,31],[74,16,60,33,"error"],[74,21,60,38],[74,23,60,40,"data"],[75,14,60,45],[75,15,60,46],[76,12,61,20],[77,10,62,16],[78,10,63,16],[78,14,63,20],[78,15,63,21,"response"],[78,23,63,29],[78,24,63,30,"ok"],[78,26,63,32],[78,28,63,34],[79,12,64,20],[79,18,64,26],[79,22,64,30,"HttpRequestError"],[79,38,64,46],[79,39,64,46,"HttpRequestError"],[79,55,64,46],[79,56,64,47],[80,14,65,24,"body"],[80,18,65,28],[81,14,66,24,"details"],[81,21,66,31],[81,23,66,33],[81,27,66,33,"stringify"],[81,39,66,42],[81,40,66,42,"stringify"],[81,49,66,42],[81,51,66,43,"data"],[81,55,66,47],[81,56,66,48,"error"],[81,61,66,53],[81,62,66,54],[81,66,66,58,"response"],[81,74,66,66],[81,75,66,67,"statusText"],[81,85,66,77],[82,14,67,24,"headers"],[82,21,67,31],[82,23,67,33,"response"],[82,31,67,41],[82,32,67,42,"headers"],[82,39,67,49],[83,14,68,24,"status"],[83,20,68,30],[83,22,68,32,"response"],[83,30,68,40],[83,31,68,41,"status"],[83,37,68,47],[84,14,69,24,"url"],[85,12,70,20],[85,13,70,21],[85,14,70,22],[86,10,71,16],[87,10,72,16],[87,17,72,23,"data"],[87,21,72,27],[88,8,73,12],[88,9,73,13],[88,10,74,12],[88,17,74,19,"err"],[88,20,74,22],[88,22,74,24],[89,10,75,16],[89,14,75,20,"err"],[89,17,75,23],[89,29,75,35,"HttpRequestError"],[89,45,75,51],[89,46,75,51,"HttpRequestError"],[89,62,75,51],[89,64,76,20],[89,70,76,26,"err"],[89,73,76,29],[90,10,77,16],[90,14,77,20,"err"],[90,17,77,23],[90,29,77,35,"TimeoutError"],[90,45,77,47],[90,46,77,47,"TimeoutError"],[90,58,77,47],[90,60,78,20],[90,66,78,26,"err"],[90,69,78,29],[91,10,79,16],[91,16,79,22],[91,20,79,26,"HttpRequestError"],[91,36,79,42],[91,37,79,42,"HttpRequestError"],[91,53,79,42],[91,54,79,43],[92,12,80,20,"body"],[92,16,80,24],[93,12,81,20,"cause"],[93,17,81,25],[93,19,81,27,"err"],[93,22,81,30],[94,12,82,20,"url"],[95,10,83,16],[95,11,83,17],[95,12,83,18],[96,8,84,12],[97,6,85,8],[98,4,86,4],[98,5,86,5],[99,2,87,0],[100,2,88,0],[101,2,89,7],[101,11,89,16,"parseUrl"],[101,19,89,24,"parseUrl"],[101,20,89,25,"url_"],[101,24,89,29],[101,26,89,31],[102,4,90,4],[102,8,90,8],[103,6,91,8],[103,12,91,14,"url"],[103,15,91,17],[103,18,91,20],[103,22,91,24,"URL"],[103,25,91,27],[103,26,91,28,"url_"],[103,30,91,32],[103,31,91,33],[104,6,92,8],[104,12,92,14,"result"],[104,18,92,20],[104,21,92,23],[104,22,92,24],[104,28,92,30],[105,8,93,12],[106,8,94,12],[106,12,94,16,"url"],[106,15,94,19],[106,16,94,20,"username"],[106,24,94,28],[106,26,94,30],[107,10,95,16],[107,16,95,22,"credentials"],[107,27,95,33],[107,30,95,36],[107,33,95,39,"decodeURIComponent"],[107,51,95,57],[107,52,95,58,"url"],[107,55,95,61],[107,56,95,62,"username"],[107,64,95,70],[107,65,95,71],[107,69,95,75,"decodeURIComponent"],[107,87,95,93],[107,88,95,94,"url"],[107,91,95,97],[107,92,95,98,"password"],[107,100,95,106],[107,101,95,107],[107,103,95,109],[108,10,96,16,"url"],[108,13,96,19],[108,14,96,20,"username"],[108,22,96,28],[108,25,96,31],[108,27,96,33],[109,10,97,16,"url"],[109,13,97,19],[109,14,97,20,"password"],[109,22,97,28],[109,25,97,31],[109,27,97,33],[110,10,98,16],[110,17,98,23],[111,12,99,20,"url"],[111,15,99,23],[111,17,99,25,"url"],[111,20,99,28],[111,21,99,29,"toString"],[111,29,99,37],[111,30,99,38],[111,31,99,39],[112,12,100,20,"headers"],[112,19,100,27],[112,21,100,29],[113,14,100,31,"Authorization"],[113,27,100,44],[113,29,100,46],[113,38,100,55,"btoa"],[113,42,100,59],[113,43,100,60,"credentials"],[113,54,100,71],[113,55,100,72],[114,12,100,75],[115,10,101,16],[115,11,101,17],[116,8,102,12],[117,8,103,12],[118,6,104,8],[118,7,104,9],[118,9,104,11],[118,10,104,12],[119,6,105,8],[119,13,105,8,"Object"],[119,19,105,8],[119,20,105,8,"assign"],[119,26,105,8],[120,8,105,17,"url"],[120,11,105,20],[120,13,105,22,"url"],[120,16,105,25],[120,17,105,26,"toString"],[120,25,105,34],[120,26,105,35],[121,6,105,36],[121,9,105,41,"result"],[121,15,105,47],[122,4,106,4],[122,5,106,5],[122,6,107,4],[122,12,107,10],[123,6,108,8],[123,13,108,15],[124,8,108,17,"url"],[124,11,108,20],[124,13,108,22,"url_"],[125,6,108,27],[125,7,108,28],[126,4,109,4],[127,2,110,0],[128,0,110,1],[128,3]],"functionMap":{"names":["<global>","getHttpRpcClient","request","withTimeout$argument_0","body.map$argument_0","parseUrl","<anonymous>"],"mappings":"AAA;OCI;QCG;mDCQ;iDCI;8BDI;iBDkB;SD2C;CDE;OKE;wBCG;SDY;CLM"},"hasCjsExports":false},"type":"js/module"}]}