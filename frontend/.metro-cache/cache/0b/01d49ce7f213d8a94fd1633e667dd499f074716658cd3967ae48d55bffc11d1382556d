{"dependencies":[{"name":"../../utils/getAction.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":53,"index":53}}],"key":"vt4scbNyA2t/tyY0oQJI6AZPJS4=","exportNames":["*"],"imports":1}},{"name":"../../utils/observe.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":54},"end":{"line":2,"column":49,"index":103}}],"key":"HKjcCKJVuiHtohOTQ78FBQFk94I=","exportNames":["*"],"imports":1}},{"name":"../../utils/poll.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":104},"end":{"line":3,"column":43,"index":147}}],"key":"Vy9/0HY5f9EZBKje2fl3cZrd9b0=","exportNames":["*"],"imports":1}},{"name":"../../utils/stringify.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":148},"end":{"line":4,"column":53,"index":201}}],"key":"hATh5RA/q0TQG1HzvPAqv2f5XM8=","exportNames":["*"],"imports":1}},{"name":"./createPendingTransactionFilter.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":202},"end":{"line":5,"column":85,"index":287}}],"key":"SrsJN+GiW+D96Ql0crywaG7cA2A=","exportNames":["*"],"imports":1}},{"name":"./getFilterChanges.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":288},"end":{"line":6,"column":57,"index":345}}],"key":"wjNQDF4/IGWZHpSGaDtBl05QJx8=","exportNames":["*"],"imports":1}},{"name":"./uninstallFilter.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":346},"end":{"line":7,"column":55,"index":401}}],"key":"4Ixra2lwclZlxAeICKfRfCpMyzY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.watchPendingTransactions = watchPendingTransactions;\n  var _utilsGetActionJs = require(_dependencyMap[0], \"../../utils/getAction.js\");\n  var _utilsObserveJs = require(_dependencyMap[1], \"../../utils/observe.js\");\n  var _utilsPollJs = require(_dependencyMap[2], \"../../utils/poll.js\");\n  var _utilsStringifyJs = require(_dependencyMap[3], \"../../utils/stringify.js\");\n  var _createPendingTransactionFilterJs = require(_dependencyMap[4], \"./createPendingTransactionFilter.js\");\n  var _getFilterChangesJs = require(_dependencyMap[5], \"./getFilterChanges.js\");\n  var _uninstallFilterJs = require(_dependencyMap[6], \"./uninstallFilter.js\");\n  /**\n   * Watches and returns pending transaction hashes.\n   *\n   * - Docs: https://viem.sh/docs/actions/public/watchPendingTransactions\n   * - JSON-RPC Methods:\n   *   - When `poll: true`\n   *     - Calls [`eth_newPendingTransactionFilter`](https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_newpendingtransactionfilter) to initialize the filter.\n   *     - Calls [`eth_getFilterChanges`](https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_getFilterChanges) on a polling interval.\n   *   - When `poll: false` & WebSocket Transport, uses a WebSocket subscription via [`eth_subscribe`](https://docs.alchemy.com/reference/eth-subscribe-polygon) and the `\"newPendingTransactions\"` event.\n   *\n   * This Action will batch up all the pending transactions found within the [`pollingInterval`](https://viem.sh/docs/actions/public/watchPendingTransactions#pollinginterval-optional), and invoke them via [`onTransactions`](https://viem.sh/docs/actions/public/watchPendingTransactions#ontransactions).\n   *\n   * @param client - Client to use\n   * @param parameters - {@link WatchPendingTransactionsParameters}\n   * @returns A function that can be invoked to stop watching for new pending transaction hashes. {@link WatchPendingTransactionsReturnType}\n   *\n   * @example\n   * import { createPublicClient, http } from 'viem'\n   * import { mainnet } from 'viem/chains'\n   * import { watchPendingTransactions } from 'viem/public'\n   *\n   * const client = createPublicClient({\n   *   chain: mainnet,\n   *   transport: http(),\n   * })\n   * const unwatch = await watchPendingTransactions(client, {\n   *   onTransactions: (hashes) => console.log(hashes),\n   * })\n   */\n  function watchPendingTransactions(client, {\n    batch = true,\n    onError,\n    onTransactions,\n    poll: poll_,\n    pollingInterval = client.pollingInterval\n  }) {\n    const enablePolling = typeof poll_ !== 'undefined' ? poll_ : client.transport.type !== 'webSocket' && client.transport.type !== 'ipc';\n    const pollPendingTransactions = () => {\n      const observerId = (0, _utilsStringifyJs.stringify)(['watchPendingTransactions', client.uid, batch, pollingInterval]);\n      return (0, _utilsObserveJs.observe)(observerId, {\n        onTransactions,\n        onError\n      }, emit => {\n        let filter;\n        const unwatch = (0, _utilsPollJs.poll)(async () => {\n          try {\n            if (!filter) {\n              try {\n                filter = await (0, _utilsGetActionJs.getAction)(client, _createPendingTransactionFilterJs.createPendingTransactionFilter, 'createPendingTransactionFilter')({});\n                return;\n              } catch (err) {\n                unwatch();\n                throw err;\n              }\n            }\n            const hashes = await (0, _utilsGetActionJs.getAction)(client, _getFilterChangesJs.getFilterChanges, 'getFilterChanges')({\n              filter\n            });\n            if (hashes.length === 0) return;\n            if (batch) emit.onTransactions(hashes);else for (const hash of hashes) emit.onTransactions([hash]);\n          } catch (err) {\n            emit.onError?.(err);\n          }\n        }, {\n          emitOnBegin: true,\n          interval: pollingInterval\n        });\n        return async () => {\n          if (filter) await (0, _utilsGetActionJs.getAction)(client, _uninstallFilterJs.uninstallFilter, 'uninstallFilter')({\n            filter\n          });\n          unwatch();\n        };\n      });\n    };\n    const subscribePendingTransactions = () => {\n      let active = true;\n      let unsubscribe = () => active = false;\n      (async () => {\n        try {\n          const {\n            unsubscribe: unsubscribe_\n          } = await client.transport.subscribe({\n            params: ['newPendingTransactions'],\n            onData(data) {\n              if (!active) return;\n              const transaction = data.result;\n              onTransactions([transaction]);\n            },\n            onError(error) {\n              onError?.(error);\n            }\n          });\n          unsubscribe = unsubscribe_;\n          if (!active) unsubscribe();\n        } catch (err) {\n          onError?.(err);\n        }\n      })();\n      return () => unsubscribe();\n    };\n    return enablePolling ? pollPendingTransactions() : subscribePendingTransactions();\n  }\n});","lineCount":118,"map":[[7,2,37,0,"exports"],[7,9,37,0],[7,10,37,0,"watchPendingTransactions"],[7,34,37,0],[7,37,37,0,"watchPendingTransactions"],[7,61,37,0],[8,2,1,0],[8,6,1,0,"_utilsGetActionJs"],[8,23,1,0],[8,26,1,0,"require"],[8,33,1,0],[8,34,1,0,"_dependencyMap"],[8,48,1,0],[9,2,2,0],[9,6,2,0,"_utilsObserveJs"],[9,21,2,0],[9,24,2,0,"require"],[9,31,2,0],[9,32,2,0,"_dependencyMap"],[9,46,2,0],[10,2,3,0],[10,6,3,0,"_utilsPollJs"],[10,18,3,0],[10,21,3,0,"require"],[10,28,3,0],[10,29,3,0,"_dependencyMap"],[10,43,3,0],[11,2,4,0],[11,6,4,0,"_utilsStringifyJs"],[11,23,4,0],[11,26,4,0,"require"],[11,33,4,0],[11,34,4,0,"_dependencyMap"],[11,48,4,0],[12,2,5,0],[12,6,5,0,"_createPendingTransactionFilterJs"],[12,39,5,0],[12,42,5,0,"require"],[12,49,5,0],[12,50,5,0,"_dependencyMap"],[12,64,5,0],[13,2,6,0],[13,6,6,0,"_getFilterChangesJs"],[13,25,6,0],[13,28,6,0,"require"],[13,35,6,0],[13,36,6,0,"_dependencyMap"],[13,50,6,0],[14,2,7,0],[14,6,7,0,"_uninstallFilterJs"],[14,24,7,0],[14,27,7,0,"require"],[14,34,7,0],[14,35,7,0,"_dependencyMap"],[14,49,7,0],[15,2,8,0],[16,0,9,0],[17,0,10,0],[18,0,11,0],[19,0,12,0],[20,0,13,0],[21,0,14,0],[22,0,15,0],[23,0,16,0],[24,0,17,0],[25,0,18,0],[26,0,19,0],[27,0,20,0],[28,0,21,0],[29,0,22,0],[30,0,23,0],[31,0,24,0],[32,0,25,0],[33,0,26,0],[34,0,27,0],[35,0,28,0],[36,0,29,0],[37,0,30,0],[38,0,31,0],[39,0,32,0],[40,0,33,0],[41,0,34,0],[42,0,35,0],[43,0,36,0],[44,2,37,7],[44,11,37,16,"watchPendingTransactions"],[44,35,37,40,"watchPendingTransactions"],[44,36,37,41,"client"],[44,42,37,47],[44,44,37,49],[45,4,37,51,"batch"],[45,9,37,56],[45,12,37,59],[45,16,37,63],[46,4,37,65,"onError"],[46,11,37,72],[47,4,37,74,"onTransactions"],[47,18,37,88],[48,4,37,90,"poll"],[48,8,37,94],[48,10,37,96,"poll_"],[48,15,37,101],[49,4,37,103,"pollingInterval"],[49,19,37,118],[49,22,37,121,"client"],[49,28,37,127],[49,29,37,128,"pollingInterval"],[50,2,37,145],[50,3,37,146],[50,5,37,148],[51,4,38,4],[51,10,38,10,"enablePolling"],[51,23,38,23],[51,26,38,26],[51,33,38,33,"poll_"],[51,38,38,38],[51,43,38,43],[51,54,38,54],[51,57,39,10,"poll_"],[51,62,39,15],[51,65,40,10,"client"],[51,71,40,16],[51,72,40,17,"transport"],[51,81,40,26],[51,82,40,27,"type"],[51,86,40,31],[51,91,40,36],[51,102,40,47],[51,106,40,51,"client"],[51,112,40,57],[51,113,40,58,"transport"],[51,122,40,67],[51,123,40,68,"type"],[51,127,40,72],[51,132,40,77],[51,137,40,82],[52,4,41,4],[52,10,41,10,"pollPendingTransactions"],[52,33,41,33],[52,36,41,36,"pollPendingTransactions"],[52,37,41,36],[52,42,41,42],[53,6,42,8],[53,12,42,14,"observerId"],[53,22,42,24],[53,25,42,27],[53,29,42,27,"stringify"],[53,46,42,36],[53,47,42,36,"stringify"],[53,56,42,36],[53,58,42,37],[53,59,43,12],[53,85,43,38],[53,87,44,12,"client"],[53,93,44,18],[53,94,44,19,"uid"],[53,97,44,22],[53,99,45,12,"batch"],[53,104,45,17],[53,106,46,12,"pollingInterval"],[53,121,46,27],[53,122,47,9],[53,123,47,10],[54,6,48,8],[54,13,48,15],[54,17,48,15,"observe"],[54,32,48,22],[54,33,48,22,"observe"],[54,40,48,22],[54,42,48,23,"observerId"],[54,52,48,33],[54,54,48,35],[55,8,48,37,"onTransactions"],[55,22,48,51],[56,8,48,53,"onError"],[57,6,48,61],[57,7,48,62],[57,9,48,65,"emit"],[57,13,48,69],[57,17,48,74],[58,8,49,12],[58,12,49,16,"filter"],[58,18,49,22],[59,8,50,12],[59,14,50,18,"unwatch"],[59,21,50,25],[59,24,50,28],[59,28,50,28,"poll"],[59,40,50,32],[59,41,50,32,"poll"],[59,45,50,32],[59,47,50,33],[59,59,50,45],[60,10,51,16],[60,14,51,20],[61,12,52,20],[61,16,52,24],[61,17,52,25,"filter"],[61,23,52,31],[61,25,52,33],[62,14,53,24],[62,18,53,28],[63,16,54,28,"filter"],[63,22,54,34],[63,25,54,37],[63,31,54,43],[63,35,54,43,"getAction"],[63,52,54,52],[63,53,54,52,"getAction"],[63,62,54,52],[63,64,54,53,"client"],[63,70,54,59],[63,72,54,61,"createPendingTransactionFilter"],[63,105,54,91],[63,106,54,91,"createPendingTransactionFilter"],[63,136,54,91],[63,138,54,93],[63,170,54,125],[63,171,54,126],[63,172,54,127],[63,173,54,128],[63,174,54,129],[63,175,54,130],[64,16,55,28],[65,14,56,24],[65,15,56,25],[65,16,57,24],[65,23,57,31,"err"],[65,26,57,34],[65,28,57,36],[66,16,58,28,"unwatch"],[66,23,58,35],[66,24,58,36],[66,25,58,37],[67,16,59,28],[67,22,59,34,"err"],[67,25,59,37],[68,14,60,24],[69,12,61,20],[70,12,62,20],[70,18,62,26,"hashes"],[70,24,62,32],[70,27,62,35],[70,33,62,41],[70,37,62,41,"getAction"],[70,54,62,50],[70,55,62,50,"getAction"],[70,64,62,50],[70,66,62,51,"client"],[70,72,62,57],[70,74,62,59,"getFilterChanges"],[70,93,62,75],[70,94,62,75,"getFilterChanges"],[70,110,62,75],[70,112,62,77],[70,130,62,95],[70,131,62,96],[70,132,62,97],[71,14,62,99,"filter"],[72,12,62,106],[72,13,62,107],[72,14,62,108],[73,12,63,20],[73,16,63,24,"hashes"],[73,22,63,30],[73,23,63,31,"length"],[73,29,63,37],[73,34,63,42],[73,35,63,43],[73,37,64,24],[74,12,65,20],[74,16,65,24,"batch"],[74,21,65,29],[74,23,66,24,"emit"],[74,27,66,28],[74,28,66,29,"onTransactions"],[74,42,66,43],[74,43,66,44,"hashes"],[74,49,66,50],[74,50,66,51],[74,51,66,52],[74,56,68,24],[74,61,68,29],[74,67,68,35,"hash"],[74,71,68,39],[74,75,68,43,"hashes"],[74,81,68,49],[74,83,69,28,"emit"],[74,87,69,32],[74,88,69,33,"onTransactions"],[74,102,69,47],[74,103,69,48],[74,104,69,49,"hash"],[74,108,69,53],[74,109,69,54],[74,110,69,55],[75,10,70,16],[75,11,70,17],[75,12,71,16],[75,19,71,23,"err"],[75,22,71,26],[75,24,71,28],[76,12,72,20,"emit"],[76,16,72,24],[76,17,72,25,"onError"],[76,24,72,32],[76,27,72,35,"err"],[76,30,72,38],[76,31,72,39],[77,10,73,16],[78,8,74,12],[78,9,74,13],[78,11,74,15],[79,10,75,16,"emitOnBegin"],[79,21,75,27],[79,23,75,29],[79,27,75,33],[80,10,76,16,"interval"],[80,18,76,24],[80,20,76,26,"pollingInterval"],[81,8,77,12],[81,9,77,13],[81,10,77,14],[82,8,78,12],[82,15,78,19],[82,27,78,31],[83,10,79,16],[83,14,79,20,"filter"],[83,20,79,26],[83,22,80,20],[83,28,80,26],[83,32,80,26,"getAction"],[83,49,80,35],[83,50,80,35,"getAction"],[83,59,80,35],[83,61,80,36,"client"],[83,67,80,42],[83,69,80,44,"uninstallFilter"],[83,87,80,59],[83,88,80,59,"uninstallFilter"],[83,103,80,59],[83,105,80,61],[83,122,80,78],[83,123,80,79],[83,124,80,80],[84,12,80,82,"filter"],[85,10,80,89],[85,11,80,90],[85,12,80,91],[86,10,81,16,"unwatch"],[86,17,81,23],[86,18,81,24],[86,19,81,25],[87,8,82,12],[87,9,82,13],[88,6,83,8],[88,7,83,9],[88,8,83,10],[89,4,84,4],[89,5,84,5],[90,4,85,4],[90,10,85,10,"subscribePendingTransactions"],[90,38,85,38],[90,41,85,41,"subscribePendingTransactions"],[90,42,85,41],[90,47,85,47],[91,6,86,8],[91,10,86,12,"active"],[91,16,86,18],[91,19,86,21],[91,23,86,25],[92,6,87,8],[92,10,87,12,"unsubscribe"],[92,21,87,23],[92,24,87,26,"unsubscribe"],[92,25,87,26],[92,30,87,33,"active"],[92,36,87,39],[92,39,87,42],[92,44,87,48],[93,6,88,8],[93,7,88,9],[93,19,88,21],[94,8,89,12],[94,12,89,16],[95,10,90,16],[95,16,90,22],[96,12,90,24,"unsubscribe"],[96,23,90,35],[96,25,90,37,"unsubscribe_"],[97,10,90,50],[97,11,90,51],[97,14,90,54],[97,20,90,60,"client"],[97,26,90,66],[97,27,90,67,"transport"],[97,36,90,76],[97,37,90,77,"subscribe"],[97,46,90,86],[97,47,90,87],[98,12,91,20,"params"],[98,18,91,26],[98,20,91,28],[98,21,91,29],[98,45,91,53],[98,46,91,54],[99,12,92,20,"onData"],[99,18,92,26,"onData"],[99,19,92,27,"data"],[99,23,92,31],[99,25,92,33],[100,14,93,24],[100,18,93,28],[100,19,93,29,"active"],[100,25,93,35],[100,27,94,28],[101,14,95,24],[101,20,95,30,"transaction"],[101,31,95,41],[101,34,95,44,"data"],[101,38,95,48],[101,39,95,49,"result"],[101,45,95,55],[102,14,96,24,"onTransactions"],[102,28,96,38],[102,29,96,39],[102,30,96,40,"transaction"],[102,41,96,51],[102,42,96,52],[102,43,96,53],[103,12,97,20],[103,13,97,21],[104,12,98,20,"onError"],[104,19,98,27,"onError"],[104,20,98,28,"error"],[104,25,98,33],[104,27,98,35],[105,14,99,24,"onError"],[105,21,99,31],[105,24,99,34,"error"],[105,29,99,39],[105,30,99,40],[106,12,100,20],[107,10,101,16],[107,11,101,17],[107,12,101,18],[108,10,102,16,"unsubscribe"],[108,21,102,27],[108,24,102,30,"unsubscribe_"],[108,36,102,42],[109,10,103,16],[109,14,103,20],[109,15,103,21,"active"],[109,21,103,27],[109,23,104,20,"unsubscribe"],[109,34,104,31],[109,35,104,32],[109,36,104,33],[110,8,105,12],[110,9,105,13],[110,10,106,12],[110,17,106,19,"err"],[110,20,106,22],[110,22,106,24],[111,10,107,16,"onError"],[111,17,107,23],[111,20,107,26,"err"],[111,23,107,29],[111,24,107,30],[112,8,108,12],[113,6,109,8],[113,7,109,9],[113,9,109,11],[113,10,109,12],[114,6,110,8],[114,13,110,15],[114,19,110,21,"unsubscribe"],[114,30,110,32],[114,31,110,33],[114,32,110,34],[115,4,111,4],[115,5,111,5],[116,4,112,4],[116,11,112,11,"enablePolling"],[116,24,112,24],[116,27,113,10,"pollPendingTransactions"],[116,50,113,33],[116,51,113,34],[116,52,113,35],[116,55,114,10,"subscribePendingTransactions"],[116,83,114,38],[116,84,114,39],[116,85,114,40],[117,2,115,0],[118,0,115,1],[118,3]],"functionMap":{"names":["<global>","watchPendingTransactions","pollPendingTransactions","observe$argument_2","poll$argument_0","<anonymous>","subscribePendingTransactions","unsubscribe","client.transport.subscribe$argument_0.onData","client.transport.subscribe$argument_0.onError"],"mappings":"AAA;OCoC;oCCI;gECO;iCCE;aDwB;mBEI;aFI;SDC;KDC;yCKC;0BCE,sBD;SDC;oBGI;qBHK;oBIC;qBJE;SCS;eDC,mBC;KLC;CDI"},"hasCjsExports":false},"type":"js/module"}]}