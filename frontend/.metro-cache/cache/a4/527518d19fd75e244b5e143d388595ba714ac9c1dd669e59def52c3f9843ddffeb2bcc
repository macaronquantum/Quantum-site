{"dependencies":[{"name":"../controllers/AccountController.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":72,"index":72}}],"key":"raxu2hnZ9hCXAXGKKedCSNk4kOw=","exportNames":["*"],"imports":1}},{"name":"../controllers/BlockchainApiController.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":73},"end":{"line":2,"column":84,"index":157}}],"key":"a0Gyip/3MT7Ik3+5DFMfpYkDURk=","exportNames":["*"],"imports":1}},{"name":"../controllers/ChainController.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":158},"end":{"line":3,"column":68,"index":226}}],"key":"/k9dnUgYQKzJovjmtDttxLYEwvk=","exportNames":["*"],"imports":1}},{"name":"../controllers/ConnectionController.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":227},"end":{"line":4,"column":78,"index":305}}],"key":"+QMPexp8lWQCy637Jx32pHeJqYY=","exportNames":["*"],"imports":1}},{"name":"./ERC7811Util.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":306},"end":{"line":5,"column":48,"index":354}}],"key":"ZNJBmEm3EWvQ4hdZiJVJNx6/Q0I=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"SendApiUtil\", {\n    enumerable: true,\n    get: function () {\n      return SendApiUtil;\n    }\n  });\n  var _controllersAccountControllerJs = require(_dependencyMap[0], \"../controllers/AccountController.js\");\n  var _controllersBlockchainApiControllerJs = require(_dependencyMap[1], \"../controllers/BlockchainApiController.js\");\n  var _controllersChainControllerJs = require(_dependencyMap[2], \"../controllers/ChainController.js\");\n  var _controllersConnectionControllerJs = require(_dependencyMap[3], \"../controllers/ConnectionController.js\");\n  var _ERC7811UtilJs = require(_dependencyMap[4], \"./ERC7811Util.js\");\n  // -- Controller ---------------------------------------- //\n  const SendApiUtil = {\n    async getMyTokensWithBalance(forceUpdate) {\n      const address = _controllersAccountControllerJs.AccountController.state.address;\n      const caipNetwork = _controllersChainControllerJs.ChainController.state.activeCaipNetwork;\n      if (!address || !caipNetwork) {\n        return [];\n      }\n      // Extract EIP-155 specific logic\n      if (caipNetwork.chainNamespace === 'eip155') {\n        const eip155Balances = await this.getEIP155Balances(address, caipNetwork);\n        if (eip155Balances) {\n          return this.filterLowQualityTokens(eip155Balances);\n        }\n      }\n      // Fallback to 1Inch API\n      const response = await _controllersBlockchainApiControllerJs.BlockchainApiController.getBalance(address, caipNetwork.caipNetworkId, forceUpdate);\n      return this.filterLowQualityTokens(response.balances);\n    },\n    async getEIP155Balances(address, caipNetwork) {\n      try {\n        const chainIdHex = _ERC7811UtilJs.ERC7811Utils.getChainIdHexFromCAIP2ChainId(caipNetwork.caipNetworkId);\n        const walletCapabilities = await _controllersConnectionControllerJs.ConnectionController.getCapabilities(address);\n        if (!walletCapabilities?.[chainIdHex]?.['assetDiscovery']?.supported) {\n          return null;\n        }\n        const walletGetAssetsResponse = await _controllersConnectionControllerJs.ConnectionController.walletGetAssets({\n          account: address,\n          chainFilter: [chainIdHex]\n        });\n        if (!_ERC7811UtilJs.ERC7811Utils.isWalletGetAssetsResponse(walletGetAssetsResponse)) {\n          return null;\n        }\n        const assets = walletGetAssetsResponse[chainIdHex] || [];\n        return assets.map(asset => _ERC7811UtilJs.ERC7811Utils.createBalance(asset, caipNetwork.caipNetworkId));\n      } catch (error) {\n        return null;\n      }\n    },\n    /**\n     * The 1Inch API includes many low-quality tokens in the balance response,\n     * which appear inconsistently. This filter prevents them from being displayed.\n     */\n    filterLowQualityTokens(balances) {\n      return balances.filter(balance => balance.quantity.decimals !== '0');\n    },\n    mapBalancesToSwapTokens(balances) {\n      return balances?.map(token => Object.assign({}, token, {\n        address: token?.address ? token.address : _controllersChainControllerJs.ChainController.getActiveNetworkTokenAddress(),\n        decimals: parseInt(token.quantity.decimals, 10),\n        logoUri: token.iconUrl,\n        eip2612: false\n      })) || [];\n    }\n  };\n});","lineCount":73,"map":[[7,2,7,0,"Object"],[7,8,7,0],[7,9,7,0,"defineProperty"],[7,23,7,0],[7,24,7,0,"exports"],[7,31,7,0],[8,4,7,0,"enumerable"],[8,14,7,0],[9,4,7,0,"get"],[9,7,7,0],[9,18,7,0,"get"],[9,19,7,0],[10,6,7,0],[10,13,7,0,"SendApiUtil"],[10,24,7,0],[11,4,7,0],[12,2,7,0],[13,2,1,0],[13,6,1,0,"_controllersAccountControllerJs"],[13,37,1,0],[13,40,1,0,"require"],[13,47,1,0],[13,48,1,0,"_dependencyMap"],[13,62,1,0],[14,2,2,0],[14,6,2,0,"_controllersBlockchainApiControllerJs"],[14,43,2,0],[14,46,2,0,"require"],[14,53,2,0],[14,54,2,0,"_dependencyMap"],[14,68,2,0],[15,2,3,0],[15,6,3,0,"_controllersChainControllerJs"],[15,35,3,0],[15,38,3,0,"require"],[15,45,3,0],[15,46,3,0,"_dependencyMap"],[15,60,3,0],[16,2,4,0],[16,6,4,0,"_controllersConnectionControllerJs"],[16,40,4,0],[16,43,4,0,"require"],[16,50,4,0],[16,51,4,0,"_dependencyMap"],[16,65,4,0],[17,2,5,0],[17,6,5,0,"_ERC7811UtilJs"],[17,20,5,0],[17,23,5,0,"require"],[17,30,5,0],[17,31,5,0,"_dependencyMap"],[17,45,5,0],[18,2,6,0],[19,2,7,7],[19,8,7,13,"SendApiUtil"],[19,19,7,24],[19,22,7,27],[20,4,8,4],[20,10,8,10,"getMyTokensWithBalance"],[20,32,8,32,"getMyTokensWithBalance"],[20,33,8,33,"forceUpdate"],[20,44,8,44],[20,46,8,46],[21,6,9,8],[21,12,9,14,"address"],[21,19,9,21],[21,22,9,24,"AccountController"],[21,53,9,41],[21,54,9,41,"AccountController"],[21,71,9,41],[21,72,9,42,"state"],[21,77,9,47],[21,78,9,48,"address"],[21,85,9,55],[22,6,10,8],[22,12,10,14,"caipNetwork"],[22,23,10,25],[22,26,10,28,"ChainController"],[22,55,10,43],[22,56,10,43,"ChainController"],[22,71,10,43],[22,72,10,44,"state"],[22,77,10,49],[22,78,10,50,"activeCaipNetwork"],[22,95,10,67],[23,6,11,8],[23,10,11,12],[23,11,11,13,"address"],[23,18,11,20],[23,22,11,24],[23,23,11,25,"caipNetwork"],[23,34,11,36],[23,36,11,38],[24,8,12,12],[24,15,12,19],[24,17,12,21],[25,6,13,8],[26,6,14,8],[27,6,15,8],[27,10,15,12,"caipNetwork"],[27,21,15,23],[27,22,15,24,"chainNamespace"],[27,36,15,38],[27,41,15,43],[27,49,15,51],[27,51,15,53],[28,8,16,12],[28,14,16,18,"eip155Balances"],[28,28,16,32],[28,31,16,35],[28,37,16,41],[28,41,16,45],[28,42,16,46,"getEIP155Balances"],[28,59,16,63],[28,60,16,64,"address"],[28,67,16,71],[28,69,16,73,"caipNetwork"],[28,80,16,84],[28,81,16,85],[29,8,17,12],[29,12,17,16,"eip155Balances"],[29,26,17,30],[29,28,17,32],[30,10,18,16],[30,17,18,23],[30,21,18,27],[30,22,18,28,"filterLowQualityTokens"],[30,44,18,50],[30,45,18,51,"eip155Balances"],[30,59,18,65],[30,60,18,66],[31,8,19,12],[32,6,20,8],[33,6,21,8],[34,6,22,8],[34,12,22,14,"response"],[34,20,22,22],[34,23,22,25],[34,29,22,31,"BlockchainApiController"],[34,66,22,54],[34,67,22,54,"BlockchainApiController"],[34,90,22,54],[34,91,22,55,"getBalance"],[34,101,22,65],[34,102,22,66,"address"],[34,109,22,73],[34,111,22,75,"caipNetwork"],[34,122,22,86],[34,123,22,87,"caipNetworkId"],[34,136,22,100],[34,138,22,102,"forceUpdate"],[34,149,22,113],[34,150,22,114],[35,6,23,8],[35,13,23,15],[35,17,23,19],[35,18,23,20,"filterLowQualityTokens"],[35,40,23,42],[35,41,23,43,"response"],[35,49,23,51],[35,50,23,52,"balances"],[35,58,23,60],[35,59,23,61],[36,4,24,4],[36,5,24,5],[37,4,25,4],[37,10,25,10,"getEIP155Balances"],[37,27,25,27,"getEIP155Balances"],[37,28,25,28,"address"],[37,35,25,35],[37,37,25,37,"caipNetwork"],[37,48,25,48],[37,50,25,50],[38,6,26,8],[38,10,26,12],[39,8,27,12],[39,14,27,18,"chainIdHex"],[39,24,27,28],[39,27,27,31,"ERC7811Utils"],[39,41,27,43],[39,42,27,43,"ERC7811Utils"],[39,54,27,43],[39,55,27,44,"getChainIdHexFromCAIP2ChainId"],[39,84,27,73],[39,85,27,74,"caipNetwork"],[39,96,27,85],[39,97,27,86,"caipNetworkId"],[39,110,27,99],[39,111,27,100],[40,8,28,12],[40,14,28,18,"walletCapabilities"],[40,32,28,36],[40,35,28,40],[40,41,28,46,"ConnectionController"],[40,75,28,66],[40,76,28,66,"ConnectionController"],[40,96,28,66],[40,97,28,67,"getCapabilities"],[40,112,28,82],[40,113,28,83,"address"],[40,120,28,90],[40,121,28,92],[41,8,29,12],[41,12,29,16],[41,13,29,17,"walletCapabilities"],[41,31,29,35],[41,34,29,38,"chainIdHex"],[41,44,29,48],[41,45,29,49],[41,48,29,52],[41,64,29,68],[41,65,29,69],[41,67,29,71,"supported"],[41,76,29,80],[41,78,29,82],[42,10,30,16],[42,17,30,23],[42,21,30,27],[43,8,31,12],[44,8,32,12],[44,14,32,18,"walletGetAssetsResponse"],[44,37,32,41],[44,40,32,44],[44,46,32,50,"ConnectionController"],[44,80,32,70],[44,81,32,70,"ConnectionController"],[44,101,32,70],[44,102,32,71,"walletGetAssets"],[44,117,32,86],[44,118,32,87],[45,10,33,16,"account"],[45,17,33,23],[45,19,33,25,"address"],[45,26,33,32],[46,10,34,16,"chainFilter"],[46,21,34,27],[46,23,34,29],[46,24,34,30,"chainIdHex"],[46,34,34,40],[47,8,35,12],[47,9,35,13],[47,10,35,14],[48,8,36,12],[48,12,36,16],[48,13,36,17,"ERC7811Utils"],[48,27,36,29],[48,28,36,29,"ERC7811Utils"],[48,40,36,29],[48,41,36,30,"isWalletGetAssetsResponse"],[48,66,36,55],[48,67,36,56,"walletGetAssetsResponse"],[48,90,36,79],[48,91,36,80],[48,93,36,82],[49,10,37,16],[49,17,37,23],[49,21,37,27],[50,8,38,12],[51,8,39,12],[51,14,39,18,"assets"],[51,20,39,24],[51,23,39,27,"walletGetAssetsResponse"],[51,46,39,50],[51,47,39,51,"chainIdHex"],[51,57,39,61],[51,58,39,62],[51,62,39,66],[51,64,39,68],[52,8,40,12],[52,15,40,19,"assets"],[52,21,40,25],[52,22,40,26,"map"],[52,25,40,29],[52,26,40,30,"asset"],[52,31,40,35],[52,35,40,39,"ERC7811Utils"],[52,49,40,51],[52,50,40,51,"ERC7811Utils"],[52,62,40,51],[52,63,40,52,"createBalance"],[52,76,40,65],[52,77,40,66,"asset"],[52,82,40,71],[52,84,40,73,"caipNetwork"],[52,95,40,84],[52,96,40,85,"caipNetworkId"],[52,109,40,98],[52,110,40,99],[52,111,40,100],[53,6,41,8],[53,7,41,9],[53,8,42,8],[53,15,42,15,"error"],[53,20,42,20],[53,22,42,22],[54,8,43,12],[54,15,43,19],[54,19,43,23],[55,6,44,8],[56,4,45,4],[56,5,45,5],[57,4,46,4],[58,0,47,0],[59,0,48,0],[60,0,49,0],[61,4,50,4,"filterLowQualityTokens"],[61,26,50,26,"filterLowQualityTokens"],[61,27,50,27,"balances"],[61,35,50,35],[61,37,50,37],[62,6,51,8],[62,13,51,15,"balances"],[62,21,51,23],[62,22,51,24,"filter"],[62,28,51,30],[62,29,51,31,"balance"],[62,36,51,38],[62,40,51,42,"balance"],[62,47,51,49],[62,48,51,50,"quantity"],[62,56,51,58],[62,57,51,59,"decimals"],[62,65,51,67],[62,70,51,72],[62,73,51,75],[62,74,51,76],[63,4,52,4],[63,5,52,5],[64,4,53,4,"mapBalancesToSwapTokens"],[64,27,53,27,"mapBalancesToSwapTokens"],[64,28,53,28,"balances"],[64,36,53,36],[64,38,53,38],[65,6,54,8],[65,13,54,16,"balances"],[65,21,54,24],[65,23,54,26,"map"],[65,26,54,29],[65,27,54,30,"token"],[65,32,54,35],[65,36,54,35,"Object"],[65,42,54,35],[65,43,54,35,"assign"],[65,49,54,35],[65,54,55,15,"token"],[65,59,55,20],[66,8,56,12,"address"],[66,15,56,19],[66,17,56,21,"token"],[66,22,56,26],[66,24,56,28,"address"],[66,31,56,35],[66,34,57,18,"token"],[66,39,57,23],[66,40,57,24,"address"],[66,47,57,31],[66,50,58,18,"ChainController"],[66,79,58,33],[66,80,58,33,"ChainController"],[66,95,58,33],[66,96,58,34,"getActiveNetworkTokenAddress"],[66,124,58,62],[66,125,58,63],[66,126,58,64],[67,8,59,12,"decimals"],[67,16,59,20],[67,18,59,22,"parseInt"],[67,26,59,30],[67,27,59,31,"token"],[67,32,59,36],[67,33,59,37,"quantity"],[67,41,59,45],[67,42,59,46,"decimals"],[67,50,59,54],[67,52,59,56],[67,54,59,58],[67,55,59,59],[68,8,60,12,"logoUri"],[68,15,60,19],[68,17,60,21,"token"],[68,22,60,26],[68,23,60,27,"iconUrl"],[68,30,60,34],[69,8,61,12,"eip2612"],[69,15,61,19],[69,17,61,21],[70,6,61,26],[70,8,62,10],[70,9,62,11],[70,13,62,15],[70,15,62,17],[71,4,63,4],[72,2,64,0],[72,3,64,1],[73,0,64,2],[73,3]],"functionMap":{"names":["<global>","getMyTokensWithBalance","getEIP155Balances","assets.map$argument_0","filterLowQualityTokens","balances.filter$argument_0","mapBalancesToSwapTokens","balances.map$argument_0"],"mappings":"AAA;ICO;KDgB;IEC;8BCe,qED;KFK;IIK;+BCC,4CD;KJC;IMC;8BCC;UDQ;KNC"},"hasCjsExports":false},"type":"js/module"}]}