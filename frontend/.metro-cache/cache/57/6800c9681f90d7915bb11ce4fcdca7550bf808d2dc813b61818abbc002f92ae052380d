{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"promiseCache\", {\n    enumerable: true,\n    get: function () {\n      return promiseCache;\n    }\n  });\n  Object.defineProperty(exports, \"responseCache\", {\n    enumerable: true,\n    get: function () {\n      return responseCache;\n    }\n  });\n  exports.getCache = getCache;\n  exports.withCache = withCache;\n  /** @internal */\n  const promiseCache = /*#__PURE__*/new Map();\n  /** @internal */\n  const responseCache = /*#__PURE__*/new Map();\n  function getCache(cacheKey) {\n    const buildCache = (cacheKey, cache) => ({\n      clear: () => cache.delete(cacheKey),\n      get: () => cache.get(cacheKey),\n      set: data => cache.set(cacheKey, data)\n    });\n    const promise = buildCache(cacheKey, promiseCache);\n    const response = buildCache(cacheKey, responseCache);\n    return {\n      clear: () => {\n        promise.clear();\n        response.clear();\n      },\n      promise,\n      response\n    };\n  }\n  /**\n   * @description Returns the result of a given promise, and caches the result for\n   * subsequent invocations against a provided cache key.\n   */\n  async function withCache(fn, {\n    cacheKey,\n    cacheTime = Number.POSITIVE_INFINITY\n  }) {\n    const cache = getCache(cacheKey);\n    // If a response exists in the cache, and it's not expired, return it\n    // and do not invoke the promise.\n    // If the max age is 0, the cache is disabled.\n    const response = cache.response.get();\n    if (response && cacheTime > 0) {\n      const age = Date.now() - response.created.getTime();\n      if (age < cacheTime) return response.data;\n    }\n    let promise = cache.promise.get();\n    if (!promise) {\n      promise = fn();\n      // Store the promise in the cache so that subsequent invocations\n      // will wait for the same promise to resolve (deduping).\n      cache.promise.set(promise);\n    }\n    try {\n      const data = await promise;\n      // Store the response in the cache so that subsequent invocations\n      // will return the same response.\n      cache.response.set({\n        created: new Date(),\n        data\n      });\n      return data;\n    } finally {\n      // Clear the promise cache so that subsequent invocations will\n      // invoke the promise again.\n      cache.promise.clear();\n    }\n  }\n});","lineCount":81,"map":[[7,2,2,0,"Object"],[7,8,2,0],[7,9,2,0,"defineProperty"],[7,23,2,0],[7,24,2,0,"exports"],[7,31,2,0],[8,4,2,0,"enumerable"],[8,14,2,0],[9,4,2,0,"get"],[9,7,2,0],[9,18,2,0,"get"],[9,19,2,0],[10,6,2,0],[10,13,2,0,"promiseCache"],[10,25,2,0],[11,4,2,0],[12,2,2,0],[13,2,4,0,"Object"],[13,8,4,0],[13,9,4,0,"defineProperty"],[13,23,4,0],[13,24,4,0,"exports"],[13,31,4,0],[14,4,4,0,"enumerable"],[14,14,4,0],[15,4,4,0,"get"],[15,7,4,0],[15,18,4,0,"get"],[15,19,4,0],[16,6,4,0],[16,13,4,0,"responseCache"],[16,26,4,0],[17,4,4,0],[18,2,4,0],[19,2,5,0,"exports"],[19,9,5,0],[19,10,5,0,"getCache"],[19,18,5,0],[19,21,5,0,"getCache"],[19,29,5,0],[20,2,26,0,"exports"],[20,9,26,0],[20,10,26,0,"withCache"],[20,19,26,0],[20,22,26,0,"withCache"],[20,31,26,0],[21,2,1,0],[22,2,2,7],[22,8,2,13,"promiseCache"],[22,20,2,25],[22,23,2,28],[22,36,2,42],[22,40,2,46,"Map"],[22,43,2,49],[22,44,2,50],[22,45,2,51],[23,2,3,0],[24,2,4,7],[24,8,4,13,"responseCache"],[24,21,4,26],[24,24,4,29],[24,37,4,43],[24,41,4,47,"Map"],[24,44,4,50],[24,45,4,51],[24,46,4,52],[25,2,5,7],[25,11,5,16,"getCache"],[25,19,5,24,"getCache"],[25,20,5,25,"cacheKey"],[25,28,5,33],[25,30,5,35],[26,4,6,4],[26,10,6,10,"buildCache"],[26,20,6,20],[26,23,6,23,"buildCache"],[26,24,6,24,"cacheKey"],[26,32,6,32],[26,34,6,34,"cache"],[26,39,6,39],[26,45,6,45],[27,6,7,8,"clear"],[27,11,7,13],[27,13,7,15,"clear"],[27,14,7,15],[27,19,7,21,"cache"],[27,24,7,26],[27,25,7,27,"delete"],[27,31,7,33],[27,32,7,34,"cacheKey"],[27,40,7,42],[27,41,7,43],[28,6,8,8,"get"],[28,9,8,11],[28,11,8,13,"get"],[28,12,8,13],[28,17,8,19,"cache"],[28,22,8,24],[28,23,8,25,"get"],[28,26,8,28],[28,27,8,29,"cacheKey"],[28,35,8,37],[28,36,8,38],[29,6,9,8,"set"],[29,9,9,11],[29,11,9,14,"data"],[29,15,9,18],[29,19,9,23,"cache"],[29,24,9,28],[29,25,9,29,"set"],[29,28,9,32],[29,29,9,33,"cacheKey"],[29,37,9,41],[29,39,9,43,"data"],[29,43,9,47],[30,4,10,4],[30,5,10,5],[30,6,10,6],[31,4,11,4],[31,10,11,10,"promise"],[31,17,11,17],[31,20,11,20,"buildCache"],[31,30,11,30],[31,31,11,31,"cacheKey"],[31,39,11,39],[31,41,11,41,"promiseCache"],[31,53,11,53],[31,54,11,54],[32,4,12,4],[32,10,12,10,"response"],[32,18,12,18],[32,21,12,21,"buildCache"],[32,31,12,31],[32,32,12,32,"cacheKey"],[32,40,12,40],[32,42,12,42,"responseCache"],[32,55,12,55],[32,56,12,56],[33,4,13,4],[33,11,13,11],[34,6,14,8,"clear"],[34,11,14,13],[34,13,14,15,"clear"],[34,14,14,15],[34,19,14,21],[35,8,15,12,"promise"],[35,15,15,19],[35,16,15,20,"clear"],[35,21,15,25],[35,22,15,26],[35,23,15,27],[36,8,16,12,"response"],[36,16,16,20],[36,17,16,21,"clear"],[36,22,16,26],[36,23,16,27],[36,24,16,28],[37,6,17,8],[37,7,17,9],[38,6,18,8,"promise"],[38,13,18,15],[39,6,19,8,"response"],[40,4,20,4],[40,5,20,5],[41,2,21,0],[42,2,22,0],[43,0,23,0],[44,0,24,0],[45,0,25,0],[46,2,26,7],[46,17,26,22,"withCache"],[46,26,26,31,"withCache"],[46,27,26,32,"fn"],[46,29,26,34],[46,31,26,36],[47,4,26,38,"cacheKey"],[47,12,26,46],[48,4,26,48,"cacheTime"],[48,13,26,57],[48,16,26,60,"Number"],[48,22,26,66],[48,23,26,67,"POSITIVE_INFINITY"],[49,2,26,85],[49,3,26,86],[49,5,26,88],[50,4,27,4],[50,10,27,10,"cache"],[50,15,27,15],[50,18,27,18,"getCache"],[50,26,27,26],[50,27,27,27,"cacheKey"],[50,35,27,35],[50,36,27,36],[51,4,28,4],[52,4,29,4],[53,4,30,4],[54,4,31,4],[54,10,31,10,"response"],[54,18,31,18],[54,21,31,21,"cache"],[54,26,31,26],[54,27,31,27,"response"],[54,35,31,35],[54,36,31,36,"get"],[54,39,31,39],[54,40,31,40],[54,41,31,41],[55,4,32,4],[55,8,32,8,"response"],[55,16,32,16],[55,20,32,20,"cacheTime"],[55,29,32,29],[55,32,32,32],[55,33,32,33],[55,35,32,35],[56,6,33,8],[56,12,33,14,"age"],[56,15,33,17],[56,18,33,20,"Date"],[56,22,33,24],[56,23,33,25,"now"],[56,26,33,28],[56,27,33,29],[56,28,33,30],[56,31,33,33,"response"],[56,39,33,41],[56,40,33,42,"created"],[56,47,33,49],[56,48,33,50,"getTime"],[56,55,33,57],[56,56,33,58],[56,57,33,59],[57,6,34,8],[57,10,34,12,"age"],[57,13,34,15],[57,16,34,18,"cacheTime"],[57,25,34,27],[57,27,35,12],[57,34,35,19,"response"],[57,42,35,27],[57,43,35,28,"data"],[57,47,35,32],[58,4,36,4],[59,4,37,4],[59,8,37,8,"promise"],[59,15,37,15],[59,18,37,18,"cache"],[59,23,37,23],[59,24,37,24,"promise"],[59,31,37,31],[59,32,37,32,"get"],[59,35,37,35],[59,36,37,36],[59,37,37,37],[60,4,38,4],[60,8,38,8],[60,9,38,9,"promise"],[60,16,38,16],[60,18,38,18],[61,6,39,8,"promise"],[61,13,39,15],[61,16,39,18,"fn"],[61,18,39,20],[61,19,39,21],[61,20,39,22],[62,6,40,8],[63,6,41,8],[64,6,42,8,"cache"],[64,11,42,13],[64,12,42,14,"promise"],[64,19,42,21],[64,20,42,22,"set"],[64,23,42,25],[64,24,42,26,"promise"],[64,31,42,33],[64,32,42,34],[65,4,43,4],[66,4,44,4],[66,8,44,8],[67,6,45,8],[67,12,45,14,"data"],[67,16,45,18],[67,19,45,21],[67,25,45,27,"promise"],[67,32,45,34],[68,6,46,8],[69,6,47,8],[70,6,48,8,"cache"],[70,11,48,13],[70,12,48,14,"response"],[70,20,48,22],[70,21,48,23,"set"],[70,24,48,26],[70,25,48,27],[71,8,48,29,"created"],[71,15,48,36],[71,17,48,38],[71,21,48,42,"Date"],[71,25,48,46],[71,26,48,47],[71,27,48,48],[72,8,48,50,"data"],[73,6,48,55],[73,7,48,56],[73,8,48,57],[74,6,49,8],[74,13,49,15,"data"],[74,17,49,19],[75,4,50,4],[75,5,50,5],[75,14,51,12],[76,6,52,8],[77,6,53,8],[78,6,54,8,"cache"],[78,11,54,13],[78,12,54,14,"promise"],[78,19,54,21],[78,20,54,22,"clear"],[78,25,54,27],[78,26,54,28],[78,27,54,29],[79,4,55,4],[80,2,56,0],[81,0,56,1],[81,3]],"functionMap":{"names":["<global>","getCache","buildCache","clear","get","set","withCache"],"mappings":"AAA;OCI;uBCC;eCC,4BD;aEC,yBF;aGC,mCH;MDC;eEI;SFG;CDI;OMK;CN8B"},"hasCjsExports":false},"type":"js/module"}]}