{"dependencies":[{"name":"./polling.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":122},"end":{"line":4,"column":44,"index":145}}],"key":"5ARmW/cSyTo7fOBnPh7VTK1e8ec=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.Fetch = void 0;\n  const polling_js_1 = require(_dependencyMap[0], \"./polling.js\");\n  /**\n   * HTTP long-polling based on the built-in `fetch()` method.\n   *\n   * Usage: browser, Node.js (since v18), Deno, Bun\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   * @see https://caniuse.com/fetch\n   * @see https://nodejs.org/api/globals.html#fetch\n   */\n  class Fetch extends polling_js_1.Polling {\n    doPoll() {\n      this._fetch().then(res => {\n        if (!res.ok) {\n          return this.onError(\"fetch read error\", res.status, res);\n        }\n        res.text().then(data => this.onData(data));\n      }).catch(err => {\n        this.onError(\"fetch read error\", err);\n      });\n    }\n    doWrite(data, callback) {\n      this._fetch(data).then(res => {\n        if (!res.ok) {\n          return this.onError(\"fetch write error\", res.status, res);\n        }\n        callback();\n      }).catch(err => {\n        this.onError(\"fetch write error\", err);\n      });\n    }\n    _fetch(data) {\n      var _a;\n      const isPost = data !== undefined;\n      const headers = new Headers(this.opts.extraHeaders);\n      if (isPost) {\n        headers.set(\"content-type\", \"text/plain;charset=UTF-8\");\n      }\n      (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.appendCookies(headers);\n      return fetch(this.uri(), {\n        method: isPost ? \"POST\" : \"GET\",\n        body: isPost ? data : null,\n        headers,\n        credentials: this.opts.withCredentials ? \"include\" : \"omit\"\n      }).then(res => {\n        var _a;\n        // @ts-ignore getSetCookie() was added in Node.js v19.7.0\n        (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(res.headers.getSetCookie());\n        return res;\n      });\n    }\n  }\n  exports.Fetch = Fetch;\n});","lineCount":61,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"Fetch"],[7,15,3,13],[7,18,3,16],[7,23,3,21],[7,24,3,22],[8,2,4,0],[8,8,4,6,"polling_js_1"],[8,20,4,18],[8,23,4,21,"require"],[8,30,4,28],[8,31,4,28,"_dependencyMap"],[8,45,4,28],[8,64,4,43],[8,65,4,44],[9,2,5,0],[10,0,6,0],[11,0,7,0],[12,0,8,0],[13,0,9,0],[14,0,10,0],[15,0,11,0],[16,0,12,0],[17,0,13,0],[18,2,14,0],[18,8,14,6,"Fetch"],[18,13,14,11],[18,22,14,20,"polling_js_1"],[18,34,14,32],[18,35,14,33,"Polling"],[18,42,14,40],[18,43,14,41],[19,4,15,4,"doPoll"],[19,10,15,10,"doPoll"],[19,11,15,10],[19,13,15,13],[20,6,16,8],[20,10,16,12],[20,11,16,13,"_fetch"],[20,17,16,19],[20,18,16,20],[20,19,16,21],[20,20,17,13,"then"],[20,24,17,17],[20,25,17,19,"res"],[20,28,17,22],[20,32,17,27],[21,8,18,12],[21,12,18,16],[21,13,18,17,"res"],[21,16,18,20],[21,17,18,21,"ok"],[21,19,18,23],[21,21,18,25],[22,10,19,16],[22,17,19,23],[22,21,19,27],[22,22,19,28,"onError"],[22,29,19,35],[22,30,19,36],[22,48,19,54],[22,50,19,56,"res"],[22,53,19,59],[22,54,19,60,"status"],[22,60,19,66],[22,62,19,68,"res"],[22,65,19,71],[22,66,19,72],[23,8,20,12],[24,8,21,12,"res"],[24,11,21,15],[24,12,21,16,"text"],[24,16,21,20],[24,17,21,21],[24,18,21,22],[24,19,21,23,"then"],[24,23,21,27],[24,24,21,29,"data"],[24,28,21,33],[24,32,21,38],[24,36,21,42],[24,37,21,43,"onData"],[24,43,21,49],[24,44,21,50,"data"],[24,48,21,54],[24,49,21,55],[24,50,21,56],[25,6,22,8],[25,7,22,9],[25,8,22,10],[25,9,23,13,"catch"],[25,14,23,18],[25,15,23,20,"err"],[25,18,23,23],[25,22,23,28],[26,8,24,12],[26,12,24,16],[26,13,24,17,"onError"],[26,20,24,24],[26,21,24,25],[26,39,24,43],[26,41,24,45,"err"],[26,44,24,48],[26,45,24,49],[27,6,25,8],[27,7,25,9],[27,8,25,10],[28,4,26,4],[29,4,27,4,"doWrite"],[29,11,27,11,"doWrite"],[29,12,27,12,"data"],[29,16,27,16],[29,18,27,18,"callback"],[29,26,27,26],[29,28,27,28],[30,6,28,8],[30,10,28,12],[30,11,28,13,"_fetch"],[30,17,28,19],[30,18,28,20,"data"],[30,22,28,24],[30,23,28,25],[30,24,29,13,"then"],[30,28,29,17],[30,29,29,19,"res"],[30,32,29,22],[30,36,29,27],[31,8,30,12],[31,12,30,16],[31,13,30,17,"res"],[31,16,30,20],[31,17,30,21,"ok"],[31,19,30,23],[31,21,30,25],[32,10,31,16],[32,17,31,23],[32,21,31,27],[32,22,31,28,"onError"],[32,29,31,35],[32,30,31,36],[32,49,31,55],[32,51,31,57,"res"],[32,54,31,60],[32,55,31,61,"status"],[32,61,31,67],[32,63,31,69,"res"],[32,66,31,72],[32,67,31,73],[33,8,32,12],[34,8,33,12,"callback"],[34,16,33,20],[34,17,33,21],[34,18,33,22],[35,6,34,8],[35,7,34,9],[35,8,34,10],[35,9,35,13,"catch"],[35,14,35,18],[35,15,35,20,"err"],[35,18,35,23],[35,22,35,28],[36,8,36,12],[36,12,36,16],[36,13,36,17,"onError"],[36,20,36,24],[36,21,36,25],[36,40,36,44],[36,42,36,46,"err"],[36,45,36,49],[36,46,36,50],[37,6,37,8],[37,7,37,9],[37,8,37,10],[38,4,38,4],[39,4,39,4,"_fetch"],[39,10,39,10,"_fetch"],[39,11,39,11,"data"],[39,15,39,15],[39,17,39,17],[40,6,40,8],[40,10,40,12,"_a"],[40,12,40,14],[41,6,41,8],[41,12,41,14,"isPost"],[41,18,41,20],[41,21,41,23,"data"],[41,25,41,27],[41,30,41,32,"undefined"],[41,39,41,41],[42,6,42,8],[42,12,42,14,"headers"],[42,19,42,21],[42,22,42,24],[42,26,42,28,"Headers"],[42,33,42,35],[42,34,42,36],[42,38,42,40],[42,39,42,41,"opts"],[42,43,42,45],[42,44,42,46,"extraHeaders"],[42,56,42,58],[42,57,42,59],[43,6,43,8],[43,10,43,12,"isPost"],[43,16,43,18],[43,18,43,20],[44,8,44,12,"headers"],[44,15,44,19],[44,16,44,20,"set"],[44,19,44,23],[44,20,44,24],[44,34,44,38],[44,36,44,40],[44,62,44,66],[44,63,44,67],[45,6,45,8],[46,6,46,8],[46,7,46,9,"_a"],[46,9,46,11],[46,12,46,14],[46,16,46,18],[46,17,46,19,"socket"],[46,23,46,25],[46,24,46,26,"_cookieJar"],[46,34,46,36],[46,40,46,42],[46,44,46,46],[46,48,46,50,"_a"],[46,50,46,52],[46,55,46,57],[46,60,46,62],[46,61,46,63],[46,64,46,66],[46,69,46,71],[46,70,46,72],[46,73,46,75,"_a"],[46,75,46,77],[46,76,46,78,"appendCookies"],[46,89,46,91],[46,90,46,92,"headers"],[46,97,46,99],[46,98,46,100],[47,6,47,8],[47,13,47,15,"fetch"],[47,18,47,20],[47,19,47,21],[47,23,47,25],[47,24,47,26,"uri"],[47,27,47,29],[47,28,47,30],[47,29,47,31],[47,31,47,33],[48,8,48,12,"method"],[48,14,48,18],[48,16,48,20,"isPost"],[48,22,48,26],[48,25,48,29],[48,31,48,35],[48,34,48,38],[48,39,48,43],[49,8,49,12,"body"],[49,12,49,16],[49,14,49,18,"isPost"],[49,20,49,24],[49,23,49,27,"data"],[49,27,49,31],[49,30,49,34],[49,34,49,38],[50,8,50,12,"headers"],[50,15,50,19],[51,8,51,12,"credentials"],[51,19,51,23],[51,21,51,25],[51,25,51,29],[51,26,51,30,"opts"],[51,30,51,34],[51,31,51,35,"withCredentials"],[51,46,51,50],[51,49,51,53],[51,58,51,62],[51,61,51,65],[52,6,52,8],[52,7,52,9],[52,8,52,10],[52,9,52,11,"then"],[52,13,52,15],[52,14,52,17,"res"],[52,17,52,20],[52,21,52,25],[53,8,53,12],[53,12,53,16,"_a"],[53,14,53,18],[54,8,54,12],[55,8,55,12],[55,9,55,13,"_a"],[55,11,55,15],[55,14,55,18],[55,18,55,22],[55,19,55,23,"socket"],[55,25,55,29],[55,26,55,30,"_cookieJar"],[55,36,55,40],[55,42,55,46],[55,46,55,50],[55,50,55,54,"_a"],[55,52,55,56],[55,57,55,61],[55,62,55,66],[55,63,55,67],[55,66,55,70],[55,71,55,75],[55,72,55,76],[55,75,55,79,"_a"],[55,77,55,81],[55,78,55,82,"parseCookies"],[55,90,55,94],[55,91,55,95,"res"],[55,94,55,98],[55,95,55,99,"headers"],[55,102,55,106],[55,103,55,107,"getSetCookie"],[55,115,55,119],[55,116,55,120],[55,117,55,121],[55,118,55,122],[56,8,56,12],[56,15,56,19,"res"],[56,18,56,22],[57,6,57,8],[57,7,57,9],[57,8,57,10],[58,4,58,4],[59,2,59,0],[60,2,60,0,"exports"],[60,9,60,7],[60,10,60,8,"Fetch"],[60,15,60,13],[60,18,60,16,"Fetch"],[60,23,60,21],[61,0,60,22],[61,3]],"functionMap":{"names":["<global>","Fetch","Fetch#doPoll","_fetch.then$argument_0","res.text.then$argument_0","_fetch.then._catch$argument_0","Fetch#doWrite","Fetch#_fetch","fetch.then$argument_0"],"mappings":"AAA;ACa;ICC;kBCE;4BCI,2BD;SDC;mBGC;SHE;KDC;IKC;kBHE;SGK;mBDC;SCE;KLC;IMC;gBCa;SDK;KNC;CDC"},"hasCjsExports":true},"type":"js/module"}]}