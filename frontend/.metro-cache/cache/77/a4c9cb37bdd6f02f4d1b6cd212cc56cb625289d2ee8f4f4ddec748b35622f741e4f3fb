{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":143},"end":{"line":4,"column":55,"index":177}}],"key":"Bu6PYP3hUl2jiacy+OFL3cCcZHs=","exportNames":["*"],"imports":1}},{"name":"../promise/withTimeout.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":25,"index":204},"end":{"line":5,"column":61,"index":240}}],"key":"5g95l8B8T7AMQE3X+f38j5e0oXU=","exportNames":["*"],"imports":1}},{"name":"../stringify.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":23,"index":265},"end":{"line":6,"column":49,"index":291}}],"key":"c7J+5OC/FhgscMnKu+PvVcdj6nc=","exportNames":["*"],"imports":1}},{"name":"./id.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":16,"index":309},"end":{"line":7,"column":34,"index":327}}],"key":"uUZ2DqYIOswcs+NHxztHkFKEPEc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.getHttpRpcClient = getHttpRpcClient;\n  const request_js_1 = require(_dependencyMap[0], \"../../errors/request.js\");\n  const withTimeout_js_1 = require(_dependencyMap[1], \"../promise/withTimeout.js\");\n  const stringify_js_1 = require(_dependencyMap[2], \"../stringify.js\");\n  const id_js_1 = require(_dependencyMap[3], \"./id.js\");\n  function getHttpRpcClient(url, options = {}) {\n    return {\n      async request(params) {\n        const {\n          body,\n          onRequest = options.onRequest,\n          onResponse = options.onResponse,\n          timeout = options.timeout ?? 10_000\n        } = params;\n        const fetchOptions = {\n          ...(options.fetchOptions ?? {}),\n          ...(params.fetchOptions ?? {})\n        };\n        const {\n          headers,\n          method,\n          signal: signal_\n        } = fetchOptions;\n        try {\n          const response = await (0, withTimeout_js_1.withTimeout)(async ({\n            signal\n          }) => {\n            const init = {\n              ...fetchOptions,\n              body: Array.isArray(body) ? (0, stringify_js_1.stringify)(body.map(body => ({\n                jsonrpc: '2.0',\n                id: body.id ?? id_js_1.idCache.take(),\n                ...body\n              }))) : (0, stringify_js_1.stringify)({\n                jsonrpc: '2.0',\n                id: body.id ?? id_js_1.idCache.take(),\n                ...body\n              }),\n              headers: {\n                'Content-Type': 'application/json',\n                ...headers\n              },\n              method: method || 'POST',\n              signal: signal_ || (timeout > 0 ? signal : null)\n            };\n            const request = new Request(url, init);\n            const args = (await onRequest?.(request, init)) ?? {\n              ...init,\n              url\n            };\n            const response = await fetch(args.url ?? url, args);\n            return response;\n          }, {\n            errorInstance: new request_js_1.TimeoutError({\n              body,\n              url\n            }),\n            timeout,\n            signal: true\n          });\n          if (onResponse) await onResponse(response);\n          let data;\n          if (response.headers.get('Content-Type')?.startsWith('application/json')) data = await response.json();else {\n            data = await response.text();\n            try {\n              data = JSON.parse(data || '{}');\n            } catch (err) {\n              if (response.ok) throw err;\n              data = {\n                error: data\n              };\n            }\n          }\n          if (!response.ok) {\n            throw new request_js_1.HttpRequestError({\n              body,\n              details: (0, stringify_js_1.stringify)(data.error) || response.statusText,\n              headers: response.headers,\n              status: response.status,\n              url\n            });\n          }\n          return data;\n        } catch (err) {\n          if (err instanceof request_js_1.HttpRequestError) throw err;\n          if (err instanceof request_js_1.TimeoutError) throw err;\n          throw new request_js_1.HttpRequestError({\n            body,\n            cause: err,\n            url\n          });\n        }\n      }\n    };\n  }\n});","lineCount":102,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"getHttpRpcClient"],[7,26,3,24],[7,29,3,27,"getHttpRpcClient"],[7,45,3,43],[8,2,4,0],[8,8,4,6,"request_js_1"],[8,20,4,18],[8,23,4,21,"require"],[8,30,4,28],[8,31,4,28,"_dependencyMap"],[8,45,4,28],[8,75,4,54],[8,76,4,55],[9,2,5,0],[9,8,5,6,"withTimeout_js_1"],[9,24,5,22],[9,27,5,25,"require"],[9,34,5,32],[9,35,5,32,"_dependencyMap"],[9,49,5,32],[9,81,5,60],[9,82,5,61],[10,2,6,0],[10,8,6,6,"stringify_js_1"],[10,22,6,20],[10,25,6,23,"require"],[10,32,6,30],[10,33,6,30,"_dependencyMap"],[10,47,6,30],[10,69,6,48],[10,70,6,49],[11,2,7,0],[11,8,7,6,"id_js_1"],[11,15,7,13],[11,18,7,16,"require"],[11,25,7,23],[11,26,7,23,"_dependencyMap"],[11,40,7,23],[11,54,7,33],[11,55,7,34],[12,2,8,0],[12,11,8,9,"getHttpRpcClient"],[12,27,8,25,"getHttpRpcClient"],[12,28,8,26,"url"],[12,31,8,29],[12,33,8,31,"options"],[12,40,8,38],[12,43,8,41],[12,44,8,42],[12,45,8,43],[12,47,8,45],[13,4,9,4],[13,11,9,11],[14,6,10,8],[14,12,10,14,"request"],[14,19,10,21,"request"],[14,20,10,22,"params"],[14,26,10,28],[14,28,10,30],[15,8,11,12],[15,14,11,18],[16,10,11,20,"body"],[16,14,11,24],[17,10,11,26,"onRequest"],[17,19,11,35],[17,22,11,38,"options"],[17,29,11,45],[17,30,11,46,"onRequest"],[17,39,11,55],[18,10,11,57,"onResponse"],[18,20,11,67],[18,23,11,70,"options"],[18,30,11,77],[18,31,11,78,"onResponse"],[18,41,11,88],[19,10,11,90,"timeout"],[19,17,11,97],[19,20,11,100,"options"],[19,27,11,107],[19,28,11,108,"timeout"],[19,35,11,115],[19,39,11,119],[20,8,11,127],[20,9,11,128],[20,12,11,131,"params"],[20,18,11,137],[21,8,12,12],[21,14,12,18,"fetchOptions"],[21,26,12,30],[21,29,12,33],[22,10,13,16],[22,14,13,20,"options"],[22,21,13,27],[22,22,13,28,"fetchOptions"],[22,34,13,40],[22,38,13,44],[22,39,13,45],[22,40,13,46],[22,41,13,47],[23,10,14,16],[23,14,14,20,"params"],[23,20,14,26],[23,21,14,27,"fetchOptions"],[23,33,14,39],[23,37,14,43],[23,38,14,44],[23,39,14,45],[24,8,15,12],[24,9,15,13],[25,8,16,12],[25,14,16,18],[26,10,16,20,"headers"],[26,17,16,27],[27,10,16,29,"method"],[27,16,16,35],[28,10,16,37,"signal"],[28,16,16,43],[28,18,16,45,"signal_"],[29,8,16,53],[29,9,16,54],[29,12,16,57,"fetchOptions"],[29,24,16,69],[30,8,17,12],[30,12,17,16],[31,10,18,16],[31,16,18,22,"response"],[31,24,18,30],[31,27,18,33],[31,33,18,39],[31,34,18,40],[31,35,18,41],[31,37,18,43,"withTimeout_js_1"],[31,53,18,59],[31,54,18,60,"withTimeout"],[31,65,18,71],[31,67,18,73],[31,74,18,80],[32,12,18,82,"signal"],[33,10,18,89],[33,11,18,90],[33,16,18,95],[34,12,19,20],[34,18,19,26,"init"],[34,22,19,30],[34,25,19,33],[35,14,20,24],[35,17,20,27,"fetchOptions"],[35,29,20,39],[36,14,21,24,"body"],[36,18,21,28],[36,20,21,30,"Array"],[36,25,21,35],[36,26,21,36,"isArray"],[36,33,21,43],[36,34,21,44,"body"],[36,38,21,48],[36,39,21,49],[36,42,22,30],[36,43,22,31],[36,44,22,32],[36,46,22,34,"stringify_js_1"],[36,60,22,48],[36,61,22,49,"stringify"],[36,70,22,58],[36,72,22,60,"body"],[36,76,22,64],[36,77,22,65,"map"],[36,80,22,68],[36,81,22,70,"body"],[36,85,22,74],[36,90,22,80],[37,16,23,32,"jsonrpc"],[37,23,23,39],[37,25,23,41],[37,30,23,46],[38,16,24,32,"id"],[38,18,24,34],[38,20,24,36,"body"],[38,24,24,40],[38,25,24,41,"id"],[38,27,24,43],[38,31,24,47,"id_js_1"],[38,38,24,54],[38,39,24,55,"idCache"],[38,46,24,62],[38,47,24,63,"take"],[38,51,24,67],[38,52,24,68],[38,53,24,69],[39,16,25,32],[39,19,25,35,"body"],[40,14,26,28],[40,15,26,29],[40,16,26,30],[40,17,26,31],[40,18,26,32],[40,21,27,30],[40,22,27,31],[40,23,27,32],[40,25,27,34,"stringify_js_1"],[40,39,27,48],[40,40,27,49,"stringify"],[40,49,27,58],[40,51,27,60],[41,16,28,32,"jsonrpc"],[41,23,28,39],[41,25,28,41],[41,30,28,46],[42,16,29,32,"id"],[42,18,29,34],[42,20,29,36,"body"],[42,24,29,40],[42,25,29,41,"id"],[42,27,29,43],[42,31,29,47,"id_js_1"],[42,38,29,54],[42,39,29,55,"idCache"],[42,46,29,62],[42,47,29,63,"take"],[42,51,29,67],[42,52,29,68],[42,53,29,69],[43,16,30,32],[43,19,30,35,"body"],[44,14,31,28],[44,15,31,29],[44,16,31,30],[45,14,32,24,"headers"],[45,21,32,31],[45,23,32,33],[46,16,33,28],[46,30,33,42],[46,32,33,44],[46,50,33,62],[47,16,34,28],[47,19,34,31,"headers"],[48,14,35,24],[48,15,35,25],[49,14,36,24,"method"],[49,20,36,30],[49,22,36,32,"method"],[49,28,36,38],[49,32,36,42],[49,38,36,48],[50,14,37,24,"signal"],[50,20,37,30],[50,22,37,32,"signal_"],[50,29,37,39],[50,34,37,44,"timeout"],[50,41,37,51],[50,44,37,54],[50,45,37,55],[50,48,37,58,"signal"],[50,54,37,64],[50,57,37,67],[50,61,37,71],[51,12,38,20],[51,13,38,21],[52,12,39,20],[52,18,39,26,"request"],[52,25,39,33],[52,28,39,36],[52,32,39,40,"Request"],[52,39,39,47],[52,40,39,48,"url"],[52,43,39,51],[52,45,39,53,"init"],[52,49,39,57],[52,50,39,58],[53,12,40,20],[53,18,40,26,"args"],[53,22,40,30],[53,25,40,33],[53,26,40,34],[53,32,40,40,"onRequest"],[53,41,40,49],[53,44,40,52,"request"],[53,51,40,59],[53,53,40,61,"init"],[53,57,40,65],[53,58,40,66],[53,63,40,71],[54,14,40,73],[54,17,40,76,"init"],[54,21,40,80],[55,14,40,82,"url"],[56,12,40,86],[56,13,40,87],[57,12,41,20],[57,18,41,26,"response"],[57,26,41,34],[57,29,41,37],[57,35,41,43,"fetch"],[57,40,41,48],[57,41,41,49,"args"],[57,45,41,53],[57,46,41,54,"url"],[57,49,41,57],[57,53,41,61,"url"],[57,56,41,64],[57,58,41,66,"args"],[57,62,41,70],[57,63,41,71],[58,12,42,20],[58,19,42,27,"response"],[58,27,42,35],[59,10,43,16],[59,11,43,17],[59,13,43,19],[60,12,44,20,"errorInstance"],[60,25,44,33],[60,27,44,35],[60,31,44,39,"request_js_1"],[60,43,44,51],[60,44,44,52,"TimeoutError"],[60,56,44,64],[60,57,44,65],[61,14,44,67,"body"],[61,18,44,71],[62,14,44,73,"url"],[63,12,44,77],[63,13,44,78],[63,14,44,79],[64,12,45,20,"timeout"],[64,19,45,27],[65,12,46,20,"signal"],[65,18,46,26],[65,20,46,28],[66,10,47,16],[66,11,47,17],[66,12,47,18],[67,10,48,16],[67,14,48,20,"onResponse"],[67,24,48,30],[67,26,49,20],[67,32,49,26,"onResponse"],[67,42,49,36],[67,43,49,37,"response"],[67,51,49,45],[67,52,49,46],[68,10,50,16],[68,14,50,20,"data"],[68,18,50,24],[69,10,51,16],[69,14,51,20,"response"],[69,22,51,28],[69,23,51,29,"headers"],[69,30,51,36],[69,31,51,37,"get"],[69,34,51,40],[69,35,51,41],[69,49,51,55],[69,50,51,56],[69,52,51,58,"startsWith"],[69,62,51,68],[69,63,51,69],[69,81,51,87],[69,82,51,88],[69,84,52,20,"data"],[69,88,52,24],[69,91,52,27],[69,97,52,33,"response"],[69,105,52,41],[69,106,52,42,"json"],[69,110,52,46],[69,111,52,47],[69,112,52,48],[69,113,52,49],[69,118,53,21],[70,12,54,20,"data"],[70,16,54,24],[70,19,54,27],[70,25,54,33,"response"],[70,33,54,41],[70,34,54,42,"text"],[70,38,54,46],[70,39,54,47],[70,40,54,48],[71,12,55,20],[71,16,55,24],[72,14,56,24,"data"],[72,18,56,28],[72,21,56,31,"JSON"],[72,25,56,35],[72,26,56,36,"parse"],[72,31,56,41],[72,32,56,42,"data"],[72,36,56,46],[72,40,56,50],[72,44,56,54],[72,45,56,55],[73,12,57,20],[73,13,57,21],[73,14,58,20],[73,21,58,27,"err"],[73,24,58,30],[73,26,58,32],[74,14,59,24],[74,18,59,28,"response"],[74,26,59,36],[74,27,59,37,"ok"],[74,29,59,39],[74,31,60,28],[74,37,60,34,"err"],[74,40,60,37],[75,14,61,24,"data"],[75,18,61,28],[75,21,61,31],[76,16,61,33,"error"],[76,21,61,38],[76,23,61,40,"data"],[77,14,61,45],[77,15,61,46],[78,12,62,20],[79,10,63,16],[80,10,64,16],[80,14,64,20],[80,15,64,21,"response"],[80,23,64,29],[80,24,64,30,"ok"],[80,26,64,32],[80,28,64,34],[81,12,65,20],[81,18,65,26],[81,22,65,30,"request_js_1"],[81,34,65,42],[81,35,65,43,"HttpRequestError"],[81,51,65,59],[81,52,65,60],[82,14,66,24,"body"],[82,18,66,28],[83,14,67,24,"details"],[83,21,67,31],[83,23,67,33],[83,24,67,34],[83,25,67,35],[83,27,67,37,"stringify_js_1"],[83,41,67,51],[83,42,67,52,"stringify"],[83,51,67,61],[83,53,67,63,"data"],[83,57,67,67],[83,58,67,68,"error"],[83,63,67,73],[83,64,67,74],[83,68,67,78,"response"],[83,76,67,86],[83,77,67,87,"statusText"],[83,87,67,97],[84,14,68,24,"headers"],[84,21,68,31],[84,23,68,33,"response"],[84,31,68,41],[84,32,68,42,"headers"],[84,39,68,49],[85,14,69,24,"status"],[85,20,69,30],[85,22,69,32,"response"],[85,30,69,40],[85,31,69,41,"status"],[85,37,69,47],[86,14,70,24,"url"],[87,12,71,20],[87,13,71,21],[87,14,71,22],[88,10,72,16],[89,10,73,16],[89,17,73,23,"data"],[89,21,73,27],[90,8,74,12],[90,9,74,13],[90,10,75,12],[90,17,75,19,"err"],[90,20,75,22],[90,22,75,24],[91,10,76,16],[91,14,76,20,"err"],[91,17,76,23],[91,29,76,35,"request_js_1"],[91,41,76,47],[91,42,76,48,"HttpRequestError"],[91,58,76,64],[91,60,77,20],[91,66,77,26,"err"],[91,69,77,29],[92,10,78,16],[92,14,78,20,"err"],[92,17,78,23],[92,29,78,35,"request_js_1"],[92,41,78,47],[92,42,78,48,"TimeoutError"],[92,54,78,60],[92,56,79,20],[92,62,79,26,"err"],[92,65,79,29],[93,10,80,16],[93,16,80,22],[93,20,80,26,"request_js_1"],[93,32,80,38],[93,33,80,39,"HttpRequestError"],[93,49,80,55],[93,50,80,56],[94,12,81,20,"body"],[94,16,81,24],[95,12,82,20,"cause"],[95,17,82,25],[95,19,82,27,"err"],[95,22,82,30],[96,12,83,20,"url"],[97,10,84,16],[97,11,84,17],[97,12,84,18],[98,8,85,12],[99,6,86,8],[100,4,87,4],[100,5,87,5],[101,2,88,0],[102,0,88,1],[102,3]],"functionMap":{"names":["<global>","getHttpRpcClient","request","<anonymous>","body.map$argument_0"],"mappings":"AAA;ACO;QCE;yECQ;qECI;8BDI;iBDiB;SD2C;CDE"},"hasCjsExports":true},"type":"js/module"}]}